(function(z,K){"object"===typeof exports&&"undefined"!==typeof module?module.exports=K():"function"===typeof define&&define.amd?define(K):(z="undefined"!==typeof globalThis?globalThis:z||self,z.igv=K())})(void 0,(function(){var z=[];var K=window.document;var ee=Object.getPrototypeOf;var te=z.slice;var ne=z.concat;var re=z.push;var ie=z.indexOf;var se={};var oe=se.toString;var ae=se.hasOwnProperty;var le=ae.toString;var ce=le.call(Object);var he={};var ue=function isFunction(z){return"function"===typeof z&&"number"!==typeof z.nodeType};var de=function isWindow(z){return null!=z&&z===z.window};var fe={type:true,src:true,noModule:true};function DOMEval(z,ee,te){ee=ee||K;var ne,re=ee.createElement("script");re.text=z;if(te)for(ne in fe)te[ne]&&(re[ne]=te[ne]);ee.head.appendChild(re).parentNode.removeChild(re)}function toType(z){return null==z?z+"":"object"===typeof z||"function"===typeof z?se[oe.call(z)]||"object":typeof z}var pe="3.3.1 -ajax,-ajax/jsonp,-ajax/load,-ajax/parseXML,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-event/ajax,-effects,-effects/Tween,-effects/animatedSelector",jQuery=function(z,K){return new jQuery.fn.init(z,K)},ge=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;jQuery.fn=jQuery.prototype={jquery:pe,constructor:jQuery,length:0,toArray:function(){return te.call(this)},get:function(z){return null==z?te.call(this):z<0?this[z+this.length]:this[z]},pushStack:function(z){var K=jQuery.merge(this.constructor(),z);K.prevObject=this;return K},each:function(z){return jQuery.each(this,z)},map:function(z){return this.pushStack(jQuery.map(this,(function(K,ee){return z.call(K,ee,K)})))},slice:function(){return this.pushStack(te.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(z){var K=this.length,ee=+z+(z<0?K:0);return this.pushStack(ee>=0&&ee<K?[this[ee]]:[])},end:function(){return this.prevObject||this.constructor()},push:re,sort:z.sort,splice:z.splice};jQuery.extend=jQuery.fn.extend=function(){var z,K,ee,te,ne,re,ie=arguments[0]||{},se=1,oe=arguments.length,ae=false;if("boolean"===typeof ie){ae=ie;ie=arguments[se]||{};se++}"object"===typeof ie||ue(ie)||(ie={});if(se===oe){ie=this;se--}for(;se<oe;se++)if(null!=(z=arguments[se]))for(K in z){ee=ie[K];te=z[K];if(ie!==te)if(ae&&te&&(jQuery.isPlainObject(te)||(ne=Array.isArray(te)))){if(ne){ne=false;re=ee&&Array.isArray(ee)?ee:[]}else re=ee&&jQuery.isPlainObject(ee)?ee:{};ie[K]=jQuery.extend(ae,re,te)}else void 0!==te&&(ie[K]=te)}return ie};jQuery.extend({expando:"jQuery"+(pe+Math.random()).replace(/\D/g,""),isReady:true,error:function(z){throw new Error(z)},noop:function(){},isPlainObject:function(z){var K,te;if(!z||"[object Object]"!==oe.call(z))return false;K=ee(z);if(!K)return true;te=ae.call(K,"constructor")&&K.constructor;return"function"===typeof te&&le.call(te)===ce},isEmptyObject:function(z){var K;for(K in z)return false;return true},globalEval:function(z){DOMEval(z)},each:function(z,K){var ee,te=0;if(isArrayLike(z)){ee=z.length;for(;te<ee;te++)if(false===K.call(z[te],te,z[te]))break}else for(te in z)if(false===K.call(z[te],te,z[te]))break;return z},trim:function(z){return null==z?"":(z+"").replace(ge,"")},makeArray:function(z,K){var ee=K||[];null!=z&&(isArrayLike(Object(z))?jQuery.merge(ee,"string"===typeof z?[z]:z):re.call(ee,z));return ee},inArray:function(z,K,ee){return null==K?-1:ie.call(K,z,ee)},merge:function(z,K){var ee=+K.length,te=0,ne=z.length;for(;te<ee;te++)z[ne++]=K[te];z.length=ne;return z},grep:function(z,K,ee){var te,ne=[],re=0,ie=z.length,se=!ee;for(;re<ie;re++){te=!K(z[re],re);te!==se&&ne.push(z[re])}return ne},map:function(z,K,ee){var te,re,ie=0,se=[];if(isArrayLike(z)){te=z.length;for(;ie<te;ie++){re=K(z[ie],ie,ee);null!=re&&se.push(re)}}else for(ie in z){re=K(z[ie],ie,ee);null!=re&&se.push(re)}return ne.apply([],se)},guid:1,support:he});"function"===typeof Symbol&&(jQuery.fn[Symbol.iterator]=z[Symbol.iterator]);jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(z,K){se["[object "+K+"]"]=K.toLowerCase()}));function isArrayLike(z){var K=!!z&&"length"in z&&z.length,ee=toType(z);return!ue(z)&&!de(z)&&("array"===ee||0===K||"number"===typeof K&&K>0&&K-1 in z)}var me=function(z){var K,ee,te,ne,re,ie,se,oe,ae,le,ce,he,ue,de,fe,pe,ge,me,be,ve="sizzle"+1*new Date,we=z.document,ye=0,_e=0,ke=createCache(),xe=createCache(),Ce=createCache(),sortOrder=function(z,K){z===K&&(ce=true);return 0},Se={}.hasOwnProperty,Ae=[],Te=Ae.pop,Ee=Ae.push,Me=Ae.push,Re=Ae.slice,indexOf=function(z,K){var ee=0,te=z.length;for(;ee<te;ee++)if(z[ee]===K)return ee;return-1},Ie="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Fe="[\\x20\\t\\r\\n\\f]",Le="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",Be="\\["+Fe+"*("+Le+")(?:"+Fe+"*([*^$|!~]?=)"+Fe+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+Le+"))|)"+Fe+"*\\]",Ne=":("+Le+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+Be+")*)|.*)\\)|)",De=new RegExp(Fe+"+","g"),Pe=new RegExp("^"+Fe+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Fe+"+$","g"),Oe=new RegExp("^"+Fe+"*,"+Fe+"*"),ze=new RegExp("^"+Fe+"*([>+~]|"+Fe+")"+Fe+"*"),He=new RegExp("="+Fe+"*([^\\]'\"]*?)"+Fe+"*\\]","g"),Ue=new RegExp(Ne),Ve=new RegExp("^"+Le+"$"),$e={ID:new RegExp("^#("+Le+")"),CLASS:new RegExp("^\\.("+Le+")"),TAG:new RegExp("^("+Le+"|[*])"),ATTR:new RegExp("^"+Be),PSEUDO:new RegExp("^"+Ne),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Fe+"*(even|odd|(([+-]|)(\\d*)n|)"+Fe+"*(?:([+-]|)"+Fe+"*(\\d+)|))"+Fe+"*\\)|)","i"),bool:new RegExp("^(?:"+Ie+")$","i"),needsContext:new RegExp("^"+Fe+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Fe+"*((?:-\\d)?\\d*)"+Fe+"*\\)|)(?=[^-]|$)","i")},qe=/^(?:input|select|textarea|button)$/i,je=/^h\d$/i,We=/^[^{]+\{\s*\[native \w/,Ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ze=/[+~]/,Qe=new RegExp("\\\\([\\da-f]{1,6}"+Fe+"?|("+Fe+")|.)","ig"),funescape=function(z,K,ee){var te="0x"+K-65536;return te!==te||ee?K:te<0?String.fromCharCode(te+65536):String.fromCharCode(te>>10|55296,1023&te|56320)},Xe=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(z,K){return K?"\0"===z?"ï¿½":z.slice(0,-1)+"\\"+z.charCodeAt(z.length-1).toString(16)+" ":"\\"+z},unloadHandler=function(){he()},Ye=addCombinator((function(z){return true===z.disabled&&("form"in z||"label"in z)}),{dir:"parentNode",next:"legend"});try{Me.apply(Ae=Re.call(we.childNodes),we.childNodes);Ae[we.childNodes.length].nodeType}catch(z){Me={apply:Ae.length?function(z,K){Ee.apply(z,Re.call(K))}:function(z,K){var ee=z.length,te=0;while(z[ee++]=K[te++]);z.length=ee-1}}}function Sizzle(z,K,te,ne){var re,se,ae,le,ce,de,ge,me=K&&K.ownerDocument,ye=K?K.nodeType:9;te=te||[];if("string"!==typeof z||!z||1!==ye&&9!==ye&&11!==ye)return te;if(!ne){(K?K.ownerDocument||K:we)!==ue&&he(K);K=K||ue;if(fe){if(11!==ye&&(ce=Ge.exec(z)))if(re=ce[1]){if(9===ye){if(!(ae=K.getElementById(re)))return te;if(ae.id===re){te.push(ae);return te}}else if(me&&(ae=me.getElementById(re))&&be(K,ae)&&ae.id===re){te.push(ae);return te}}else{if(ce[2]){Me.apply(te,K.getElementsByTagName(z));return te}if((re=ce[3])&&ee.getElementsByClassName&&K.getElementsByClassName){Me.apply(te,K.getElementsByClassName(re));return te}}if(ee.qsa&&!Ce[z+" "]&&(!pe||!pe.test(z))){if(1!==ye){me=K;ge=z}else if("object"!==K.nodeName.toLowerCase()){(le=K.getAttribute("id"))?le=le.replace(Xe,fcssescape):K.setAttribute("id",le=ve);de=ie(z);se=de.length;while(se--)de[se]="#"+le+" "+toSelector(de[se]);ge=de.join(",");me=Ze.test(z)&&testContext(K.parentNode)||K}if(ge)try{Me.apply(te,me.querySelectorAll(ge));return te}catch(z){}finally{le===ve&&K.removeAttribute("id")}}}}return oe(z.replace(Pe,"$1"),K,te,ne)}
/**
             * Create key-value caches of limited size
             * @returns {function(string, object)} Returns the Object data after storing it on itself with
             *    property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
             *    deleting the oldest entry
             */function createCache(){var z=[];function cache(K,ee){z.push(K+" ")>te.cacheLength&&delete cache[z.shift()];return cache[K+" "]=ee}return cache}
/**
             * Mark a function for special use by Sizzle
             * @param {Function} fn The function to mark
             */function markFunction(z){z[ve]=true;return z}
/**
             * Support testing using an element
             * @param {Function} fn Passed the created element and returns a boolean result
             */function assert(z){var K=ue.createElement("fieldset");try{return!!z(K)}catch(z){return false}finally{K.parentNode&&K.parentNode.removeChild(K);K=null}}
/**
             * Checks document order of two siblings
             * @param {Element} a
             * @param {Element} b
             * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
             */function siblingCheck(z,K){var ee=K&&z,te=ee&&1===z.nodeType&&1===K.nodeType&&z.sourceIndex-K.sourceIndex;if(te)return te;if(ee)while(ee=ee.nextSibling)if(ee===K)return-1;return z?1:-1}
/**
             * Returns a function to use in pseudos for input types
             * @param {String} type
             */function createInputPseudo(z){return function(K){var ee=K.nodeName.toLowerCase();return"input"===ee&&K.type===z}}
/**
             * Returns a function to use in pseudos for buttons
             * @param {String} type
             */function createButtonPseudo(z){return function(K){var ee=K.nodeName.toLowerCase();return("input"===ee||"button"===ee)&&K.type===z}}
/**
             * Returns a function to use in pseudos for :enabled/:disabled
             * @param {Boolean} disabled true for :disabled; false for :enabled
             */function createDisabledPseudo(z){return function(K){return"form"in K?K.parentNode&&false===K.disabled?"label"in K?"label"in K.parentNode?K.parentNode.disabled===z:K.disabled===z:K.isDisabled===z||K.isDisabled!==!z&&Ye(K)===z:K.disabled===z:"label"in K&&K.disabled===z}}
/**
             * Returns a function to use in pseudos for positionals
             * @param {Function} fn
             */function createPositionalPseudo(z){return markFunction((function(K){K=+K;return markFunction((function(ee,te){var ne,re=z([],ee.length,K),ie=re.length;while(ie--)ee[ne=re[ie]]&&(ee[ne]=!(te[ne]=ee[ne]))}))}))}
/**
             * Checks a node for validity as a Sizzle context
             * @param {Element|Object=} context
             * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value
             */function testContext(z){return z&&"undefined"!==typeof z.getElementsByTagName&&z}ee=Sizzle.support={};
/**
             * Detects XML nodes
             * @param {Element|Object} elem An element or a document
             * @returns {Boolean} True iff elem is a non-HTML XML node
             */re=Sizzle.isXML=function(z){var K=z&&(z.ownerDocument||z).documentElement;return!!K&&"HTML"!==K.nodeName};
/**
             * Sets document-related variables once based on the current document
             * @param {Element|Object} [doc] An element or document object to use to set the document
             * @returns {Object} Returns the current document
             */he=Sizzle.setDocument=function(z){var K,ne,ie=z?z.ownerDocument||z:we;if(ie===ue||9!==ie.nodeType||!ie.documentElement)return ue;ue=ie;de=ue.documentElement;fe=!re(ue);we!==ue&&(ne=ue.defaultView)&&ne.top!==ne&&(ne.addEventListener?ne.addEventListener("unload",unloadHandler,false):ne.attachEvent&&ne.attachEvent("onunload",unloadHandler));ee.attributes=assert((function(z){z.className="i";return!z.getAttribute("className")}));ee.getElementsByTagName=assert((function(z){z.appendChild(ue.createComment(""));return!z.getElementsByTagName("*").length}));ee.getElementsByClassName=We.test(ue.getElementsByClassName);ee.getById=assert((function(z){de.appendChild(z).id=ve;return!ue.getElementsByName||!ue.getElementsByName(ve).length}));if(ee.getById){te.filter.ID=function(z){var K=z.replace(Qe,funescape);return function(z){return z.getAttribute("id")===K}};te.find.ID=function(z,K){if("undefined"!==typeof K.getElementById&&fe){var ee=K.getElementById(z);return ee?[ee]:[]}}}else{te.filter.ID=function(z){var K=z.replace(Qe,funescape);return function(z){var ee="undefined"!==typeof z.getAttributeNode&&z.getAttributeNode("id");return ee&&ee.value===K}};te.find.ID=function(z,K){if("undefined"!==typeof K.getElementById&&fe){var ee,te,ne,re=K.getElementById(z);if(re){ee=re.getAttributeNode("id");if(ee&&ee.value===z)return[re];ne=K.getElementsByName(z);te=0;while(re=ne[te++]){ee=re.getAttributeNode("id");if(ee&&ee.value===z)return[re]}}return[]}}}te.find.TAG=ee.getElementsByTagName?function(z,K){return"undefined"!==typeof K.getElementsByTagName?K.getElementsByTagName(z):ee.qsa?K.querySelectorAll(z):void 0}:function(z,K){var ee,te=[],ne=0,re=K.getElementsByTagName(z);if("*"===z){while(ee=re[ne++])1===ee.nodeType&&te.push(ee);return te}return re};te.find.CLASS=ee.getElementsByClassName&&function(z,K){if("undefined"!==typeof K.getElementsByClassName&&fe)return K.getElementsByClassName(z)};ge=[];pe=[];if(ee.qsa=We.test(ue.querySelectorAll)){assert((function(z){de.appendChild(z).innerHTML="<a id='"+ve+"'></a><select id='"+ve+"-\r\\' msallowcapture=''><option selected=''></option></select>";z.querySelectorAll("[msallowcapture^='']").length&&pe.push("[*^$]="+Fe+"*(?:''|\"\")");z.querySelectorAll("[selected]").length||pe.push("\\["+Fe+"*(?:value|"+Ie+")");z.querySelectorAll("[id~="+ve+"-]").length||pe.push("~=");z.querySelectorAll(":checked").length||pe.push(":checked");z.querySelectorAll("a#"+ve+"+*").length||pe.push(".#.+[+~]")}));assert((function(z){z.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var K=ue.createElement("input");K.setAttribute("type","hidden");z.appendChild(K).setAttribute("name","D");z.querySelectorAll("[name=d]").length&&pe.push("name"+Fe+"*[*^$|!~]?=");2!==z.querySelectorAll(":enabled").length&&pe.push(":enabled",":disabled");de.appendChild(z).disabled=true;2!==z.querySelectorAll(":disabled").length&&pe.push(":enabled",":disabled");z.querySelectorAll("*,:x");pe.push(",.*:")}))}(ee.matchesSelector=We.test(me=de.matches||de.webkitMatchesSelector||de.mozMatchesSelector||de.oMatchesSelector||de.msMatchesSelector))&&assert((function(z){ee.disconnectedMatch=me.call(z,"*");me.call(z,"[s!='']:x");ge.push("!=",Ne)}));pe=pe.length&&new RegExp(pe.join("|"));ge=ge.length&&new RegExp(ge.join("|"));K=We.test(de.compareDocumentPosition);be=K||We.test(de.contains)?function(z,K){var ee=9===z.nodeType?z.documentElement:z,te=K&&K.parentNode;return z===te||!!(te&&1===te.nodeType&&(ee.contains?ee.contains(te):z.compareDocumentPosition&&16&z.compareDocumentPosition(te)))}:function(z,K){if(K)while(K=K.parentNode)if(K===z)return true;return false};sortOrder=K?function(z,K){if(z===K){ce=true;return 0}var te=!z.compareDocumentPosition-!K.compareDocumentPosition;if(te)return te;te=(z.ownerDocument||z)===(K.ownerDocument||K)?z.compareDocumentPosition(K):1;return 1&te||!ee.sortDetached&&K.compareDocumentPosition(z)===te?z===ue||z.ownerDocument===we&&be(we,z)?-1:K===ue||K.ownerDocument===we&&be(we,K)?1:le?indexOf(le,z)-indexOf(le,K):0:4&te?-1:1}:function(z,K){if(z===K){ce=true;return 0}var ee,te=0,ne=z.parentNode,re=K.parentNode,ie=[z],se=[K];if(!ne||!re)return z===ue?-1:K===ue?1:ne?-1:re?1:le?indexOf(le,z)-indexOf(le,K):0;if(ne===re)return siblingCheck(z,K);ee=z;while(ee=ee.parentNode)ie.unshift(ee);ee=K;while(ee=ee.parentNode)se.unshift(ee);while(ie[te]===se[te])te++;return te?siblingCheck(ie[te],se[te]):ie[te]===we?-1:se[te]===we?1:0};return ue};Sizzle.matches=function(z,K){return Sizzle(z,null,null,K)};Sizzle.matchesSelector=function(z,K){(z.ownerDocument||z)!==ue&&he(z);K=K.replace(He,"='$1']");if(ee.matchesSelector&&fe&&!Ce[K+" "]&&(!ge||!ge.test(K))&&(!pe||!pe.test(K)))try{var te=me.call(z,K);if(te||ee.disconnectedMatch||z.document&&11!==z.document.nodeType)return te}catch(z){}return Sizzle(K,ue,null,[z]).length>0};Sizzle.contains=function(z,K){(z.ownerDocument||z)!==ue&&he(z);return be(z,K)};Sizzle.attr=function(z,K){(z.ownerDocument||z)!==ue&&he(z);var ne=te.attrHandle[K.toLowerCase()],re=ne&&Se.call(te.attrHandle,K.toLowerCase())?ne(z,K,!fe):void 0;return void 0!==re?re:ee.attributes||!fe?z.getAttribute(K):(re=z.getAttributeNode(K))&&re.specified?re.value:null};Sizzle.escape=function(z){return(z+"").replace(Xe,fcssescape)};Sizzle.error=function(z){throw new Error("Syntax error, unrecognized expression: "+z)};
/**
             * Document sorting and removing duplicates
             * @param {ArrayLike} results
             */Sizzle.uniqueSort=function(z){var K,te=[],ne=0,re=0;ce=!ee.detectDuplicates;le=!ee.sortStable&&z.slice(0);z.sort(sortOrder);if(ce){while(K=z[re++])K===z[re]&&(ne=te.push(re));while(ne--)z.splice(te[ne],1)}le=null;return z};
/**
             * Utility function for retrieving the text value of an array of DOM nodes
             * @param {Array|Element} elem
             */ne=Sizzle.getText=function(z){var K,ee="",te=0,re=z.nodeType;if(re){if(1===re||9===re||11===re){if("string"===typeof z.textContent)return z.textContent;for(z=z.firstChild;z;z=z.nextSibling)ee+=ne(z)}else if(3===re||4===re)return z.nodeValue}else while(K=z[te++])ee+=ne(K);return ee};te=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:$e,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(z){z[1]=z[1].replace(Qe,funescape);z[3]=(z[3]||z[4]||z[5]||"").replace(Qe,funescape);"~="===z[2]&&(z[3]=" "+z[3]+" ");return z.slice(0,4)},CHILD:function(z){z[1]=z[1].toLowerCase();if("nth"===z[1].slice(0,3)){z[3]||Sizzle.error(z[0]);z[4]=+(z[4]?z[5]+(z[6]||1):2*("even"===z[3]||"odd"===z[3]));z[5]=+(z[7]+z[8]||"odd"===z[3])}else z[3]&&Sizzle.error(z[0]);return z},PSEUDO:function(z){var K,ee=!z[6]&&z[2];if($e.CHILD.test(z[0]))return null;if(z[3])z[2]=z[4]||z[5]||"";else if(ee&&Ue.test(ee)&&(K=ie(ee,true))&&(K=ee.indexOf(")",ee.length-K)-ee.length)){z[0]=z[0].slice(0,K);z[2]=ee.slice(0,K)}return z.slice(0,3)}},filter:{TAG:function(z){var K=z.replace(Qe,funescape).toLowerCase();return"*"===z?function(){return true}:function(z){return z.nodeName&&z.nodeName.toLowerCase()===K}},CLASS:function(z){var K=ke[z+" "];return K||(K=new RegExp("(^|"+Fe+")"+z+"("+Fe+"|$)"))&&ke(z,(function(z){return K.test("string"===typeof z.className&&z.className||"undefined"!==typeof z.getAttribute&&z.getAttribute("class")||"")}))},ATTR:function(z,K,ee){return function(te){var ne=Sizzle.attr(te,z);if(null==ne)return"!="===K;if(!K)return true;ne+="";return"="===K?ne===ee:"!="===K?ne!==ee:"^="===K?ee&&0===ne.indexOf(ee):"*="===K?ee&&ne.indexOf(ee)>-1:"$="===K?ee&&ne.slice(-ee.length)===ee:"~="===K?(" "+ne.replace(De," ")+" ").indexOf(ee)>-1:"|="===K&&(ne===ee||ne.slice(0,ee.length+1)===ee+"-")}},CHILD:function(z,K,ee,te,ne){var re="nth"!==z.slice(0,3),ie="last"!==z.slice(-4),se="of-type"===K;return 1===te&&0===ne?function(z){return!!z.parentNode}:function(K,ee,oe){var ae,le,ce,he,ue,de,fe=re!==ie?"nextSibling":"previousSibling",pe=K.parentNode,ge=se&&K.nodeName.toLowerCase(),me=!oe&&!se,be=false;if(pe){if(re){while(fe){he=K;while(he=he[fe])if(se?he.nodeName.toLowerCase()===ge:1===he.nodeType)return false;de=fe="only"===z&&!de&&"nextSibling"}return true}de=[ie?pe.firstChild:pe.lastChild];if(ie&&me){he=pe;ce=he[ve]||(he[ve]={});le=ce[he.uniqueID]||(ce[he.uniqueID]={});ae=le[z]||[];ue=ae[0]===ye&&ae[1];be=ue&&ae[2];he=ue&&pe.childNodes[ue];while(he=++ue&&he&&he[fe]||(be=ue=0)||de.pop())if(1===he.nodeType&&++be&&he===K){le[z]=[ye,ue,be];break}}else{if(me){he=K;ce=he[ve]||(he[ve]={});le=ce[he.uniqueID]||(ce[he.uniqueID]={});ae=le[z]||[];ue=ae[0]===ye&&ae[1];be=ue}if(false===be)while(he=++ue&&he&&he[fe]||(be=ue=0)||de.pop())if((se?he.nodeName.toLowerCase()===ge:1===he.nodeType)&&++be){if(me){ce=he[ve]||(he[ve]={});le=ce[he.uniqueID]||(ce[he.uniqueID]={});le[z]=[ye,be]}if(he===K)break}}be-=ne;return be===te||be%te===0&&be/te>=0}}},PSEUDO:function(z,K){var ee,ne=te.pseudos[z]||te.setFilters[z.toLowerCase()]||Sizzle.error("unsupported pseudo: "+z);if(ne[ve])return ne(K);if(ne.length>1){ee=[z,z,"",K];return te.setFilters.hasOwnProperty(z.toLowerCase())?markFunction((function(z,ee){var te,re=ne(z,K),ie=re.length;while(ie--){te=indexOf(z,re[ie]);z[te]=!(ee[te]=re[ie])}})):function(z){return ne(z,0,ee)}}return ne}},pseudos:{not:markFunction((function(z){var K=[],ee=[],te=se(z.replace(Pe,"$1"));return te[ve]?markFunction((function(z,K,ee,ne){var re,ie=te(z,null,ne,[]),se=z.length;while(se--)(re=ie[se])&&(z[se]=!(K[se]=re))})):function(z,ne,re){K[0]=z;te(K,null,re,ee);K[0]=null;return!ee.pop()}})),has:markFunction((function(z){return function(K){return Sizzle(z,K).length>0}})),contains:markFunction((function(z){z=z.replace(Qe,funescape);return function(K){return(K.textContent||K.innerText||ne(K)).indexOf(z)>-1}})),lang:markFunction((function(z){Ve.test(z||"")||Sizzle.error("unsupported lang: "+z);z=z.replace(Qe,funescape).toLowerCase();return function(K){var ee;do{if(ee=fe?K.lang:K.getAttribute("xml:lang")||K.getAttribute("lang")){ee=ee.toLowerCase();return ee===z||0===ee.indexOf(z+"-")}}while((K=K.parentNode)&&1===K.nodeType);return false}})),target:function(K){var ee=z.location&&z.location.hash;return ee&&ee.slice(1)===K.id},root:function(z){return z===de},focus:function(z){return z===ue.activeElement&&(!ue.hasFocus||ue.hasFocus())&&!!(z.type||z.href||~z.tabIndex)},enabled:createDisabledPseudo(false),disabled:createDisabledPseudo(true),checked:function(z){var K=z.nodeName.toLowerCase();return"input"===K&&!!z.checked||"option"===K&&!!z.selected},selected:function(z){z.parentNode&&z.parentNode.selectedIndex;return true===z.selected},empty:function(z){for(z=z.firstChild;z;z=z.nextSibling)if(z.nodeType<6)return false;return true},parent:function(z){return!te.pseudos.empty(z)},header:function(z){return je.test(z.nodeName)},input:function(z){return qe.test(z.nodeName)},button:function(z){var K=z.nodeName.toLowerCase();return"input"===K&&"button"===z.type||"button"===K},text:function(z){var K;return"input"===z.nodeName.toLowerCase()&&"text"===z.type&&(null==(K=z.getAttribute("type"))||"text"===K.toLowerCase())},first:createPositionalPseudo((function(){return[0]})),last:createPositionalPseudo((function(z,K){return[K-1]})),eq:createPositionalPseudo((function(z,K,ee){return[ee<0?ee+K:ee]})),even:createPositionalPseudo((function(z,K){var ee=0;for(;ee<K;ee+=2)z.push(ee);return z})),odd:createPositionalPseudo((function(z,K){var ee=1;for(;ee<K;ee+=2)z.push(ee);return z})),lt:createPositionalPseudo((function(z,K,ee){var te=ee<0?ee+K:ee;for(;--te>=0;)z.push(te);return z})),gt:createPositionalPseudo((function(z,K,ee){var te=ee<0?ee+K:ee;for(;++te<K;)z.push(te);return z}))}};te.pseudos.nth=te.pseudos.eq;for(K in{radio:true,checkbox:true,file:true,password:true,image:true})te.pseudos[K]=createInputPseudo(K);for(K in{submit:true,reset:true})te.pseudos[K]=createButtonPseudo(K);function setFilters(){}setFilters.prototype=te.filters=te.pseudos;te.setFilters=new setFilters;ie=Sizzle.tokenize=function(z,K){var ee,ne,re,ie,se,oe,ae,le=xe[z+" "];if(le)return K?0:le.slice(0);se=z;oe=[];ae=te.preFilter;while(se){if(!ee||(ne=Oe.exec(se))){ne&&(se=se.slice(ne[0].length)||se);oe.push(re=[])}ee=false;if(ne=ze.exec(se)){ee=ne.shift();re.push({value:ee,type:ne[0].replace(Pe," ")});se=se.slice(ee.length)}for(ie in te.filter)if((ne=$e[ie].exec(se))&&(!ae[ie]||(ne=ae[ie](ne)))){ee=ne.shift();re.push({value:ee,type:ie,matches:ne});se=se.slice(ee.length)}if(!ee)break}return K?se.length:se?Sizzle.error(z):xe(z,oe).slice(0)};function toSelector(z){var K=0,ee=z.length,te="";for(;K<ee;K++)te+=z[K].value;return te}function addCombinator(z,K,ee){var te=K.dir,ne=K.next,re=ne||te,ie=ee&&"parentNode"===re,se=_e++;return K.first?function(K,ee,ne){while(K=K[te])if(1===K.nodeType||ie)return z(K,ee,ne);return false}:function(K,ee,oe){var ae,le,ce,he=[ye,se];if(oe){while(K=K[te])if((1===K.nodeType||ie)&&z(K,ee,oe))return true}else while(K=K[te])if(1===K.nodeType||ie){ce=K[ve]||(K[ve]={});le=ce[K.uniqueID]||(ce[K.uniqueID]={});if(ne&&ne===K.nodeName.toLowerCase())K=K[te]||K;else{if((ae=le[re])&&ae[0]===ye&&ae[1]===se)return he[2]=ae[2];le[re]=he;if(he[2]=z(K,ee,oe))return true}}return false}}function elementMatcher(z){return z.length>1?function(K,ee,te){var ne=z.length;while(ne--)if(!z[ne](K,ee,te))return false;return true}:z[0]}function multipleContexts(z,K,ee){var te=0,ne=K.length;for(;te<ne;te++)Sizzle(z,K[te],ee);return ee}function condense(z,K,ee,te,ne){var re,ie=[],se=0,oe=z.length,ae=null!=K;for(;se<oe;se++)if((re=z[se])&&(!ee||ee(re,te,ne))){ie.push(re);ae&&K.push(se)}return ie}function setMatcher(z,K,ee,te,ne,re){te&&!te[ve]&&(te=setMatcher(te));ne&&!ne[ve]&&(ne=setMatcher(ne,re));return markFunction((function(re,ie,se,oe){var ae,le,ce,he=[],ue=[],de=ie.length,fe=re||multipleContexts(K||"*",se.nodeType?[se]:se,[]),pe=!z||!re&&K?fe:condense(fe,he,z,se,oe),ge=ee?ne||(re?z:de||te)?[]:ie:pe;ee&&ee(pe,ge,se,oe);if(te){ae=condense(ge,ue);te(ae,[],se,oe);le=ae.length;while(le--)(ce=ae[le])&&(ge[ue[le]]=!(pe[ue[le]]=ce))}if(re){if(ne||z){if(ne){ae=[];le=ge.length;while(le--)(ce=ge[le])&&ae.push(pe[le]=ce);ne(null,ge=[],ae,oe)}le=ge.length;while(le--)(ce=ge[le])&&(ae=ne?indexOf(re,ce):he[le])>-1&&(re[ae]=!(ie[ae]=ce))}}else{ge=condense(ge===ie?ge.splice(de,ge.length):ge);ne?ne(null,ie,ge,oe):Me.apply(ie,ge)}}))}function matcherFromTokens(z){var K,ee,ne,re=z.length,ie=te.relative[z[0].type],se=ie||te.relative[" "],oe=ie?1:0,le=addCombinator((function(z){return z===K}),se,true),ce=addCombinator((function(z){return indexOf(K,z)>-1}),se,true),he=[function(z,ee,te){var ne=!ie&&(te||ee!==ae)||((K=ee).nodeType?le(z,ee,te):ce(z,ee,te));K=null;return ne}];for(;oe<re;oe++)if(ee=te.relative[z[oe].type])he=[addCombinator(elementMatcher(he),ee)];else{ee=te.filter[z[oe].type].apply(null,z[oe].matches);if(ee[ve]){ne=++oe;for(;ne<re;ne++)if(te.relative[z[ne].type])break;return setMatcher(oe>1&&elementMatcher(he),oe>1&&toSelector(z.slice(0,oe-1).concat({value:" "===z[oe-2].type?"*":""})).replace(Pe,"$1"),ee,oe<ne&&matcherFromTokens(z.slice(oe,ne)),ne<re&&matcherFromTokens(z=z.slice(ne)),ne<re&&toSelector(z))}he.push(ee)}return elementMatcher(he)}function matcherFromGroupMatchers(z,K){var ee=K.length>0,ne=z.length>0,superMatcher=function(re,ie,se,oe,le){var ce,de,pe,ge=0,me="0",be=re&&[],ve=[],we=ae,_e=re||ne&&te.find.TAG("*",le),ke=ye+=null==we?1:Math.random()||.1,xe=_e.length;le&&(ae=ie===ue||ie||le);for(;me!==xe&&null!=(ce=_e[me]);me++){if(ne&&ce){de=0;if(!ie&&ce.ownerDocument!==ue){he(ce);se=!fe}while(pe=z[de++])if(pe(ce,ie||ue,se)){oe.push(ce);break}le&&(ye=ke)}if(ee){(ce=!pe&&ce)&&ge--;re&&be.push(ce)}}ge+=me;if(ee&&me!==ge){de=0;while(pe=K[de++])pe(be,ve,ie,se);if(re){if(ge>0)while(me--)be[me]||ve[me]||(ve[me]=Te.call(oe));ve=condense(ve)}Me.apply(oe,ve);le&&!re&&ve.length>0&&ge+K.length>1&&Sizzle.uniqueSort(oe)}if(le){ye=ke;ae=we}return be};return ee?markFunction(superMatcher):superMatcher}se=Sizzle.compile=function(z,K){var ee,te=[],ne=[],re=Ce[z+" "];if(!re){K||(K=ie(z));ee=K.length;while(ee--){re=matcherFromTokens(K[ee]);re[ve]?te.push(re):ne.push(re)}re=Ce(z,matcherFromGroupMatchers(ne,te));re.selector=z}return re};
/**
             * A low-level selection function that works with Sizzle's compiled
             *  selector functions
             * @param {String|Function} selector A selector or a pre-compiled
             *  selector function built with Sizzle.compile
             * @param {Element} context
             * @param {Array} [results]
             * @param {Array} [seed] A set of elements to match against
             */oe=Sizzle.select=function(z,K,ee,ne){var re,oe,ae,le,ce,he="function"===typeof z&&z,ue=!ne&&ie(z=he.selector||z);ee=ee||[];if(1===ue.length){oe=ue[0]=ue[0].slice(0);if(oe.length>2&&"ID"===(ae=oe[0]).type&&9===K.nodeType&&fe&&te.relative[oe[1].type]){K=(te.find.ID(ae.matches[0].replace(Qe,funescape),K)||[])[0];if(!K)return ee;he&&(K=K.parentNode);z=z.slice(oe.shift().value.length)}re=$e.needsContext.test(z)?0:oe.length;while(re--){ae=oe[re];if(te.relative[le=ae.type])break;if((ce=te.find[le])&&(ne=ce(ae.matches[0].replace(Qe,funescape),Ze.test(oe[0].type)&&testContext(K.parentNode)||K))){oe.splice(re,1);z=ne.length&&toSelector(oe);if(!z){Me.apply(ee,ne);return ee}break}}}(he||se(z,ue))(ne,K,!fe,ee,!K||Ze.test(z)&&testContext(K.parentNode)||K);return ee};ee.sortStable=ve.split("").sort(sortOrder).join("")===ve;ee.detectDuplicates=!!ce;he();return Sizzle}(window);jQuery.find=me;jQuery.expr=me.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.uniqueSort=jQuery.unique=me.uniqueSort;jQuery.text=me.getText;jQuery.isXMLDoc=me.isXML;jQuery.contains=me.contains;jQuery.escapeSelector=me.escape;var dir=function(z,K,ee){var te=[],ne=void 0!==ee;while((z=z[K])&&9!==z.nodeType)if(1===z.nodeType){if(ne&&jQuery(z).is(ee))break;te.push(z)}return te};var siblings=function(z,K){var ee=[];for(;z;z=z.nextSibling)1===z.nodeType&&z!==K&&ee.push(z);return ee};var be=jQuery.expr.match.needsContext;function nodeName(z,K){return z.nodeName&&z.nodeName.toLowerCase()===K.toLowerCase()}var ve=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function winnow(z,K,ee){return ue(K)?jQuery.grep(z,(function(z,te){return!!K.call(z,te,z)!==ee})):K.nodeType?jQuery.grep(z,(function(z){return z===K!==ee})):"string"!==typeof K?jQuery.grep(z,(function(z){return ie.call(K,z)>-1!==ee})):jQuery.filter(K,z,ee)}jQuery.filter=function(z,K,ee){var te=K[0];ee&&(z=":not("+z+")");return 1===K.length&&1===te.nodeType?jQuery.find.matchesSelector(te,z)?[te]:[]:jQuery.find.matches(z,jQuery.grep(K,(function(z){return 1===z.nodeType})))};jQuery.fn.extend({find:function(z){var K,ee,te=this.length,ne=this;if("string"!==typeof z)return this.pushStack(jQuery(z).filter((function(){for(K=0;K<te;K++)if(jQuery.contains(ne[K],this))return true})));ee=this.pushStack([]);for(K=0;K<te;K++)jQuery.find(z,ne[K],ee);return te>1?jQuery.uniqueSort(ee):ee},filter:function(z){return this.pushStack(winnow(this,z||[],false))},not:function(z){return this.pushStack(winnow(this,z||[],true))},is:function(z){return!!winnow(this,"string"===typeof z&&be.test(z)?jQuery(z):z||[],false).length}});var we,ye=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,_e=jQuery.fn.init=function(z,ee,te){var ne,re;if(!z)return this;te=te||we;if("string"===typeof z){ne="<"===z[0]&&">"===z[z.length-1]&&z.length>=3?[null,z,null]:ye.exec(z);if(!ne||!ne[1]&&ee)return!ee||ee.jquery?(ee||te).find(z):this.constructor(ee).find(z);if(ne[1]){ee=ee instanceof jQuery?ee[0]:ee;jQuery.merge(this,jQuery.parseHTML(ne[1],ee&&ee.nodeType?ee.ownerDocument||ee:K,true));if(ve.test(ne[1])&&jQuery.isPlainObject(ee))for(ne in ee)ue(this[ne])?this[ne](ee[ne]):this.attr(ne,ee[ne]);return this}re=K.getElementById(ne[2]);if(re){this[0]=re;this.length=1}return this}if(z.nodeType){this[0]=z;this.length=1;return this}return ue(z)?void 0!==te.ready?te.ready(z):z(jQuery):jQuery.makeArray(z,this)};_e.prototype=jQuery.fn;we=jQuery(K);var ke=/^(?:parents|prev(?:Until|All))/,xe={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({has:function(z){var K=jQuery(z,this),ee=K.length;return this.filter((function(){var z=0;for(;z<ee;z++)if(jQuery.contains(this,K[z]))return true}))},closest:function(z,K){var ee,te=0,ne=this.length,re=[],ie="string"!==typeof z&&jQuery(z);if(!be.test(z))for(;te<ne;te++)for(ee=this[te];ee&&ee!==K;ee=ee.parentNode)if(ee.nodeType<11&&(ie?ie.index(ee)>-1:1===ee.nodeType&&jQuery.find.matchesSelector(ee,z))){re.push(ee);break}return this.pushStack(re.length>1?jQuery.uniqueSort(re):re)},index:function(z){return z?"string"===typeof z?ie.call(jQuery(z),this[0]):ie.call(this,z.jquery?z[0]:z):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(z,K){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(z,K))))},addBack:function(z){return this.add(null==z?this.prevObject:this.prevObject.filter(z))}});function sibling(z,K){while((z=z[K])&&1!==z.nodeType);return z}jQuery.each({parent:function(z){var K=z.parentNode;return K&&11!==K.nodeType?K:null},parents:function(z){return dir(z,"parentNode")},parentsUntil:function(z,K,ee){return dir(z,"parentNode",ee)},next:function(z){return sibling(z,"nextSibling")},prev:function(z){return sibling(z,"previousSibling")},nextAll:function(z){return dir(z,"nextSibling")},prevAll:function(z){return dir(z,"previousSibling")},nextUntil:function(z,K,ee){return dir(z,"nextSibling",ee)},prevUntil:function(z,K,ee){return dir(z,"previousSibling",ee)},siblings:function(z){return siblings((z.parentNode||{}).firstChild,z)},children:function(z){return siblings(z.firstChild)},contents:function(z){if(nodeName(z,"iframe"))return z.contentDocument;nodeName(z,"template")&&(z=z.content||z);return jQuery.merge([],z.childNodes)}},(function(z,K){jQuery.fn[z]=function(ee,te){var ne=jQuery.map(this,K,ee);"Until"!==z.slice(-5)&&(te=ee);te&&"string"===typeof te&&(ne=jQuery.filter(te,ne));if(this.length>1){xe[z]||jQuery.uniqueSort(ne);ke.test(z)&&ne.reverse()}return this.pushStack(ne)}}));var Ce=/[^\x20\t\r\n\f]+/g;function createOptions(z){var K={};jQuery.each(z.match(Ce)||[],(function(z,ee){K[ee]=true}));return K}jQuery.Callbacks=function(z){z="string"===typeof z?createOptions(z):jQuery.extend({},z);var K,ee,te,ne,re=[],ie=[],se=-1,fire=function(){ne=ne||z.once;te=K=true;for(;ie.length;se=-1){ee=ie.shift();while(++se<re.length)if(false===re[se].apply(ee[0],ee[1])&&z.stopOnFalse){se=re.length;ee=false}}z.memory||(ee=false);K=false;ne&&(re=ee?[]:"")},oe={add:function(){if(re){if(ee&&!K){se=re.length-1;ie.push(ee)}(function add(K){jQuery.each(K,(function(K,ee){ue(ee)?z.unique&&oe.has(ee)||re.push(ee):ee&&ee.length&&"string"!==toType(ee)&&add(ee)}))})(arguments);ee&&!K&&fire()}return this},remove:function(){jQuery.each(arguments,(function(z,K){var ee;while((ee=jQuery.inArray(K,re,ee))>-1){re.splice(ee,1);ee<=se&&se--}}));return this},has:function(z){return z?jQuery.inArray(z,re)>-1:re.length>0},empty:function(){re&&(re=[]);return this},disable:function(){ne=ie=[];re=ee="";return this},disabled:function(){return!re},lock:function(){ne=ie=[];ee||K||(re=ee="");return this},locked:function(){return!!ne},fireWith:function(z,ee){if(!ne){ee=ee||[];ee=[z,ee.slice?ee.slice():ee];ie.push(ee);K||fire()}return this},fire:function(){oe.fireWith(this,arguments);return this},fired:function(){return!!te}};return oe};function Identity(z){return z}function Thrower(z){throw z}function adoptValue(z,K,ee,te){var ne;try{z&&ue(ne=z.promise)?ne.call(z).done(K).fail(ee):z&&ue(ne=z.then)?ne.call(z,K,ee):K.apply(void 0,[z].slice(te))}catch(z){ee.apply(void 0,[z])}}jQuery.extend({Deferred:function(z){var K=[["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory"),2],["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),0,"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),1,"rejected"]],ee="pending",te={state:function(){return ee},always:function(){ne.done(arguments).fail(arguments);return this},catch:function(z){return te.then(null,z)},pipe:function(){var z=arguments;return jQuery.Deferred((function(ee){jQuery.each(K,(function(K,te){var re=ue(z[te[4]])&&z[te[4]];ne[te[1]]((function(){var z=re&&re.apply(this,arguments);z&&ue(z.promise)?z.promise().progress(ee.notify).done(ee.resolve).fail(ee.reject):ee[te[0]+"With"](this,re?[z]:arguments)}))}));z=null})).promise()},then:function(z,ee,te){var ne=0;function resolve(z,K,ee,te){return function(){var re=this,ie=arguments,mightThrow=function(){var se,oe;if(!(z<ne)){se=ee.apply(re,ie);if(se===K.promise())throw new TypeError("Thenable self-resolution");oe=se&&("object"===typeof se||"function"===typeof se)&&se.then;if(ue(oe))if(te)oe.call(se,resolve(ne,K,Identity,te),resolve(ne,K,Thrower,te));else{ne++;oe.call(se,resolve(ne,K,Identity,te),resolve(ne,K,Thrower,te),resolve(ne,K,Identity,K.notifyWith))}else{if(ee!==Identity){re=void 0;ie=[se]}(te||K.resolveWith)(re,ie)}}},se=te?mightThrow:function(){try{mightThrow()}catch(te){jQuery.Deferred.exceptionHook&&jQuery.Deferred.exceptionHook(te,se.stackTrace);if(z+1>=ne){if(ee!==Thrower){re=void 0;ie=[te]}K.rejectWith(re,ie)}}};if(z)se();else{jQuery.Deferred.getStackHook&&(se.stackTrace=jQuery.Deferred.getStackHook());window.setTimeout(se)}}}return jQuery.Deferred((function(ne){K[0][3].add(resolve(0,ne,ue(te)?te:Identity,ne.notifyWith));K[1][3].add(resolve(0,ne,ue(z)?z:Identity));K[2][3].add(resolve(0,ne,ue(ee)?ee:Thrower))})).promise()},promise:function(z){return null!=z?jQuery.extend(z,te):te}},ne={};jQuery.each(K,(function(z,re){var ie=re[2],se=re[5];te[re[1]]=ie.add;se&&ie.add((function(){ee=se}),K[3-z][2].disable,K[3-z][3].disable,K[0][2].lock,K[0][3].lock);ie.add(re[3].fire);ne[re[0]]=function(){ne[re[0]+"With"](this===ne?void 0:this,arguments);return this};ne[re[0]+"With"]=ie.fireWith}));te.promise(ne);z&&z.call(ne,ne);return ne},when:function(z){var K=arguments.length,ee=K,ne=Array(ee),re=te.call(arguments),ie=jQuery.Deferred(),updateFunc=function(z){return function(ee){ne[z]=this;re[z]=arguments.length>1?te.call(arguments):ee;--K||ie.resolveWith(ne,re)}};if(K<=1){adoptValue(z,ie.done(updateFunc(ee)).resolve,ie.reject,!K);if("pending"===ie.state()||ue(re[ee]&&re[ee].then))return ie.then()}while(ee--)adoptValue(re[ee],updateFunc(ee),ie.reject);return ie.promise()}});var Se=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(z,K){window.console&&window.console.warn&&z&&Se.test(z.name)&&window.console.warn("jQuery.Deferred exception: "+z.message,z.stack,K)};jQuery.readyException=function(z){window.setTimeout((function(){throw z}))};var Ae=jQuery.Deferred();jQuery.fn.ready=function(z){Ae.then(z).catch((function(z){jQuery.readyException(z)}));return this};jQuery.extend({isReady:false,readyWait:1,ready:function(z){if(!(true===z?--jQuery.readyWait:jQuery.isReady)){jQuery.isReady=true;true!==z&&--jQuery.readyWait>0||Ae.resolveWith(K,[jQuery])}}});jQuery.ready.then=Ae.then;function completed(){K.removeEventListener("DOMContentLoaded",completed);window.removeEventListener("load",completed);jQuery.ready()}if("complete"===K.readyState||"loading"!==K.readyState&&!K.documentElement.doScroll)window.setTimeout(jQuery.ready);else{K.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed)}var access=function(z,K,ee,te,ne,re,ie){var se=0,oe=z.length,ae=null==ee;if("object"===toType(ee)){ne=true;for(se in ee)access(z,K,se,ee[se],true,re,ie)}else if(void 0!==te){ne=true;ue(te)||(ie=true);if(ae)if(ie){K.call(z,te);K=null}else{ae=K;K=function(z,K,ee){return ae.call(jQuery(z),ee)}}if(K)for(;se<oe;se++)K(z[se],ee,ie?te:te.call(z[se],se,K(z[se],ee)))}return ne?z:ae?K.call(z):oe?K(z[0],ee):re};var Te=/^-ms-/,Ee=/-([a-z])/g;function fcamelCase(z,K){return K.toUpperCase()}function camelCase(z){return z.replace(Te,"ms-").replace(Ee,fcamelCase)}var acceptData=function(z){return 1===z.nodeType||9===z.nodeType||!+z.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1;Data.prototype={cache:function(z){var K=z[this.expando];if(!K){K={};acceptData(z)&&(z.nodeType?z[this.expando]=K:Object.defineProperty(z,this.expando,{value:K,configurable:true}))}return K},set:function(z,K,ee){var te,ne=this.cache(z);if("string"===typeof K)ne[camelCase(K)]=ee;else for(te in K)ne[camelCase(te)]=K[te];return ne},get:function(z,K){return void 0===K?this.cache(z):z[this.expando]&&z[this.expando][camelCase(K)]},access:function(z,K,ee){if(void 0===K||K&&"string"===typeof K&&void 0===ee)return this.get(z,K);this.set(z,K,ee);return void 0!==ee?ee:K},remove:function(z,K){var ee,te=z[this.expando];if(void 0!==te){if(void 0!==K){if(Array.isArray(K))K=K.map(camelCase);else{K=camelCase(K);K=K in te?[K]:K.match(Ce)||[]}ee=K.length;while(ee--)delete te[K[ee]]}(void 0===K||jQuery.isEmptyObject(te))&&(z.nodeType?z[this.expando]=void 0:delete z[this.expando])}},hasData:function(z){var K=z[this.expando];return void 0!==K&&!jQuery.isEmptyObject(K)}};var Me=new Data;var Re=new Data;var Ie=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Fe=/[A-Z]/g;function getData(z){return"true"===z||"false"!==z&&("null"===z?null:z===+z+""?+z:Ie.test(z)?JSON.parse(z):z)}function dataAttr(z,K,ee){var te;if(void 0===ee&&1===z.nodeType){te="data-"+K.replace(Fe,"-$&").toLowerCase();ee=z.getAttribute(te);if("string"===typeof ee){try{ee=getData(ee)}catch(z){}Re.set(z,K,ee)}else ee=void 0}return ee}jQuery.extend({hasData:function(z){return Re.hasData(z)||Me.hasData(z)},data:function(z,K,ee){return Re.access(z,K,ee)},removeData:function(z,K){Re.remove(z,K)},_data:function(z,K,ee){return Me.access(z,K,ee)},_removeData:function(z,K){Me.remove(z,K)}});jQuery.fn.extend({data:function(z,K){var ee,te,ne,re=this[0],ie=re&&re.attributes;if(void 0===z){if(this.length){ne=Re.get(re);if(1===re.nodeType&&!Me.get(re,"hasDataAttrs")){ee=ie.length;while(ee--)if(ie[ee]){te=ie[ee].name;if(0===te.indexOf("data-")){te=camelCase(te.slice(5));dataAttr(re,te,ne[te])}}Me.set(re,"hasDataAttrs",true)}}return ne}return"object"===typeof z?this.each((function(){Re.set(this,z)})):access(this,(function(K){var ee;if(re&&void 0===K){ee=Re.get(re,z);if(void 0!==ee)return ee;ee=dataAttr(re,z);return void 0!==ee?ee:void 0}this.each((function(){Re.set(this,z,K)}))}),null,K,arguments.length>1,null,true)},removeData:function(z){return this.each((function(){Re.remove(this,z)}))}});jQuery.extend({queue:function(z,K,ee){var te;if(z){K=(K||"fx")+"queue";te=Me.get(z,K);ee&&(!te||Array.isArray(ee)?te=Me.access(z,K,jQuery.makeArray(ee)):te.push(ee));return te||[]}},dequeue:function(z,K){K=K||"fx";var ee=jQuery.queue(z,K),te=ee.length,ne=ee.shift(),re=jQuery._queueHooks(z,K),next=function(){jQuery.dequeue(z,K)};if("inprogress"===ne){ne=ee.shift();te--}if(ne){"fx"===K&&ee.unshift("inprogress");delete re.stop;ne.call(z,next,re)}!te&&re&&re.empty.fire()},_queueHooks:function(z,K){var ee=K+"queueHooks";return Me.get(z,ee)||Me.access(z,ee,{empty:jQuery.Callbacks("once memory").add((function(){Me.remove(z,[K+"queue",ee])}))})}});jQuery.fn.extend({queue:function(z,K){var ee=2;if("string"!==typeof z){K=z;z="fx";ee--}return arguments.length<ee?jQuery.queue(this[0],z):void 0===K?this:this.each((function(){var ee=jQuery.queue(this,z,K);jQuery._queueHooks(this,z);"fx"===z&&"inprogress"!==ee[0]&&jQuery.dequeue(this,z)}))},dequeue:function(z){return this.each((function(){jQuery.dequeue(this,z)}))},clearQueue:function(z){return this.queue(z||"fx",[])},promise:function(z,K){var ee,te=1,ne=jQuery.Deferred(),re=this,ie=this.length,resolve=function(){--te||ne.resolveWith(re,[re])};if("string"!==typeof z){K=z;z=void 0}z=z||"fx";while(ie--){ee=Me.get(re[ie],z+"queueHooks");if(ee&&ee.empty){te++;ee.empty.add(resolve)}}resolve();return ne.promise(K)}});var Le=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var Be=new RegExp("^(?:([+-])=|)("+Le+")([a-z%]*)$","i");var Ne=["Top","Right","Bottom","Left"];var isHiddenWithinTree=function(z,K){z=K||z;return"none"===z.style.display||""===z.style.display&&jQuery.contains(z.ownerDocument,z)&&"none"===jQuery.css(z,"display")};var swap=function(z,K,ee,te){var ne,re,ie={};for(re in K){ie[re]=z.style[re];z.style[re]=K[re]}ne=ee.apply(z,te||[]);for(re in K)z.style[re]=ie[re];return ne};function adjustCSS(z,K,ee,te){var ne,re,ie=20,se=te?function(){return te.cur()}:function(){return jQuery.css(z,K,"")},oe=se(),ae=ee&&ee[3]||(jQuery.cssNumber[K]?"":"px"),le=(jQuery.cssNumber[K]||"px"!==ae&&+oe)&&Be.exec(jQuery.css(z,K));if(le&&le[3]!==ae){oe/=2;ae=ae||le[3];le=+oe||1;while(ie--){jQuery.style(z,K,le+ae);(1-re)*(1-(re=se()/oe||.5))<=0&&(ie=0);le/=re}le*=2;jQuery.style(z,K,le+ae);ee=ee||[]}if(ee){le=+le||+oe||0;ne=ee[1]?le+(ee[1]+1)*ee[2]:+ee[2];if(te){te.unit=ae;te.start=le;te.end=ne}}return ne}var De={};function getDefaultDisplay(z){var K,ee=z.ownerDocument,te=z.nodeName,ne=De[te];if(ne)return ne;K=ee.body.appendChild(ee.createElement(te));ne=jQuery.css(K,"display");K.parentNode.removeChild(K);"none"===ne&&(ne="block");De[te]=ne;return ne}function showHide(z,K){var ee,te,ne=[],re=0,ie=z.length;for(;re<ie;re++){te=z[re];if(te.style){ee=te.style.display;if(K){if("none"===ee){ne[re]=Me.get(te,"display")||null;ne[re]||(te.style.display="")}""===te.style.display&&isHiddenWithinTree(te)&&(ne[re]=getDefaultDisplay(te))}else if("none"!==ee){ne[re]="none";Me.set(te,"display",ee)}}}for(re=0;re<ie;re++)null!=ne[re]&&(z[re].style.display=ne[re]);return z}jQuery.fn.extend({show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(z){return"boolean"===typeof z?z?this.show():this.hide():this.each((function(){isHiddenWithinTree(this)?jQuery(this).show():jQuery(this).hide()}))}});var Pe=/^(?:checkbox|radio)$/i;var Oe=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i;var ze=/^$|^module$|\/(?:java|ecma)script/i;var He={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};He.optgroup=He.option;He.tbody=He.tfoot=He.colgroup=He.caption=He.thead;He.th=He.td;function getAll(z,K){var ee;ee="undefined"!==typeof z.getElementsByTagName?z.getElementsByTagName(K||"*"):"undefined"!==typeof z.querySelectorAll?z.querySelectorAll(K||"*"):[];return void 0===K||K&&nodeName(z,K)?jQuery.merge([z],ee):ee}function setGlobalEval(z,K){var ee=0,te=z.length;for(;ee<te;ee++)Me.set(z[ee],"globalEval",!K||Me.get(K[ee],"globalEval"))}var Ue=/<|&#?\w+;/;function buildFragment(z,K,ee,te,ne){var re,ie,se,oe,ae,le,ce=K.createDocumentFragment(),he=[],ue=0,de=z.length;for(;ue<de;ue++){re=z[ue];if(re||0===re)if("object"===toType(re))jQuery.merge(he,re.nodeType?[re]:re);else if(Ue.test(re)){ie=ie||ce.appendChild(K.createElement("div"));se=(Oe.exec(re)||["",""])[1].toLowerCase();oe=He[se]||He._default;ie.innerHTML=oe[1]+jQuery.htmlPrefilter(re)+oe[2];le=oe[0];while(le--)ie=ie.lastChild;jQuery.merge(he,ie.childNodes);ie=ce.firstChild;ie.textContent=""}else he.push(K.createTextNode(re))}ce.textContent="";ue=0;while(re=he[ue++])if(te&&jQuery.inArray(re,te)>-1)ne&&ne.push(re);else{ae=jQuery.contains(re.ownerDocument,re);ie=getAll(ce.appendChild(re),"script");ae&&setGlobalEval(ie);if(ee){le=0;while(re=ie[le++])ze.test(re.type||"")&&ee.push(re)}}return ce}(function(){var z=K.createDocumentFragment(),ee=z.appendChild(K.createElement("div")),te=K.createElement("input");te.setAttribute("type","radio");te.setAttribute("checked","checked");te.setAttribute("name","t");ee.appendChild(te);he.checkClone=ee.cloneNode(true).cloneNode(true).lastChild.checked;ee.innerHTML="<textarea>x</textarea>";he.noCloneChecked=!!ee.cloneNode(true).lastChild.defaultValue})();var Ve=K.documentElement;var $e=/^key/,qe=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,je=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return K.activeElement}catch(z){}}function on(z,K,ee,te,ne,re){var ie,se;if("object"===typeof K){if("string"!==typeof ee){te=te||ee;ee=void 0}for(se in K)on(z,se,ee,te,K[se],re);return z}if(null==te&&null==ne){ne=ee;te=ee=void 0}else if(null==ne)if("string"===typeof ee){ne=te;te=void 0}else{ne=te;te=ee;ee=void 0}if(false===ne)ne=returnFalse;else if(!ne)return z;if(1===re){ie=ne;ne=function(z){jQuery().off(z);return ie.apply(this,arguments)};ne.guid=ie.guid||(ie.guid=jQuery.guid++)}return z.each((function(){jQuery.event.add(this,K,ne,te,ee)}))}jQuery.event={global:{},add:function(z,K,ee,te,ne){var re,ie,se,oe,ae,le,ce,he,ue,de,fe,pe=Me.get(z);if(pe){if(ee.handler){re=ee;ee=re.handler;ne=re.selector}ne&&jQuery.find.matchesSelector(Ve,ne);ee.guid||(ee.guid=jQuery.guid++);(oe=pe.events)||(oe=pe.events={});(ie=pe.handle)||(ie=pe.handle=function(K){return"undefined"!==typeof jQuery&&jQuery.event.triggered!==K.type?jQuery.event.dispatch.apply(z,arguments):void 0});K=(K||"").match(Ce)||[""];ae=K.length;while(ae--){se=je.exec(K[ae])||[];ue=fe=se[1];de=(se[2]||"").split(".").sort();if(ue){ce=jQuery.event.special[ue]||{};ue=(ne?ce.delegateType:ce.bindType)||ue;ce=jQuery.event.special[ue]||{};le=jQuery.extend({type:ue,origType:fe,data:te,handler:ee,guid:ee.guid,selector:ne,needsContext:ne&&jQuery.expr.match.needsContext.test(ne),namespace:de.join(".")},re);if(!(he=oe[ue])){he=oe[ue]=[];he.delegateCount=0;ce.setup&&false!==ce.setup.call(z,te,de,ie)||z.addEventListener&&z.addEventListener(ue,ie)}if(ce.add){ce.add.call(z,le);le.handler.guid||(le.handler.guid=ee.guid)}ne?he.splice(he.delegateCount++,0,le):he.push(le);jQuery.event.global[ue]=true}}}},remove:function(z,K,ee,te,ne){var re,ie,se,oe,ae,le,ce,he,ue,de,fe,pe=Me.hasData(z)&&Me.get(z);if(pe&&(oe=pe.events)){K=(K||"").match(Ce)||[""];ae=K.length;while(ae--){se=je.exec(K[ae])||[];ue=fe=se[1];de=(se[2]||"").split(".").sort();if(ue){ce=jQuery.event.special[ue]||{};ue=(te?ce.delegateType:ce.bindType)||ue;he=oe[ue]||[];se=se[2]&&new RegExp("(^|\\.)"+de.join("\\.(?:.*\\.|)")+"(\\.|$)");ie=re=he.length;while(re--){le=he[re];if((ne||fe===le.origType)&&(!ee||ee.guid===le.guid)&&(!se||se.test(le.namespace))&&(!te||te===le.selector||"**"===te&&le.selector)){he.splice(re,1);le.selector&&he.delegateCount--;ce.remove&&ce.remove.call(z,le)}}if(ie&&!he.length){ce.teardown&&false!==ce.teardown.call(z,de,pe.handle)||jQuery.removeEvent(z,ue,pe.handle);delete oe[ue]}}else for(ue in oe)jQuery.event.remove(z,ue+K[ae],ee,te,true)}jQuery.isEmptyObject(oe)&&Me.remove(z,"handle events")}},dispatch:function(z){var K=jQuery.event.fix(z);var ee,te,ne,re,ie,se,oe=new Array(arguments.length),ae=(Me.get(this,"events")||{})[K.type]||[],le=jQuery.event.special[K.type]||{};oe[0]=K;for(ee=1;ee<arguments.length;ee++)oe[ee]=arguments[ee];K.delegateTarget=this;if(!le.preDispatch||false!==le.preDispatch.call(this,K)){se=jQuery.event.handlers.call(this,K,ae);ee=0;while((re=se[ee++])&&!K.isPropagationStopped()){K.currentTarget=re.elem;te=0;while((ie=re.handlers[te++])&&!K.isImmediatePropagationStopped())if(!K.rnamespace||K.rnamespace.test(ie.namespace)){K.handleObj=ie;K.data=ie.data;ne=((jQuery.event.special[ie.origType]||{}).handle||ie.handler).apply(re.elem,oe);if(void 0!==ne&&false===(K.result=ne)){K.preventDefault();K.stopPropagation()}}}le.postDispatch&&le.postDispatch.call(this,K);return K.result}},handlers:function(z,K){var ee,te,ne,re,ie,se=[],oe=K.delegateCount,ae=z.target;if(oe&&ae.nodeType&&!("click"===z.type&&z.button>=1))for(;ae!==this;ae=ae.parentNode||this)if(1===ae.nodeType&&!("click"===z.type&&true===ae.disabled)){re=[];ie={};for(ee=0;ee<oe;ee++){te=K[ee];ne=te.selector+" ";void 0===ie[ne]&&(ie[ne]=te.needsContext?jQuery(ne,this).index(ae)>-1:jQuery.find(ne,this,null,[ae]).length);ie[ne]&&re.push(te)}re.length&&se.push({elem:ae,handlers:re})}ae=this;oe<K.length&&se.push({elem:ae,handlers:K.slice(oe)});return se},addProp:function(z,K){Object.defineProperty(jQuery.Event.prototype,z,{enumerable:true,configurable:true,get:ue(K)?function(){if(this.originalEvent)return K(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[z]},set:function(K){Object.defineProperty(this,z,{enumerable:true,configurable:true,writable:true,value:K})}})},fix:function(z){return z[jQuery.expando]?z:new jQuery.Event(z)},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&nodeName(this,"input")){this.click();return false}},_default:function(z){return nodeName(z.target,"a")}},beforeunload:{postDispatch:function(z){void 0!==z.result&&z.originalEvent&&(z.originalEvent.returnValue=z.result)}}}};jQuery.removeEvent=function(z,K,ee){z.removeEventListener&&z.removeEventListener(K,ee)};jQuery.Event=function(z,K){if(!(this instanceof jQuery.Event))return new jQuery.Event(z,K);if(z&&z.type){this.originalEvent=z;this.type=z.type;this.isDefaultPrevented=z.defaultPrevented||void 0===z.defaultPrevented&&false===z.returnValue?returnTrue:returnFalse;this.target=z.target&&3===z.target.nodeType?z.target.parentNode:z.target;this.currentTarget=z.currentTarget;this.relatedTarget=z.relatedTarget}else this.type=z;K&&jQuery.extend(this,K);this.timeStamp=z&&z.timeStamp||Date.now();this[jQuery.expando]=true};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:false,preventDefault:function(){var z=this.originalEvent;this.isDefaultPrevented=returnTrue;z&&!this.isSimulated&&z.preventDefault()},stopPropagation:function(){var z=this.originalEvent;this.isPropagationStopped=returnTrue;z&&!this.isSimulated&&z.stopPropagation()},stopImmediatePropagation:function(){var z=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;z&&!this.isSimulated&&z.stopImmediatePropagation();this.stopPropagation()}};jQuery.each({altKey:true,bubbles:true,cancelable:true,changedTouches:true,ctrlKey:true,detail:true,eventPhase:true,metaKey:true,pageX:true,pageY:true,shiftKey:true,view:true,char:true,charCode:true,key:true,keyCode:true,button:true,buttons:true,clientX:true,clientY:true,offsetX:true,offsetY:true,pointerId:true,pointerType:true,screenX:true,screenY:true,targetTouches:true,toElement:true,touches:true,which:function(z){var K=z.button;return null==z.which&&$e.test(z.type)?null!=z.charCode?z.charCode:z.keyCode:!z.which&&void 0!==K&&qe.test(z.type)?1&K?1:2&K?3:4&K?2:0:z.which}},jQuery.event.addProp);jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(z,K){jQuery.event.special[z]={delegateType:K,bindType:K,handle:function(z){var ee,te=this,ne=z.relatedTarget,re=z.handleObj;if(!ne||ne!==te&&!jQuery.contains(te,ne)){z.type=re.origType;ee=re.handler.apply(this,arguments);z.type=K}return ee}}}));jQuery.fn.extend({on:function(z,K,ee,te){return on(this,z,K,ee,te)},one:function(z,K,ee,te){return on(this,z,K,ee,te,1)},off:function(z,K,ee){var te,ne;if(z&&z.preventDefault&&z.handleObj){te=z.handleObj;jQuery(z.delegateTarget).off(te.namespace?te.origType+"."+te.namespace:te.origType,te.selector,te.handler);return this}if("object"===typeof z){for(ne in z)this.off(ne,K,z[ne]);return this}if(false===K||"function"===typeof K){ee=K;K=void 0}false===ee&&(ee=returnFalse);return this.each((function(){jQuery.event.remove(this,z,ee,K)}))}});var We=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ge=/<script|<style|<link/i,Ze=/checked\s*(?:[^=]|=\s*.checked.)/i,Qe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(z,K){return nodeName(z,"table")&&nodeName(11!==K.nodeType?K:K.firstChild,"tr")&&jQuery(z).children("tbody")[0]||z}function disableScript(z){z.type=(null!==z.getAttribute("type"))+"/"+z.type;return z}function restoreScript(z){"true/"===(z.type||"").slice(0,5)?z.type=z.type.slice(5):z.removeAttribute("type");return z}function cloneCopyEvent(z,K){var ee,te,ne,re,ie,se,oe,ae;if(1===K.nodeType){if(Me.hasData(z)){re=Me.access(z);ie=Me.set(K,re);ae=re.events;if(ae){delete ie.handle;ie.events={};for(ne in ae)for(ee=0,te=ae[ne].length;ee<te;ee++)jQuery.event.add(K,ne,ae[ne][ee])}}if(Re.hasData(z)){se=Re.access(z);oe=jQuery.extend({},se);Re.set(K,oe)}}}function fixInput(z,K){var ee=K.nodeName.toLowerCase();"input"===ee&&Pe.test(z.type)?K.checked=z.checked:"input"!==ee&&"textarea"!==ee||(K.defaultValue=z.defaultValue)}function domManip(z,K,ee,te){K=ne.apply([],K);var re,ie,se,oe,ae,le,ce=0,de=z.length,fe=de-1,pe=K[0],ge=ue(pe);if(ge||de>1&&"string"===typeof pe&&!he.checkClone&&Ze.test(pe))return z.each((function(ne){var re=z.eq(ne);ge&&(K[0]=pe.call(this,ne,re.html()));domManip(re,K,ee,te)}));if(de){re=buildFragment(K,z[0].ownerDocument,false,z,te);ie=re.firstChild;1===re.childNodes.length&&(re=ie);if(ie||te){se=jQuery.map(getAll(re,"script"),disableScript);oe=se.length;for(;ce<de;ce++){ae=re;if(ce!==fe){ae=jQuery.clone(ae,true,true);oe&&jQuery.merge(se,getAll(ae,"script"))}ee.call(z[ce],ae,ce)}if(oe){le=se[se.length-1].ownerDocument;jQuery.map(se,restoreScript);for(ce=0;ce<oe;ce++){ae=se[ce];ze.test(ae.type||"")&&!Me.access(ae,"globalEval")&&jQuery.contains(le,ae)&&(ae.src&&"module"!==(ae.type||"").toLowerCase()?jQuery._evalUrl&&jQuery._evalUrl(ae.src):DOMEval(ae.textContent.replace(Qe,""),le,ae))}}}}return z}function remove(z,K,ee){var te,ne=K?jQuery.filter(K,z):z,re=0;for(;null!=(te=ne[re]);re++){ee||1!==te.nodeType||jQuery.cleanData(getAll(te));if(te.parentNode){ee&&jQuery.contains(te.ownerDocument,te)&&setGlobalEval(getAll(te,"script"));te.parentNode.removeChild(te)}}return z}jQuery.extend({htmlPrefilter:function(z){return z.replace(We,"<$1></$2>")},clone:function(z,K,ee){var te,ne,re,ie,se=z.cloneNode(true),oe=jQuery.contains(z.ownerDocument,z);if(!he.noCloneChecked&&(1===z.nodeType||11===z.nodeType)&&!jQuery.isXMLDoc(z)){ie=getAll(se);re=getAll(z);for(te=0,ne=re.length;te<ne;te++)fixInput(re[te],ie[te])}if(K)if(ee){re=re||getAll(z);ie=ie||getAll(se);for(te=0,ne=re.length;te<ne;te++)cloneCopyEvent(re[te],ie[te])}else cloneCopyEvent(z,se);ie=getAll(se,"script");ie.length>0&&setGlobalEval(ie,!oe&&getAll(z,"script"));return se},cleanData:function(z){var K,ee,te,ne=jQuery.event.special,re=0;for(;void 0!==(ee=z[re]);re++)if(acceptData(ee)){if(K=ee[Me.expando]){if(K.events)for(te in K.events)ne[te]?jQuery.event.remove(ee,te):jQuery.removeEvent(ee,te,K.handle);ee[Me.expando]=void 0}ee[Re.expando]&&(ee[Re.expando]=void 0)}}});jQuery.fn.extend({detach:function(z){return remove(this,z,true)},remove:function(z){return remove(this,z)},text:function(z){return access(this,(function(z){return void 0===z?jQuery.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=z)}))}),null,z,arguments.length)},append:function(){return domManip(this,arguments,(function(z){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var K=manipulationTarget(this,z);K.appendChild(z)}}))},prepend:function(){return domManip(this,arguments,(function(z){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var K=manipulationTarget(this,z);K.insertBefore(z,K.firstChild)}}))},before:function(){return domManip(this,arguments,(function(z){this.parentNode&&this.parentNode.insertBefore(z,this)}))},after:function(){return domManip(this,arguments,(function(z){this.parentNode&&this.parentNode.insertBefore(z,this.nextSibling)}))},empty:function(){var z,K=0;for(;null!=(z=this[K]);K++)if(1===z.nodeType){jQuery.cleanData(getAll(z,false));z.textContent=""}return this},clone:function(z,K){z=null!=z&&z;K=null==K?z:K;return this.map((function(){return jQuery.clone(this,z,K)}))},html:function(z){return access(this,(function(z){var K=this[0]||{},ee=0,te=this.length;if(void 0===z&&1===K.nodeType)return K.innerHTML;if("string"===typeof z&&!Ge.test(z)&&!He[(Oe.exec(z)||["",""])[1].toLowerCase()]){z=jQuery.htmlPrefilter(z);try{for(;ee<te;ee++){K=this[ee]||{};if(1===K.nodeType){jQuery.cleanData(getAll(K,false));K.innerHTML=z}}K=0}catch(z){}}K&&this.empty().append(z)}),null,z,arguments.length)},replaceWith:function(){var z=[];return domManip(this,arguments,(function(K){var ee=this.parentNode;if(jQuery.inArray(this,z)<0){jQuery.cleanData(getAll(this));ee&&ee.replaceChild(K,this)}}),z)}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(z,K){jQuery.fn[z]=function(z){var ee,te=[],ne=jQuery(z),ie=ne.length-1,se=0;for(;se<=ie;se++){ee=se===ie?this:this.clone(true);jQuery(ne[se])[K](ee);re.apply(te,ee.get())}return this.pushStack(te)}}));var Xe=new RegExp("^("+Le+")(?!px)[a-z%]+$","i");var getStyles=function(z){var K=z.ownerDocument.defaultView;K&&K.opener||(K=window);return K.getComputedStyle(z)};var Ye=new RegExp(Ne.join("|"),"i");(function(){function computeStyleTests(){if(se){ie.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0";se.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%";Ve.appendChild(ie).appendChild(se);var K=window.getComputedStyle(se);z="1%"!==K.top;re=12===roundPixelMeasures(K.marginLeft);se.style.right="60%";ne=36===roundPixelMeasures(K.right);ee=36===roundPixelMeasures(K.width);se.style.position="absolute";te=36===se.offsetWidth||"absolute";Ve.removeChild(ie);se=null}}function roundPixelMeasures(z){return Math.round(parseFloat(z))}var z,ee,te,ne,re,ie=K.createElement("div"),se=K.createElement("div");if(se.style){se.style.backgroundClip="content-box";se.cloneNode(true).style.backgroundClip="";he.clearCloneStyle="content-box"===se.style.backgroundClip;jQuery.extend(he,{boxSizingReliable:function(){computeStyleTests();return ee},pixelBoxStyles:function(){computeStyleTests();return ne},pixelPosition:function(){computeStyleTests();return z},reliableMarginLeft:function(){computeStyleTests();return re},scrollboxSize:function(){computeStyleTests();return te}})}})();function curCSS(z,K,ee){var te,ne,re,ie,se=z.style;ee=ee||getStyles(z);if(ee){ie=ee.getPropertyValue(K)||ee[K];""!==ie||jQuery.contains(z.ownerDocument,z)||(ie=jQuery.style(z,K));if(!he.pixelBoxStyles()&&Xe.test(ie)&&Ye.test(K)){te=se.width;ne=se.minWidth;re=se.maxWidth;se.minWidth=se.maxWidth=se.width=ie;ie=ee.width;se.width=te;se.minWidth=ne;se.maxWidth=re}}return void 0!==ie?ie+"":ie}function addGetHookIf(z,K){return{get:function(){if(!z())return(this.get=K).apply(this,arguments);delete this.get}}}var Ke=/^(none|table(?!-c[ea]).+)/,Je=/^--/,et={position:"absolute",visibility:"hidden",display:"block"},tt={letterSpacing:"0",fontWeight:"400"},nt=["Webkit","Moz","ms"],rt=K.createElement("div").style;function vendorPropName(z){if(z in rt)return z;var K=z[0].toUpperCase()+z.slice(1),ee=nt.length;while(ee--){z=nt[ee]+K;if(z in rt)return z}}function finalPropName(z){var K=jQuery.cssProps[z];K||(K=jQuery.cssProps[z]=vendorPropName(z)||z);return K}function setPositiveNumber(z,K,ee){var te=Be.exec(K);return te?Math.max(0,te[2]-(ee||0))+(te[3]||"px"):K}function boxModelAdjustment(z,K,ee,te,ne,re){var ie="width"===K?1:0,se=0,oe=0;if(ee===(te?"border":"content"))return 0;for(;ie<4;ie+=2){"margin"===ee&&(oe+=jQuery.css(z,ee+Ne[ie],true,ne));if(te){"content"===ee&&(oe-=jQuery.css(z,"padding"+Ne[ie],true,ne));"margin"!==ee&&(oe-=jQuery.css(z,"border"+Ne[ie]+"Width",true,ne))}else{oe+=jQuery.css(z,"padding"+Ne[ie],true,ne);"padding"!==ee?oe+=jQuery.css(z,"border"+Ne[ie]+"Width",true,ne):se+=jQuery.css(z,"border"+Ne[ie]+"Width",true,ne)}}!te&&re>=0&&(oe+=Math.max(0,Math.ceil(z["offset"+K[0].toUpperCase()+K.slice(1)]-re-oe-se-.5)));return oe}function getWidthOrHeight(z,K,ee){var te=getStyles(z),ne=curCSS(z,K,te),re="border-box"===jQuery.css(z,"boxSizing",false,te),ie=re;if(Xe.test(ne)){if(!ee)return ne;ne="auto"}ie=ie&&(he.boxSizingReliable()||ne===z.style[K]);if("auto"===ne||!parseFloat(ne)&&"inline"===jQuery.css(z,"display",false,te)){ne=z["offset"+K[0].toUpperCase()+K.slice(1)];ie=true}ne=parseFloat(ne)||0;return ne+boxModelAdjustment(z,K,ee||(re?"border":"content"),ie,te,ne)+"px"}jQuery.extend({cssHooks:{opacity:{get:function(z,K){if(K){var ee=curCSS(z,"opacity");return""===ee?"1":ee}}}},cssNumber:{animationIterationCount:true,columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{},style:function(z,K,ee,te){if(z&&3!==z.nodeType&&8!==z.nodeType&&z.style){var ne,re,ie,se=camelCase(K),oe=Je.test(K),ae=z.style;oe||(K=finalPropName(se));ie=jQuery.cssHooks[K]||jQuery.cssHooks[se];if(void 0===ee)return ie&&"get"in ie&&void 0!==(ne=ie.get(z,false,te))?ne:ae[K];re=typeof ee;if("string"===re&&(ne=Be.exec(ee))&&ne[1]){ee=adjustCSS(z,K,ne);re="number"}if(null!=ee&&ee===ee){"number"===re&&(ee+=ne&&ne[3]||(jQuery.cssNumber[se]?"":"px"));he.clearCloneStyle||""!==ee||0!==K.indexOf("background")||(ae[K]="inherit");ie&&"set"in ie&&void 0===(ee=ie.set(z,ee,te))||(oe?ae.setProperty(K,ee):ae[K]=ee)}}},css:function(z,K,ee,te){var ne,re,ie,se=camelCase(K),oe=Je.test(K);oe||(K=finalPropName(se));ie=jQuery.cssHooks[K]||jQuery.cssHooks[se];ie&&"get"in ie&&(ne=ie.get(z,true,ee));void 0===ne&&(ne=curCSS(z,K,te));"normal"===ne&&K in tt&&(ne=tt[K]);if(""===ee||ee){re=parseFloat(ne);return true===ee||isFinite(re)?re||0:ne}return ne}});jQuery.each(["height","width"],(function(z,K){jQuery.cssHooks[K]={get:function(z,ee,te){if(ee)return!Ke.test(jQuery.css(z,"display"))||z.getClientRects().length&&z.getBoundingClientRect().width?getWidthOrHeight(z,K,te):swap(z,et,(function(){return getWidthOrHeight(z,K,te)}))},set:function(z,ee,te){var ne,re=getStyles(z),ie="border-box"===jQuery.css(z,"boxSizing",false,re),se=te&&boxModelAdjustment(z,K,te,ie,re);ie&&he.scrollboxSize()===re.position&&(se-=Math.ceil(z["offset"+K[0].toUpperCase()+K.slice(1)]-parseFloat(re[K])-boxModelAdjustment(z,K,"border",false,re)-.5));if(se&&(ne=Be.exec(ee))&&"px"!==(ne[3]||"px")){z.style[K]=ee;ee=jQuery.css(z,K)}return setPositiveNumber(z,ee,se)}}}));jQuery.cssHooks.marginLeft=addGetHookIf(he.reliableMarginLeft,(function(z,K){if(K)return(parseFloat(curCSS(z,"marginLeft"))||z.getBoundingClientRect().left-swap(z,{marginLeft:0},(function(){return z.getBoundingClientRect().left})))+"px"}));jQuery.each({margin:"",padding:"",border:"Width"},(function(z,K){jQuery.cssHooks[z+K]={expand:function(ee){var te=0,ne={},re="string"===typeof ee?ee.split(" "):[ee];for(;te<4;te++)ne[z+Ne[te]+K]=re[te]||re[te-2]||re[0];return ne}};"margin"!==z&&(jQuery.cssHooks[z+K].set=setPositiveNumber)}));jQuery.fn.extend({css:function(z,K){return access(this,(function(z,K,ee){var te,ne,re={},ie=0;if(Array.isArray(K)){te=getStyles(z);ne=K.length;for(;ie<ne;ie++)re[K[ie]]=jQuery.css(z,K[ie],false,te);return re}return void 0!==ee?jQuery.style(z,K,ee):jQuery.css(z,K)}),z,K,arguments.length>1)}});jQuery.fn.delay=function(z,K){z=jQuery.fx&&jQuery.fx.speeds[z]||z;K=K||"fx";return this.queue(K,(function(K,ee){var te=window.setTimeout(K,z);ee.stop=function(){window.clearTimeout(te)}}))};(function(){var z=K.createElement("input"),ee=K.createElement("select"),te=ee.appendChild(K.createElement("option"));z.type="checkbox";he.checkOn=""!==z.value;he.optSelected=te.selected;z=K.createElement("input");z.value="t";z.type="radio";he.radioValue="t"===z.value})();var it,st=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(z,K){return access(this,jQuery.attr,z,K,arguments.length>1)},removeAttr:function(z){return this.each((function(){jQuery.removeAttr(this,z)}))}});jQuery.extend({attr:function(z,K,ee){var te,ne,re=z.nodeType;if(3!==re&&8!==re&&2!==re){if("undefined"===typeof z.getAttribute)return jQuery.prop(z,K,ee);1===re&&jQuery.isXMLDoc(z)||(ne=jQuery.attrHooks[K.toLowerCase()]||(jQuery.expr.match.bool.test(K)?it:void 0));if(void 0!==ee){if(null===ee){jQuery.removeAttr(z,K);return}if(ne&&"set"in ne&&void 0!==(te=ne.set(z,ee,K)))return te;z.setAttribute(K,ee+"");return ee}if(ne&&"get"in ne&&null!==(te=ne.get(z,K)))return te;te=jQuery.find.attr(z,K);return null==te?void 0:te}},attrHooks:{type:{set:function(z,K){if(!he.radioValue&&"radio"===K&&nodeName(z,"input")){var ee=z.value;z.setAttribute("type",K);ee&&(z.value=ee);return K}}}},removeAttr:function(z,K){var ee,te=0,ne=K&&K.match(Ce);if(ne&&1===z.nodeType)while(ee=ne[te++])z.removeAttribute(ee)}});it={set:function(z,K,ee){false===K?jQuery.removeAttr(z,ee):z.setAttribute(ee,ee);return ee}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),(function(z,K){var ee=st[K]||jQuery.find.attr;st[K]=function(z,K,te){var ne,re,ie=K.toLowerCase();if(!te){re=st[ie];st[ie]=ne;ne=null!=ee(z,K,te)?ie:null;st[ie]=re}return ne}}));var ot=/^(?:input|select|textarea|button)$/i,at=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(z,K){return access(this,jQuery.prop,z,K,arguments.length>1)},removeProp:function(z){return this.each((function(){delete this[jQuery.propFix[z]||z]}))}});jQuery.extend({prop:function(z,K,ee){var te,ne,re=z.nodeType;if(3!==re&&8!==re&&2!==re){if(1!==re||!jQuery.isXMLDoc(z)){K=jQuery.propFix[K]||K;ne=jQuery.propHooks[K]}return void 0!==ee?ne&&"set"in ne&&void 0!==(te=ne.set(z,ee,K))?te:z[K]=ee:ne&&"get"in ne&&null!==(te=ne.get(z,K))?te:z[K]}},propHooks:{tabIndex:{get:function(z){var K=jQuery.find.attr(z,"tabindex");return K?parseInt(K,10):ot.test(z.nodeName)||at.test(z.nodeName)&&z.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}});he.optSelected||(jQuery.propHooks.selected={get:function(z){var K=z.parentNode;K&&K.parentNode&&K.parentNode.selectedIndex;return null},set:function(z){var K=z.parentNode;if(K){K.selectedIndex;K.parentNode&&K.parentNode.selectedIndex}}});jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){jQuery.propFix[this.toLowerCase()]=this}));function stripAndCollapse(z){var K=z.match(Ce)||[];return K.join(" ")}function getClass(z){return z.getAttribute&&z.getAttribute("class")||""}function classesToArray(z){return Array.isArray(z)?z:"string"===typeof z&&z.match(Ce)||[]}jQuery.fn.extend({addClass:function(z){var K,ee,te,ne,re,ie,se,oe=0;if(ue(z))return this.each((function(K){jQuery(this).addClass(z.call(this,K,getClass(this)))}));K=classesToArray(z);if(K.length)while(ee=this[oe++]){ne=getClass(ee);te=1===ee.nodeType&&" "+stripAndCollapse(ne)+" ";if(te){ie=0;while(re=K[ie++])te.indexOf(" "+re+" ")<0&&(te+=re+" ");se=stripAndCollapse(te);ne!==se&&ee.setAttribute("class",se)}}return this},removeClass:function(z){var K,ee,te,ne,re,ie,se,oe=0;if(ue(z))return this.each((function(K){jQuery(this).removeClass(z.call(this,K,getClass(this)))}));if(!arguments.length)return this.attr("class","");K=classesToArray(z);if(K.length)while(ee=this[oe++]){ne=getClass(ee);te=1===ee.nodeType&&" "+stripAndCollapse(ne)+" ";if(te){ie=0;while(re=K[ie++])while(te.indexOf(" "+re+" ")>-1)te=te.replace(" "+re+" "," ");se=stripAndCollapse(te);ne!==se&&ee.setAttribute("class",se)}}return this},toggleClass:function(z,K){var ee=typeof z,te="string"===ee||Array.isArray(z);return"boolean"===typeof K&&te?K?this.addClass(z):this.removeClass(z):ue(z)?this.each((function(ee){jQuery(this).toggleClass(z.call(this,ee,getClass(this),K),K)})):this.each((function(){var K,ne,re,ie;if(te){ne=0;re=jQuery(this);ie=classesToArray(z);while(K=ie[ne++])re.hasClass(K)?re.removeClass(K):re.addClass(K)}else if(void 0===z||"boolean"===ee){K=getClass(this);K&&Me.set(this,"__className__",K);this.setAttribute&&this.setAttribute("class",K||false===z?"":Me.get(this,"__className__")||"")}}))},hasClass:function(z){var K,ee,te=0;K=" "+z+" ";while(ee=this[te++])if(1===ee.nodeType&&(" "+stripAndCollapse(getClass(ee))+" ").indexOf(K)>-1)return true;return false}});var lt=/\r/g;jQuery.fn.extend({val:function(z){var K,ee,te,ne=this[0];if(arguments.length){te=ue(z);return this.each((function(ee){var ne;if(1===this.nodeType){ne=te?z.call(this,ee,jQuery(this).val()):z;null==ne?ne="":"number"===typeof ne?ne+="":Array.isArray(ne)&&(ne=jQuery.map(ne,(function(z){return null==z?"":z+""})));K=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];K&&"set"in K&&void 0!==K.set(this,ne,"value")||(this.value=ne)}}))}if(ne){K=jQuery.valHooks[ne.type]||jQuery.valHooks[ne.nodeName.toLowerCase()];if(K&&"get"in K&&void 0!==(ee=K.get(ne,"value")))return ee;ee=ne.value;return"string"===typeof ee?ee.replace(lt,""):null==ee?"":ee}}});jQuery.extend({valHooks:{option:{get:function(z){var K=jQuery.find.attr(z,"value");return null!=K?K:stripAndCollapse(jQuery.text(z))}},select:{get:function(z){var K,ee,te,ne=z.options,re=z.selectedIndex,ie="select-one"===z.type,se=ie?null:[],oe=ie?re+1:ne.length;te=re<0?oe:ie?re:0;for(;te<oe;te++){ee=ne[te];if((ee.selected||te===re)&&!ee.disabled&&(!ee.parentNode.disabled||!nodeName(ee.parentNode,"optgroup"))){K=jQuery(ee).val();if(ie)return K;se.push(K)}}return se},set:function(z,K){var ee,te,ne=z.options,re=jQuery.makeArray(K),ie=ne.length;while(ie--){te=ne[ie];(te.selected=jQuery.inArray(jQuery.valHooks.option.get(te),re)>-1)&&(ee=true)}ee||(z.selectedIndex=-1);return re}}}});jQuery.each(["radio","checkbox"],(function(){jQuery.valHooks[this]={set:function(z,K){if(Array.isArray(K))return z.checked=jQuery.inArray(jQuery(z).val(),K)>-1}};he.checkOn||(jQuery.valHooks[this].get=function(z){return null===z.getAttribute("value")?"on":z.value})}));he.focusin="onfocusin"in window;var ct=/^(?:focusinfocus|focusoutblur)$/,stopPropagationCallback=function(z){z.stopPropagation()};jQuery.extend(jQuery.event,{trigger:function(z,ee,te,ne){var re,ie,se,oe,le,ce,he,fe,pe=[te||K],ge=ae.call(z,"type")?z.type:z,me=ae.call(z,"namespace")?z.namespace.split("."):[];ie=fe=se=te=te||K;if(3!==te.nodeType&&8!==te.nodeType&&!ct.test(ge+jQuery.event.triggered)){if(ge.indexOf(".")>-1){me=ge.split(".");ge=me.shift();me.sort()}le=ge.indexOf(":")<0&&"on"+ge;z=z[jQuery.expando]?z:new jQuery.Event(ge,"object"===typeof z&&z);z.isTrigger=ne?2:3;z.namespace=me.join(".");z.rnamespace=z.namespace?new RegExp("(^|\\.)"+me.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;z.result=void 0;z.target||(z.target=te);ee=null==ee?[z]:jQuery.makeArray(ee,[z]);he=jQuery.event.special[ge]||{};if(ne||!he.trigger||false!==he.trigger.apply(te,ee)){if(!ne&&!he.noBubble&&!de(te)){oe=he.delegateType||ge;ct.test(oe+ge)||(ie=ie.parentNode);for(;ie;ie=ie.parentNode){pe.push(ie);se=ie}se===(te.ownerDocument||K)&&pe.push(se.defaultView||se.parentWindow||window)}re=0;while((ie=pe[re++])&&!z.isPropagationStopped()){fe=ie;z.type=re>1?oe:he.bindType||ge;ce=(Me.get(ie,"events")||{})[z.type]&&Me.get(ie,"handle");ce&&ce.apply(ie,ee);ce=le&&ie[le];if(ce&&ce.apply&&acceptData(ie)){z.result=ce.apply(ie,ee);false===z.result&&z.preventDefault()}}z.type=ge;if(!ne&&!z.isDefaultPrevented()&&(!he._default||false===he._default.apply(pe.pop(),ee))&&acceptData(te)&&le&&ue(te[ge])&&!de(te)){se=te[le];se&&(te[le]=null);jQuery.event.triggered=ge;z.isPropagationStopped()&&fe.addEventListener(ge,stopPropagationCallback);te[ge]();z.isPropagationStopped()&&fe.removeEventListener(ge,stopPropagationCallback);jQuery.event.triggered=void 0;se&&(te[le]=se)}return z.result}}},simulate:function(z,K,ee){var te=jQuery.extend(new jQuery.Event,ee,{type:z,isSimulated:true});jQuery.event.trigger(te,null,K)}});jQuery.fn.extend({trigger:function(z,K){return this.each((function(){jQuery.event.trigger(z,K,this)}))},triggerHandler:function(z,K){var ee=this[0];if(ee)return jQuery.event.trigger(z,K,ee,true)}});he.focusin||jQuery.each({focus:"focusin",blur:"focusout"},(function(z,K){var handler=function(z){jQuery.event.simulate(K,z.target,jQuery.event.fix(z))};jQuery.event.special[K]={setup:function(){var ee=this.ownerDocument||this,te=Me.access(ee,K);te||ee.addEventListener(z,handler,true);Me.access(ee,K,(te||0)+1)},teardown:function(){var ee=this.ownerDocument||this,te=Me.access(ee,K)-1;if(te)Me.access(ee,K,te);else{ee.removeEventListener(z,handler,true);Me.remove(ee,K)}}}}));var ht=/\[\]$/,ut=/\r?\n/g,dt=/^(?:submit|button|image|reset|file)$/i,ft=/^(?:input|select|textarea|keygen)/i;function buildParams(z,K,ee,te){var ne;if(Array.isArray(K))jQuery.each(K,(function(K,ne){ee||ht.test(z)?te(z,ne):buildParams(z+"["+("object"===typeof ne&&null!=ne?K:"")+"]",ne,ee,te)}));else if(ee||"object"!==toType(K))te(z,K);else for(ne in K)buildParams(z+"["+ne+"]",K[ne],ee,te)}jQuery.param=function(z,K){var ee,te=[],add=function(z,K){var ee=ue(K)?K():K;te[te.length]=encodeURIComponent(z)+"="+encodeURIComponent(null==ee?"":ee)};if(Array.isArray(z)||z.jquery&&!jQuery.isPlainObject(z))jQuery.each(z,(function(){add(this.name,this.value)}));else for(ee in z)buildParams(ee,z[ee],K,add);return te.join("&")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var z=jQuery.prop(this,"elements");return z?jQuery.makeArray(z):this})).filter((function(){var z=this.type;return this.name&&!jQuery(this).is(":disabled")&&ft.test(this.nodeName)&&!dt.test(z)&&(this.checked||!Pe.test(z))})).map((function(z,K){var ee=jQuery(this).val();return null==ee?null:Array.isArray(ee)?jQuery.map(ee,(function(z){return{name:K.name,value:z.replace(ut,"\r\n")}})):{name:K.name,value:ee.replace(ut,"\r\n")}})).get()}});jQuery.fn.extend({wrapAll:function(z){var K;if(this[0]){ue(z)&&(z=z.call(this[0]));K=jQuery(z,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&K.insertBefore(this[0]);K.map((function(){var z=this;while(z.firstElementChild)z=z.firstElementChild;return z})).append(this)}return this},wrapInner:function(z){return ue(z)?this.each((function(K){jQuery(this).wrapInner(z.call(this,K))})):this.each((function(){var K=jQuery(this),ee=K.contents();ee.length?ee.wrapAll(z):K.append(z)}))},wrap:function(z){var K=ue(z);return this.each((function(ee){jQuery(this).wrapAll(K?z.call(this,ee):z)}))},unwrap:function(z){this.parent(z).not("body").each((function(){jQuery(this).replaceWith(this.childNodes)}));return this}});jQuery.expr.pseudos.hidden=function(z){return!jQuery.expr.pseudos.visible(z)};jQuery.expr.pseudos.visible=function(z){return!!(z.offsetWidth||z.offsetHeight||z.getClientRects().length)};he.createHTMLDocument=function(){var z=K.implementation.createHTMLDocument("").body;z.innerHTML="<form></form><form></form>";return 2===z.childNodes.length}();jQuery.parseHTML=function(z,ee,te){if("string"!==typeof z)return[];if("boolean"===typeof ee){te=ee;ee=false}var ne,re,ie;if(!ee)if(he.createHTMLDocument){ee=K.implementation.createHTMLDocument("");ne=ee.createElement("base");ne.href=K.location.href;ee.head.appendChild(ne)}else ee=K;re=ve.exec(z);ie=!te&&[];if(re)return[ee.createElement(re[1])];re=buildFragment([z],ee,ie);ie&&ie.length&&jQuery(ie).remove();return jQuery.merge([],re.childNodes)};jQuery.offset={setOffset:function(z,K,ee){var te,ne,re,ie,se,oe,ae,le=jQuery.css(z,"position"),ce=jQuery(z),he={};"static"===le&&(z.style.position="relative");se=ce.offset();re=jQuery.css(z,"top");oe=jQuery.css(z,"left");ae=("absolute"===le||"fixed"===le)&&(re+oe).indexOf("auto")>-1;if(ae){te=ce.position();ie=te.top;ne=te.left}else{ie=parseFloat(re)||0;ne=parseFloat(oe)||0}ue(K)&&(K=K.call(z,ee,jQuery.extend({},se)));null!=K.top&&(he.top=K.top-se.top+ie);null!=K.left&&(he.left=K.left-se.left+ne);"using"in K?K.using.call(z,he):ce.css(he)}};jQuery.fn.extend({offset:function(z){if(arguments.length)return void 0===z?this:this.each((function(K){jQuery.offset.setOffset(this,z,K)}));var K,ee,te=this[0];if(te){if(!te.getClientRects().length)return{top:0,left:0};K=te.getBoundingClientRect();ee=te.ownerDocument.defaultView;return{top:K.top+ee.pageYOffset,left:K.left+ee.pageXOffset}}},position:function(){if(this[0]){var z,K,ee,te=this[0],ne={top:0,left:0};if("fixed"===jQuery.css(te,"position"))K=te.getBoundingClientRect();else{K=this.offset();ee=te.ownerDocument;z=te.offsetParent||ee.documentElement;while(z&&(z===ee.body||z===ee.documentElement)&&"static"===jQuery.css(z,"position"))z=z.parentNode;if(z&&z!==te&&1===z.nodeType){ne=jQuery(z).offset();ne.top+=jQuery.css(z,"borderTopWidth",true);ne.left+=jQuery.css(z,"borderLeftWidth",true)}}return{top:K.top-ne.top-jQuery.css(te,"marginTop",true),left:K.left-ne.left-jQuery.css(te,"marginLeft",true)}}},offsetParent:function(){return this.map((function(){var z=this.offsetParent;while(z&&"static"===jQuery.css(z,"position"))z=z.offsetParent;return z||Ve}))}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(z,K){var ee="pageYOffset"===K;jQuery.fn[z]=function(te){return access(this,(function(z,te,ne){var re;de(z)?re=z:9===z.nodeType&&(re=z.defaultView);if(void 0===ne)return re?re[K]:z[te];re?re.scrollTo(ee?re.pageXOffset:ne,ee?ne:re.pageYOffset):z[te]=ne}),z,te,arguments.length)}}));jQuery.each(["top","left"],(function(z,K){jQuery.cssHooks[K]=addGetHookIf(he.pixelPosition,(function(z,ee){if(ee){ee=curCSS(z,K);return Xe.test(ee)?jQuery(z).position()[K]+"px":ee}}))}));jQuery.each({Height:"height",Width:"width"},(function(z,K){jQuery.each({padding:"inner"+z,content:K,"":"outer"+z},(function(ee,te){jQuery.fn[te]=function(ne,re){var ie=arguments.length&&(ee||"boolean"!==typeof ne),se=ee||(true===ne||true===re?"margin":"border");return access(this,(function(K,ee,ne){var re;if(de(K))return 0===te.indexOf("outer")?K["inner"+z]:K.document.documentElement["client"+z];if(9===K.nodeType){re=K.documentElement;return Math.max(K.body["scroll"+z],re["scroll"+z],K.body["offset"+z],re["offset"+z],re["client"+z])}return void 0===ne?jQuery.css(K,ee,se):jQuery.style(K,ee,ne,se)}),K,ie?ne:void 0,ie)}}))}));jQuery.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(z,K){jQuery.fn[K]=function(z,ee){return arguments.length>0?this.on(K,null,z,ee):this.trigger(K)}}));jQuery.fn.extend({hover:function(z,K){return this.mouseenter(z).mouseleave(K||z)}});jQuery.fn.extend({bind:function(z,K,ee){return this.on(z,null,K,ee)},unbind:function(z,K){return this.off(z,null,K)},delegate:function(z,K,ee,te){return this.on(K,z,ee,te)},undelegate:function(z,K,ee){return 1===arguments.length?this.off(z,"**"):this.off(K,z||"**",ee)}});jQuery.proxy=function(z,K){var ee,ne,re;if("string"===typeof K){ee=z[K];K=z;z=ee}if(ue(z)){ne=te.call(arguments,2);re=function(){return z.apply(K||this,ne.concat(te.call(arguments)))};re.guid=z.guid=z.guid||jQuery.guid++;return re}};jQuery.holdReady=function(z){z?jQuery.readyWait++:jQuery.ready(true)};jQuery.isArray=Array.isArray;jQuery.parseJSON=JSON.parse;jQuery.nodeName=nodeName;jQuery.isFunction=ue;jQuery.isWindow=de;jQuery.camelCase=camelCase;jQuery.type=toType;jQuery.now=Date.now;jQuery.isNumeric=function(z){var K=jQuery.type(z);return("number"===K||"string"===K)&&!isNaN(z-parseFloat(z))};const pt=jQuery;function div(z){return create$1("div",z)}function create$1(z,K){const ee=document.createElement(z);if(K){K.class&&ee.classList.add(K.class);K.id&&(ee.id=K.id);K.style&&applyStyle(ee,K.style)}return ee}function hide(z){const K=getComputedStyle(z);"none"!==K.display&&(z._initialDisplay=K.display);z.style.display="none"}function show(z){const K=getComputedStyle(z).display;if("none"===K){const K=z._initialDisplay||"block";z.style.display=K}}function hideAll(z){document.querySelectorAll(z).forEach((z=>{hide(z)}))}function empty(z){while(z.firstChild)z.removeChild(z.firstChild)}function offset(z){if(!z.getClientRects().length)return{top:0,left:0};const K=z.getBoundingClientRect();const ee=z.ownerDocument.defaultView;return{top:K.top+ee.pageYOffset,left:K.left+ee.pageXOffset}}function pageCoordinates(z){if(z.type.startsWith("touch")){const K=z.touches[0];return{x:K.pageX,y:K.pageY}}return{x:z.pageX,y:z.pageY}}const relativeDOMBBox=(z,K)=>{const{x:ee,y:te,width:ne,height:re}=z.getBoundingClientRect();const{x:ie,y:se,width:oe,height:ae}=K.getBoundingClientRect();return{x:ie-ee,y:se-te,width:oe,height:ae}};function applyStyle(z,K){for(let ee of Object.keys(K))z.style[ee]=K[ee]}function guid$2(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}let getMouseXY=(z,{clientX:K,clientY:ee})=>{const{left:te,top:ne,width:re,height:ie}=z.getBoundingClientRect();const se=K-te;const oe=ee-ne;return{x:se,y:oe,xNormalized:se/re,yNormalized:oe/ie,width:re,height:ie}};
/**
     * Translate the mouse coordinates for the event to the coordinates for the given target element
     * @param event
     * @param domElement
     * @returns {{x: number, y: number}}
     */function translateMouseCoordinates(z,K){const{clientX:ee,clientY:te}=z;return getMouseXY(K,{clientX:ee,clientY:te})}var gt=Object.freeze({__proto__:null,applyStyle:applyStyle,create:create$1,div:div,empty:empty,guid:guid$2,hide:hide,hideAll:hideAll,offset:offset,pageCoordinates:pageCoordinates,relativeDOMBBox:relativeDOMBBox,show:show,translateMouseCoordinates:translateMouseCoordinates});
/*! @license DOMPurify 3.0.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.0.5/LICENSE */const{entries:mt,setPrototypeOf:bt,isFrozen:vt,getPrototypeOf:wt,getOwnPropertyDescriptor:yt}=Object;let{freeze:_t,seal:kt,create:xt}=Object;let{apply:Ct,construct:St}="undefined"!==typeof Reflect&&Reflect;Ct||(Ct=function apply(z,K,ee){return z.apply(K,ee)});_t||(_t=function freeze(z){return z});kt||(kt=function seal(z){return z});St||(St=function construct(z,K){return new z(...K)});const At=unapply(Array.prototype.forEach);const Tt=unapply(Array.prototype.pop);const Et=unapply(Array.prototype.push);const Mt=unapply(String.prototype.toLowerCase);const Rt=unapply(String.prototype.toString);const It=unapply(String.prototype.match);const Ft=unapply(String.prototype.replace);const Lt=unapply(String.prototype.indexOf);const Bt=unapply(String.prototype.trim);const Nt=unapply(RegExp.prototype.test);const Dt=unconstruct(TypeError);function unapply(z){return function(K){for(var ee=arguments.length,te=new Array(ee>1?ee-1:0),ne=1;ne<ee;ne++)te[ne-1]=arguments[ne];return Ct(z,K,te)}}function unconstruct(z){return function(){for(var K=arguments.length,ee=new Array(K),te=0;te<K;te++)ee[te]=arguments[te];return St(z,ee)}}function addToSet(z,K,ee){var te;ee=null!==(te=ee)&&void 0!==te?te:Mt;bt&&bt(z,null);let ne=K.length;while(ne--){let te=K[ne];if("string"===typeof te){const z=ee(te);if(z!==te){vt(K)||(K[ne]=z);te=z}}z[te]=true}return z}function clone(z){const K=xt(null);for(const[ee,te]of mt(z))K[ee]=te;return K}function lookupGetter(z,K){while(null!==z){const ee=yt(z,K);if(ee){if(ee.get)return unapply(ee.get);if("function"===typeof ee.value)return unapply(ee.value)}z=wt(z)}function fallbackValue(z){console.warn("fallback value for",z);return null}return fallbackValue}const Pt=_t(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]);const Ot=_t(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]);const zt=_t(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]);const Ht=_t(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]);const Ut=_t(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]);const Vt=_t(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]);const $t=_t(["#text"]);const qt=_t(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]);const jt=_t(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]);const Wt=_t(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]);const Gt=_t(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]);const Zt=kt(/\{\{[\w\W]*|[\w\W]*\}\}/gm);const Qt=kt(/<%[\w\W]*|[\w\W]*%>/gm);const Xt=kt(/\${[\w\W]*}/gm);const Yt=kt(/^data-[\-\w.\u00B7-\uFFFF]/);const Kt=kt(/^aria-[\-\w]+$/);const Jt=kt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i);const en=kt(/^(?:\w+script|data):/i);const tn=kt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g);const nn=kt(/^html$/i);var rn=Object.freeze({__proto__:null,MUSTACHE_EXPR:Zt,ERB_EXPR:Qt,TMPLIT_EXPR:Xt,DATA_ATTR:Yt,ARIA_ATTR:Kt,IS_ALLOWED_URI:Jt,IS_SCRIPT_OR_DATA:en,ATTR_WHITESPACE:tn,DOCTYPE_NAME:nn});const getGlobal=()=>"undefined"===typeof window?null:window
/**
     * Creates a no-op policy for internal use only.
     * Don't export this function outside this module!
     * @param {?TrustedTypePolicyFactory} trustedTypes The policy factory.
     * @param {HTMLScriptElement} purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).
     * @return {?TrustedTypePolicy} The policy created (or null, if Trusted Types
     * are not supported or creating the policy failed).
     */;const sn=function _createTrustedTypesPolicy(z,K){if("object"!==typeof z||"function"!==typeof z.createPolicy)return null;let ee=null;const te="data-tt-policy-suffix";K&&K.hasAttribute(te)&&(ee=K.getAttribute(te));const ne="dompurify"+(ee?"#"+ee:"");try{return z.createPolicy(ne,{createHTML(z){return z},createScriptURL(z){return z}})}catch(z){console.warn("TrustedTypes policy "+ne+" could not be created.");return null}};function createDOMPurify(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:getGlobal();const DOMPurify=z=>createDOMPurify(z);DOMPurify.version="3.0.5";DOMPurify.removed=[];if(!z||!z.document||9!==z.document.nodeType){DOMPurify.isSupported=false;return DOMPurify}const K=z.document;const ee=K.currentScript;let{document:te}=z;const{DocumentFragment:ne,HTMLTemplateElement:re,Node:ie,Element:se,NodeFilter:oe,NamedNodeMap:ae=z.NamedNodeMap||z.MozNamedAttrMap,HTMLFormElement:le,DOMParser:ce,trustedTypes:he}=z;const ue=se.prototype;const de=lookupGetter(ue,"cloneNode");const fe=lookupGetter(ue,"nextSibling");const pe=lookupGetter(ue,"childNodes");const ge=lookupGetter(ue,"parentNode");if("function"===typeof re){const z=te.createElement("template");z.content&&z.content.ownerDocument&&(te=z.content.ownerDocument)}let me;let be="";const{implementation:ve,createNodeIterator:we,createDocumentFragment:ye,getElementsByTagName:_e}=te;const{importNode:ke}=K;let xe={};DOMPurify.isSupported="function"===typeof mt&&"function"===typeof ge&&ve&&void 0!==ve.createHTMLDocument;const{MUSTACHE_EXPR:Ce,ERB_EXPR:Se,TMPLIT_EXPR:Ae,DATA_ATTR:Te,ARIA_ATTR:Ee,IS_SCRIPT_OR_DATA:Me,ATTR_WHITESPACE:Re}=rn;let{IS_ALLOWED_URI:Ie}=rn;let Fe=null;const Le=addToSet({},[...Pt,...Ot,...zt,...Ut,...$t]);let Be=null;const Ne=addToSet({},[...qt,...jt,...Wt,...Gt]);let De=Object.seal(Object.create(null,{tagNameCheck:{writable:true,configurable:false,enumerable:true,value:null},attributeNameCheck:{writable:true,configurable:false,enumerable:true,value:null},allowCustomizedBuiltInElements:{writable:true,configurable:false,enumerable:true,value:false}}));let Pe=null;let Oe=null;let ze=true;let He=true;let Ue=false;let Ve=true;let $e=false;let qe=false;let je=false;let We=false;let Ge=false;let Ze=false;let Qe=false;let Xe=true;let Ye=false;const Ke="user-content-";let Je=true;let et=false;let tt={};let nt=null;const rt=addToSet({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let it=null;const st=addToSet({},["audio","video","img","source","image","track"]);let ot=null;const at=addToSet({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]);const lt="http://www.w3.org/1998/Math/MathML";const ct="http://www.w3.org/2000/svg";const ht="http://www.w3.org/1999/xhtml";let ut=ht;let dt=false;let ft=null;const pt=addToSet({},[lt,ct,ht],Rt);let gt;const bt=["application/xhtml+xml","text/html"];const vt="text/html";let wt;let yt=null;const kt=te.createElement("form");const xt=function isRegexOrFunction(z){return z instanceof RegExp||z instanceof Function};
/**
       * _parseConfig
       *
       * @param  {Object} cfg optional config literal
       */const Ct=function _parseConfig(z){if(!yt||yt!==z){z&&"object"===typeof z||(z={});z=clone(z);gt=gt=-1===bt.indexOf(z.PARSER_MEDIA_TYPE)?vt:z.PARSER_MEDIA_TYPE;wt="application/xhtml+xml"===gt?Rt:Mt;Fe="ALLOWED_TAGS"in z?addToSet({},z.ALLOWED_TAGS,wt):Le;Be="ALLOWED_ATTR"in z?addToSet({},z.ALLOWED_ATTR,wt):Ne;ft="ALLOWED_NAMESPACES"in z?addToSet({},z.ALLOWED_NAMESPACES,Rt):pt;ot="ADD_URI_SAFE_ATTR"in z?addToSet(clone(at),z.ADD_URI_SAFE_ATTR,wt):at;it="ADD_DATA_URI_TAGS"in z?addToSet(clone(st),z.ADD_DATA_URI_TAGS,wt):st;nt="FORBID_CONTENTS"in z?addToSet({},z.FORBID_CONTENTS,wt):rt;Pe="FORBID_TAGS"in z?addToSet({},z.FORBID_TAGS,wt):{};Oe="FORBID_ATTR"in z?addToSet({},z.FORBID_ATTR,wt):{};tt="USE_PROFILES"in z&&z.USE_PROFILES;ze=false!==z.ALLOW_ARIA_ATTR;He=false!==z.ALLOW_DATA_ATTR;Ue=z.ALLOW_UNKNOWN_PROTOCOLS||false;Ve=false!==z.ALLOW_SELF_CLOSE_IN_ATTR;$e=z.SAFE_FOR_TEMPLATES||false;qe=z.WHOLE_DOCUMENT||false;Ge=z.RETURN_DOM||false;Ze=z.RETURN_DOM_FRAGMENT||false;Qe=z.RETURN_TRUSTED_TYPE||false;We=z.FORCE_BODY||false;Xe=false!==z.SANITIZE_DOM;Ye=z.SANITIZE_NAMED_PROPS||false;Je=false!==z.KEEP_CONTENT;et=z.IN_PLACE||false;Ie=z.ALLOWED_URI_REGEXP||Jt;ut=z.NAMESPACE||ht;De=z.CUSTOM_ELEMENT_HANDLING||{};z.CUSTOM_ELEMENT_HANDLING&&xt(z.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(De.tagNameCheck=z.CUSTOM_ELEMENT_HANDLING.tagNameCheck);z.CUSTOM_ELEMENT_HANDLING&&xt(z.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(De.attributeNameCheck=z.CUSTOM_ELEMENT_HANDLING.attributeNameCheck);z.CUSTOM_ELEMENT_HANDLING&&"boolean"===typeof z.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(De.allowCustomizedBuiltInElements=z.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements);$e&&(He=false);Ze&&(Ge=true);if(tt){Fe=addToSet({},[...$t]);Be=[];if(true===tt.html){addToSet(Fe,Pt);addToSet(Be,qt)}if(true===tt.svg){addToSet(Fe,Ot);addToSet(Be,jt);addToSet(Be,Gt)}if(true===tt.svgFilters){addToSet(Fe,zt);addToSet(Be,jt);addToSet(Be,Gt)}if(true===tt.mathMl){addToSet(Fe,Ut);addToSet(Be,Wt);addToSet(Be,Gt)}}if(z.ADD_TAGS){Fe===Le&&(Fe=clone(Fe));addToSet(Fe,z.ADD_TAGS,wt)}if(z.ADD_ATTR){Be===Ne&&(Be=clone(Be));addToSet(Be,z.ADD_ATTR,wt)}z.ADD_URI_SAFE_ATTR&&addToSet(ot,z.ADD_URI_SAFE_ATTR,wt);if(z.FORBID_CONTENTS){nt===rt&&(nt=clone(nt));addToSet(nt,z.FORBID_CONTENTS,wt)}Je&&(Fe["#text"]=true);qe&&addToSet(Fe,["html","head","body"]);if(Fe.table){addToSet(Fe,["tbody"]);delete Pe.tbody}if(z.TRUSTED_TYPES_POLICY){if("function"!==typeof z.TRUSTED_TYPES_POLICY.createHTML)throw Dt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!==typeof z.TRUSTED_TYPES_POLICY.createScriptURL)throw Dt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');me=z.TRUSTED_TYPES_POLICY;be=me.createHTML("")}else{void 0===me&&(me=sn(he,ee));null!==me&&"string"===typeof be&&(be=me.createHTML(""))}_t&&_t(z);yt=z}};const St=addToSet({},["mi","mo","mn","ms","mtext"]);const Zt=addToSet({},["foreignobject","desc","title","annotation-xml"]);const Qt=addToSet({},["title","style","font","a","script"]);const Xt=addToSet({},Ot);addToSet(Xt,zt);addToSet(Xt,Ht);const Yt=addToSet({},Ut);addToSet(Yt,Vt);
/**
       *
       *
       * @param  {Element} element a DOM element whose namespace is being checked
       * @returns {boolean} Return false if the element has a
       *  namespace that a spec-compliant parser would never
       *  return. Return true otherwise.
       */const Kt=function _checkValidNamespace(z){let K=ge(z);K&&K.tagName||(K={namespaceURI:ut,tagName:"template"});const ee=Mt(z.tagName);const te=Mt(K.tagName);return!!ft[z.namespaceURI]&&(z.namespaceURI===ct?K.namespaceURI===ht?"svg"===ee:K.namespaceURI===lt?"svg"===ee&&("annotation-xml"===te||St[te]):Boolean(Xt[ee]):z.namespaceURI===lt?K.namespaceURI===ht?"math"===ee:K.namespaceURI===ct?"math"===ee&&Zt[te]:Boolean(Yt[ee]):z.namespaceURI===ht?!(K.namespaceURI===ct&&!Zt[te])&&(!(K.namespaceURI===lt&&!St[te])&&(!Yt[ee]&&(Qt[ee]||!Xt[ee]))):!("application/xhtml+xml"!==gt||!ft[z.namespaceURI]))};
/**
       * _forceRemove
       *
       * @param  {Node} node a DOM node
       */const en=function _forceRemove(z){Et(DOMPurify.removed,{element:z});try{z.parentNode.removeChild(z)}catch(K){z.remove()}};
/**
       * _removeAttribute
       *
       * @param  {String} name an Attribute name
       * @param  {Node} node a DOM node
       */const tn=function _removeAttribute(z,K){try{Et(DOMPurify.removed,{attribute:K.getAttributeNode(z),from:K})}catch(z){Et(DOMPurify.removed,{attribute:null,from:K})}K.removeAttribute(z);if("is"===z&&!Be[z])if(Ge||Ze)try{en(K)}catch(z){}else try{K.setAttribute(z,"")}catch(z){}};
/**
       * _initDocument
       *
       * @param  {String} dirty a string of dirty markup
       * @return {Document} a DOM, filled with the dirty markup
       */const an=function _initDocument(z){let K;let ee;if(We)z="<remove></remove>"+z;else{const K=It(z,/^[\r\n\t ]+/);ee=K&&K[0]}"application/xhtml+xml"===gt&&ut===ht&&(z='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+z+"</body></html>");const ne=me?me.createHTML(z):z;if(ut===ht)try{K=(new ce).parseFromString(ne,gt)}catch(z){}if(!K||!K.documentElement){K=ve.createDocument(ut,"template",null);try{K.documentElement.innerHTML=dt?be:ne}catch(z){}}const re=K.body||K.documentElement;z&&ee&&re.insertBefore(te.createTextNode(ee),re.childNodes[0]||null);return ut===ht?_e.call(K,qe?"html":"body")[0]:qe?K.documentElement:re};
/**
       * _createIterator
       *
       * @param  {Document} root document/fragment to create iterator for
       * @return {Iterator} iterator instance
       */const ln=function _createIterator(z){return we.call(z.ownerDocument||z,z,oe.SHOW_ELEMENT|oe.SHOW_COMMENT|oe.SHOW_TEXT,null,false)};
/**
       * _isClobbered
       *
       * @param  {Node} elm element to check for clobbering attacks
       * @return {Boolean} true if clobbered, false if safe
       */const cn=function _isClobbered(z){return z instanceof le&&("string"!==typeof z.nodeName||"string"!==typeof z.textContent||"function"!==typeof z.removeChild||!(z.attributes instanceof ae)||"function"!==typeof z.removeAttribute||"function"!==typeof z.setAttribute||"string"!==typeof z.namespaceURI||"function"!==typeof z.insertBefore||"function"!==typeof z.hasChildNodes)};
/**
       * _isNode
       *
       * @param  {Node} obj object to check whether it's a DOM node
       * @return {Boolean} true is object is a DOM node
       */const hn=function _isNode(z){return"object"===typeof ie?z instanceof ie:z&&"object"===typeof z&&"number"===typeof z.nodeType&&"string"===typeof z.nodeName};
/**
       * _executeHook
       * Execute user configurable hooks
       *
       * @param  {String} entryPoint  Name of the hook's entry point
       * @param  {Node} currentNode node to work on with the hook
       * @param  {Object} data additional hook parameters
       */const un=function _executeHook(z,K,ee){xe[z]&&At(xe[z],(z=>{z.call(DOMPurify,K,ee,yt)}))};
/**
       * _sanitizeElements
       *
       * @protect nodeName
       * @protect textContent
       * @protect removeChild
       *
       * @param   {Node} currentNode to check for permission to exist
       * @return  {Boolean} true if node was killed, false if left alive
       */const dn=function _sanitizeElements(z){let K;un("beforeSanitizeElements",z,null);if(cn(z)){en(z);return true}const ee=wt(z.nodeName);un("uponSanitizeElement",z,{tagName:ee,allowedTags:Fe});if(z.hasChildNodes()&&!hn(z.firstElementChild)&&(!hn(z.content)||!hn(z.content.firstElementChild))&&Nt(/<[/\w]/g,z.innerHTML)&&Nt(/<[/\w]/g,z.textContent)){en(z);return true}if(!Fe[ee]||Pe[ee]){if(!Pe[ee]&&gn(ee)){if(De.tagNameCheck instanceof RegExp&&Nt(De.tagNameCheck,ee))return false;if(De.tagNameCheck instanceof Function&&De.tagNameCheck(ee))return false}if(Je&&!nt[ee]){const K=ge(z)||z.parentNode;const ee=pe(z)||z.childNodes;if(ee&&K){const te=ee.length;for(let ne=te-1;ne>=0;--ne)K.insertBefore(de(ee[ne],true),fe(z))}}en(z);return true}if(z instanceof se&&!Kt(z)){en(z);return true}if(("noscript"===ee||"noembed"===ee||"noframes"===ee)&&Nt(/<\/no(script|embed|frames)/i,z.innerHTML)){en(z);return true}if($e&&3===z.nodeType){K=z.textContent;K=Ft(K,Ce," ");K=Ft(K,Se," ");K=Ft(K,Ae," ");if(z.textContent!==K){Et(DOMPurify.removed,{element:z.cloneNode()});z.textContent=K}}un("afterSanitizeElements",z,null);return false};
/**
       * _isValidAttribute
       *
       * @param  {string} lcTag Lowercase tag name of containing element.
       * @param  {string} lcName Lowercase attribute name.
       * @param  {string} value Attribute value.
       * @return {Boolean} Returns true if `value` is valid, otherwise false.
       */const pn=function _isValidAttribute(z,K,ee){if(Xe&&("id"===K||"name"===K)&&(ee in te||ee in kt))return false;if(He&&!Oe[K]&&Nt(Te,K));else if(ze&&Nt(Ee,K));else if(!Be[K]||Oe[K]){if(!(gn(z)&&(De.tagNameCheck instanceof RegExp&&Nt(De.tagNameCheck,z)||De.tagNameCheck instanceof Function&&De.tagNameCheck(z))&&(De.attributeNameCheck instanceof RegExp&&Nt(De.attributeNameCheck,K)||De.attributeNameCheck instanceof Function&&De.attributeNameCheck(K))||"is"===K&&De.allowCustomizedBuiltInElements&&(De.tagNameCheck instanceof RegExp&&Nt(De.tagNameCheck,ee)||De.tagNameCheck instanceof Function&&De.tagNameCheck(ee))))return false}else if(ot[K]);else if(Nt(Ie,Ft(ee,Re,"")));else if("src"!==K&&"xlink:href"!==K&&"href"!==K||"script"===z||0!==Lt(ee,"data:")||!it[z]){if(Ue&&!Nt(Me,Ft(ee,Re,"")));else if(ee)return false}else;return true};
/**
       * _basicCustomElementCheck
       * checks if at least one dash is included in tagName, and it's not the first char
       * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name
       * @param {string} tagName name of the tag of the node to sanitize
       */const gn=function _basicCustomElementTest(z){return z.indexOf("-")>0};
/**
       * _sanitizeAttributes
       *
       * @protect attributes
       * @protect nodeName
       * @protect removeAttribute
       * @protect setAttribute
       *
       * @param  {Node} currentNode to sanitize
       */const mn=function _sanitizeAttributes(z){let K;let ee;let te;let ne;un("beforeSanitizeAttributes",z,null);const{attributes:re}=z;if(!re)return;const ie={attrName:"",attrValue:"",keepAttr:true,allowedAttributes:Be};ne=re.length;while(ne--){K=re[ne];const{name:se,namespaceURI:oe}=K;ee="value"===se?K.value:Bt(K.value);te=wt(se);ie.attrName=te;ie.attrValue=ee;ie.keepAttr=true;ie.forceKeepAttr=void 0;un("uponSanitizeAttribute",z,ie);ee=ie.attrValue;if(ie.forceKeepAttr)continue;tn(se,z);if(!ie.keepAttr)continue;if(!Ve&&Nt(/\/>/i,ee)){tn(se,z);continue}if($e){ee=Ft(ee,Ce," ");ee=Ft(ee,Se," ");ee=Ft(ee,Ae," ")}const ae=wt(z.nodeName);if(pn(ae,te,ee)){if(Ye&&("id"===te||"name"===te)){tn(se,z);ee=Ke+ee}if(me&&"object"===typeof he&&"function"===typeof he.getAttributeType)if(oe);else switch(he.getAttributeType(ae,te)){case"TrustedHTML":ee=me.createHTML(ee);break;case"TrustedScriptURL":ee=me.createScriptURL(ee);break}try{oe?z.setAttributeNS(oe,se,ee):z.setAttribute(se,ee);Tt(DOMPurify.removed)}catch(z){}}}un("afterSanitizeAttributes",z,null)};
/**
       * _sanitizeShadowDOM
       *
       * @param  {DocumentFragment} fragment to iterate over recursively
       */const bn=function _sanitizeShadowDOM(z){let K;const ee=ln(z);un("beforeSanitizeShadowDOM",z,null);while(K=ee.nextNode()){un("uponSanitizeShadowNode",K,null);if(!dn(K)){K.content instanceof ne&&_sanitizeShadowDOM(K.content);mn(K)}}un("afterSanitizeShadowDOM",z,null)};
/**
       * Sanitize
       * Public method providing core sanitation functionality
       *
       * @param {String|Node} dirty string or DOM node
       * @param {Object} configuration object
       */DOMPurify.sanitize=function(z){let ee=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};let te;let re;let se;let oe;dt=!z;dt&&(z="\x3c!--\x3e");if("string"!==typeof z&&!hn(z)){if("function"!==typeof z.toString)throw Dt("toString is not a function");z=z.toString();if("string"!==typeof z)throw Dt("dirty is not a string, aborting")}if(!DOMPurify.isSupported)return z;je||Ct(ee);DOMPurify.removed=[];"string"===typeof z&&(et=false);if(et){if(z.nodeName){const K=wt(z.nodeName);if(!Fe[K]||Pe[K])throw Dt("root node is forbidden and cannot be sanitized in-place")}}else if(z instanceof ie){te=an("\x3c!----\x3e");re=te.ownerDocument.importNode(z,true);1===re.nodeType&&"BODY"===re.nodeName||"HTML"===re.nodeName?te=re:te.appendChild(re)}else{if(!Ge&&!$e&&!qe&&-1===z.indexOf("<"))return me&&Qe?me.createHTML(z):z;te=an(z);if(!te)return Ge?null:Qe?be:""}te&&We&&en(te.firstChild);const ae=ln(et?z:te);while(se=ae.nextNode())if(!dn(se)){se.content instanceof ne&&bn(se.content);mn(se)}if(et)return z;if(Ge){if(Ze){oe=ye.call(te.ownerDocument);while(te.firstChild)oe.appendChild(te.firstChild)}else oe=te;(Be.shadowroot||Be.shadowrootmode)&&(oe=ke.call(K,oe,true));return oe}let le=qe?te.outerHTML:te.innerHTML;qe&&Fe["!doctype"]&&te.ownerDocument&&te.ownerDocument.doctype&&te.ownerDocument.doctype.name&&Nt(nn,te.ownerDocument.doctype.name)&&(le="<!DOCTYPE "+te.ownerDocument.doctype.name+">\n"+le);if($e){le=Ft(le,Ce," ");le=Ft(le,Se," ");le=Ft(le,Ae," ")}return me&&Qe?me.createHTML(le):le};
/**
       * Public method to set the configuration once
       * setConfig
       *
       * @param {Object} cfg configuration object
       */DOMPurify.setConfig=function(z){Ct(z);je=true};DOMPurify.clearConfig=function(){yt=null;je=false};
/**
       * Public method to check if an attribute value is valid.
       * Uses last set config, if any. Otherwise, uses config defaults.
       * isValidAttribute
       *
       * @param  {string} tag Tag name of containing element.
       * @param  {string} attr Attribute name.
       * @param  {string} value Attribute value.
       * @return {Boolean} Returns true if `value` is valid. Otherwise, returns false.
       */DOMPurify.isValidAttribute=function(z,K,ee){yt||Ct({});const te=wt(z);const ne=wt(K);return pn(te,ne,ee)};
/**
       * AddHook
       * Public method to add DOMPurify hooks
       *
       * @param {String} entryPoint entry point for the hook to add
       * @param {Function} hookFunction function to execute
       */DOMPurify.addHook=function(z,K){if("function"===typeof K){xe[z]=xe[z]||[];Et(xe[z],K)}};
/**
       * RemoveHook
       * Public method to remove a DOMPurify hook at a given entryPoint
       * (pops it from the stack of hooks if more are present)
       *
       * @param {String} entryPoint entry point for the hook to remove
       * @return {Function} removed(popped) hook
       */DOMPurify.removeHook=function(z){if(xe[z])return Tt(xe[z])};
/**
       * RemoveHooks
       * Public method to remove all DOMPurify hooks at a given entryPoint
       *
       * @param  {String} entryPoint entry point for the hooks to remove
       */DOMPurify.removeHooks=function(z){xe[z]&&(xe[z]=[])};DOMPurify.removeAllHooks=function(){xe={}};return DOMPurify}var an=createDOMPurify();function createCheckbox$1(z,K){const ee=div({class:"igv-ui-trackgear-popover-check-container"});const te=iconMarkup("check",true===K?"#444":"transparent");te.style.borderColor="gray";te.style.borderWidth="1px";te.style.borderStyle="solid";ee.appendChild(te);let ne=div();ne.textContent=z;ee.appendChild(ne);return ee}function createIcon(z,K){return iconMarkup(z,K)}function iconMarkup(z,K){K=K||"currentColor";let ee=ln[z];if(!ee){console.error(`No icon named: ${z}`);ee=ln.question}const te=document.createElementNS("http://www.w3.org/2000/svg","svg");te.setAttributeNS(null,"viewBox","0 0 "+ee[0]+" "+ee[1]);const ne=document.createElementNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"fill",K);ne.setAttributeNS(null,"d",ee[4]);te.appendChild(ne);return te}const ln={check:[512,512,[],"f00c","M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"],cog:[512,512,[],"f013","M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"],exclamation:[192,512,[],"f12a","M176 432c0 44.112-35.888 80-80 80s-80-35.888-80-80 35.888-80 80-80 80 35.888 80 80zM25.26 25.199l13.6 272C39.499 309.972 50.041 320 62.83 320h66.34c12.789 0 23.331-10.028 23.97-22.801l13.6-272C167.425 11.49 156.496 0 142.77 0H49.23C35.504 0 24.575 11.49 25.26 25.199z"],"exclamation-circle":[512,512,[],"f06a","M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],"exclamation-triangle":[576,512,[],"f071","M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],minus:[448,512,[],"f068","M424 318.2c13.3 0 24-10.7 24-24v-76.4c0-13.3-10.7-24-24-24H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h400z"],"minus-circle":[512,512,[],"f056","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"],"minus-square":[448,512,[],"f146","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"],plus:[448,512,[],"f067","M448 294.2v-76.4c0-13.3-10.7-24-24-24H286.2V56c0-13.3-10.7-24-24-24h-76.4c-13.3 0-24 10.7-24 24v137.8H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h137.8V456c0 13.3 10.7 24 24 24h76.4c13.3 0 24-10.7 24-24V318.2H424c13.3 0 24-10.7 24-24z"],"plus-circle":[512,512,[],"f055","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],"plus-square":[448,512,[],"f0fe","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],question:[384,512,[],"f128","M202.021 0C122.202 0 70.503 32.703 29.914 91.026c-7.363 10.58-5.093 25.086 5.178 32.874l43.138 32.709c10.373 7.865 25.132 6.026 33.253-4.148 25.049-31.381 43.63-49.449 82.757-49.449 30.764 0 68.816 19.799 68.816 49.631 0 22.552-18.617 34.134-48.993 51.164-35.423 19.86-82.299 44.576-82.299 106.405V320c0 13.255 10.745 24 24 24h72.471c13.255 0 24-10.745 24-24v-5.773c0-42.86 125.268-44.645 125.268-160.627C377.504 66.256 286.902 0 202.021 0zM192 373.459c-38.196 0-69.271 31.075-69.271 69.271 0 38.195 31.075 69.27 69.271 69.27s69.271-31.075 69.271-69.271-31.075-69.27-69.271-69.27z"],save:[448,512,[],"f0c7","M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"],search:[512,512,[],"f002","M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"],share:[512,512,[],"f064","M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"],spinner:[512,512,[],"f110","M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"],square:[448,512,[],"f0c8","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"],"square-full":[512,512,[],"f45c","M512 512H0V0h512v512z"],times:[384,512,[],"f00d","M323.1 441l53.9-53.9c9.4-9.4 9.4-24.5 0-33.9L279.8 256l97.2-97.2c9.4-9.4 9.4-24.5 0-33.9L323.1 71c-9.4-9.4-24.5-9.4-33.9 0L192 168.2 94.8 71c-9.4-9.4-24.5-9.4-33.9 0L7 124.9c-9.4 9.4-9.4 24.5 0 33.9l97.2 97.2L7 353.2c-9.4 9.4-9.4 24.5 0 33.9L60.9 441c9.4 9.4 24.5 9.4 33.9 0l97.2-97.2 97.2 97.2c9.3 9.3 24.5 9.3 33.9 0z"],"times-circle":[512,512,[],"f057","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"],wrench:[512,512,[],"f0ad","M481.156 200c9.3 0 15.12 10.155 10.325 18.124C466.295 259.992 420.419 288 368 288c-79.222 0-143.501-63.974-143.997-143.079C223.505 65.469 288.548-.001 368.002 0c52.362.001 98.196 27.949 123.4 69.743C496.24 77.766 490.523 88 481.154 88H376l-40 56 40 56h105.156zm-171.649 93.003L109.255 493.255c-24.994 24.993-65.515 24.994-90.51 0-24.993-24.994-24.993-65.516 0-90.51L218.991 202.5c16.16 41.197 49.303 74.335 90.516 90.503zM104 432c0-13.255-10.745-24-24-24s-24 10.745-24 24 10.745 24 24 24 24-10.745 24-24z"]};var cn=Object.freeze({__proto__:null,createCheckbox:createCheckbox$1,createIcon:createIcon});function attachDialogCloseHandlerWithParent(z,K){var ee=document.createElement("div");z.appendChild(ee);ee.appendChild(createIcon("times"));ee.addEventListener("click",(function(z){z.preventDefault();z.stopPropagation();K()}))}var hn=Object.freeze({__proto__:null,attachDialogCloseHandlerWithParent:attachDialogCloseHandlerWithParent});let un;function makeDraggable(z,K,ee){K.addEventListener("mousedown",dragStart.bind(z));function dragStart(z){z.stopPropagation();z.preventDefault();const K=drag.bind(this);const te=dragEnd.bind(this);const ne=getComputedStyle(this);un={constraint:ee,dragFunction:K,dragEndFunction:te,screenX:z.screenX,screenY:z.screenY,top:parseInt(ne.top.replace("px","")),left:parseInt(ne.left.replace("px",""))};document.addEventListener("mousemove",K);document.addEventListener("mouseup",te);document.addEventListener("mouseleave",te);document.addEventListener("mouseexit",te)}}function drag(z){if(!un){console.error("No drag data!");return}z.stopPropagation();z.preventDefault();const K=z.screenX-un.screenX;const ee=z.screenY-un.screenY;const te=un.left+K;const ne=un.constraint?Math.max(un.constraint.minY,un.top+ee):un.top+ee;this.style.left=`${te}px`;this.style.top=`${ne}px`}function dragEnd(z){if(!un){console.error("No drag data!");return}z.stopPropagation();z.preventDefault();const K=un.dragFunction;const ee=un.dragEndFunction;document.removeEventListener("mousemove",K);document.removeEventListener("mouseup",ee);document.removeEventListener("mouseleave",ee);document.removeEventListener("mouseexit",ee);un=void 0}const dn={401:"Access unauthorized",403:"Access forbidden",404:"Not found"};class AlertDialog{
/**
         * Initialize a new alert dialog
         * @param parent
         * @param alertProps - Optional - properties such as scroll to error
         */
constructor(z,K){this.alertProps=Object.assign({shouldFocus:true,preventScroll:false},K);this.container=div({class:"igv-ui-alert-dialog-container"});z.appendChild(this.container);this.container.setAttribute("tabIndex","-1");const ee=div();this.container.appendChild(ee);this.errorHeadline=div();ee.appendChild(this.errorHeadline);this.errorHeadline.textContent="";let te=div({class:"igv-ui-alert-dialog-body"});this.container.appendChild(te);this.body=div({class:"igv-ui-alert-dialog-body-copy"});te.appendChild(this.body);let ne=div();this.container.appendChild(ne);this.ok=div();ne.appendChild(this.ok);this.ok.textContent="OK";const okHandler=()=>{if("function"===typeof this.callback){this.callback("OK");this.callback=void 0}this.body.innerHTML="";hide(this.container)};this.ok.addEventListener("click",(z=>{z.stopPropagation();okHandler()}));this.container.addEventListener("keypress",(z=>{z.stopPropagation();"Enter"===z.key&&okHandler()}));makeDraggable(this.container,ee);hide(this.container)}present(z,K){this.errorHeadline.textContent=z.message?"ERROR":"";let ee=z.message||z;dn.hasOwnProperty(ee)&&(ee=dn[ee]);const te=an.sanitize(ee);this.body.innerHTML=te;this.callback=K;show(this.container);this.alertProps.shouldFocus&&this.container.focus({preventScroll:this.alertProps.preventScroll})}}class InputDialog{constructor(z){this.parent=z;this.container=div({class:"igv-ui-generic-dialog-container"});z.appendChild(this.container);const K=div({class:"igv-ui-generic-dialog-header"});this.container.appendChild(K);this.label=div({class:"igv-ui-generic-dialog-one-liner"});this.container.appendChild(this.label);this.label.text="Unlabeled";this.input_container=div({class:"igv-ui-generic-dialog-input"});this.container.appendChild(this.input_container);this.input=document.createElement("input");this.input_container.appendChild(this.input);const ee=div({class:"igv-ui-generic-dialog-ok-cancel"});this.container.appendChild(ee);this.ok=div();ee.appendChild(this.ok);this.ok.textContent="OK";this.cancel=div();ee.appendChild(this.cancel);this.cancel.textContent="Cancel";hide(this.container);this.input.addEventListener("keyup",(z=>{if(13===z.keyCode){if("function"===typeof this.callback){this.callback(this.input.value);this.callback=void 0}this.input.value=void 0;hide(this.container)}}));this.ok.addEventListener("click",(()=>{if("function"===typeof this.callback){this.callback(this.input.value);this.callback=void 0}this.input.value=void 0;hide(this.container)}));const cancel=()=>{this.input.value="";hide(this.container)};this.cancel.addEventListener("click",cancel);attachDialogCloseHandlerWithParent(K,cancel);makeDraggable(this.container,K)}get value(){return an.sanitize(this.input.value)}present(z,K){this.label.textContent=z.label;this.input.value=z.value;this.callback=z.callback||z.click;show(this.container);this.clampLocation(K.clientX,K.clientY)}clampLocation(z,K){const{width:ee,height:te}=this.container.getBoundingClientRect();const ne=window.innerHeight;const re=window.innerWidth;const ie=Math.min(ne-te,K);const se=Math.min(re-ee,z);this.container.style.left=`${se}px`;this.container.style.top=`${ie}px`}}const pn={licorice:"#000000",lead:"#1e1e1e",tungsten:"#3a3a3a",iron:"#545453",steel:"#6e6e6e",tin:"#878687",nickel:"#888787",aluminum:"#a09fa0",magnesium:"#b8b8b8",silver:"#d0d0d0",mercury:"#e8e8e8",snow:"#ffffff",cayenne:"#891100",mocha:"#894800",aspargus:"#888501",fern:"#458401",clover:"#028401",moss:"#018448",teal:"#008688",ocean:"#004a88",midnight:"#001888",eggplant:"#491a88",plum:"#891e88",maroon:"#891648",maraschino:"#ff2101",tangerine:"#ff8802",lemon:"#fffa03",lime:"#83f902",spring:"#05f802",seam_foam:"#03f987",turquoise:"#00fdff",aqua:"#008cff",blueberry:"#002eff",grape:"#8931ff",magenta:"#ff39ff",strawberry:"#ff2987",salmon:"#ff726e",cantaloupe:"#ffce6e",banana:"#fffb6d",honeydew:"#cefa6e",flora:"#68f96e",spindrift:"#68fbd0",ice:"#68fdff",sky:"#6acfff",orchid:"#6e76ff",lavender:"#d278ff",bubblegum:"#ff7aff",carnation:"#ff7fd3"};class GenericContainer{constructor({parent:z,top:K,left:ee,width:te,height:ne,border:re,closeHandler:ie}){let se=div({class:"igv-ui-generic-container"});z.appendChild(se);hide(se);this.container=se;void 0!==K&&(this.container.style.top=`${K}px`);void 0!==ee&&(this.container.style.left=`${ee}px`);void 0!==te&&(this.container.style.width=`${te}px`);void 0!==ne&&(this.container.style.height=`${ne}px`);re&&(this.container.style.border=re);const oe=div();this.container.appendChild(oe);attachDialogCloseHandlerWithParent(oe,(z=>{hide(this.container);"function"===typeof ie&&ie(z)}));makeDraggable(this.container,oe)}show(){show(this.container)}hide(){hide(this.container)}dispose(){this.container.parent&&this.container.parent.removeChild(this.container)}}class ColorPicker extends GenericContainer{constructor({parent:z,top:K,left:ee,width:te,height:ne,defaultColors:re,colorHandler:ie}){super({parent:z,top:K,left:ee,width:te,height:ne,border:"1px solid gray"});createColorSwatchSelector(this.container,ie,re)}}const createColorSwatchSelector=(z,K,ee)=>{const te=Object.values(pn);for(let ee of te){const te=div({class:"igv-ui-color-swatch"});z.appendChild(te);decorateSwatch(te,ee,K)}if(ee)for(let te of ee){const ee=div({class:"igv-ui-color-swatch"});z.appendChild(ee);decorateSwatch(ee,te,K)}};const decorateSwatch=(z,K,ee)=>{z.style.backgroundColor=K;z.addEventListener("mouseenter",(ee=>z.style.borderColor=K));z.addEventListener("mouseleave",(K=>z.style.borderColor="white"));z.addEventListener("click",(z=>{z.stopPropagation();ee(K)}));z.addEventListener("touchend",(z=>{z.stopPropagation();ee(K)}))};class Popover{constructor(z,K){this.parent=z;this.popover=div({class:"igv-ui-popover"});z.appendChild(this.popover);const ee=div();this.popover.appendChild(ee);const te=div();ee.appendChild(te);K&&(te.textContent=K);attachDialogCloseHandlerWithParent(ee,(()=>this.hide()));makeDraggable(this.popover,ee);this.popoverContent=div();this.popover.appendChild(this.popoverContent);this.popover.style.display="none"}presentContentWithEvent(z,K){this.popover.style.display="block";this.popoverContent.innerHTML=K;present$1(z,this.popover,this.popoverContent)}presentMenu(z,K){if(0===K.length)return;this.popover.style.display="block";const ee=createMenuElements$1(K,this.popover);for(let z of ee)this.popoverContent.appendChild(z.object);present$1(z,this.popover,this.popoverContent)}hide(){this.popover.style.display="none";this.dispose()}dispose(){this.popover&&this.popover.parentNode.removeChild(this.popover);const z=Object.keys(this);for(let K of z)this[K]=void 0}}function present$1(z,K,ee){const{x:te,y:ne,width:re}=translateMouseCoordinates(z,K.parentNode);K.style.top=`${ne}px`;const{width:ie}=K.getBoundingClientRect();const se=te+ie;const oe=se-re;K.style.left=`${se>re?te-oe:te}px`;ee.style.maxWidth=`${Math.min(ie,re)}px`}function createMenuElements$1(z,K){const ee=z.map((function(z,ee){let te;if("string"===typeof z){te=div();te.innerHTML=z}else if("Node"===typeof z)te=z;else{"function"===typeof z.init&&z.init();if("checkbox"===z.type)te=createCheckbox$1("Show all bases",z.value);else if("color"===z.type){const ne=new ColorPicker({parent:K.parentElement,width:364,colorHandler:K=>z.click(K)});te=div();"string"===typeof z.label&&(te.innerHTML=z.label);const clickHandler=z=>{ne.show();hide(K);z.preventDefault();z.stopPropagation()};te.addEventListener("click",clickHandler);te.addEventListener("touchend",clickHandler);te.addEventListener("mouseup",(function(z){z.preventDefault();z.stopPropagation()}))}else{te=div();"string"===typeof z.label&&(te.innerHTML=z.label)}if(z.click&&"color"!==z.type){te.addEventListener("click",handleClick);te.addEventListener("touchend",handleClick);te.addEventListener("mouseup",(function(z){z.preventDefault();z.stopPropagation()}));function handleClick(ee){z.click();hide(K);ee.preventDefault();ee.stopPropagation()}}}return{object:te,init:z.init}}));return ee}class GenericColorPicker extends GenericContainer{constructor({parent:z,width:K}){super({parent:z,width:K,border:"1px solid gray"})}configure(z,K){this.colorHandlers=K;this.setActiveColorHandler("color");this.createSwatches(z)}setActiveColorHandler(z){this.activeColorHandler=this.colorHandlers[z]}createSwatches(z){this.container.querySelectorAll(".igv-ui-color-swatch").forEach((z=>z.remove()));const K=Object.values(pn);for(let z of K){const K=div({class:"igv-ui-color-swatch"});this.container.appendChild(K);this.decorateSwatch(K,z)}if(z)for(let K of z){const z=div({class:"igv-ui-color-swatch"});this.container.appendChild(z);this.decorateSwatch(z,K)}}decorateSwatch(z,K){z.style.backgroundColor=K;z.addEventListener("mouseenter",(()=>z.style.borderColor=K));z.addEventListener("mouseleave",(()=>z.style.borderColor="white"));z.addEventListener("click",(z=>{z.stopPropagation();this.activeColorHandler(K)}));z.addEventListener("touchend",(z=>{z.stopPropagation();this.activeColorHandler(K)}))}}function embedCSS$2(){const z=document.createElement("style");z.setAttribute("type","text/css");z.setAttribute("title","igv-ui.css");z.innerHTML='.igv-ui-popover {\n  cursor: default;\n  position: absolute;\n  z-index: 2048;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: 1px;\n  font-family: "Open Sans", sans-serif;\n  font-size: small;\n  background-color: white;\n}\n.igv-ui-popover > div:first-child {\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%;\n  height: 24px;\n  cursor: move;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-color: #7F7F7F;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n}\n.igv-ui-popover > div:first-child > div:first-child {\n  margin-left: 4px;\n}\n.igv-ui-popover > div:first-child > div:last-child {\n  margin-right: 4px;\n  height: 12px;\n  width: 12px;\n  color: #7F7F7F;\n}\n.igv-ui-popover > div:first-child > div:last-child:hover {\n  cursor: pointer;\n  color: #444;\n}\n.igv-ui-popover > div:last-child {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 400px;\n  max-width: 800px;\n  background-color: white;\n}\n.igv-ui-popover > div:last-child > div {\n  user-select: all;\n  margin-left: 4px;\n  margin-right: 4px;\n  min-width: 220px;\n  overflow-x: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.igv-ui-popover > div:last-child > div > span {\n  font-weight: bolder;\n}\n.igv-ui-popover > div:last-child hr {\n  width: 100%;\n}\n\n.igv-ui-alert-dialog-container {\n  box-sizing: content-box;\n  position: absolute;\n  z-index: 2048;\n  top: 50%;\n  left: 50%;\n  width: 400px;\n  height: 200px;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  outline: none;\n  font-family: "Open Sans", sans-serif;\n  font-size: 15px;\n  font-weight: 400;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n}\n.igv-ui-alert-dialog-container > div:first-child {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  width: 100%;\n  height: 24px;\n  cursor: move;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-color: #7F7F7F;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n}\n.igv-ui-alert-dialog-container > div:first-child div:first-child {\n  padding-left: 8px;\n}\n.igv-ui-alert-dialog-container .igv-ui-alert-dialog-body {\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text;\n  color: #373737;\n  width: 100%;\n  height: calc(100% - 24px - 64px);\n  overflow-y: scroll;\n}\n.igv-ui-alert-dialog-container .igv-ui-alert-dialog-body .igv-ui-alert-dialog-body-copy {\n  margin: 16px;\n  width: auto;\n  height: auto;\n  overflow-wrap: break-word;\n  word-break: break-word;\n  background-color: white;\n  border: unset;\n}\n.igv-ui-alert-dialog-container > div:last-child {\n  width: 100%;\n  margin-bottom: 10px;\n  background-color: white;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: center;\n  align-items: center;\n}\n.igv-ui-alert-dialog-container > div:last-child div {\n  margin: unset;\n  width: 40px;\n  height: 30px;\n  line-height: 30px;\n  text-align: center;\n  color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: small;\n  font-weight: 400;\n  border-color: #2B81AF;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 4px;\n  background-color: #2B81AF;\n}\n.igv-ui-alert-dialog-container > div:last-child div:hover {\n  cursor: pointer;\n  border-color: #25597f;\n  background-color: #25597f;\n}\n\n.igv-ui-color-swatch {\n  position: relative;\n  box-sizing: content-box;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: center;\n  width: 32px;\n  height: 32px;\n  border-style: solid;\n  border-width: 2px;\n  border-color: white;\n  border-radius: 4px;\n}\n\n.igv-ui-color-swatch:hover {\n  border-color: dimgray;\n}\n\n.igv-ui-colorpicker-menu-close-button {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  width: 100%;\n  height: 32px;\n  margin-top: 4px;\n  margin-bottom: 4px;\n  padding-right: 8px;\n}\n.igv-ui-colorpicker-menu-close-button i.fa {\n  display: block;\n  margin-left: 4px;\n  margin-right: 4px;\n  color: #5f5f5f;\n}\n.igv-ui-colorpicker-menu-close-button i.fa:hover,\n.igv-ui-colorpicker-menu-close-button i.fa:focus,\n.igv-ui-colorpicker-menu-close-button i.fa:active {\n  cursor: pointer;\n  color: #0f0f0f;\n}\n\n.igv-ui-generic-dialog-container {\n  box-sizing: content-box;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 300px;\n  height: 200px;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  z-index: 2048;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-header {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  width: 100%;\n  height: 24px;\n  cursor: move;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-color: #7F7F7F;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-header div {\n  margin-right: 4px;\n  margin-bottom: 2px;\n  height: 12px;\n  width: 12px;\n  color: #7F7F7F;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-header div:hover {\n  cursor: pointer;\n  color: #444;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-one-liner {\n  color: #373737;\n  width: 95%;\n  height: 24px;\n  line-height: 24px;\n  text-align: left;\n  margin-top: 8px;\n  padding-left: 8px;\n  overflow-wrap: break-word;\n  background-color: white;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input {\n  margin-top: 8px;\n  width: 95%;\n  height: 24px;\n  color: #373737;\n  line-height: 24px;\n  padding-left: 8px;\n  background-color: white;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input div {\n  width: 30%;\n  height: 100%;\n  font-size: 16px;\n  text-align: right;\n  padding-right: 8px;\n  background-color: white;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input input {\n  display: block;\n  height: 100%;\n  width: 100%;\n  padding-left: 4px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n  color: #373737;\n  text-align: left;\n  outline: none;\n  border-style: solid;\n  border-width: thin;\n  border-color: #7F7F7F;\n  background-color: white;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input input {\n  width: 50%;\n  font-size: 16px;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-input {\n  margin-top: 8px;\n  width: calc(100% - 16px);\n  height: 24px;\n  color: #373737;\n  line-height: 24px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-input input {\n  display: block;\n  height: 100%;\n  width: 100%;\n  padding-left: 4px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n  color: #373737;\n  text-align: left;\n  outline: none;\n  border-style: solid;\n  border-width: thin;\n  border-color: #7F7F7F;\n  background-color: white;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-input input {\n  font-size: 16px;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel {\n  width: 100%;\n  height: 28px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div {\n  margin-top: 32px;\n  color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  width: 75px;\n  height: 28px;\n  line-height: 28px;\n  text-align: center;\n  border-color: transparent;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 2px;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:first-child {\n  margin-left: 32px;\n  margin-right: 0;\n  background-color: #5ea4e0;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:last-child {\n  margin-left: 0;\n  margin-right: 32px;\n  background-color: #c4c4c4;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:first-child:hover {\n  cursor: pointer;\n  background-color: #3b5c7f;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:last-child:hover {\n  cursor: pointer;\n  background-color: #7f7f7f;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok {\n  width: 100%;\n  height: 36px;\n  margin-top: 32px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok div {\n  width: 98px;\n  height: 36px;\n  line-height: 36px;\n  text-align: center;\n  color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  border-color: white;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 4px;\n  background-color: #2B81AF;\n}\n.igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok div:hover {\n  cursor: pointer;\n  background-color: #25597f;\n}\n\n.igv-ui-generic-container {\n  box-sizing: content-box;\n  position: absolute;\n  z-index: 2048;\n  background-color: white;\n  cursor: pointer;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-ui-generic-container > div:first-child {\n  cursor: move;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  height: 24px;\n  width: 100%;\n  background-color: #dddddd;\n}\n.igv-ui-generic-container > div:first-child > div {\n  display: block;\n  color: #5f5f5f;\n  cursor: pointer;\n  width: 14px;\n  height: 14px;\n  margin-right: 8px;\n  margin-bottom: 4px;\n}\n\n.igv-ui-dialog {\n  z-index: 2048;\n  position: fixed;\n  width: fit-content;\n  height: fit-content;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  background-color: white;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n}\n.igv-ui-dialog .igv-ui-dialog-header {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  width: 100%;\n  height: 24px;\n  cursor: move;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-color: #7F7F7F;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n}\n.igv-ui-dialog .igv-ui-dialog-header div {\n  margin-right: 4px;\n  margin-bottom: 2px;\n  height: 12px;\n  width: 12px;\n  color: #7F7F7F;\n}\n.igv-ui-dialog .igv-ui-dialog-header div:hover {\n  cursor: pointer;\n  color: #444;\n}\n.igv-ui-dialog .igv-ui-dialog-one-liner {\n  width: 95%;\n  height: 24px;\n  line-height: 24px;\n  text-align: left;\n  margin: 8px;\n  overflow-wrap: break-word;\n  background-color: white;\n  font-weight: bold;\n}\n.igv-ui-dialog .igv-ui-dialog-ok-cancel {\n  width: 100%;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-ui-dialog .igv-ui-dialog-ok-cancel div {\n  margin: 16px;\n  margin-top: 32px;\n  color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  width: 75px;\n  height: 28px;\n  line-height: 28px;\n  text-align: center;\n  border-color: transparent;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 2px;\n}\n.igv-ui-dialog .igv-ui-dialog-ok-cancel div:first-child {\n  background-color: #5ea4e0;\n}\n.igv-ui-dialog .igv-ui-dialog-ok-cancel div:last-child {\n  background-color: #c4c4c4;\n}\n.igv-ui-dialog .igv-ui-dialog-ok-cancel div:first-child:hover {\n  cursor: pointer;\n  background-color: #3b5c7f;\n}\n.igv-ui-dialog .igv-ui-dialog-ok-cancel div:last-child:hover {\n  cursor: pointer;\n  background-color: #7f7f7f;\n}\n.igv-ui-dialog .igv-ui-dialog-ok {\n  width: 100%;\n  height: 36px;\n  margin-top: 32px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-ui-dialog .igv-ui-dialog-ok div {\n  width: 98px;\n  height: 36px;\n  line-height: 36px;\n  text-align: center;\n  color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  border-color: white;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 4px;\n  background-color: #2B81AF;\n}\n.igv-ui-dialog .igv-ui-dialog-ok div:hover {\n  cursor: pointer;\n  background-color: #25597f;\n}\n\n.igv-ui-panel, .igv-ui-panel-row, .igv-ui-panel-column {\n  z-index: 2048;\n  background-color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  display: flex;\n  justify-content: flex-start;\n  align-items: flex-start;\n}\n\n.igv-ui-panel-column {\n  display: flex;\n  flex-direction: column;\n}\n\n.igv-ui-panel-row {\n  display: flex;\n  flex-direction: row;\n}\n\n.igv-ui-textbox {\n  background-color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  display: flex;\n  justify-content: flex-start;\n  align-items: flex-start;\n}\n\n.igv-ui-table {\n  background-color: white;\n}\n\n.igv-ui-table thead {\n  position: sticky;\n  top: 0;\n}\n\n.igv-ui-table th {\n  text-align: left;\n}\n\n.igv-ui-table td {\n  padding-right: 20px;\n}\n\n.igv-ui-table tr:hover {\n  background-color: lightblue;\n}\n\n/*# sourceMappingURL=igv-ui.css.map */\n';document.head.append(z)}if("undefined"!==typeof document){stylesheetExists("igv-ui.css")||embedCSS$2();function stylesheetExists(z){for(let K of document.styleSheets){K=K.href?K.href.replace(/^.*[\\\/]/,""):"";if(K===z)return true}return false}}function createCheckbox(z,K){const ee=gt.div({class:"igv-menu-popup-check-container"});const te=gt.div();ee.appendChild(te);const ne=cn.createIcon("check",true===K?"#444":"transparent");te.appendChild(ne);const re=gt.div();re.innerText=z;ee.appendChild(re);return ee}
/**
     * Configure item list for track "gear" menu.
     * @param trackView
     */const gn={trackMenuItemList:function(z){const K=new Set(["alignment","annotation","variant","eqtl","snp"]);const ee=z.track.config&&void 0!==z.track.config.visibilityWindow;let te=[];if("sequence"!==z.track.config.type){te.push(trackRenameMenuItem(z));te.push(trackHeightMenuItem(z))}if(this.showColorPicker(z.track)){te.push("<hr/>");te.push(colorPickerMenuItem({trackView:z,label:"Set track color",option:"color"}));te.push(unsetColorMenuItem({trackView:z,label:"Unset track color"}));if("wig"===z.track.config.type||"annotation"===z.track.config.type){te.push(colorPickerMenuItem({trackView:z,label:"Set alt color",option:"altColor"}));te.push(unsetAltColorMenuItem({trackView:z,label:"Unset alt color"}))}}z.track.menuItemList&&(te=te.concat(z.track.menuItemList()));if(ee||K.has(z.track.type)){te.push("<hr/>");te.push(visibilityWindowMenuItem(z))}if(false!==z.track.removable){te.push("<hr/>");te.push(trackRemovalMenuItem(z))}return te},numericDataMenuItems:function(z){const K=[];K.push("<hr/>");const ee=pt("<div>");ee.text("Set data range");const click=()=>{z.browser.dataRangeDialog.configure(z);z.browser.dataRangeDialog.present(pt(z.browser.columnContainer))};K.push({object:ee,click:click});void 0!==z.track.logScale&&K.push({object:pt(createCheckbox("Log scale",z.track.logScale)),click:()=>{z.track.logScale=!z.track.logScale;z.repaintViews()}});K.push({object:pt(createCheckbox("Autoscale",z.track.autoscale)),click:()=>{z.track.autoscale=!z.track.autoscale;z.updateViews()}});return K},trackMenuItemListHelper:function(z,K){var ee=[];z.length>0&&(ee=z.map((function(z,ee){var te;if(z.name){te=pt("<div>");te.text(z.name)}else if(z.object)te=z.object;else if("string"===typeof z.label){te=pt("<div>");te.html(z.label)}else"string"===typeof z&&(te=z.startsWith("<")?pt(z):pt("<div>"+z+"</div>"));0===ee&&te.addClass("igv-track-menu-border-top");if(z.click){te.on("click",handleClick);te.on("touchend",(function(z){handleClick(z)}));te.on("mouseup",(function(z){z.preventDefault();z.stopPropagation()}));function handleClick(ee){z.click(ee);K.hide();ee.preventDefault();ee.stopPropagation()}}return{object:te,init:z.init||void 0}})));return ee},showColorPicker(z){return void 0===z.type||"bedtype"===z.type||"alignment"===z.type||"annotation"===z.type||"variant"===z.type||"wig"===z.type||"interact"===z.type},createMenuItem(z,K){const ee=pt("<div>");ee.text(z);return{object:ee,click:K}}};function visibilityWindowMenuItem(z){const click=K=>{const callback=()=>{let K=z.browser.inputDialog.value;K=""===K||void 0===K?-1:K.trim();z.track.visibilityWindow=Number.parseInt(K);z.track.config.visibilityWindow=Number.parseInt(K);z.updateViews()};const ee={label:"Visibility Window",value:z.track.visibilityWindow,callback:callback};z.browser.inputDialog.present(ee,K)};const K=pt("<div>");K.text("Set visibility window");return{object:K,click:click}}function trackRemovalMenuItem(z){const K=pt("<div>");K.text("Remove track");return{object:K,click:()=>z.browser.removeTrack(z.track)}}function colorPickerMenuItem({trackView:z,label:K,option:ee}){const te=pt("<div>");te.text(K);return{object:te,click:()=>z.presentColorPicker(ee)}}function unsetColorMenuItem({trackView:z,label:K}){const ee=pt("<div>");ee.text(K);return{object:ee,click:()=>{z.track.color=void 0;z.repaintViews()}}}function unsetAltColorMenuItem({trackView:z,label:K}){const ee=pt("<div>");ee.text(K);return{object:ee,click:()=>{z.track.altColor=void 0;z.repaintViews()}}}function trackRenameMenuItem(z){const click=K=>{const callback=function(){let K=z.browser.inputDialog.value;K=""===K||void 0===K?"untitled":K.trim();z.track.name=K};const ee={label:"Track Name",value:getTrackLabelText(z.track)||"unnamed",callback:callback};z.browser.inputDialog.present(ee,K)};const K=pt("<div>");K.text("Set track name");return{object:K,click:click}}function trackHeightMenuItem(z){const click=K=>{const callback=()=>{const K=Number(z.browser.inputDialog.value,10);if(void 0!==K){void 0!==z.track.minHeight&&z.track.minHeight>K&&(z.track.minHeight=K);void 0!==z.track.maxHeight&&z.track.maxHeight<K&&(z.track.minHeight=K);z.setTrackHeight(K,true);z.checkContentHeight();z.repaintViews();z.track.autoHeight=false}};const ee={label:"Track Height",value:z.track.height,callback:callback};z.browser.inputDialog.present(ee,K)};const K=pt("<div>");K.text("Set track height");return{object:K,click:click}}function getTrackLabelText(z){var K,ee;K=z.trackView.viewports[0];ee=K.$trackLabel.text();return ee}class DataRangeDialog{constructor(z,K,ee){this.browser=z;this.$container=pt("<div>",{class:"igv-generic-dialog-container"});K.append(this.$container);this.$container.offset({left:0,top:0});const te=pt("<div>",{class:"igv-generic-dialog-header"});this.$container.append(te);hn.attachDialogCloseHandlerWithParent(te[0],(()=>{this.$minimum_input.val(void 0);this.$maximum_input.val(void 0);this.$container.offset({left:0,top:0});this.$container.hide()}));this.$minimum=pt("<div>",{class:"igv-generic-dialog-label-input"});this.$container.append(this.$minimum);const ne=pt("<div>");ne.text("Minimum");this.$minimum.append(ne);this.$minimum_input=pt("<input>");this.$minimum.append(this.$minimum_input);this.$maximum=pt("<div>",{class:"igv-generic-dialog-label-input"});this.$container.append(this.$maximum);const re=pt("<div>");re.text("Maximum");this.$maximum.append(re);this.$maximum_input=pt("<input>");this.$maximum.append(this.$maximum_input);const ie=pt("<div>",{class:"igv-generic-dialog-ok-cancel"});this.$container.append(ie);this.$ok=pt("<div>");ie.append(this.$ok);this.$ok.text("OK");this.$cancel=pt("<div>");ie.append(this.$cancel);this.$cancel.text("Cancel");this.$cancel.on("click",(()=>{this.$minimum_input.val(void 0);this.$maximum_input.val(void 0);this.$container.offset({left:0,top:0});this.$container.hide()}));makeDraggable(this.$container.get(0),te.get(0));this.$container.hide()}configure(z){const K=z.dataRange();let ee;let te;if(K){ee=K.min;te=K.max}else{ee=0;te=100}this.$minimum_input.val(ee);this.$maximum_input.val(te);this.$minimum_input.unbind();this.$minimum_input.on("keyup",(K=>{13===K.keyCode&&this.processResults(z)}));this.$maximum_input.unbind();this.$maximum_input.on("keyup",(K=>{13===K.keyCode&&this.processResults(z)}));this.$ok.unbind();this.$ok.on("click",(K=>{this.processResults(z)}))}processResults(z){const K=Number(this.$minimum_input.val());const ee=Number(this.$maximum_input.val());isNaN(K)||isNaN(ee)?this.browser.alert.present(new Error("Must input numeric values"),void 0):z.setDataRange(K,ee);this.$minimum_input.val(void 0);this.$maximum_input.val(void 0);this.$container.offset({left:0,top:0});this.$container.hide()}present(z){const K=z.offset().top;const ee=pt("body").scrollTop();this.$container.offset({left:z.width()-this.$container.width(),top:K+ee});this.$container.show()}}
/**
     * Covers string literals and String objects
     * @param x
     * @returns {boolean}
     */function isString$2(z){return"string"===typeof z||z instanceof String}function numberFormatter$1(z){var K=String(z).split(/[.,]/),ee=",",te=".";return K[0].split("").reverse().reduce((function(z,K,te){return te%3===0?z+ee+K:z+K})).split("").reverse().join("")+(K[1]?te+K[1]:"")}const splitLines$5=function(z){return z.split(/\n|\r\n|\r/g)};function splitStringRespectingQuotes(z,K){var ee,te,ne=[],re=z.length,ie=0,se=false;if(re>0){ne[ie]=z.charAt(0);for(ee=1;ee<re;ee++){te=z.charAt(ee);if('"'===te)se=!se;else if(se||te!==K)ne[ie]+=te;else{ie++;ne[ie]=""}}}return ne}function stripQuotes$1(z){if(void 0===z)return z;(z.startsWith("'")||z.startsWith('"'))&&(z=z.substring(1));(z.endsWith("'")||z.endsWith('"'))&&(z=z.substring(0,z.length-1));return z}function capitalize(z){return z.length>0?z.charAt(0).toUpperCase()+z.slice(1):z}function parseLocusString$1(z){const K=z.split(":");const ee=K[1].split("-");const te={chr:K[0],start:Number.parseInt(ee[0].replace(/,/g,""))-1};ee.length>1?te.end=Number.parseInt(ee[1].replace(/,/g,"")):te.end=te.start+1;return te}
/**
     * Return the filename from the path.   Example
     *   https://foo.com/bar.bed?param=2   => bar.bed
     * @param urlOrFile
     */function getFilename$2(z){if(void 0!==z.name)return z.name;if(isString$2(z)){let K=z.lastIndexOf("/");let ee=K<0?z:z.substr(K+1);K=ee.indexOf("?");K>0&&(ee=ee.substr(0,K));return ee}throw Error("Expected File or string, got "+typeof z)}
/**
     * Test if object is a File or File-like object.
     *
     * @param object
     */function isFile(z){return!!z&&("function"!==typeof z&&(z instanceof File||z.hasOwnProperty("name")&&"function"===typeof z.slice&&"function"===typeof z.arrayBuffer))}function download(z,K){const ee=document.createElement("a");ee.setAttribute("href",K);ee.setAttribute("download",z);ee.style.display="none";document.body.appendChild(ee);ee.click();document.body.removeChild(ee)}"object"===typeof process&&"undefined"===typeof window&&(global.atob=function(z){return Buffer.from(z,"base64").toString("binary")});function parseUri(z){var K=mn,ee=K.parser.loose.exec(z),te={},ne=14;while(ne--)te[K.key[ne]]=ee[ne]||"";te[K.q.name]={};te[K.key[12]].replace(K.q.parser,(function(z,ee,ne){ee&&(te[K.q.name][ee]=ne)}));return te}const mn={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};
/**
     * Resolve a url, which might be a string, function (that returns a string or Promse), or Promise (that resolves to a string)
     *
     * @param url
     * @returns {Promise<*>}
     */async function resolveURL(z){return"function"===typeof z?z():z}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const bn=4;const vn=0;const wn=1;const yn=2;function zero$1$1(z){let K=z.length;while(--K>=0)z[K]=0}const _n=0;const kn=1;const xn=2;const Cn=3;const Sn=258;const An=29;const Tn=256;const En=Tn+1+An;const Mn=30;const Rn=19;const In=2*En+1;const Fn=15;const Ln=16;const Bn=7;const Nn=256;const Dn=16;const Pn=17;const On=18;const zn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]);const Hn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);const Un=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]);const Vn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);const $n=512;const qn=new Array(2*(En+2));zero$1$1(qn);const jn=new Array(2*Mn);zero$1$1(jn);const Wn=new Array($n);zero$1$1(Wn);const Gn=new Array(Sn-Cn+1);zero$1$1(Gn);const Zn=new Array(An);zero$1$1(Zn);const Qn=new Array(Mn);zero$1$1(Qn);function StaticTreeDesc(z,K,ee,te,ne){this.static_tree=z;this.extra_bits=K;this.extra_base=ee;this.elems=te;this.max_length=ne;this.has_stree=z&&z.length}let Xn;let Yn;let Kn;function TreeDesc(z,K){this.dyn_tree=z;this.max_code=0;this.stat_desc=K}const d_code=z=>z<256?Wn[z]:Wn[256+(z>>>7)];const put_short=(z,K)=>{z.pending_buf[z.pending++]=255&K;z.pending_buf[z.pending++]=K>>>8&255};const send_bits=(z,K,ee)=>{if(z.bi_valid>Ln-ee){z.bi_buf|=K<<z.bi_valid&65535;put_short(z,z.bi_buf);z.bi_buf=K>>Ln-z.bi_valid;z.bi_valid+=ee-Ln}else{z.bi_buf|=K<<z.bi_valid&65535;z.bi_valid+=ee}};const send_code=(z,K,ee)=>{send_bits(z,ee[2*K],ee[2*K+1])};const bi_reverse=(z,K)=>{let ee=0;do{ee|=1&z;z>>>=1;ee<<=1}while(--K>0);return ee>>>1};const bi_flush=z=>{if(16===z.bi_valid){put_short(z,z.bi_buf);z.bi_buf=0;z.bi_valid=0}else if(z.bi_valid>=8){z.pending_buf[z.pending++]=255&z.bi_buf;z.bi_buf>>=8;z.bi_valid-=8}};const gen_bitlen=(z,K)=>{const ee=K.dyn_tree;const te=K.max_code;const ne=K.stat_desc.static_tree;const re=K.stat_desc.has_stree;const ie=K.stat_desc.extra_bits;const se=K.stat_desc.extra_base;const oe=K.stat_desc.max_length;let ae;let le,ce;let he;let ue;let de;let fe=0;for(he=0;he<=Fn;he++)z.bl_count[he]=0;ee[2*z.heap[z.heap_max]+1]=0;for(ae=z.heap_max+1;ae<In;ae++){le=z.heap[ae];he=ee[2*ee[2*le+1]+1]+1;if(he>oe){he=oe;fe++}ee[2*le+1]=he;if(!(le>te)){z.bl_count[he]++;ue=0;le>=se&&(ue=ie[le-se]);de=ee[2*le];z.opt_len+=de*(he+ue);re&&(z.static_len+=de*(ne[2*le+1]+ue))}}if(0!==fe){do{he=oe-1;while(0===z.bl_count[he])he--;z.bl_count[he]--;z.bl_count[he+1]+=2;z.bl_count[oe]--;fe-=2}while(fe>0);for(he=oe;0!==he;he--){le=z.bl_count[he];while(0!==le){ce=z.heap[--ae];if(!(ce>te)){if(ee[2*ce+1]!==he){z.opt_len+=(he-ee[2*ce+1])*ee[2*ce];ee[2*ce+1]=he}le--}}}}};const gen_codes=(z,K,ee)=>{const te=new Array(Fn+1);let ne=0;let re;let ie;for(re=1;re<=Fn;re++){ne=ne+ee[re-1]<<1;te[re]=ne}for(ie=0;ie<=K;ie++){let K=z[2*ie+1];0!==K&&(z[2*ie]=bi_reverse(te[K]++,K))}};const tr_static_init=()=>{let z;let K;let ee;let te;let ne;const re=new Array(Fn+1);ee=0;for(te=0;te<An-1;te++){Zn[te]=ee;for(z=0;z<1<<zn[te];z++)Gn[ee++]=te}Gn[ee-1]=te;ne=0;for(te=0;te<16;te++){Qn[te]=ne;for(z=0;z<1<<Hn[te];z++)Wn[ne++]=te}ne>>=7;for(;te<Mn;te++){Qn[te]=ne<<7;for(z=0;z<1<<Hn[te]-7;z++)Wn[256+ne++]=te}for(K=0;K<=Fn;K++)re[K]=0;z=0;while(z<=143){qn[2*z+1]=8;z++;re[8]++}while(z<=255){qn[2*z+1]=9;z++;re[9]++}while(z<=279){qn[2*z+1]=7;z++;re[7]++}while(z<=287){qn[2*z+1]=8;z++;re[8]++}gen_codes(qn,En+1,re);for(z=0;z<Mn;z++){jn[2*z+1]=5;jn[2*z]=bi_reverse(z,5)}Xn=new StaticTreeDesc(qn,zn,Tn+1,En,Fn);Yn=new StaticTreeDesc(jn,Hn,0,Mn,Fn);Kn=new StaticTreeDesc(new Array(0),Un,0,Rn,Bn)};const init_block=z=>{let K;for(K=0;K<En;K++)z.dyn_ltree[2*K]=0;for(K=0;K<Mn;K++)z.dyn_dtree[2*K]=0;for(K=0;K<Rn;K++)z.bl_tree[2*K]=0;z.dyn_ltree[2*Nn]=1;z.opt_len=z.static_len=0;z.sym_next=z.matches=0};const bi_windup=z=>{z.bi_valid>8?put_short(z,z.bi_buf):z.bi_valid>0&&(z.pending_buf[z.pending++]=z.bi_buf);z.bi_buf=0;z.bi_valid=0};const smaller=(z,K,ee,te)=>{const ne=2*K;const re=2*ee;return z[ne]<z[re]||z[ne]===z[re]&&te[K]<=te[ee]};const pqdownheap=(z,K,ee)=>{const te=z.heap[ee];let ne=ee<<1;while(ne<=z.heap_len){ne<z.heap_len&&smaller(K,z.heap[ne+1],z.heap[ne],z.depth)&&ne++;if(smaller(K,te,z.heap[ne],z.depth))break;z.heap[ee]=z.heap[ne];ee=ne;ne<<=1}z.heap[ee]=te};const compress_block=(z,K,ee)=>{let te;let ne;let re=0;let ie;let se;if(0!==z.sym_next)do{te=255&z.pending_buf[z.sym_buf+re++];te+=(255&z.pending_buf[z.sym_buf+re++])<<8;ne=z.pending_buf[z.sym_buf+re++];if(0===te)send_code(z,ne,K);else{ie=Gn[ne];send_code(z,ie+Tn+1,K);se=zn[ie];if(0!==se){ne-=Zn[ie];send_bits(z,ne,se)}te--;ie=d_code(te);send_code(z,ie,ee);se=Hn[ie];if(0!==se){te-=Qn[ie];send_bits(z,te,se)}}}while(re<z.sym_next);send_code(z,Nn,K)};const build_tree=(z,K)=>{const ee=K.dyn_tree;const te=K.stat_desc.static_tree;const ne=K.stat_desc.has_stree;const re=K.stat_desc.elems;let ie,se;let oe=-1;let ae;z.heap_len=0;z.heap_max=In;for(ie=0;ie<re;ie++)if(0!==ee[2*ie]){z.heap[++z.heap_len]=oe=ie;z.depth[ie]=0}else ee[2*ie+1]=0;while(z.heap_len<2){ae=z.heap[++z.heap_len]=oe<2?++oe:0;ee[2*ae]=1;z.depth[ae]=0;z.opt_len--;ne&&(z.static_len-=te[2*ae+1])}K.max_code=oe;for(ie=z.heap_len>>1;ie>=1;ie--)pqdownheap(z,ee,ie);ae=re;do{ie=z.heap[1];z.heap[1]=z.heap[z.heap_len--];pqdownheap(z,ee,1);se=z.heap[1];z.heap[--z.heap_max]=ie;z.heap[--z.heap_max]=se;ee[2*ae]=ee[2*ie]+ee[2*se];z.depth[ae]=(z.depth[ie]>=z.depth[se]?z.depth[ie]:z.depth[se])+1;ee[2*ie+1]=ee[2*se+1]=ae;z.heap[1]=ae++;pqdownheap(z,ee,1)}while(z.heap_len>=2);z.heap[--z.heap_max]=z.heap[1];gen_bitlen(z,K);gen_codes(ee,oe,z.bl_count)};const scan_tree=(z,K,ee)=>{let te;let ne=-1;let re;let ie=K[1];let se=0;let oe=7;let ae=4;if(0===ie){oe=138;ae=3}K[2*(ee+1)+1]=65535;for(te=0;te<=ee;te++){re=ie;ie=K[2*(te+1)+1];if(!(++se<oe&&re===ie)){if(se<ae)z.bl_tree[2*re]+=se;else if(0!==re){re!==ne&&z.bl_tree[2*re]++;z.bl_tree[2*Dn]++}else se<=10?z.bl_tree[2*Pn]++:z.bl_tree[2*On]++;se=0;ne=re;if(0===ie){oe=138;ae=3}else if(re===ie){oe=6;ae=3}else{oe=7;ae=4}}}};const send_tree=(z,K,ee)=>{let te;let ne=-1;let re;let ie=K[1];let se=0;let oe=7;let ae=4;if(0===ie){oe=138;ae=3}for(te=0;te<=ee;te++){re=ie;ie=K[2*(te+1)+1];if(!(++se<oe&&re===ie)){if(se<ae)do{send_code(z,re,z.bl_tree)}while(0!==--se);else if(0!==re){if(re!==ne){send_code(z,re,z.bl_tree);se--}send_code(z,Dn,z.bl_tree);send_bits(z,se-3,2)}else if(se<=10){send_code(z,Pn,z.bl_tree);send_bits(z,se-3,3)}else{send_code(z,On,z.bl_tree);send_bits(z,se-11,7)}se=0;ne=re;if(0===ie){oe=138;ae=3}else if(re===ie){oe=6;ae=3}else{oe=7;ae=4}}}};const build_bl_tree=z=>{let K;scan_tree(z,z.dyn_ltree,z.l_desc.max_code);scan_tree(z,z.dyn_dtree,z.d_desc.max_code);build_tree(z,z.bl_desc);for(K=Rn-1;K>=3;K--)if(0!==z.bl_tree[2*Vn[K]+1])break;z.opt_len+=3*(K+1)+5+5+4;return K};const send_all_trees=(z,K,ee,te)=>{let ne;send_bits(z,K-257,5);send_bits(z,ee-1,5);send_bits(z,te-4,4);for(ne=0;ne<te;ne++)send_bits(z,z.bl_tree[2*Vn[ne]+1],3);send_tree(z,z.dyn_ltree,K-1);send_tree(z,z.dyn_dtree,ee-1)};const detect_data_type=z=>{let K=4093624447;let ee;for(ee=0;ee<=31;ee++,K>>>=1)if(1&K&&0!==z.dyn_ltree[2*ee])return vn;if(0!==z.dyn_ltree[18]||0!==z.dyn_ltree[20]||0!==z.dyn_ltree[26])return wn;for(ee=32;ee<Tn;ee++)if(0!==z.dyn_ltree[2*ee])return wn;return vn};let Jn=false;const _tr_init$1=z=>{if(!Jn){tr_static_init();Jn=true}z.l_desc=new TreeDesc(z.dyn_ltree,Xn);z.d_desc=new TreeDesc(z.dyn_dtree,Yn);z.bl_desc=new TreeDesc(z.bl_tree,Kn);z.bi_buf=0;z.bi_valid=0;init_block(z)};const _tr_stored_block$1=(z,K,ee,te)=>{send_bits(z,(_n<<1)+(te?1:0),3);bi_windup(z);put_short(z,ee);put_short(z,~ee);ee&&z.pending_buf.set(z.window.subarray(K,K+ee),z.pending);z.pending+=ee};const _tr_align$1=z=>{send_bits(z,kn<<1,3);send_code(z,Nn,qn);bi_flush(z)};const _tr_flush_block$1=(z,K,ee,te)=>{let ne,re;let ie=0;if(z.level>0){z.strm.data_type===yn&&(z.strm.data_type=detect_data_type(z));build_tree(z,z.l_desc);build_tree(z,z.d_desc);ie=build_bl_tree(z);ne=z.opt_len+3+7>>>3;re=z.static_len+3+7>>>3;re<=ne&&(ne=re)}else ne=re=ee+5;if(ee+4<=ne&&-1!==K)_tr_stored_block$1(z,K,ee,te);else if(z.strategy===bn||re===ne){send_bits(z,(kn<<1)+(te?1:0),3);compress_block(z,qn,jn)}else{send_bits(z,(xn<<1)+(te?1:0),3);send_all_trees(z,z.l_desc.max_code+1,z.d_desc.max_code+1,ie+1);compress_block(z,z.dyn_ltree,z.dyn_dtree)}init_block(z);te&&bi_windup(z)};const _tr_tally$1=(z,K,ee)=>{z.pending_buf[z.sym_buf+z.sym_next++]=K;z.pending_buf[z.sym_buf+z.sym_next++]=K>>8;z.pending_buf[z.sym_buf+z.sym_next++]=ee;if(0===K)z.dyn_ltree[2*ee]++;else{z.matches++;K--;z.dyn_ltree[2*(Gn[ee]+Tn+1)]++;z.dyn_dtree[2*d_code(K)]++}return z.sym_next===z.sym_end};var er=_tr_init$1;var tr=_tr_stored_block$1;var nr=_tr_flush_block$1;var rr=_tr_tally$1;var ir=_tr_align$1;var sr={_tr_init:er,_tr_stored_block:tr,_tr_flush_block:nr,_tr_tally:rr,_tr_align:ir};const adler32$1=(z,K,ee,te)=>{let ne=65535&z|0,re=z>>>16&65535|0,ie=0;while(0!==ee){ie=ee>2e3?2e3:ee;ee-=ie;do{ne=ne+K[te++]|0;re=re+ne|0}while(--ie);ne%=65521;re%=65521}return ne|re<<16|0};var or=adler32$1;const makeTable$1=()=>{let z,K=[];for(var ee=0;ee<256;ee++){z=ee;for(var te=0;te<8;te++)z=1&z?3988292384^z>>>1:z>>>1;K[ee]=z}return K};const ar=new Uint32Array(makeTable$1());const crc32$1=(z,K,ee,te)=>{const ne=ar;const re=te+ee;z^=-1;for(let ee=te;ee<re;ee++)z=z>>>8^ne[255&(z^K[ee])];return-1^z};var lr=crc32$1;var cr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var hr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ur,_tr_stored_block:dr,_tr_flush_block:fr,_tr_tally:pr,_tr_align:gr}=sr;const{Z_NO_FLUSH:mr,Z_PARTIAL_FLUSH:br,Z_FULL_FLUSH:vr,Z_FINISH:wr,Z_BLOCK:yr,Z_OK:_r,Z_STREAM_END:kr,Z_STREAM_ERROR:xr,Z_DATA_ERROR:Cr,Z_BUF_ERROR:Sr,Z_DEFAULT_COMPRESSION:Ar,Z_FILTERED:Tr,Z_HUFFMAN_ONLY:Er,Z_RLE:Mr,Z_FIXED:Rr,Z_DEFAULT_STRATEGY:Ir,Z_UNKNOWN:Fr,Z_DEFLATED:Lr}=hr;const Br=9;const Nr=15;const Dr=8;const Pr=29;const Or=256;const zr=Or+1+Pr;const Hr=30;const Ur=19;const Vr=2*zr+1;const $r=15;const qr=3;const jr=258;const Wr=jr+qr+1;const Gr=32;const Zr=42;const Qr=57;const Xr=69;const Yr=73;const Kr=91;const Jr=103;const ei=113;const ti=666;const ni=1;const ri=2;const ii=3;const si=4;const oi=3;const err=(z,K)=>{z.msg=cr[K];return K};const rank=z=>2*z-(z>4?9:0);const zero=z=>{let K=z.length;while(--K>=0)z[K]=0};const slide_hash=z=>{let K,ee;let te;let ne=z.w_size;K=z.hash_size;te=K;do{ee=z.head[--te];z.head[te]=ee>=ne?ee-ne:0}while(--K);K=ne;te=K;do{ee=z.prev[--te];z.prev[te]=ee>=ne?ee-ne:0}while(--K)};let HASH_ZLIB=(z,K,ee)=>(K<<z.hash_shift^ee)&z.hash_mask;let ai=HASH_ZLIB;const flush_pending=z=>{const K=z.state;let ee=K.pending;ee>z.avail_out&&(ee=z.avail_out);if(0!==ee){z.output.set(K.pending_buf.subarray(K.pending_out,K.pending_out+ee),z.next_out);z.next_out+=ee;K.pending_out+=ee;z.total_out+=ee;z.avail_out-=ee;K.pending-=ee;0===K.pending&&(K.pending_out=0)}};const flush_block_only=(z,K)=>{fr(z,z.block_start>=0?z.block_start:-1,z.strstart-z.block_start,K);z.block_start=z.strstart;flush_pending(z.strm)};const put_byte=(z,K)=>{z.pending_buf[z.pending++]=K};const putShortMSB=(z,K)=>{z.pending_buf[z.pending++]=K>>>8&255;z.pending_buf[z.pending++]=255&K};const read_buf=(z,K,ee,te)=>{let ne=z.avail_in;ne>te&&(ne=te);if(0===ne)return 0;z.avail_in-=ne;K.set(z.input.subarray(z.next_in,z.next_in+ne),ee);1===z.state.wrap?z.adler=or(z.adler,K,ne,ee):2===z.state.wrap&&(z.adler=lr(z.adler,K,ne,ee));z.next_in+=ne;z.total_in+=ne;return ne};const longest_match=(z,K)=>{let ee=z.max_chain_length;let te=z.strstart;let ne;let re;let ie=z.prev_length;let se=z.nice_match;const oe=z.strstart>z.w_size-Wr?z.strstart-(z.w_size-Wr):0;const ae=z.window;const le=z.w_mask;const ce=z.prev;const he=z.strstart+jr;let ue=ae[te+ie-1];let de=ae[te+ie];z.prev_length>=z.good_match&&(ee>>=2);se>z.lookahead&&(se=z.lookahead);do{ne=K;if(ae[ne+ie]===de&&ae[ne+ie-1]===ue&&ae[ne]===ae[te]&&ae[++ne]===ae[te+1]){te+=2;ne++;do{}while(ae[++te]===ae[++ne]&&ae[++te]===ae[++ne]&&ae[++te]===ae[++ne]&&ae[++te]===ae[++ne]&&ae[++te]===ae[++ne]&&ae[++te]===ae[++ne]&&ae[++te]===ae[++ne]&&ae[++te]===ae[++ne]&&te<he);re=jr-(he-te);te=he-jr;if(re>ie){z.match_start=K;ie=re;if(re>=se)break;ue=ae[te+ie-1];de=ae[te+ie]}}}while((K=ce[K&le])>oe&&0!==--ee);return ie<=z.lookahead?ie:z.lookahead};const fill_window=z=>{const K=z.w_size;let ee,te,ne;do{te=z.window_size-z.lookahead-z.strstart;if(z.strstart>=K+(K-Wr)){z.window.set(z.window.subarray(K,K+K-te),0);z.match_start-=K;z.strstart-=K;z.block_start-=K;z.insert>z.strstart&&(z.insert=z.strstart);slide_hash(z);te+=K}if(0===z.strm.avail_in)break;ee=read_buf(z.strm,z.window,z.strstart+z.lookahead,te);z.lookahead+=ee;if(z.lookahead+z.insert>=qr){ne=z.strstart-z.insert;z.ins_h=z.window[ne];z.ins_h=ai(z,z.ins_h,z.window[ne+1]);while(z.insert){z.ins_h=ai(z,z.ins_h,z.window[ne+qr-1]);z.prev[ne&z.w_mask]=z.head[z.ins_h];z.head[z.ins_h]=ne;ne++;z.insert--;if(z.lookahead+z.insert<qr)break}}}while(z.lookahead<Wr&&0!==z.strm.avail_in)};const deflate_stored=(z,K)=>{let ee=z.pending_buf_size-5>z.w_size?z.w_size:z.pending_buf_size-5;let te,ne,re,ie=0;let se=z.strm.avail_in;do{te=65535;re=z.bi_valid+42>>3;if(z.strm.avail_out<re)break;re=z.strm.avail_out-re;ne=z.strstart-z.block_start;te>ne+z.strm.avail_in&&(te=ne+z.strm.avail_in);te>re&&(te=re);if(te<ee&&(0===te&&K!==wr||K===mr||te!==ne+z.strm.avail_in))break;ie=K===wr&&te===ne+z.strm.avail_in?1:0;dr(z,0,0,ie);z.pending_buf[z.pending-4]=te;z.pending_buf[z.pending-3]=te>>8;z.pending_buf[z.pending-2]=~te;z.pending_buf[z.pending-1]=~te>>8;flush_pending(z.strm);if(ne){ne>te&&(ne=te);z.strm.output.set(z.window.subarray(z.block_start,z.block_start+ne),z.strm.next_out);z.strm.next_out+=ne;z.strm.avail_out-=ne;z.strm.total_out+=ne;z.block_start+=ne;te-=ne}if(te){read_buf(z.strm,z.strm.output,z.strm.next_out,te);z.strm.next_out+=te;z.strm.avail_out-=te;z.strm.total_out+=te}}while(0===ie);se-=z.strm.avail_in;if(se){if(se>=z.w_size){z.matches=2;z.window.set(z.strm.input.subarray(z.strm.next_in-z.w_size,z.strm.next_in),0);z.strstart=z.w_size;z.insert=z.strstart}else{if(z.window_size-z.strstart<=se){z.strstart-=z.w_size;z.window.set(z.window.subarray(z.w_size,z.w_size+z.strstart),0);z.matches<2&&z.matches++;z.insert>z.strstart&&(z.insert=z.strstart)}z.window.set(z.strm.input.subarray(z.strm.next_in-se,z.strm.next_in),z.strstart);z.strstart+=se;z.insert+=se>z.w_size-z.insert?z.w_size-z.insert:se}z.block_start=z.strstart}z.high_water<z.strstart&&(z.high_water=z.strstart);if(ie)return si;if(K!==mr&&K!==wr&&0===z.strm.avail_in&&z.strstart===z.block_start)return ri;re=z.window_size-z.strstart;if(z.strm.avail_in>re&&z.block_start>=z.w_size){z.block_start-=z.w_size;z.strstart-=z.w_size;z.window.set(z.window.subarray(z.w_size,z.w_size+z.strstart),0);z.matches<2&&z.matches++;re+=z.w_size;z.insert>z.strstart&&(z.insert=z.strstart)}re>z.strm.avail_in&&(re=z.strm.avail_in);if(re){read_buf(z.strm,z.window,z.strstart,re);z.strstart+=re;z.insert+=re>z.w_size-z.insert?z.w_size-z.insert:re}z.high_water<z.strstart&&(z.high_water=z.strstart);re=z.bi_valid+42>>3;re=z.pending_buf_size-re>65535?65535:z.pending_buf_size-re;ee=re>z.w_size?z.w_size:re;ne=z.strstart-z.block_start;if(ne>=ee||(ne||K===wr)&&K!==mr&&0===z.strm.avail_in&&ne<=re){te=ne>re?re:ne;ie=K===wr&&0===z.strm.avail_in&&te===ne?1:0;dr(z,z.block_start,te,ie);z.block_start+=te;flush_pending(z.strm)}return ie?ii:ni};const deflate_fast=(z,K)=>{let ee;let te;for(;;){if(z.lookahead<Wr){fill_window(z);if(z.lookahead<Wr&&K===mr)return ni;if(0===z.lookahead)break}ee=0;if(z.lookahead>=qr){z.ins_h=ai(z,z.ins_h,z.window[z.strstart+qr-1]);ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h];z.head[z.ins_h]=z.strstart}0!==ee&&z.strstart-ee<=z.w_size-Wr&&(z.match_length=longest_match(z,ee));if(z.match_length>=qr){te=pr(z,z.strstart-z.match_start,z.match_length-qr);z.lookahead-=z.match_length;if(z.match_length<=z.max_lazy_match&&z.lookahead>=qr){z.match_length--;do{z.strstart++;z.ins_h=ai(z,z.ins_h,z.window[z.strstart+qr-1]);ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h];z.head[z.ins_h]=z.strstart}while(0!==--z.match_length);z.strstart++}else{z.strstart+=z.match_length;z.match_length=0;z.ins_h=z.window[z.strstart];z.ins_h=ai(z,z.ins_h,z.window[z.strstart+1])}}else{te=pr(z,0,z.window[z.strstart]);z.lookahead--;z.strstart++}if(te){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}}z.insert=z.strstart<qr-1?z.strstart:qr-1;if(K===wr){flush_block_only(z,true);return 0===z.strm.avail_out?ii:si}if(z.sym_next){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}return ri};const deflate_slow=(z,K)=>{let ee;let te;let ne;for(;;){if(z.lookahead<Wr){fill_window(z);if(z.lookahead<Wr&&K===mr)return ni;if(0===z.lookahead)break}ee=0;if(z.lookahead>=qr){z.ins_h=ai(z,z.ins_h,z.window[z.strstart+qr-1]);ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h];z.head[z.ins_h]=z.strstart}z.prev_length=z.match_length;z.prev_match=z.match_start;z.match_length=qr-1;if(0!==ee&&z.prev_length<z.max_lazy_match&&z.strstart-ee<=z.w_size-Wr){z.match_length=longest_match(z,ee);z.match_length<=5&&(z.strategy===Tr||z.match_length===qr&&z.strstart-z.match_start>4096)&&(z.match_length=qr-1)}if(z.prev_length>=qr&&z.match_length<=z.prev_length){ne=z.strstart+z.lookahead-qr;te=pr(z,z.strstart-1-z.prev_match,z.prev_length-qr);z.lookahead-=z.prev_length-1;z.prev_length-=2;do{if(++z.strstart<=ne){z.ins_h=ai(z,z.ins_h,z.window[z.strstart+qr-1]);ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h];z.head[z.ins_h]=z.strstart}}while(0!==--z.prev_length);z.match_available=0;z.match_length=qr-1;z.strstart++;if(te){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}}else if(z.match_available){te=pr(z,0,z.window[z.strstart-1]);te&&flush_block_only(z,false);z.strstart++;z.lookahead--;if(0===z.strm.avail_out)return ni}else{z.match_available=1;z.strstart++;z.lookahead--}}if(z.match_available){te=pr(z,0,z.window[z.strstart-1]);z.match_available=0}z.insert=z.strstart<qr-1?z.strstart:qr-1;if(K===wr){flush_block_only(z,true);return 0===z.strm.avail_out?ii:si}if(z.sym_next){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}return ri};const deflate_rle=(z,K)=>{let ee;let te;let ne,re;const ie=z.window;for(;;){if(z.lookahead<=jr){fill_window(z);if(z.lookahead<=jr&&K===mr)return ni;if(0===z.lookahead)break}z.match_length=0;if(z.lookahead>=qr&&z.strstart>0){ne=z.strstart-1;te=ie[ne];if(te===ie[++ne]&&te===ie[++ne]&&te===ie[++ne]){re=z.strstart+jr;do{}while(te===ie[++ne]&&te===ie[++ne]&&te===ie[++ne]&&te===ie[++ne]&&te===ie[++ne]&&te===ie[++ne]&&te===ie[++ne]&&te===ie[++ne]&&ne<re);z.match_length=jr-(re-ne);z.match_length>z.lookahead&&(z.match_length=z.lookahead)}}if(z.match_length>=qr){ee=pr(z,1,z.match_length-qr);z.lookahead-=z.match_length;z.strstart+=z.match_length;z.match_length=0}else{ee=pr(z,0,z.window[z.strstart]);z.lookahead--;z.strstart++}if(ee){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}}z.insert=0;if(K===wr){flush_block_only(z,true);return 0===z.strm.avail_out?ii:si}if(z.sym_next){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}return ri};const deflate_huff=(z,K)=>{let ee;for(;;){if(0===z.lookahead){fill_window(z);if(0===z.lookahead){if(K===mr)return ni;break}}z.match_length=0;ee=pr(z,0,z.window[z.strstart]);z.lookahead--;z.strstart++;if(ee){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}}z.insert=0;if(K===wr){flush_block_only(z,true);return 0===z.strm.avail_out?ii:si}if(z.sym_next){flush_block_only(z,false);if(0===z.strm.avail_out)return ni}return ri};function Config(z,K,ee,te,ne){this.good_length=z;this.max_lazy=K;this.nice_length=ee;this.max_chain=te;this.func=ne}const li=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];const lm_init=z=>{z.window_size=2*z.w_size;zero(z.head);z.max_lazy_match=li[z.level].max_lazy;z.good_match=li[z.level].good_length;z.nice_match=li[z.level].nice_length;z.max_chain_length=li[z.level].max_chain;z.strstart=0;z.block_start=0;z.lookahead=0;z.insert=0;z.match_length=z.prev_length=qr-1;z.match_available=0;z.ins_h=0};function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Lr;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new Uint16Array(2*Vr);this.dyn_dtree=new Uint16Array(2*(2*Hr+1));this.bl_tree=new Uint16Array(2*(2*Ur+1));zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new Uint16Array($r+1);this.heap=new Uint16Array(2*zr+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new Uint16Array(2*zr+1);zero(this.depth);this.sym_buf=0;this.lit_bufsize=0;this.sym_next=0;this.sym_end=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}const deflateStateCheck=z=>{if(!z)return 1;const K=z.state;return!K||K.strm!==z||K.status!==Zr&&K.status!==Qr&&K.status!==Xr&&K.status!==Yr&&K.status!==Kr&&K.status!==Jr&&K.status!==ei&&K.status!==ti?1:0};const deflateResetKeep=z=>{if(deflateStateCheck(z))return err(z,xr);z.total_in=z.total_out=0;z.data_type=Fr;const K=z.state;K.pending=0;K.pending_out=0;K.wrap<0&&(K.wrap=-K.wrap);K.status=2===K.wrap?Qr:K.wrap?Zr:ei;z.adler=2===K.wrap?0:1;K.last_flush=-2;ur(K);return _r};const deflateReset=z=>{const K=deflateResetKeep(z);K===_r&&lm_init(z.state);return K};const deflateSetHeader=(z,K)=>{if(deflateStateCheck(z)||2!==z.state.wrap)return xr;z.state.gzhead=K;return _r};const deflateInit2=(z,K,ee,te,ne,re)=>{if(!z)return xr;let ie=1;K===Ar&&(K=6);if(te<0){ie=0;te=-te}else if(te>15){ie=2;te-=16}if(ne<1||ne>Br||ee!==Lr||te<8||te>15||K<0||K>9||re<0||re>Rr||8===te&&1!==ie)return err(z,xr);8===te&&(te=9);const se=new DeflateState;z.state=se;se.strm=z;se.status=Zr;se.wrap=ie;se.gzhead=null;se.w_bits=te;se.w_size=1<<se.w_bits;se.w_mask=se.w_size-1;se.hash_bits=ne+7;se.hash_size=1<<se.hash_bits;se.hash_mask=se.hash_size-1;se.hash_shift=~~((se.hash_bits+qr-1)/qr);se.window=new Uint8Array(2*se.w_size);se.head=new Uint16Array(se.hash_size);se.prev=new Uint16Array(se.w_size);se.lit_bufsize=1<<ne+6;se.pending_buf_size=4*se.lit_bufsize;se.pending_buf=new Uint8Array(se.pending_buf_size);se.sym_buf=se.lit_bufsize;se.sym_end=3*(se.lit_bufsize-1);se.level=K;se.strategy=re;se.method=ee;return deflateReset(z)};const deflateInit=(z,K)=>deflateInit2(z,K,Lr,Nr,Dr,Ir);const deflate$2=(z,K)=>{if(deflateStateCheck(z)||K>yr||K<0)return z?err(z,xr):xr;const ee=z.state;if(!z.output||0!==z.avail_in&&!z.input||ee.status===ti&&K!==wr)return err(z,0===z.avail_out?Sr:xr);const te=ee.last_flush;ee.last_flush=K;if(0!==ee.pending){flush_pending(z);if(0===z.avail_out){ee.last_flush=-1;return _r}}else if(0===z.avail_in&&rank(K)<=rank(te)&&K!==wr)return err(z,Sr);if(ee.status===ti&&0!==z.avail_in)return err(z,Sr);ee.status===Zr&&0===ee.wrap&&(ee.status=ei);if(ee.status===Zr){let K=Lr+(ee.w_bits-8<<4)<<8;let te=-1;te=ee.strategy>=Er||ee.level<2?0:ee.level<6?1:6===ee.level?2:3;K|=te<<6;0!==ee.strstart&&(K|=Gr);K+=31-K%31;putShortMSB(ee,K);if(0!==ee.strstart){putShortMSB(ee,z.adler>>>16);putShortMSB(ee,65535&z.adler)}z.adler=1;ee.status=ei;flush_pending(z);if(0!==ee.pending){ee.last_flush=-1;return _r}}if(ee.status===Qr){z.adler=0;put_byte(ee,31);put_byte(ee,139);put_byte(ee,8);if(ee.gzhead){put_byte(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0));put_byte(ee,255&ee.gzhead.time);put_byte(ee,ee.gzhead.time>>8&255);put_byte(ee,ee.gzhead.time>>16&255);put_byte(ee,ee.gzhead.time>>24&255);put_byte(ee,9===ee.level?2:ee.strategy>=Er||ee.level<2?4:0);put_byte(ee,255&ee.gzhead.os);if(ee.gzhead.extra&&ee.gzhead.extra.length){put_byte(ee,255&ee.gzhead.extra.length);put_byte(ee,ee.gzhead.extra.length>>8&255)}ee.gzhead.hcrc&&(z.adler=lr(z.adler,ee.pending_buf,ee.pending,0));ee.gzindex=0;ee.status=Xr}else{put_byte(ee,0);put_byte(ee,0);put_byte(ee,0);put_byte(ee,0);put_byte(ee,0);put_byte(ee,9===ee.level?2:ee.strategy>=Er||ee.level<2?4:0);put_byte(ee,oi);ee.status=ei;flush_pending(z);if(0!==ee.pending){ee.last_flush=-1;return _r}}}if(ee.status===Xr){if(ee.gzhead.extra){let K=ee.pending;let te=(65535&ee.gzhead.extra.length)-ee.gzindex;while(ee.pending+te>ee.pending_buf_size){let ne=ee.pending_buf_size-ee.pending;ee.pending_buf.set(ee.gzhead.extra.subarray(ee.gzindex,ee.gzindex+ne),ee.pending);ee.pending=ee.pending_buf_size;ee.gzhead.hcrc&&ee.pending>K&&(z.adler=lr(z.adler,ee.pending_buf,ee.pending-K,K));ee.gzindex+=ne;flush_pending(z);if(0!==ee.pending){ee.last_flush=-1;return _r}K=0;te-=ne}let ne=new Uint8Array(ee.gzhead.extra);ee.pending_buf.set(ne.subarray(ee.gzindex,ee.gzindex+te),ee.pending);ee.pending+=te;ee.gzhead.hcrc&&ee.pending>K&&(z.adler=lr(z.adler,ee.pending_buf,ee.pending-K,K));ee.gzindex=0}ee.status=Yr}if(ee.status===Yr){if(ee.gzhead.name){let K=ee.pending;let te;do{if(ee.pending===ee.pending_buf_size){ee.gzhead.hcrc&&ee.pending>K&&(z.adler=lr(z.adler,ee.pending_buf,ee.pending-K,K));flush_pending(z);if(0!==ee.pending){ee.last_flush=-1;return _r}K=0}te=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0;put_byte(ee,te)}while(0!==te);ee.gzhead.hcrc&&ee.pending>K&&(z.adler=lr(z.adler,ee.pending_buf,ee.pending-K,K));ee.gzindex=0}ee.status=Kr}if(ee.status===Kr){if(ee.gzhead.comment){let K=ee.pending;let te;do{if(ee.pending===ee.pending_buf_size){ee.gzhead.hcrc&&ee.pending>K&&(z.adler=lr(z.adler,ee.pending_buf,ee.pending-K,K));flush_pending(z);if(0!==ee.pending){ee.last_flush=-1;return _r}K=0}te=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0;put_byte(ee,te)}while(0!==te);ee.gzhead.hcrc&&ee.pending>K&&(z.adler=lr(z.adler,ee.pending_buf,ee.pending-K,K))}ee.status=Jr}if(ee.status===Jr){if(ee.gzhead.hcrc){if(ee.pending+2>ee.pending_buf_size){flush_pending(z);if(0!==ee.pending){ee.last_flush=-1;return _r}}put_byte(ee,255&z.adler);put_byte(ee,z.adler>>8&255);z.adler=0}ee.status=ei;flush_pending(z);if(0!==ee.pending){ee.last_flush=-1;return _r}}if(0!==z.avail_in||0!==ee.lookahead||K!==mr&&ee.status!==ti){let te=0===ee.level?deflate_stored(ee,K):ee.strategy===Er?deflate_huff(ee,K):ee.strategy===Mr?deflate_rle(ee,K):li[ee.level].func(ee,K);te!==ii&&te!==si||(ee.status=ti);if(te===ni||te===ii){0===z.avail_out&&(ee.last_flush=-1);return _r}if(te===ri){if(K===br)gr(ee);else if(K!==yr){dr(ee,0,0,false);if(K===vr){zero(ee.head);if(0===ee.lookahead){ee.strstart=0;ee.block_start=0;ee.insert=0}}}flush_pending(z);if(0===z.avail_out){ee.last_flush=-1;return _r}}}if(K!==wr)return _r;if(ee.wrap<=0)return kr;if(2===ee.wrap){put_byte(ee,255&z.adler);put_byte(ee,z.adler>>8&255);put_byte(ee,z.adler>>16&255);put_byte(ee,z.adler>>24&255);put_byte(ee,255&z.total_in);put_byte(ee,z.total_in>>8&255);put_byte(ee,z.total_in>>16&255);put_byte(ee,z.total_in>>24&255)}else{putShortMSB(ee,z.adler>>>16);putShortMSB(ee,65535&z.adler)}flush_pending(z);ee.wrap>0&&(ee.wrap=-ee.wrap);return 0!==ee.pending?_r:kr};const deflateEnd=z=>{if(deflateStateCheck(z))return xr;const K=z.state.status;z.state=null;return K===ei?err(z,Cr):_r};const deflateSetDictionary=(z,K)=>{let ee=K.length;if(deflateStateCheck(z))return xr;const te=z.state;const ne=te.wrap;if(2===ne||1===ne&&te.status!==Zr||te.lookahead)return xr;1===ne&&(z.adler=or(z.adler,K,ee,0));te.wrap=0;if(ee>=te.w_size){if(0===ne){zero(te.head);te.strstart=0;te.block_start=0;te.insert=0}let z=new Uint8Array(te.w_size);z.set(K.subarray(ee-te.w_size,ee),0);K=z;ee=te.w_size}const re=z.avail_in;const ie=z.next_in;const se=z.input;z.avail_in=ee;z.next_in=0;z.input=K;fill_window(te);while(te.lookahead>=qr){let z=te.strstart;let K=te.lookahead-(qr-1);do{te.ins_h=ai(te,te.ins_h,te.window[z+qr-1]);te.prev[z&te.w_mask]=te.head[te.ins_h];te.head[te.ins_h]=z;z++}while(--K);te.strstart=z;te.lookahead=qr-1;fill_window(te)}te.strstart+=te.lookahead;te.block_start=te.strstart;te.insert=te.lookahead;te.lookahead=0;te.match_length=te.prev_length=qr-1;te.match_available=0;z.next_in=ie;z.input=se;z.avail_in=re;te.wrap=ne;return _r};var ci=deflateInit;var hi=deflateInit2;var ui=deflateReset;var di=deflateResetKeep;var fi=deflateSetHeader;var pi=deflate$2;var gi=deflateEnd;var mi=deflateSetDictionary;var bi="pako deflate (from Nodeca project)";var vi={deflateInit:ci,deflateInit2:hi,deflateReset:ui,deflateResetKeep:di,deflateSetHeader:fi,deflate:pi,deflateEnd:gi,deflateSetDictionary:mi,deflateInfo:bi};const _has$1=(z,K)=>Object.prototype.hasOwnProperty.call(z,K);var assign$1=function(z){const K=Array.prototype.slice.call(arguments,1);while(K.length){const ee=K.shift();if(ee){if("object"!==typeof ee)throw new TypeError(ee+"must be non-object");for(const K in ee)_has$1(ee,K)&&(z[K]=ee[K])}}return z};var flattenChunks$1=z=>{let K=0;for(let ee=0,te=z.length;ee<te;ee++)K+=z[ee].length;const ee=new Uint8Array(K);for(let K=0,te=0,ne=z.length;K<ne;K++){let ne=z[K];ee.set(ne,te);te+=ne.length}return ee};var wi={assign:assign$1,flattenChunks:flattenChunks$1};let yi=true;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Ep){yi=false}const _i=new Uint8Array(256);for(let Mp=0;Mp<256;Mp++)_i[Mp]=Mp>=252?6:Mp>=248?5:Mp>=240?4:Mp>=224?3:Mp>=192?2:1;_i[254]=_i[254]=1;var string2buf$1=z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(z);let K,ee,te,ne,re,ie=z.length,se=0;for(ne=0;ne<ie;ne++){ee=z.charCodeAt(ne);if(55296===(64512&ee)&&ne+1<ie){te=z.charCodeAt(ne+1);if(56320===(64512&te)){ee=65536+(ee-55296<<10)+(te-56320);ne++}}se+=ee<128?1:ee<2048?2:ee<65536?3:4}K=new Uint8Array(se);for(re=0,ne=0;re<se;ne++){ee=z.charCodeAt(ne);if(55296===(64512&ee)&&ne+1<ie){te=z.charCodeAt(ne+1);if(56320===(64512&te)){ee=65536+(ee-55296<<10)+(te-56320);ne++}}if(ee<128)K[re++]=ee;else if(ee<2048){K[re++]=192|ee>>>6;K[re++]=128|63&ee}else if(ee<65536){K[re++]=224|ee>>>12;K[re++]=128|ee>>>6&63;K[re++]=128|63&ee}else{K[re++]=240|ee>>>18;K[re++]=128|ee>>>12&63;K[re++]=128|ee>>>6&63;K[re++]=128|63&ee}}return K};const buf2binstring$1=(z,K)=>{if(K<65534&&z.subarray&&yi)return String.fromCharCode.apply(null,z.length===K?z:z.subarray(0,K));let ee="";for(let te=0;te<K;te++)ee+=String.fromCharCode(z[te]);return ee};var buf2string$1=(z,K)=>{const ee=K||z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(z.subarray(0,K));let te,ne;const re=new Array(2*ee);for(ne=0,te=0;te<ee;){let K=z[te++];if(K<128){re[ne++]=K;continue}let ie=_i[K];if(ie>4){re[ne++]=65533;te+=ie-1}else{K&=2===ie?31:3===ie?15:7;while(ie>1&&te<ee){K=K<<6|63&z[te++];ie--}if(ie>1)re[ne++]=65533;else if(K<65536)re[ne++]=K;else{K-=65536;re[ne++]=55296|K>>10&1023;re[ne++]=56320|1023&K}}}return buf2binstring$1(re,ne)};var utf8border$1=(z,K)=>{K=K||z.length;K>z.length&&(K=z.length);let ee=K-1;while(ee>=0&&128===(192&z[ee]))ee--;return ee<0||0===ee?K:ee+_i[z[ee]]>K?ee:K};var ki={string2buf:string2buf$1,buf2string:buf2string$1,utf8border:utf8border$1};function ZStream$1(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}var xi=ZStream$1;const Ci=Object.prototype.toString;const{Z_NO_FLUSH:Si,Z_SYNC_FLUSH:Ai,Z_FULL_FLUSH:Ti,Z_FINISH:Ei,Z_OK:Mi,Z_STREAM_END:Ri,Z_DEFAULT_COMPRESSION:Ii,Z_DEFAULT_STRATEGY:Fi,Z_DEFLATED:Li}=hr;function Deflate$1(z){this.options=wi.assign({level:Ii,method:Li,chunkSize:16384,windowBits:15,memLevel:8,strategy:Fi},z||{});let K=this.options;K.raw&&K.windowBits>0?K.windowBits=-K.windowBits:K.gzip&&K.windowBits>0&&K.windowBits<16&&(K.windowBits+=16);this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new xi;this.strm.avail_out=0;let ee=vi.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(ee!==Mi)throw new Error(cr[ee]);K.header&&vi.deflateSetHeader(this.strm,K.header);if(K.dictionary){let z;z="string"===typeof K.dictionary?ki.string2buf(K.dictionary):"[object ArrayBuffer]"===Ci.call(K.dictionary)?new Uint8Array(K.dictionary):K.dictionary;ee=vi.deflateSetDictionary(this.strm,z);if(ee!==Mi)throw new Error(cr[ee]);this._dict_set=true}}Deflate$1.prototype.push=function(z,K){const ee=this.strm;const te=this.options.chunkSize;let ne,re;if(this.ended)return false;re=K===~~K?K:true===K?Ei:Si;"string"===typeof z?ee.input=ki.string2buf(z):"[object ArrayBuffer]"===Ci.call(z)?ee.input=new Uint8Array(z):ee.input=z;ee.next_in=0;ee.avail_in=ee.input.length;for(;;){if(0===ee.avail_out){ee.output=new Uint8Array(te);ee.next_out=0;ee.avail_out=te}if((re===Ai||re===Ti)&&ee.avail_out<=6){this.onData(ee.output.subarray(0,ee.next_out));ee.avail_out=0}else{ne=vi.deflate(ee,re);if(ne===Ri){ee.next_out>0&&this.onData(ee.output.subarray(0,ee.next_out));ne=vi.deflateEnd(this.strm);this.onEnd(ne);this.ended=true;return ne===Mi}if(0!==ee.avail_out){if(re>0&&ee.next_out>0){this.onData(ee.output.subarray(0,ee.next_out));ee.avail_out=0}else if(0===ee.avail_in)break}else this.onData(ee.output)}}return true};Deflate$1.prototype.onData=function(z){this.chunks.push(z)};Deflate$1.prototype.onEnd=function(z){z===Mi&&(this.result=wi.flattenChunks(this.chunks));this.chunks=[];this.err=z;this.msg=this.strm.msg};function deflate$1(z,K){const ee=new Deflate$1(K);ee.push(z,true);if(ee.err)throw ee.msg||cr[ee.err];return ee.result}function deflateRaw$1(z,K){K=K||{};K.raw=true;return deflate$1(z,K)}function gzip$1(z,K){K=K||{};K.gzip=true;return deflate$1(z,K)}var Bi=Deflate$1;var Ni=deflate$1;var Di=deflateRaw$1;var Pi=gzip$1;var Oi=hr;var zi={Deflate:Bi,deflate:Ni,deflateRaw:Di,gzip:Pi,constants:Oi};const Hi=16209;const Ui=16191;var Vi=function inflate_fast(z,K){let ee;let te;let ne;let re;let ie;let se;let oe;let ae;let le;let ce;let he;let ue;let de;let fe;let pe;let ge;let me;let be;let ve;let we;let ye;let _e;let ke,xe;const Ce=z.state;ee=z.next_in;ke=z.input;te=ee+(z.avail_in-5);ne=z.next_out;xe=z.output;re=ne-(K-z.avail_out);ie=ne+(z.avail_out-257);se=Ce.dmax;oe=Ce.wsize;ae=Ce.whave;le=Ce.wnext;ce=Ce.window;he=Ce.hold;ue=Ce.bits;de=Ce.lencode;fe=Ce.distcode;pe=(1<<Ce.lenbits)-1;ge=(1<<Ce.distbits)-1;e:do{if(ue<15){he+=ke[ee++]<<ue;ue+=8;he+=ke[ee++]<<ue;ue+=8}me=de[he&pe];t:for(;;){be=me>>>24;he>>>=be;ue-=be;be=me>>>16&255;if(0===be)xe[ne++]=65535&me;else{if(!(16&be)){if(0===(64&be)){me=de[(65535&me)+(he&(1<<be)-1)];continue t}if(32&be){Ce.mode=Ui;break e}z.msg="invalid literal/length code";Ce.mode=Hi;break e}ve=65535&me;be&=15;if(be){if(ue<be){he+=ke[ee++]<<ue;ue+=8}ve+=he&(1<<be)-1;he>>>=be;ue-=be}if(ue<15){he+=ke[ee++]<<ue;ue+=8;he+=ke[ee++]<<ue;ue+=8}me=fe[he&ge];n:for(;;){be=me>>>24;he>>>=be;ue-=be;be=me>>>16&255;if(!(16&be)){if(0===(64&be)){me=fe[(65535&me)+(he&(1<<be)-1)];continue n}z.msg="invalid distance code";Ce.mode=Hi;break e}we=65535&me;be&=15;if(ue<be){he+=ke[ee++]<<ue;ue+=8;if(ue<be){he+=ke[ee++]<<ue;ue+=8}}we+=he&(1<<be)-1;if(we>se){z.msg="invalid distance too far back";Ce.mode=Hi;break e}he>>>=be;ue-=be;be=ne-re;if(we>be){be=we-be;if(be>ae&&Ce.sane){z.msg="invalid distance too far back";Ce.mode=Hi;break e}ye=0;_e=ce;if(0===le){ye+=oe-be;if(be<ve){ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=ne-we;_e=xe}}else if(le<be){ye+=oe+le-be;be-=le;if(be<ve){ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=0;if(le<ve){be=le;ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=ne-we;_e=xe}}}else{ye+=le-be;if(be<ve){ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=ne-we;_e=xe}}while(ve>2){xe[ne++]=_e[ye++];xe[ne++]=_e[ye++];xe[ne++]=_e[ye++];ve-=3}if(ve){xe[ne++]=_e[ye++];ve>1&&(xe[ne++]=_e[ye++])}}else{ye=ne-we;do{xe[ne++]=xe[ye++];xe[ne++]=xe[ye++];xe[ne++]=xe[ye++];ve-=3}while(ve>2);if(ve){xe[ne++]=xe[ye++];ve>1&&(xe[ne++]=xe[ye++])}}break}}break}}while(ee<te&&ne<ie);ve=ue>>3;ee-=ve;ue-=ve<<3;he&=(1<<ue)-1;z.next_in=ee;z.next_out=ne;z.avail_in=ee<te?te-ee+5:5-(ee-te);z.avail_out=ne<ie?ie-ne+257:257-(ne-ie);Ce.hold=he;Ce.bits=ue};const $i=15;const qi=852;const ji=592;const Wi=0;const Gi=1;const Zi=2;const Qi=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]);const Xi=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]);const Yi=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]);const Ki=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);const inflate_table$1=(z,K,ee,te,ne,re,ie,se)=>{const oe=se.bits;let ae=0;let le=0;let ce=0,he=0;let ue=0;let de=0;let fe=0;let pe=0;let ge=0;let me=0;let be;let ve;let we;let ye;let _e;let ke=null;let xe;const Ce=new Uint16Array($i+1);const Se=new Uint16Array($i+1);let Ae=null;let Te,Ee,Me;for(ae=0;ae<=$i;ae++)Ce[ae]=0;for(le=0;le<te;le++)Ce[K[ee+le]]++;ue=oe;for(he=$i;he>=1;he--)if(0!==Ce[he])break;ue>he&&(ue=he);if(0===he){ne[re++]=20971520;ne[re++]=20971520;se.bits=1;return 0}for(ce=1;ce<he;ce++)if(0!==Ce[ce])break;ue<ce&&(ue=ce);pe=1;for(ae=1;ae<=$i;ae++){pe<<=1;pe-=Ce[ae];if(pe<0)return-1}if(pe>0&&(z===Wi||1!==he))return-1;Se[1]=0;for(ae=1;ae<$i;ae++)Se[ae+1]=Se[ae]+Ce[ae];for(le=0;le<te;le++)0!==K[ee+le]&&(ie[Se[K[ee+le]]++]=le);if(z===Wi){ke=Ae=ie;xe=20}else if(z===Gi){ke=Qi;Ae=Xi;xe=257}else{ke=Yi;Ae=Ki;xe=0}me=0;le=0;ae=ce;_e=re;de=ue;fe=0;we=-1;ge=1<<ue;ye=ge-1;if(z===Gi&&ge>qi||z===Zi&&ge>ji)return 1;for(;;){Te=ae-fe;if(ie[le]+1<xe){Ee=0;Me=ie[le]}else if(ie[le]>=xe){Ee=Ae[ie[le]-xe];Me=ke[ie[le]-xe]}else{Ee=96;Me=0}be=1<<ae-fe;ve=1<<de;ce=ve;do{ve-=be;ne[_e+(me>>fe)+ve]=Te<<24|Ee<<16|Me|0}while(0!==ve);be=1<<ae-1;while(me&be)be>>=1;if(0!==be){me&=be-1;me+=be}else me=0;le++;if(0===--Ce[ae]){if(ae===he)break;ae=K[ee+ie[le]]}if(ae>ue&&(me&ye)!==we){0===fe&&(fe=ue);_e+=ce;de=ae-fe;pe=1<<de;while(de+fe<he){pe-=Ce[de+fe];if(pe<=0)break;de++;pe<<=1}ge+=1<<de;if(z===Gi&&ge>qi||z===Zi&&ge>ji)return 1;we=me&ye;ne[we]=ue<<24|de<<16|_e-re|0}}0!==me&&(ne[_e+me]=ae-fe<<24|64<<16|0);se.bits=ue;return 0};var Ji=inflate_table$1;const es=0;const ts=1;const ns=2;const{Z_FINISH:rs,Z_BLOCK:is,Z_TREES:ss,Z_OK:os,Z_STREAM_END:as,Z_NEED_DICT:ls,Z_STREAM_ERROR:cs,Z_DATA_ERROR:hs,Z_MEM_ERROR:us,Z_BUF_ERROR:ds,Z_DEFLATED:fs}=hr;const ps=16180;const gs=16181;const ms=16182;const bs=16183;const vs=16184;const ws=16185;const ys=16186;const _s=16187;const ks=16188;const xs=16189;const Cs=16190;const Ss=16191;const As=16192;const Ts=16193;const Es=16194;const Ms=16195;const Rs=16196;const Is=16197;const Fs=16198;const Ls=16199;const Bs=16200;const Ns=16201;const Ds=16202;const Ps=16203;const Os=16204;const zs=16205;const Hs=16206;const Us=16207;const Vs=16208;const $s=16209;const qs=16210;const js=16211;const Ws=852;const Gs=592;const Zs=15;const Qs=Zs;const zswap32$1=z=>(z>>>24&255)+(z>>>8&65280)+((65280&z)<<8)+((255&z)<<24);function InflateState$1(){this.strm=null;this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new Uint16Array(320);this.work=new Uint16Array(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}const inflateStateCheck=z=>{if(!z)return 1;const K=z.state;return!K||K.strm!==z||K.mode<ps||K.mode>js?1:0};const inflateResetKeep$1=z=>{if(inflateStateCheck(z))return cs;const K=z.state;z.total_in=z.total_out=K.total=0;z.msg="";K.wrap&&(z.adler=1&K.wrap);K.mode=ps;K.last=0;K.havedict=0;K.flags=-1;K.dmax=32768;K.head=null;K.hold=0;K.bits=0;K.lencode=K.lendyn=new Int32Array(Ws);K.distcode=K.distdyn=new Int32Array(Gs);K.sane=1;K.back=-1;return os};const inflateReset$1=z=>{if(inflateStateCheck(z))return cs;const K=z.state;K.wsize=0;K.whave=0;K.wnext=0;return inflateResetKeep$1(z)};const inflateReset2$1=(z,K)=>{let ee;if(inflateStateCheck(z))return cs;const te=z.state;if(K<0){ee=0;K=-K}else{ee=5+(K>>4);K<48&&(K&=15)}if(K&&(K<8||K>15))return cs;null!==te.window&&te.wbits!==K&&(te.window=null);te.wrap=ee;te.wbits=K;return inflateReset$1(z)};const inflateInit2$1=(z,K)=>{if(!z)return cs;const ee=new InflateState$1;z.state=ee;ee.strm=z;ee.window=null;ee.mode=ps;const te=inflateReset2$1(z,K);te!==os&&(z.state=null);return te};const inflateInit$1=z=>inflateInit2$1(z,Qs);let Xs=true;let Ys,Ks;const fixedtables$1=z=>{if(Xs){Ys=new Int32Array(512);Ks=new Int32Array(32);let K=0;while(K<144)z.lens[K++]=8;while(K<256)z.lens[K++]=9;while(K<280)z.lens[K++]=7;while(K<288)z.lens[K++]=8;Ji(ts,z.lens,0,288,Ys,0,z.work,{bits:9});K=0;while(K<32)z.lens[K++]=5;Ji(ns,z.lens,0,32,Ks,0,z.work,{bits:5});Xs=false}z.lencode=Ys;z.lenbits=9;z.distcode=Ks;z.distbits=5};const updatewindow$1=(z,K,ee,te)=>{let ne;const re=z.state;if(null===re.window){re.wsize=1<<re.wbits;re.wnext=0;re.whave=0;re.window=new Uint8Array(re.wsize)}if(te>=re.wsize){re.window.set(K.subarray(ee-re.wsize,ee),0);re.wnext=0;re.whave=re.wsize}else{ne=re.wsize-re.wnext;ne>te&&(ne=te);re.window.set(K.subarray(ee-te,ee-te+ne),re.wnext);te-=ne;if(te){re.window.set(K.subarray(ee-te,ee),0);re.wnext=te;re.whave=re.wsize}else{re.wnext+=ne;re.wnext===re.wsize&&(re.wnext=0);re.whave<re.wsize&&(re.whave+=ne)}}return 0};const inflate$2$1=(z,K)=>{let ee;let te,ne;let re;let ie;let se,oe;let ae;let le;let ce,he;let ue;let de;let fe;let pe=0;let ge,me,be;let ve,we,ye;let _e;let ke;const xe=new Uint8Array(4);let Ce;let Se;const Ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(z)||!z.output||!z.input&&0!==z.avail_in)return cs;ee=z.state;ee.mode===Ss&&(ee.mode=As);ie=z.next_out;ne=z.output;oe=z.avail_out;re=z.next_in;te=z.input;se=z.avail_in;ae=ee.hold;le=ee.bits;ce=se;he=oe;ke=os;e:for(;;)switch(ee.mode){case ps:if(0===ee.wrap){ee.mode=As;break}while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(2&ee.wrap&&35615===ae){0===ee.wbits&&(ee.wbits=15);ee.check=0;xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=lr(ee.check,xe,2,0);ae=0;le=0;ee.mode=gs;break}ee.head&&(ee.head.done=false);if(!(1&ee.wrap)||(((255&ae)<<8)+(ae>>8))%31){z.msg="incorrect header check";ee.mode=$s;break}if((15&ae)!==fs){z.msg="unknown compression method";ee.mode=$s;break}ae>>>=4;le-=4;_e=8+(15&ae);0===ee.wbits&&(ee.wbits=_e);if(_e>15||_e>ee.wbits){z.msg="invalid window size";ee.mode=$s;break}ee.dmax=1<<ee.wbits;ee.flags=0;z.adler=ee.check=1;ee.mode=512&ae?xs:Ss;ae=0;le=0;break;case gs:while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.flags=ae;if((255&ee.flags)!==fs){z.msg="unknown compression method";ee.mode=$s;break}if(57344&ee.flags){z.msg="unknown header flags set";ee.mode=$s;break}ee.head&&(ee.head.text=ae>>8&1);if(512&ee.flags&&4&ee.wrap){xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=lr(ee.check,xe,2,0)}ae=0;le=0;ee.mode=ms;case ms:while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.head&&(ee.head.time=ae);if(512&ee.flags&&4&ee.wrap){xe[0]=255&ae;xe[1]=ae>>>8&255;xe[2]=ae>>>16&255;xe[3]=ae>>>24&255;ee.check=lr(ee.check,xe,4,0)}ae=0;le=0;ee.mode=bs;case bs:while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(ee.head){ee.head.xflags=255&ae;ee.head.os=ae>>8}if(512&ee.flags&&4&ee.wrap){xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=lr(ee.check,xe,2,0)}ae=0;le=0;ee.mode=vs;case vs:if(1024&ee.flags){while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.length=ae;ee.head&&(ee.head.extra_len=ae);if(512&ee.flags&&4&ee.wrap){xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=lr(ee.check,xe,2,0)}ae=0;le=0}else ee.head&&(ee.head.extra=null);ee.mode=ws;case ws:if(1024&ee.flags){ue=ee.length;ue>se&&(ue=se);if(ue){if(ee.head){_e=ee.head.extra_len-ee.length;ee.head.extra||(ee.head.extra=new Uint8Array(ee.head.extra_len));ee.head.extra.set(te.subarray(re,re+ue),_e)}512&ee.flags&&4&ee.wrap&&(ee.check=lr(ee.check,te,ue,re));se-=ue;re+=ue;ee.length-=ue}if(ee.length)break e}ee.length=0;ee.mode=ys;case ys:if(2048&ee.flags){if(0===se)break e;ue=0;do{_e=te[re+ue++];ee.head&&_e&&ee.length<65536&&(ee.head.name+=String.fromCharCode(_e))}while(_e&&ue<se);512&ee.flags&&4&ee.wrap&&(ee.check=lr(ee.check,te,ue,re));se-=ue;re+=ue;if(_e)break e}else ee.head&&(ee.head.name=null);ee.length=0;ee.mode=_s;case _s:if(4096&ee.flags){if(0===se)break e;ue=0;do{_e=te[re+ue++];ee.head&&_e&&ee.length<65536&&(ee.head.comment+=String.fromCharCode(_e))}while(_e&&ue<se);512&ee.flags&&4&ee.wrap&&(ee.check=lr(ee.check,te,ue,re));se-=ue;re+=ue;if(_e)break e}else ee.head&&(ee.head.comment=null);ee.mode=ks;case ks:if(512&ee.flags){while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(4&ee.wrap&&ae!==(65535&ee.check)){z.msg="header crc mismatch";ee.mode=$s;break}ae=0;le=0}if(ee.head){ee.head.hcrc=ee.flags>>9&1;ee.head.done=true}z.adler=ee.check=0;ee.mode=Ss;break;case xs:while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}z.adler=ee.check=zswap32$1(ae);ae=0;le=0;ee.mode=Cs;case Cs:if(0===ee.havedict){z.next_out=ie;z.avail_out=oe;z.next_in=re;z.avail_in=se;ee.hold=ae;ee.bits=le;return ls}z.adler=ee.check=1;ee.mode=Ss;case Ss:if(K===is||K===ss)break e;case As:if(ee.last){ae>>>=7&le;le-=7&le;ee.mode=Hs;break}while(le<3){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.last=1&ae;ae>>>=1;le-=1;switch(3&ae){case 0:ee.mode=Ts;break;case 1:fixedtables$1(ee);ee.mode=Ls;if(K===ss){ae>>>=2;le-=2;break e}break;case 2:ee.mode=Rs;break;case 3:z.msg="invalid block type";ee.mode=$s}ae>>>=2;le-=2;break;case Ts:ae>>>=7&le;le-=7&le;while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if((65535&ae)!==(ae>>>16^65535)){z.msg="invalid stored block lengths";ee.mode=$s;break}ee.length=65535&ae;ae=0;le=0;ee.mode=Es;if(K===ss)break e;case Es:ee.mode=Ms;case Ms:ue=ee.length;if(ue){ue>se&&(ue=se);ue>oe&&(ue=oe);if(0===ue)break e;ne.set(te.subarray(re,re+ue),ie);se-=ue;re+=ue;oe-=ue;ie+=ue;ee.length-=ue;break}ee.mode=Ss;break;case Rs:while(le<14){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.nlen=257+(31&ae);ae>>>=5;le-=5;ee.ndist=1+(31&ae);ae>>>=5;le-=5;ee.ncode=4+(15&ae);ae>>>=4;le-=4;if(ee.nlen>286||ee.ndist>30){z.msg="too many length or distance symbols";ee.mode=$s;break}ee.have=0;ee.mode=Is;case Is:while(ee.have<ee.ncode){while(le<3){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.lens[Ae[ee.have++]]=7&ae;ae>>>=3;le-=3}while(ee.have<19)ee.lens[Ae[ee.have++]]=0;ee.lencode=ee.lendyn;ee.lenbits=7;Ce={bits:ee.lenbits};ke=Ji(es,ee.lens,0,19,ee.lencode,0,ee.work,Ce);ee.lenbits=Ce.bits;if(ke){z.msg="invalid code lengths set";ee.mode=$s;break}ee.have=0;ee.mode=Fs;case Fs:while(ee.have<ee.nlen+ee.ndist){for(;;){pe=ee.lencode[ae&(1<<ee.lenbits)-1];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(be<16){ae>>>=ge;le-=ge;ee.lens[ee.have++]=be}else{if(16===be){Se=ge+2;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ge;le-=ge;if(0===ee.have){z.msg="invalid bit length repeat";ee.mode=$s;break}_e=ee.lens[ee.have-1];ue=3+(3&ae);ae>>>=2;le-=2}else if(17===be){Se=ge+3;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ge;le-=ge;_e=0;ue=3+(7&ae);ae>>>=3;le-=3}else{Se=ge+7;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ge;le-=ge;_e=0;ue=11+(127&ae);ae>>>=7;le-=7}if(ee.have+ue>ee.nlen+ee.ndist){z.msg="invalid bit length repeat";ee.mode=$s;break}while(ue--)ee.lens[ee.have++]=_e}}if(ee.mode===$s)break;if(0===ee.lens[256]){z.msg="invalid code -- missing end-of-block";ee.mode=$s;break}ee.lenbits=9;Ce={bits:ee.lenbits};ke=Ji(ts,ee.lens,0,ee.nlen,ee.lencode,0,ee.work,Ce);ee.lenbits=Ce.bits;if(ke){z.msg="invalid literal/lengths set";ee.mode=$s;break}ee.distbits=6;ee.distcode=ee.distdyn;Ce={bits:ee.distbits};ke=Ji(ns,ee.lens,ee.nlen,ee.ndist,ee.distcode,0,ee.work,Ce);ee.distbits=Ce.bits;if(ke){z.msg="invalid distances set";ee.mode=$s;break}ee.mode=Ls;if(K===ss)break e;case Ls:ee.mode=Bs;case Bs:if(se>=6&&oe>=258){z.next_out=ie;z.avail_out=oe;z.next_in=re;z.avail_in=se;ee.hold=ae;ee.bits=le;Vi(z,he);ie=z.next_out;ne=z.output;oe=z.avail_out;re=z.next_in;te=z.input;se=z.avail_in;ae=ee.hold;le=ee.bits;ee.mode===Ss&&(ee.back=-1);break}ee.back=0;for(;;){pe=ee.lencode[ae&(1<<ee.lenbits)-1];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(me&&0===(240&me)){ve=ge;we=me;ye=be;for(;;){pe=ee.lencode[ye+((ae&(1<<ve+we)-1)>>ve)];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ve+ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ve;le-=ve;ee.back+=ve}ae>>>=ge;le-=ge;ee.back+=ge;ee.length=be;if(0===me){ee.mode=zs;break}if(32&me){ee.back=-1;ee.mode=Ss;break}if(64&me){z.msg="invalid literal/length code";ee.mode=$s;break}ee.extra=15&me;ee.mode=Ns;case Ns:if(ee.extra){Se=ee.extra;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.length+=ae&(1<<ee.extra)-1;ae>>>=ee.extra;le-=ee.extra;ee.back+=ee.extra}ee.was=ee.length;ee.mode=Ds;case Ds:for(;;){pe=ee.distcode[ae&(1<<ee.distbits)-1];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(0===(240&me)){ve=ge;we=me;ye=be;for(;;){pe=ee.distcode[ye+((ae&(1<<ve+we)-1)>>ve)];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ve+ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ve;le-=ve;ee.back+=ve}ae>>>=ge;le-=ge;ee.back+=ge;if(64&me){z.msg="invalid distance code";ee.mode=$s;break}ee.offset=be;ee.extra=15&me;ee.mode=Ps;case Ps:if(ee.extra){Se=ee.extra;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.offset+=ae&(1<<ee.extra)-1;ae>>>=ee.extra;le-=ee.extra;ee.back+=ee.extra}if(ee.offset>ee.dmax){z.msg="invalid distance too far back";ee.mode=$s;break}ee.mode=Os;case Os:if(0===oe)break e;ue=he-oe;if(ee.offset>ue){ue=ee.offset-ue;if(ue>ee.whave&&ee.sane){z.msg="invalid distance too far back";ee.mode=$s;break}if(ue>ee.wnext){ue-=ee.wnext;de=ee.wsize-ue}else de=ee.wnext-ue;ue>ee.length&&(ue=ee.length);fe=ee.window}else{fe=ne;de=ie-ee.offset;ue=ee.length}ue>oe&&(ue=oe);oe-=ue;ee.length-=ue;do{ne[ie++]=fe[de++]}while(--ue);0===ee.length&&(ee.mode=Bs);break;case zs:if(0===oe)break e;ne[ie++]=ee.length;oe--;ee.mode=Bs;break;case Hs:if(ee.wrap){while(le<32){if(0===se)break e;se--;ae|=te[re++]<<le;le+=8}he-=oe;z.total_out+=he;ee.total+=he;4&ee.wrap&&he&&(z.adler=ee.check=ee.flags?lr(ee.check,ne,he,ie-he):or(ee.check,ne,he,ie-he));he=oe;if(4&ee.wrap&&(ee.flags?ae:zswap32$1(ae))!==ee.check){z.msg="incorrect data check";ee.mode=$s;break}ae=0;le=0}ee.mode=Us;case Us:if(ee.wrap&&ee.flags){while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(4&ee.wrap&&ae!==(4294967295&ee.total)){z.msg="incorrect length check";ee.mode=$s;break}ae=0;le=0}ee.mode=Vs;case Vs:ke=as;break e;case $s:ke=hs;break e;case qs:return us;case js:default:return cs}z.next_out=ie;z.avail_out=oe;z.next_in=re;z.avail_in=se;ee.hold=ae;ee.bits=le;(ee.wsize||he!==z.avail_out&&ee.mode<$s&&(ee.mode<Hs||K!==rs))&&updatewindow$1(z,z.output,z.next_out,he-z.avail_out);ce-=z.avail_in;he-=z.avail_out;z.total_in+=ce;z.total_out+=he;ee.total+=he;4&ee.wrap&&he&&(z.adler=ee.check=ee.flags?lr(ee.check,ne,he,z.next_out-he):or(ee.check,ne,he,z.next_out-he));z.data_type=ee.bits+(ee.last?64:0)+(ee.mode===Ss?128:0)+(ee.mode===Ls||ee.mode===Es?256:0);(0===ce&&0===he||K===rs)&&ke===os&&(ke=ds);return ke};const inflateEnd$1=z=>{if(inflateStateCheck(z))return cs;let K=z.state;K.window&&(K.window=null);z.state=null;return os};const inflateGetHeader$1=(z,K)=>{if(inflateStateCheck(z))return cs;const ee=z.state;if(0===(2&ee.wrap))return cs;ee.head=K;K.done=false;return os};const inflateSetDictionary$1=(z,K)=>{const ee=K.length;let te;let ne;let re;if(inflateStateCheck(z))return cs;te=z.state;if(0!==te.wrap&&te.mode!==Cs)return cs;if(te.mode===Cs){ne=1;ne=or(ne,K,ee,0);if(ne!==te.check)return hs}re=updatewindow$1(z,K,ee,ee);if(re){te.mode=qs;return us}te.havedict=1;return os};var Js=inflateReset$1;var eo=inflateReset2$1;var to=inflateResetKeep$1;var no=inflateInit$1;var ro=inflateInit2$1;var io=inflate$2$1;var so=inflateEnd$1;var oo=inflateGetHeader$1;var ao=inflateSetDictionary$1;var lo="pako inflate (from Nodeca project)";var co={inflateReset:Js,inflateReset2:eo,inflateResetKeep:to,inflateInit:no,inflateInit2:ro,inflate:io,inflateEnd:so,inflateGetHeader:oo,inflateSetDictionary:ao,inflateInfo:lo};function GZheader$1(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}var ho=GZheader$1;const uo=Object.prototype.toString;const{Z_NO_FLUSH:fo,Z_FINISH:po,Z_OK:go,Z_STREAM_END:mo,Z_NEED_DICT:bo,Z_STREAM_ERROR:vo,Z_DATA_ERROR:wo,Z_MEM_ERROR:yo}=hr;function Inflate$1$1(z){this.options=wi.assign({chunkSize:65536,windowBits:15,to:""},z||{});const K=this.options;if(K.raw&&K.windowBits>=0&&K.windowBits<16){K.windowBits=-K.windowBits;0===K.windowBits&&(K.windowBits=-15)}K.windowBits>=0&&K.windowBits<16&&!(z&&z.windowBits)&&(K.windowBits+=32);K.windowBits>15&&K.windowBits<48&&0===(15&K.windowBits)&&(K.windowBits|=15);this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new xi;this.strm.avail_out=0;let ee=co.inflateInit2(this.strm,K.windowBits);if(ee!==go)throw new Error(cr[ee]);this.header=new ho;co.inflateGetHeader(this.strm,this.header);if(K.dictionary){"string"===typeof K.dictionary?K.dictionary=ki.string2buf(K.dictionary):"[object ArrayBuffer]"===uo.call(K.dictionary)&&(K.dictionary=new Uint8Array(K.dictionary));if(K.raw){ee=co.inflateSetDictionary(this.strm,K.dictionary);if(ee!==go)throw new Error(cr[ee])}}}Inflate$1$1.prototype.push=function(z,K){const ee=this.strm;const te=this.options.chunkSize;const ne=this.options.dictionary;let re,ie,se;if(this.ended)return false;ie=K===~~K?K:true===K?po:fo;"[object ArrayBuffer]"===uo.call(z)?ee.input=new Uint8Array(z):ee.input=z;ee.next_in=0;ee.avail_in=ee.input.length;for(;;){if(0===ee.avail_out){ee.output=new Uint8Array(te);ee.next_out=0;ee.avail_out=te}re=co.inflate(ee,ie);if(re===bo&&ne){re=co.inflateSetDictionary(ee,ne);re===go?re=co.inflate(ee,ie):re===wo&&(re=bo)}while(ee.avail_in>0&&re===mo&&ee.state.wrap>0&&0!==z[ee.next_in]){co.inflateReset(ee);re=co.inflate(ee,ie)}switch(re){case vo:case wo:case bo:case yo:this.onEnd(re);this.ended=true;return false}se=ee.avail_out;if(ee.next_out&&(0===ee.avail_out||re===mo))if("string"===this.options.to){let z=ki.utf8border(ee.output,ee.next_out);let K=ee.next_out-z;let ne=ki.buf2string(ee.output,z);ee.next_out=K;ee.avail_out=te-K;K&&ee.output.set(ee.output.subarray(z,z+K),0);this.onData(ne)}else this.onData(ee.output.length===ee.next_out?ee.output:ee.output.subarray(0,ee.next_out));if(re!==go||0!==se){if(re===mo){re=co.inflateEnd(this.strm);this.onEnd(re);this.ended=true;return true}if(0===ee.avail_in)break}}return true};Inflate$1$1.prototype.onData=function(z){this.chunks.push(z)};Inflate$1$1.prototype.onEnd=function(z){z===go&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=wi.flattenChunks(this.chunks));this.chunks=[];this.err=z;this.msg=this.strm.msg};function inflate$1$1(z,K){const ee=new Inflate$1$1(K);ee.push(z);if(ee.err)throw ee.msg||cr[ee.err];return ee.result}function inflateRaw$1$1(z,K){K=K||{};K.raw=true;return inflate$1$1(z,K)}var _o=Inflate$1$1;var ko=inflate$1$1;var xo=inflateRaw$1$1;var Co=inflate$1$1;var So=hr;var Ao={Inflate:_o,inflate:ko,inflateRaw:xo,ungzip:Co,constants:So};const{Deflate:To,deflate:Eo,deflateRaw:Mo,gzip:Ro}=zi;const{Inflate:Io,inflate:Fo,inflateRaw:Lo,ungzip:Bo}=Ao;var No=Mo;var Do=Fo;var Po=Lo;var Oo=Bo;const zo=4;function isgzipped(z){const K=ArrayBuffer.isView(z)?z:new Uint8Array(z);return 31===K[0]&&139===K[1]}function ungzip_blocks(z){const K=ArrayBuffer.isView(z)?z:new Uint8Array(z);const ee=K[3]&zo;return 0!==ee&&66===K[12]&&67===K[13]?unbgzf(K.buffer):Oo(K)}function unbgzf(z,K){const ee=[];let te=0;let ne=0;K=K||z.byteLength-18;while(te<K)try{const K=ArrayBuffer.isView(z)?z:new Uint8Array(z,te,18);const re=K[11]<<8|K[10];K[3];K[12];K[13];K[15],K[14];const ie=1+(K[17]<<8|K[16]);const se=12+re+te;const oe=z.byteLength-se;const ae=ie-re-19;if(oe<ae||ae<=0)break;const le=new Uint8Array(z,se,ae);const ce=Po(le);te+=ae-1+26;ne+=ce.byteLength;ee.push(ce)}catch(z){console.error(z);break}if(1===ee.length)return ee[0];{const z=new Uint8Array(ne);let K=0;for(let te=0;te<ee.length;++te){var re=new Uint8Array(ee[te]);arrayCopy(re,0,z,K,re.length);K+=re.length}return z}}function bgzBlockSize$1(z){const K=ArrayBuffer.isView(z)?z:new Uint8Array(z);const ee=1+(K[17]<<8|K[16]);return ee}const Ho=new Uint8Array(1);const Uo="function"===typeof Ho.subarray;function arrayCopy(z,K,ee,te,ne){if(0!==ne){if(!z)throw"Undef src";if(!ee)throw"Undef dest";0===K&&ne===z.length?arrayCopy_fast(z,ee,te):Uo?arrayCopy_fast(z.subarray(K,K+ne),ee,te):1===z.BYTES_PER_ELEMENT&&ne>100?arrayCopy_fast(new Uint8Array(z.buffer,z.byteOffset+K,ne),ee,te):arrayCopy_slow(z,K,ee,te,ne)}}function arrayCopy_slow(z,K,ee,te,ne){for(let re=0;re<ne;++re)ee[te+re]=z[K+re]}function arrayCopy_fast(z,K,ee){K.set(z,ee)}
/**
     * Compress string and encode in a url safe form
     * @param s
     */function compressString(z){const K=new Uint8Array(z.length);for(var ee=0;ee<z.length;ee++)K[ee]=z.charCodeAt(ee);const te=new No(K);const ne=String.fromCharCode.apply(null,te);let re=btoa(ne);return re.replace(/\+/g,".").replace(/\//g,"_").replace(/=/g,"-")}
/**
     * Uncompress the url-safe encoded compressed string, presumably created by compressString above
     *
     * @param enc
     * @returns {string}
     */function uncompressString(z){z=z.replace(/\./g,"+").replace(/_/g,"/").replace(/-/g,"=");const K=atob(z);const ee=[];for(let z=0;z<K.length;z++)ee.push(K.charCodeAt(z));const te=Po(ee);let ne="";for(let z of te)ne+=String.fromCharCode(z);return ne}
/**
     * @param dataURI
     * @returns {Array<number>|Uint8Array}
     */function decodeDataURI$1(z,K){const ee=z.split(",");const te=ee[0].split(":")[1];let ne=ee[1];if(te.indexOf("base64")>=0){ne=atob(ne);const z=new Uint8Array(ne.length);for(let K=0;K<ne.length;K++)z[K]=ne.charCodeAt(K);let ee;ee=K||te.indexOf("gzip")>0?Oo(z):z;return ee}return decodeURIComponent(ne)}const Vo={lerp:(z,K,ee)=>(1-ee)*z+ee*K,mean:function(z){var K,ee=0,te=0;for(K=0;K<z.length;K++)if(!isNaN(z[K])){ee+=z[K];te++}return te>0?ee/te:0},meanAndStdev:function(z){var K,ee,te=0,ne=0,re=0;for(ee=0;ee<z.length;ee++){K=z[ee];if(!isNaN(K)){te+=K;ne+=K*K;re++}}return re>0?{mean:te/re,stdev:Math.sqrt(ne-te*te/re)}:{mean:0,stdev:0}},median:function(z){var K=0,ee=z.length;z.sort();K=ee%2===0?(z[ee/2-1]+z[ee/2])/2:z[(ee-1)/2];return K},percentile:function(z,K){if(0!==z.length){var ee=Math.floor(z.length*((100-K)/100));if(0===ee){z.sort((function(z,K){return K-z}));return z[ee]}return selectElement(z,ee)}},clamp:function(z,K,ee){return Math.min(Math.max(z,K),ee)},log2:function(z){return Math.log(z)/Math.LN2}};function selectElement(z,K){var ee,te=new BinaryHeap;for(ee=0;ee<z.length;ee++){var ne=z[ee];if(te.content.length<K||ne>te.content[0]){te.content.length===K&&te.pop();te.push(ne)}}return te.content[0]}function BinaryHeap(){this.content=[]}BinaryHeap.prototype={push:function(z){this.content.push(z);this.bubbleUp(this.content.length-1)},pop:function(){var z=this.content[0];var K=this.content.pop();if(this.content.length>0){this.content[0]=K;this.sinkDown(0)}return z},remove:function(z){var K=this.content.length;for(var ee=0;ee<K;ee++)if(this.content[ee]===z){var te=this.content.pop();if(ee===K-1)break;this.content[ee]=te;this.bubbleUp(ee);this.sinkDown(ee);break}},size:function(){return this.content.length},bubbleUp:function(z){var K=this.content[z],ee=K;while(z>0){var te=Math.floor((z+1)/2)-1,ne=this.content[te];if(ee>=ne)break;this.content[te]=K;this.content[z]=ne;z=te}},sinkDown:function(z){var K=this.content.length,ee=this.content[z],te=ee;while(true){var ne=2*(z+1),re=ne-1;var ie=null;if(re<K){var se=this.content[re],oe=se;oe<te&&(ie=re)}if(ne<K){var ae=this.content[ne],le=ae;le<(null==ie?te:oe)&&(ie=ne)}if(null==ie)break;this.content[z]=this.content[ie];this.content[ie]=ee;z=ie}}};function _random(z,K){return Math.random()*(K-z)+z}const $o={rgbListFromHSV:()=>{let z=1;let K=[];for(let ee=1;ee>=.5;ee-=.1)for(let te=0;te<1;te+=1/28){const ne="rgb("+$o.hsvToRgb(te,z,ee).join(",")+")";K.push(ne)}K.pop();K.push($o.rgbColor(16,16,16));return K},rgbToHex:function(z){z=z.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return z&&4===z.length?"#"+("0"+parseInt(z[1],10).toString(16)).slice(-2)+("0"+parseInt(z[2],10).toString(16)).slice(-2)+("0"+parseInt(z[3],10).toString(16)).slice(-2):""},hexToRgb:function(z){var K=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(z);if(null!==K)return"rgb("+parseInt(K[1],16)+","+parseInt(K[2],16)+","+parseInt(K[3],16)+")"},
/**
         * Converts an HSV color value to RGB. Conversion formula
         * adapted from http://en.wikipedia.org/wiki/HSV_color_space.
         * Assumes h, s, and v are contained in the set [0, 1] and
         * returns r, g, and b in the set [0, 255].
         *
         * Credit: https://gist.githubusercontent.com/mjackson/5311256
         *
         * @param   h       The hue
         * @param   s       The saturation
         * @param   v       The value
         * @return  Array   The RGB representation
         */
hsvToRgb:function(z,K,ee){var te,ne,re;var ie=Math.floor(6*z);var se=6*z-ie;var oe=ee*(1-K);var ae=ee*(1-se*K);var le=ee*(1-(1-se)*K);switch(ie%6){case 0:te=ee,ne=le,re=oe;break;case 1:te=ae,ne=ee,re=oe;break;case 2:te=oe,ne=ee,re=le;break;case 3:te=oe,ne=ae,re=ee;break;case 4:te=le,ne=oe,re=ee;break;case 5:te=ee,ne=oe,re=ae;break}return[Math.floor(255*te),Math.floor(255*ne),Math.floor(255*re)]},
/**
         * Converts an HSL color value to RGB. Conversion formula
         * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
         * Assumes h, s, and l are contained in the set [0, 1] and
         * returns r, g, and b in the set [0, 255].
         *
         * Credit: https://gist.githubusercontent.com/mjackson/5311256
         *
         * @param   h       The hue
         * @param   s       The saturation
         * @param   l       The lightness
         * @return  Array   The RGB representation
         */
hslToRgb:function(z,K,ee){var te,ne,re;if(0===K)te=ne=re=ee;else{var ie=ee<.5?ee*(1+K):ee+K-ee*K;var se=2*ee-ie;te=$o.hue2rgb(se,ie,z+1/3);ne=$o.hue2rgb(se,ie,z);re=$o.hue2rgb(se,ie,z-1/3)}return[255*te,255*ne,255*re]},hue2rgb:(z,K,ee)=>{ee<0&&(ee+=1);ee>1&&(ee-=1);return ee<1/6?z+6*(K-z)*ee:ee<.5?K:ee<2/3?z+(K-z)*(2/3-ee)*6:z},rgbaColor:function(z,K,ee,te){z=Vo.clamp(z,0,255);K=Vo.clamp(K,0,255);ee=Vo.clamp(ee,0,255);te=Vo.clamp(te,0,1);return"rgba("+z+","+K+","+ee+","+te+")"},rgbColor:function(z,K,ee){z=Vo.clamp(z,0,255);K=Vo.clamp(K,0,255);ee=Vo.clamp(ee,0,255);return"rgb("+z+","+K+","+ee+")"},greyScale:function(z){var K=Vo.clamp(z,0,255);return"rgb("+K+","+K+","+K+")"},randomGrey:function(z,K){z=Vo.clamp(z,0,255);K=Vo.clamp(K,0,255);var ee=Math.round(_random(z,K)).toString(10);return"rgb("+ee+","+ee+","+ee+")"},randomRGB:function(z,K){z=Vo.clamp(z,0,255);K=Vo.clamp(K,0,255);var ee=Math.round(_random(z,K)).toString(10);var te=Math.round(_random(z,K)).toString(10);var ne=Math.round(_random(z,K)).toString(10);return"rgb("+ee+","+te+","+ne+")"},randomRGBConstantAlpha:function(z,K,ee){z=Vo.clamp(z,0,255);K=Vo.clamp(K,0,255);var te=Math.round(_random(z,K)).toString(10);var ne=Math.round(_random(z,K)).toString(10);var re=Math.round(_random(z,K)).toString(10);return"rgba("+te+","+ne+","+re+","+ee+")"},addAlpha:function(z,K){if("0"===z||"."===z)z="rgb(0,0,0)";else{const K=this.colorNameToHex(z);K&&(z=K)}var ee=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(z);if(z.startsWith("rgba")){const ee=z.lastIndexOf(",");return z.substring(0,ee+1)+K.toString()+")"}ee&&(z=$o.hexToRgb(z));if(z.startsWith("rgb"))return z.replace("rgb","rgba").replace(")",", "+K+")");console.log(z+" is not an rgb style string");return z},rgbComponents:function(z){if("0"===z||"."===z)return[0,0,0];const K=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(z);if(K)z=$o.hexToRgb(z);else if(!z.startsWith("rgb")){const K=this.colorNameToHex(z);z=this.hexToRgb(K)}if(z.startsWith("rgb("))return z.substring(4,z.length-1).split(",").map((z=>Number.parseInt(z.trim())));if(z.startsWith("rgba("))return z.substring(5,z.length-1).split(",").map(((z,K)=>{z=z.trim();return 3===K?Number.parseFloat(z):Number.parseInt(z)}));throw Error("Unrecognized color string: color")},
/**
         *
         * @param dest  RGB components as an array
         * @param src  RGB components as an array
         * @param alpha   alpha transparancy in the range 0-1
         * @returns {}
         */
getCompositeColor:function(z,K,ee){var te=Math.floor(ee*K[0]+(1-ee)*z[0]),ne=Math.floor(ee*K[1]+(1-ee)*z[1]),re=Math.floor(ee*K[2]+(1-ee)*z[2]);return"rgb("+te+","+ne+","+re+")"},createColorString:function(z){z=stripQuotes$1(z);return z.includes(",")?z.startsWith("rgb")?z:"rgb("+z+")":z},darkenLighten:function(z,K){let ee;let te=this.colorNameToHex(z);ee=te?$o.hexToRgb(te):z.startsWith("rgb(")?z:$o.hexToRgb(z);const ne=ee.replace(")","").substring(4).split(",");const re=Math.max(0,Math.min(255,Number.parseInt(ne[0].trim())+K));const ie=Math.max(0,Math.min(255,Number.parseInt(ne[1].trim())+K));const se=Math.max(0,Math.min(255,Number.parseInt(ne[2].trim())+K));return"rgb("+re.toString()+","+ie.toString()+","+se.toString()+")"},
/**
         * Convert html/css color name to hex value.  Adapted from https://gist.github.com/mxfh/4719348
         * @param colorName
         * @returns {*}
         */
colorNameToHex:function(z){const K={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",darkgrey:"#a9a9a9",darkslategrey:"#2f4f4f",dimgrey:"#696969",grey:"#808080",lightgray:"#d3d3d3",lightslategrey:"#778899",slategrey:"#708090"};return K[z]}};const qo="googleapis";class Oauth{constructor(){this.oauthTokens={}}setToken(z,K){K=K||qo;this.oauthTokens[K]=z}getToken(z){z=z||qo;let K;for(let ee of Object.keys(this.oauthTokens)){const te=wildcardToRegExp(ee);if(te.test(z)){K=this.oauthTokens[ee];break}}return K}removeToken(z){z=z||qo;for(let K of Object.keys(this.oauthTokens)){const ee=wildcardToRegExp(K);ee.test(z)&&(this.oauthTokens[K]=void 0)}}}function wildcardToRegExp(z){return new RegExp("^"+z.split(/\*+/).map(regExpEscape).join(".*")+"$")}function regExpEscape(z){return z.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function isGoogleURL(z){return z.includes("googleapis")&&!z.includes("urlshortener")||isGoogleStorageURL(z)||isGoogleDriveURL(z)}function isGoogleStorageURL(z){return z.startsWith("gs://")||z.startsWith("https://www.googleapis.com/storage")||z.startsWith("https://storage.cloud.google.com")||z.startsWith("https://storage.googleapis.com")}function isGoogleDriveURL(z){return z.indexOf("drive.google.com")>=0||z.indexOf("www.googleapis.com/drive")>0}
/**
     * Translate gs:// urls to https
     * See https://cloud.google.com/storage/docs/json_api/v1
     * @param gsUrl
     * @returns {string|*}
     */function translateGoogleCloudURL(z){let{bucket:K,object:ee}=parseBucketName(z);ee=encode(ee);const te=z.indexOf("?");const ne=te>0?z.substring(te)+"&alt=media":"?alt=media";return`https://storage.googleapis.com/storage/v1/b/${K}/o/${ee}${ne}`
/**
     * Parse a google bucket and object name from a google storage URL.  Known forms include
     *
     * gs://BUCKET_NAME/OBJECT_NAME
     * https://storage.googleapis.com/BUCKET_NAME/OBJECT_NAME
     * https://storage.googleapis.com/storage/v1/b/BUCKET_NAME/o/OBJECT_NAME
     * https://www.googleapis.com/storage/v1/b/BUCKET_NAME/o/OBJECT_NAME"
     * https://storage.googleapis.com/download/storage/v1/b/BUCKET_NAME/o/OBJECT_NAME
     *
     * @param url
     */}function parseBucketName(z){let K;let ee;if(z.startsWith("gs://")){const te=z.indexOf("/",5);if(te>=0){K=z.substring(5,te);const ne=z.indexOf("?");ee=ne<0?z.substring(te+1):z.substring(te+1,ne)}}else if(z.startsWith("https://storage.googleapis.com")||z.startsWith("https://storage.cloud.google.com")){const te=z.indexOf("/v1/b/",8);if(te>0){const ne=z.indexOf("/o/",te);if(ne>0){const re=z.indexOf("?",ne);K=z.substring(te+6,ne);ee=re>0?z.substring(ne+3,re):z.substring(ne+3)}}else{const te=z.indexOf("/",8);const ne=z.indexOf("/",te+1);const re=z.indexOf("?",ne);if(ne>0){K=z.substring(te+1,ne);ee=re<0?z.substring(ne+1):z.substring(ne+1,re)}}}else if(z.startsWith("https://www.googleapis.com/storage/v1/b")){const te=z.indexOf("/v1/b/",8);const ne=z.indexOf("/o/",te);if(ne>0){const re=z.indexOf("?",ne);K=z.substring(te+6,ne);ee=re>0?z.substring(ne+3,re):z.substring(ne+3)}}if(K&&ee)return{bucket:K,object:ee};throw Error(`Unrecognized Google Storage URI: ${z}`)}
/**
     * Percent a GCS object name.  See https://cloud.google.com/storage/docs/request-endpoints
     * Specific characters to encode:
     *   !, #, $, &, ', (, ), *, +, ,, /, :, ;, =, ?, @, [, ], and space characters.
     * @param obj
     */function encode(z){let K="";z.split("").forEach((function(z){jo.has(z)?K+=jo.get(z):K+=z}));return K}const jo=new Map;jo.set("!","%21");jo.set("#","%23");jo.set("$","%24");jo.set("%","%25");jo.set("&","%26");jo.set("'","%27");jo.set("(","%28");jo.set(")","%29");jo.set("*","%2A");jo.set("+","%2B");jo.set(",","%2C");jo.set("/","%2F");jo.set(":","%3A");jo.set(";","%3B");jo.set("=","%3D");jo.set("?","%3F");jo.set("@","%40");jo.set("[","%5B");jo.set("]","%5D");jo.set(" ","%20");async function init$1(z){if(!google.accounts.oauth2.initTokenClient)throw new Error("Google accounts token client not loaded (https://accounts.google.com/gsi/client)");if(isInitialized())throw new Error("Google client is already initialized");const K={client_id:z.client_id,scope:z.scope||"https://www.googleapis.com/auth/userinfo.profile",state:z.state||"igv",error:z=>{throw new Error(z.type)},hint:z.hint,hosted_domain:z.hosted_domain};const ee=google.accounts.oauth2.initTokenClient(K);google.igv={tokenClient:ee,apiKey:z.apiKey}}function isInitialized(){return window.google&&window.google.igv}
/**
     * Return the current access token if the user is signed in, or undefined otherwise.  This function does not
     * attempt a signIn or request any specfic scopes.
     *
     * @returns access_token || undefined
     */function getCurrentAccessToken(){return isInitialized()&&google.igv.tokenResponse&&Date.now()<google.igv.tokenExpiresAt?google.igv.tokenResponse.access_token:void 0}
/**
     * Return a promise for an access token for the given scope.  If the user hasn't authorized the scope request it
     *
     * @param scope
     * @returns {Promise<unknown>}
     */async function getAccessToken(z){if(!isInitialized())throw Error("Google oAuth has not been initialized");if(google.igv.tokenResponse&&Date.now()<google.igv.tokenExpiresAt&&google.accounts.oauth2.hasGrantedAllScopes(google.igv.tokenResponse,z))return google.igv.tokenResponse.access_token;{const K=google.igv.tokenClient;return new Promise(((ee,te)=>{try{K.callback=z=>{void 0!==z.error&&te(z);google.igv.tokenResponse=z;google.igv.tokenExpiresAt=Date.now()+1e3*z.expires_in;ee(z.access_token)};K.requestAccessToken({scope:z})}catch(z){console.log(z)}}))}}function getScopeForURL(z){return isGoogleDriveURL(z)?"https://www.googleapis.com/auth/drive.readonly":isGoogleStorageURL(z)?"https://www.googleapis.com/auth/devstorage.read_only":"https://www.googleapis.com/auth/userinfo.profile"}function getApiKey(){return google.igv.apiKey}
/**
     * Return information about a specific google drive URL
     *
     * @param googleDriveURL
     * @returns {Promise<any>}
     */async function getDriveFileInfo(z){const K=getGoogleDriveFileID(z);let ee="https://www.googleapis.com/drive/v3/files/"+K+"?supportsTeamDrives=true";const te=getApiKey();te&&(ee+="&key="+te);const ne=await fetch(ee);let re=await ne.json();if(re.error&&404===re.error.code){let z="https://www.googleapis.com/auth/drive.readonly";const K=await getAccessToken(z);if(!K)throw Error(re.error);{const z=await fetch(ee,{headers:{Authorization:`Bearer ${K}`}});re=await z.json();if(re.error)throw Error(re.error)}}return re}function getDriveDownloadURL(z){var K=getGoogleDriveFileID(z);return K?"https://www.googleapis.com/drive/v3/files/"+K+"?alt=media&supportsTeamDrives=true":z}function getGoogleDriveFileID(z){if(z.includes("/open?id=")){const K=z.indexOf("/open?id=")+9;const ee=z.indexOf("&");if(K>0&&ee>K)return z.substring(K,ee);if(K>0)return z.substring(K)}else{if(z.includes("/file/d/")){const K=z.indexOf("/file/d/")+8;const ee=z.lastIndexOf("/");return z.substring(K,ee)}if(z.startsWith("https://www.googleapis.com/drive")){let K=z.indexOf("/files/");const ee=z.indexOf("?");if(K>0){K+=7;return ee>0?z.substring(K,ee):z.substring(K)}}}throw Error("Unknown Google Drive url format: "+z)}
/**
     * @constructor
     * @param {Object} options A set op options to pass to the throttle function
     *        @param {number} requestsPerSecond The amount of requests per second
     *                                          the library will limit to
     */class Throttle{constructor(z){this.requestsPerSecond=z.requestsPerSecond||10;this.lastStartTime=0;this.queued=[]}
/**
         * Adds a promise
         * @param {Function} async function to be executed
         * @param {Object} options A set of options.
         * @return {Promise} A promise
         */add(z,K){var ee=this;return new Promise((function(K,te){ee.queued.push({resolve:K,reject:te,asyncFunction:z});ee.dequeue()}))}
/**
         * Adds all the promises passed as parameters
         * @param {Function} promises An array of functions that return a promise
         * @param {Object} options A set of options.
         * @param {number} options.signal An AbortSignal object that can be used to abort the returned promise
         * @param {number} options.weight A "weight" of each operation resolving by array of promises
         * @return {Promise} A promise that succeeds when all the promises passed as options do
         */addAll(z,K){var ee=z.map(function(z){return this.add(z,K)}.bind(this));return Promise.all(ee)}dequeue(){if(this.queued.length>0){var z=new Date,K=1e3/this.requestsPerSecond+1,ee=z-this.lastStartTime;ee>=K?this._execute():setTimeout(function(){this.dequeue()}.bind(this),K-ee)}}async _execute(){this.lastStartTime=new Date;var z=this.queued.shift();const K=z.asyncFunction;try{const ee=await K();z.resolve(ee)}catch(K){z.reject(K)}}}class IGVXhr{constructor(){this.apiKey=void 0;this.googleThrottle=new Throttle({requestsPerSecond:8});this.RANGE_WARNING_GIVEN=false;this.oauth=new Oauth}setApiKey(z){this.apiKey=z}async loadArrayBuffer(z,K){K=K||{};K.responseType||(K.responseType="arraybuffer");return isFile(z)?this._loadFileSlice(z,K):this.load(z,K)}async loadJson(z,K){K=K||{};const ee=K.method||(K.sendData?"POST":"GET");"POST"===ee&&(K.contentType="application/json");const te=await this.loadString(z,K);return te?JSON.parse(te):te}async loadString(z,K){K=K||{};return z instanceof File?this._loadStringFromFile(z,K):this._loadStringFromUrl(z,K)}async load(z,K){K=K||{};const ee=typeof z;z=await("function"===typeof z?z():z);if(isFile(z))return this._loadFileSlice(z,K);if("function"===typeof z.startsWith){if(z.startsWith("data:")){const ee=decodeDataURI$1(z).buffer;if(K.range){const z=K.range.size?K.range.start+K.range.size:ee.byteLength;return ee.slice(K.range.start,z)}return ee}z.startsWith("https://drive.google.com")&&(z=getDriveDownloadURL(z));return isGoogleDriveURL(z)||z.startsWith("https://www.dropbox.com")?this.googleThrottle.add((async()=>this._loadURL(z,K))):this._loadURL(z,K)}throw Error(`url must be either a 'File', 'string', 'function', or 'Promise'.  Actual type: ${ee}`)}async _loadURL(z,K){const ee=this;const te=z;z=mapUrl$1(z);K=K||{};let ne=K.oauthToken||this.getOauthToken(z);ne&&(ne=await("function"===typeof ne?ne():ne));return new Promise((function(re,ie){if(isGoogleURL(z)&&!isGoogleStorageSigned(z)){isGoogleStorageURL(z)&&(z=translateGoogleCloudURL(z));z=addApiKey(z);isGoogleDriveURL(z)&&addTeamDrive(z);ne||(ne=getCurrentGoogleAccessToken())}const se=K.headers||{};ne&&addOauthHeaders(se,ne);const oe=K.range;const ae=new XMLHttpRequest;const le=K.sendData||K.body;const ce=K.method||(le?"POST":"GET");const he=K.responseType;const ue=K.contentType;const de=K.mimeType;ae.open(ce,z);K.timeout&&(ae.timeout=K.timeout);if(oe){let z="";oe.size&&(z=oe.start+oe.size-1);ae.setRequestHeader("Range","bytes="+oe.start+"-"+z)}ue&&ae.setRequestHeader("Content-Type",ue);de&&ae.overrideMimeType(de);he&&(ae.responseType=he);if(se)for(let z of Object.keys(se)){const K=se[z];ae.setRequestHeader(z,K)}true===K.withCredentials&&(ae.withCredentials=true);ae.onload=async function(te){if(0===ae.status||ae.status>=200&&ae.status<=300)if("HEAD"===K.method){const z=K.requestedHeaders||["content-length"];const ee={};for(let K of z)ee[K]=ae.getResponseHeader(K);re(ee)}else if(oe&&206!==ae.status&&0!==oe.start){ae.response.length>1e5&&!ee.RANGE_WARNING_GIVEN&&alert(`Warning: Range header ignored for URL: ${z}.  This can have severe performance impacts.`);re(ae.response.slice(oe.start,oe.start+oe.size))}else re(ae.response);else 416===ae.status?handleError(Error("416 Unsatisfiable Range")):"undefined"===typeof gapi||404!==ae.status&&401!==ae.status&&403!==ae.status||!isGoogleURL(z)||K.retries?403===ae.status?handleError("Access forbidden: "+z):handleError(ae.status):tryGoogleAuth()};ae.onerror=function(ee){isGoogleURL(z)&&!K.retries?tryGoogleAuth():handleError("Error accessing resource: "+z+" Status: "+ae.status)};ae.ontimeout=function(z){handleError("Timed out")};ae.onabort=function(z){console.log("Aborted");ie(z)};try{ae.send(le)}catch(ee){isGoogleURL(z)&&!K.retries?tryGoogleAuth():handleError(ee)}function handleError(z){if(!ie)throw z;ie(z)}async function tryGoogleAuth(){try{const z=await fetchGoogleAccessToken(te);K.retries=1;K.oauthToken=z;const ne=await ee.load(te,K);re(ne)}catch(z){if(z.error){const K=z.error.startsWith("popup_blocked")?"Google login popup blocked by browser.":z.error;alert(K)}else handleError(z)}}}))}async _loadFileSlice(z,K){let ee=K&&K.range?z.slice(K.range.start,K.range.start+K.range.size):z;const te=await ee.arrayBuffer();return"arraybuffer"===K.responseType?te:arrayBufferToString(te)}async _loadStringFromFile(z,K){const ee=K.range?z.slice(K.range.start,K.range.start+K.range.size):z;const te=await ee.arrayBuffer();return arrayBufferToString(te)}async _loadStringFromUrl(z,K){K=K||{};K.responseType="arraybuffer";const ee=await this.load(z,K);return arrayBufferToString(ee)}
/**
         * Explicity set an oAuth token for use with given host.  If host is undefined token is used for google api access*
         * @param token
         * @param host
         */setOauthToken(z,K){this.oauth.setToken(z,K)}
/**
         * Return an oauth token for the URL if we have one.  This method does not force sign-in, and the token may
         * or may not be valid.  Sign-in is triggered on request failure.
         * *
         * @param url
         * @returns {*}
         */getOauthToken(z){const K=isGoogleURL(z)?void 0:parseUri(z).host;let ee=this.oauth.getToken(K);if(ee)return ee;if(void 0===K){const z=getCurrentGoogleAccessToken();if(z&&z.expires_at>Date.now())return z.access_token}}
/**
         * This method should only be called when it is known the server supports HEAD requests.  It is used to recover
         * from 416 errors from out-of-spec WRT range request servers.  Notably Globus.
         * * *
         * @param url
         * @param options
         * @returns {Promise<unknown>}
         */async getContentLength(z,K){K=K||{};K.method="HEAD";K.requestedHeaders=["content-length"];const ee=await this._loadURL(z,K);const te=ee["content-length"];return te?Number.parseInt(te):0}}function isGoogleStorageSigned(z){return z.indexOf("X-Goog-Signature")>-1}
/**
     * Return a Google oAuth token, triggering a sign in if required.   This method should not be called until we know
     * a token is required, that is until we've tried the url and received a 401, 403, or 404.
     *
     * @param url
     * @returns the oauth token
     */async function fetchGoogleAccessToken(z){if(isInitialized()){const K=getScopeForURL(z);const ee=await getAccessToken(K);return ee}throw Error("Authorization is required, but Google oAuth has not been initalized. Contact your site administrator for assistance.")}
/**
     * Return the current google access token, if one exists.  Do not triger signOn or request additional scopes.
     * @returns {undefined|access_token}
     */function getCurrentGoogleAccessToken(){if(isInitialized()){const z=getCurrentAccessToken();return z}}function addOauthHeaders(z,K){if(K){z["Cache-Control"]="no-cache";z.Authorization="Bearer "+K}return z}function addApiKey(z){let K=Wo.apiKey;K||"undefined"===typeof gapi||(K=gapi.apiKey);if(void 0!==K&&!z.includes("key=")){const ee=z.includes("?")?"&":"?";z=z+ee+"key="+K}return z}function addTeamDrive(z){if(z.includes("supportsTeamDrive"))return z;{const K=z.includes("?")?"&":"?";z=z+K+"supportsTeamDrive=true"}}
/**
     * Perform some well-known url mappings.
     * @param url
     */function mapUrl$1(z){return z.startsWith("https://www.dropbox.com")?z.replace("//www.dropbox.com","//dl.dropboxusercontent.com"):z.startsWith("https://drive.google.com")?getDriveDownloadURL(z):z.includes("//www.broadinstitute.org/igvdata")?z.replace("//www.broadinstitute.org/igvdata","//data.broadinstitute.org/igvdata"):z.includes("//igvdata.broadinstitute.org")?z.replace("//igvdata.broadinstitute.org","//s3.amazonaws.com/igv.broadinstitute.org"):z.includes("//igv.genepattern.org")?z.replace("//igv.genepattern.org","//igv-genepattern-org.s3.amazonaws.com"):z.startsWith("ftp://ftp.ncbi.nlm.nih.gov/geo")?z.replace("ftp://","https://"):z}function arrayBufferToString(z){let K;K=isgzipped(z)?ungzip_blocks(z):new Uint8Array(z);return"TextDecoder"in getGlobalObject()?(new TextDecoder).decode(K):decodeUTF8(K)}
/**
     * Use when TextDecoder is not available (primarily IE).
     *
     * From: https://gist.github.com/Yaffle/5458286
     *
     * @param octets
     * @returns {string}
     */function decodeUTF8(z){var K="";var ee=0;while(ee<z.length){var te=z[ee];var ne=0;var re=0;if(te<=127){ne=0;re=255&te}else if(te<=223){ne=1;re=31&te}else if(te<=239){ne=2;re=15&te}else if(te<=244){ne=3;re=7&te}if(z.length-ee-ne>0){var ie=0;while(ie<ne){te=z[ee+ie+1];re=re<<6|63&te;ie+=1}}else{re=65533;ne=z.length-ee}K+=String.fromCodePoint(re);ee+=ne+1}return K}function getGlobalObject(){return"undefined"!==typeof self?self:"undefined"!==typeof global?global:window}const Wo=new IGVXhr;var Go=1;var Zo=2;var Qo={};Qo.color=Go;Qo.parent=Qo;Qo.left=Qo;Qo.right=Qo;class IntervalTree{constructor(){this.root=Qo}insert(z,K,ee){var te=new Interval(z,K,ee);var ne=new Node(te);this.treeInsert(ne);ne.color=Zo;while(ne!==this.root&&ne.parent.color===Zo)if(ne.parent===ne.parent.parent.left){let z=ne.parent.parent.right;if(z.color===Zo){ne.parent.color=Go;z.color=Go;ne.parent.parent.color=Zo;ne=ne.parent.parent}else{if(ne===ne.parent.right){ne=ne.parent;leftRotate.call(this,ne)}ne.parent.color=Go;ne.parent.parent.color=Zo;rightRotate.call(this,ne.parent.parent)}}else{let z=ne.parent.parent.left;if(z.color===Zo){ne.parent.color=Go;z.color=Go;ne.parent.parent.color=Zo;ne=ne.parent.parent}else{if(ne===ne.parent.left){ne=ne.parent;rightRotate.call(this,ne)}ne.parent.color=Go;ne.parent.parent.color=Zo;leftRotate.call(this,ne.parent.parent)}}this.root.color=Go}
/**
         *
         * @param start - query interval
         * @param end - query interval
         * @returns Array of all intervals overlapping the query region
         */findOverlapping(z,K){var ee=new Interval(z,K,0);if(this.root===Qo)return[];var te=searchAll.call(this,ee,this.root,[]);te.length>1&&te.sort((function(z,K){return z.low-K.low}));return te}logIntervals(){logNode(this.root,0);function logNode(z,K){var ee="";for(var te=0;te<K;te++)ee+=" ";console.log(ee+z.interval.low+" "+z.interval.high);K+=5;z.left!==Qo&&logNode(z.left,K);z.right!==Qo&&logNode(z.right,K)}}mapIntervals(z){applyInterval(this.root);function applyInterval(K){z(K.interval);K.left!==Qo&&applyInterval(K.left);K.right!==Qo&&applyInterval(K.right)}}
/**
         * Note:  Does not maintain RB constraints,  this is done post insert
         *
         * @param x  a Node
         */treeInsert(z){var K=this.root;var ee=Qo;while(K!==Qo){ee=K;K=z.interval.low<=K.interval.low?K.left:K.right}z.parent=ee;if(ee===Qo){this.root=z;z.left=z.right=Qo}else z.interval.low<=ee.interval.low?ee.left=z:ee.right=z;applyUpdate.call(this,z)}}function searchAll(z,K,ee){K.interval.overlaps(z)&&ee.push(K.interval);K.left!==Qo&&K.left.max>=z.low&&searchAll.call(this,z,K.left,ee);K.right!==Qo&&K.right.min<=z.high&&searchAll.call(this,z,K.right,ee);return ee}function leftRotate(z){var K=z.right;z.right=K.left;K.left!==Qo&&(K.left.parent=z);K.parent=z.parent;z.parent===Qo?this.root=K:z.parent.left===z?z.parent.left=K:z.parent.right=K;K.left=z;z.parent=K;applyUpdate.call(this,z)}function rightRotate(z){var K=z.left;z.left=K.right;K.right!==Qo&&(K.right.parent=z);K.parent=z.parent;z.parent===Qo?this.root=K:z.parent.right===z?z.parent.right=K:z.parent.left=K;K.right=z;z.parent=K;applyUpdate.call(this,z)}function applyUpdate(z){while(z!==Qo){var K=z.left.max>z.right.max?z.left.max:z.right.max;var ee=z.interval.high;z.max=K>ee?K:ee;var te=z.left.min<z.right.min?z.left.min:z.right.min;var ne=z.interval.low;z.min=te<ne?te:ne;z=z.parent}}class Interval{constructor(z,K,ee){this.low=z;this.high=K;this.value=ee}equals(z){return!!z&&(this===z||this.low===z.low&&this.high===z.high)}compareTo(z){return this.low<z.low?-1:this.low>z.low?1:this.high<z.high?-1:this.high>z.high?1:0}overlaps(z){return this.low<=z.high&&z.low<=this.high}}function Node(z){this.parent=Qo;this.left=Qo;this.right=Qo;this.interval=z;this.color=Zo}
/**
     * Object for caching lists of features.  Supports effecient queries for sub-range  (chr, start, end)
     *
     * @param featureList
     * @param The genomic range spanned by featureList (optional)
     * @constructor
     */class FeatureCache$1{constructor(z,K,ee){z=z||[];this.treeMap=this.buildTreeMap(z,K);this.range=ee;this.count=z.length}containsRange(z){return void 0===this.range||this.range.contains(z.chr,z.start,z.end)}queryFeatures(z,K,ee){const te=this.treeMap[z];if(!te)return[];const ne=te.findOverlapping(K,ee);if(0===ne.length)return[];{const te=[];const re=this.allFeatures[z];if(re){for(let z of ne){const ne=z.value;for(let z=ne.start;z<ne.end;z++){let ne=re[z];if(ne.start>ee)break;ne.end>=K&&te.push(ne)}}te.sort((function(z,K){return z.start-K.start}))}return te}}
/**
         * Returns all features, unsorted.
         *
         * @returns {Array}
         */
getAllFeatures(){return this.allFeatures}buildTreeMap(z,K){const ee={};const te=[];this.allFeatures={};if(z){for(let ee of z){let z=ee.chr;K&&(z=K.getChromosomeName(z));let ne=this.allFeatures[z];if(!ne){te.push(z);ne=[];this.allFeatures[z]=ne}ne.push(ee)}for(let z of te){const K=this.allFeatures[z];K.sort((function(z,K){return z.start===K.start?0:z.start>K.start?1:-1}));ee[z]=buildIntervalTree$1(K)}}return ee}}
/**
     * Build an interval tree from the feature list for fast interval based queries.   We lump features in groups
     * of 10, or total size / 100,   to reduce size of the tree.
     *
     * @param featureList
     */function buildIntervalTree$1(z){const K=new IntervalTree;const ee=z.length;const te=Math.max(10,Math.round(ee/10));for(let ne=0;ne<ee;ne+=te){const re=Math.min(ee,ne+te);const ie=new IndexRange(ne,re);const se=z[ne].start;let oe=se;for(let K=ne;K<re;K++)oe=Math.max(oe,z[K].end);K.insert(se,oe,ie)}return K}class IndexRange{constructor(z,K){this.start=z;this.end=K}}const Xo={packFeatures:function(z,K,ee){var te;var ne;if(z){K=K||1e4;ee||z.sort((function(z,K){return z.start-K.start}));if(0===z.length)return[];var re,ie,se,oe,ae,le,ce=[],he=0,ue=0,de=2;te=z[0].start;ne=z[z.length-1].start;le=Math.max(te,z[0].start);re=le;z.forEach((function(z){var K=Math.max(0,z.start-le);void 0===ce[K]&&(ce[K]=[]);ce[K].push(z)}));ie=0;while(he<z.length&&ie<=K){while(re<=ne){oe=void 0;while(!oe&&re<=ne){se=re-le;void 0===ce[se]?++re:oe=ce[se]}if(!oe)break;ae=oe.pop();0===oe.length&&(ce[se]=void 0);ae.row=ie;re=ae.end+de;++he}ie++;re=le;if(he===ue)break;ue=he}}},
/**
         * Find features overlapping the given interval.  It is assumed that all features share the same chromosome.
         *
         * TODO -- significant overlap with FeatureCache, refactor to combine
         *
         * @param featureList
         * @param start
         * @param end
         */
findOverlapping:function(z,K,ee){if(z&&0!==z.length){const te=buildIntervalTree(z);const ne=te.findOverlapping(K,ee);if(0===ne.length)return[];z=[];ne.forEach((function(te){const ne=te.value;const re=ne.length;for(let te=0;te<re;te++){const re=ne[te];if(re.start>ee)break;re.end>K&&z.push(re)}}));z.sort((function(z,K){return z.start-K.start}));return z}return[]}};
/**
     * Build an interval tree from the feature list for fast interval based queries.   We lump features in groups
     * of 10, or total size / 100,   to reduce size of the tree.
     *
     * @param featureList
     */function buildIntervalTree(z){const K=new IntervalTree;const ee=z.length;const te=Math.max(10,Math.round(ee/100));z.sort((function(z,K){return z.start===K.start?0:z.start>K.start?1:-1}));for(let ne=0;ne<ee;ne+=te){const re=Math.min(ee,ne+te);const ie=z.slice(ne,re);const se=ie[0].start;let oe=se;ie.forEach((function(z){oe=Math.max(oe,z.end)}));K.insert(se,oe,ie)}return K}const Yo={cantaloupe:{r:255,g:206,b:110},honeydew:{r:206,g:250,b:110},spindrift:{r:104,g:251,b:208},sky:{r:106,g:207,b:255},lavender:{r:210,g:120,b:255},carnation:{r:255,g:127,b:211},licorice:{r:0,g:0,b:0},snow:{r:255,g:255,b:255},salmon:{r:255,g:114,b:110},banana:{r:255,g:251,b:109},flora:{r:104,g:249,b:110},ice:{r:104,g:253,b:255},orchid:{r:110,g:118,b:255},bubblegum:{r:255,g:122,b:255},lead:{r:30,g:30,b:30},mercury:{r:232,g:232,b:232},tangerine:{r:255,g:136,b:2},lime:{r:131,g:249,b:2},sea_foam:{r:3,g:249,b:135},aqua:{r:0,g:140,b:255},grape:{r:137,g:49,b:255},strawberry:{r:255,g:41,b:135},tungsten:{r:58,g:58,b:58},silver:{r:208,g:208,b:208},maraschino:{r:255,g:33,b:1},lemon:{r:255,g:250,b:3},spring:{r:5,g:248,b:2},turquoise:{r:0,g:253,b:255},blueberry:{r:0,g:46,b:255},magenta:{r:255,g:57,b:255},iron:{r:84,g:84,b:83},magnesium:{r:184,g:184,b:184},mocha:{r:137,g:72,b:0},fern:{r:69,g:132,b:1},moss:{r:1,g:132,b:72},ocean:{r:0,g:74,b:136},eggplant:{r:73,g:26,b:136},maroon:{r:137,g:22,b:72},steel:{r:110,g:110,b:110},aluminum:{r:160,g:159,b:160},cayenne:{r:137,g:17,b:0},aspargus:{r:136,g:133,b:1},clover:{r:2,g:132,b:1},teal:{r:0,g:134,b:136},midnight:{r:0,g:24,b:136},plum:{r:137,g:30,b:136},tin:{r:135,g:134,b:135},nickel:{r:136,g:135,b:135}};function appleCrayonRGB(z){const{r:K,g:ee,b:te}=Yo[z];return`rgb(${K},${ee},${te})`}function appleCrayonRGBA(z,K){const{r:ee,g:te,b:ne}=Yo[z];return`rgba(${ee},${te},${ne},${K})`}const Ko={Set1:["rgb(228,26,28)","rgb(55,126,184)","rgb(77,175,74)","rgb(166,86,40)","rgb(152,78,163)","rgb(255,127,0)","rgb(247,129,191)","rgb(153,153,153)","rgb(255,255,51)"],Dark2:["rgb(27,158,119)","rgb(217,95,2)","rgb(117,112,179)","rgb(231,41,138)","rgb(102,166,30)","rgb(230,171,2)","rgb(166,118,29)","rgb(102,102,102)"],Set2:["rgb(102, 194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],Set3:["rgb(141,211,199)","rgb(255,255,179)","rgb(190,186,218)","rgb(251,128,114)","rgb(128,177,211)","rgb(253,180,98)","rgb(179,222,105)","rgb(252,205,229)","rgb(217,217,217)","rgb(188,128,189)","rgb(204,235,197)","rgb(255,237,111)"],Pastel1:["rgb(251,180,174)","rgb(179,205,227)","rgb(204,235,197)","rgb(222,203,228)","rgb(254,217,166)","rgb(255,255,204)","rgb(229,216,189)","rgb(253,218,236)"],Pastel2:["rgb(173,226,207)","rgb(253,205,172)","rgb(203,213,232)","rgb(244,202,228)","rgb(230,245,201)","rgb(255,242,174)","rgb(243,225,206)"],Accent:["rgb(127,201,127)","rgb(190,174,212)","rgb(253,192,134)","rgb(255,255,153)","rgb(56,108,176)","rgb(240,2,127)","rgb(191,91,23)"]};class PaletteColorTable{constructor(z){this.colors=Ko[z];Array.isArray(this.colors)||(this.colors=[]);this.colorTable={};this.nextIdx=0;this.colorGenerator=new RandomColorGenerator}getColor(z){if(!this.colorTable.hasOwnProperty(z)){this.nextIdx<this.colors.length?this.colorTable[z]=this.colors[this.nextIdx]:this.colorTable[z]=this.colorGenerator.get();this.nextIdx++}return this.colorTable[z]}}class ColorTable{constructor(z){this.colorTable=z||{};this.nextIdx=0;this.colorGenerator=new RandomColorGenerator}getColor(z){if(!this.colorTable.hasOwnProperty(z)){if(this.colorTable.hasOwnProperty("*"))return this.colorTable["*"];this.colorTable[z]=this.colorGenerator.get()}return this.colorTable[z]}}function RandomColorGenerator(){this.hue=Math.random();this.goldenRatio=.618033988749895;this.hexwidth=2}RandomColorGenerator.prototype.hsvToRgb=function(z,K,ee){var te=Math.floor(6*z),ne=6*z-te,re=ee*(1-K),ie=ee*(1-ne*K),se=ee*(1-(1-ne)*K),oe=255,ae=255,le=255;switch(te){case 0:oe=ee,ae=se,le=re;break;case 1:oe=ie,ae=ee,le=re;break;case 2:oe=re,ae=ee,le=se;break;case 3:oe=re,ae=ie,le=ee;break;case 4:oe=se,ae=re,le=ee;break;case 5:oe=ee,ae=re,le=ie;break}return[Math.floor(256*oe),Math.floor(256*ae),Math.floor(256*le)]};RandomColorGenerator.prototype.padHex=function(z){return z.length>this.hexwidth?z:new Array(this.hexwidth-z.length+1).join("0")+z};RandomColorGenerator.prototype.get=function(z,K){this.hue+=this.goldenRatio;this.hue%=1;"number"!==typeof z&&(z=.5);"number"!==typeof K&&(K=.95);var ee=this.hsvToRgb(this.hue,z,K);return"#"+this.padHex(ee[0].toString(16))+this.padHex(ee[1].toString(16))+this.padHex(ee[2].toString(16))};new RandomColorGenerator;function randomRGB$1(z,K){z=Vo.clamp(z,0,255);K=Vo.clamp(K,0,255);const ee=Math.round(Math.random()*(K-z)+z).toString(10);const te=Math.round(Math.random()*(K-z)+z).toString(10);const ne=Math.round(Math.random()*(K-z)+z).toString(10);return`rgb(${ee},${te},${ne})`}const Jo={configureHighDPICanvas:function(z,K,ee){const te=window.devicePixelRatio;z.canvas.style.width=`${K}px`;z.canvas.width=Math.floor(te*K);z.canvas.style.height=`${ee}px`;z.canvas.height=Math.floor(te*ee);z.scale(te,te)},setProperties:function(z,K){for(var ee in K)if(K.hasOwnProperty(ee)){var te=K[ee];z[ee]=te}},strokeLine:function(z,K,ee,te,ne,re){K=Math.floor(K)+.5;ee=Math.floor(ee)+.5;te=Math.floor(te)+.5;ne=Math.floor(ne)+.5;if(re){z.save();Jo.setProperties(z,re)}z.beginPath();z.moveTo(K,ee);z.lineTo(te,ne);z.stroke();re&&z.restore()},fillRect:function(z,K,ee,te,ne,re){K=Math.round(K);ee=Math.round(ee);if(re){z.save();Jo.setProperties(z,re)}z.fillRect(K,ee,te,ne);re&&z.restore()},fillPolygon:function(z,K,ee,te){if(te){z.save();Jo.setProperties(z,te)}doPath(z,K,ee);z.fill();te&&z.restore()},strokePolygon:function(z,K,ee,te){if(te){z.save();Jo.setProperties(z,te)}doPath(z,K,ee);z.stroke();te&&z.restore()},fillText:function(z,K,ee,te,ne,re){(ne||re)&&z.save();ne&&Jo.setProperties(z,ne);if(re){z.translate(ee,te);for(var ie in re){var se=re[ie];"translate"===ie&&z.translate(se.x,se.y);"rotate"===ie&&z.rotate(se.angle*Math.PI/180)}z.fillText(K,0,0)}else z.fillText(K,ee,te);(ne||re)&&z.restore()},strokeText:function(z,K,ee,te,ne,re){(ne||re)&&z.save();ne&&Jo.setProperties(z,ne);if(re){z.translate(ee,te);for(var ie in re){var se=re[ie];"translate"===ie&&z.translate(se.x,se.y);"rotate"===ie&&z.rotate(se.angle*Math.PI/180)}z.strokeText(K,0,0)}else z.strokeText(K,ee,te);(ne||re)&&z.restore()},strokeCircle:function(z,K,ee,te,ne){if(ne){z.save();Jo.setProperties(z,ne)}z.beginPath();z.arc(K,ee,te,0,2*Math.PI);z.stroke();ne&&z.restore()},fillCircle:function(z,K,ee,te,ne){if(ne){z.save();Jo.setProperties(z,ne)}z.beginPath();z.arc(K,ee,te,0,2*Math.PI);z.fill();ne&&z.restore()},drawArrowhead:function(z,K,ee,te,ne){z.save();te||(te=5);ne&&(z.lineWidth=ne);z.beginPath();z.moveTo(K,ee-te/2);z.lineTo(K,ee+te/2);z.lineTo(K+te,ee);z.lineTo(K,ee-te/2);z.closePath();z.fill();z.restore()},dashedLine:function(z,K,ee,te,ne,re,ie={}){void 0===re&&(re=2);z.setLineDash([re,re]);Jo.strokeLine(z,K,ee,te,ne,ie);z.setLineDash([])},roundRect:function(z,K,ee,te,ne,re,ie,se){"undefined"==typeof se&&(se=true);"undefined"===typeof re&&(re=5);z.beginPath();z.moveTo(K+re,ee);z.lineTo(K+te-re,ee);z.quadraticCurveTo(K+te,ee,K+te,ee+re);z.lineTo(K+te,ee+ne-re);z.quadraticCurveTo(K+te,ee+ne,K+te-re,ee+ne);z.lineTo(K+re,ee+ne);z.quadraticCurveTo(K,ee+ne,K,ee+ne-re);z.lineTo(K,ee+re);z.quadraticCurveTo(K,ee,K+re,ee);z.closePath();se&&z.stroke();ie&&z.fill()},polygon:function(z,K,ee,te,ne){"undefined"==typeof ne&&(ne=true);z.beginPath();var re=K.length;z.moveTo(K[0],ee[0]);for(var ie=1;ie<re;ie++)z.lineTo(K[ie],ee[ie]);z.closePath();ne&&z.stroke();te&&z.fill()},drawRandomColorVerticalLines:z=>{for(let K=0;K<z.canvas.width;K++)Jo.fillRect(z,K,0,1,z.canvas.height,{fillStyle:randomRGB$1(100,250)})},labelTransformWithContext:(z,K)=>{z.translate(K,0);z.scale(-1,1);z.translate(-K,0)}};function doPath(z,K,ee){var te,ne=K.length;for(te=0;te<ne;te++){K[te]=Math.round(K[te]);ee[te]=Math.round(ee[te])}z.beginPath();z.moveTo(K[0],ee[0]);for(te=1;te<ne;te++)z.lineTo(K[te],ee[te]);z.closePath()}class Alert{constructor(z){this.dialog=new AlertDialog(z)}present(z,K){this.dialog.present(z,K)}}const ea={gwascatalog:{fields:["bin","chr","start","end","name","pubMedID","author","pubDate","journal","title","trait","initSample","replSample","region","genes","riskAllele","riskAlFreq","pValue","pValueDesc","orOrBeta","ci95","platform","cnv"]},wgrna:{fields:["bin","chr","start","end","name","score","strand","thickStart","thickEnd","type"]},cpgislandext:{fields:["bin","chr","start","end","name","length","cpgNum","gcNum","perCpg","perGc","obsExp"]},clinVarMain:{fields:["chr1","start","end","name","score","strand","thickStart","thickEnd","reserved","blockCount","blockSizes","chromStarts","origName","clinSign","reviewStatus","type","geneId","snpId","nsvId","rcvAcc","testedInGtr","phenotypeList","phenotype","origin","assembly","cytogenetic","hgvsCod","hgvsProt","numSubmit","lastEval","guidelines","otherIds"]}};
/**
     * Test if the given value is a string or number.  Not using typeof as it fails on boxed primitives.
     *
     * @param value
     * @returns boolean
     */function isSimpleType(z){const K=new Set(["boolean","number","string","symbol"]);const ee=typeof z;return void 0!==z&&(K.has(ee)||z.substring||z.toFixed)}function buildOptions(z,K){var ee={oauthToken:z.oauthToken,headers:z.headers,withCredentials:z.withCredentials,filename:z.filename};return Object.assign(ee,K)}
/**
     * isMobile test from http://detectmobilebrowsers.com
     * TODO -- improve UI design so this isn't neccessary
     * @returns {boolean}
     */const doAutoscale=function(z){var K,ee;if(z&&z.length>0){K=Number.MAX_VALUE;ee=-Number.MAX_VALUE;for(let te of z)if(!Number.isNaN(te.value)){K=Math.min(K,te.value);ee=Math.max(ee,te.value)}ee>0&&(K=Math.min(0,K));ee<0&&(ee=0)}else{K=0;ee=100}return{min:K,max:ee}};const validateGenomicExtent=function(z,K,ee){let te=K.start;let ne=K.end;if(void 0===ne){te-=ee/2;ne=te+ee;if(ne>z){ne=z;te=ne-ee}else if(te<0){te=0;ne=ee}}else if(ne-te<ee){const K=(ne+te)/2;if(K-ee/2<0){te=0;ne=te+ee}else if(K+ee/2>z){ne=z;te=ne-ee}else{te=K-ee/2;ne=te+ee}}K.start=Math.ceil(te);K.end=Math.floor(ne)};const isNumber=function(z){return"number"===typeof z?z-z===0:"string"===typeof z&&""!==z.trim()&&(Number.isFinite?Number.isFinite(+z):isFinite(+z))};async function getFilename$1(z){if(isString$2(z)&&z.startsWith("https://drive.google.com")){if(void 0===getApiKey())throw Error("Google drive is referenced, but API key is not defined.  An API key is required for Google Drive access");const K=await getDriveFileInfo(z);return K.originalFileName||K.name}return getFilename$2(z)}function prettyBasePairNumber(z){var K,ee,te,ne;if(!(z>1e7)){if(z>1e4){K=1e3;ee=" kb";te=z/K;ne=Math.floor(te);return numberFormatter$1(ne)+ee}return numberFormatter$1(z)+" bp"}K=1e6;ee=" mb";te=z/K;ne=Math.floor(te);return ne.toString()+ee}function isDataURL(z){return isString$2(z)&&z.startsWith("data:")}function createColumn(z,K){const ee=gt.div({class:K});z.appendChild(ee)}function insertElementBefore(z,K){K.parentNode.insertBefore(z,K)}function insertElementAfter(z,K){K.parentNode.insertBefore(z,K.nextSibling)}function isSecureContext(){return"https:"===window.location.protocol||"localhost"===window.location.hostname}function getElementAbsoluteHeight(z){z="string"===typeof z?document.querySelector(z):z;const K=window.getComputedStyle(z);const ee=parseFloat(K.marginTop)+parseFloat(K.marginBottom);const te=z.offsetHeight;return Math.ceil(ee+te)}
/**
     * Decoder for bedpe records.
     *
     * Bedpe format was created by Aaron Quinlan et al as part of the bedtools project.
     * The spec is here:  https://bedtools.readthedocs.io/en/latest/content/general-usage.html,
     *
     * 1      2      3    4      5      6    7    8     9       10      11-
     * chrom1 start1 end1 chrom2 start2 end2 name score strand1 strand2 <Any number of additional, user-defined fields>
     *
     * However there are off spec variants, an important one being a 7 column format with score in place of the standard
     * name column.
     *
     * A common variant is a "hiccups" output file, which is standard bedpe with the exception of a header line
     * of the form
     *
     * chr1    x1    x2    chr2    y1    y2    name    score    strand1    strand2    color    observed    expectedBL    expectedDonut    expectedH    expectedV    fdrBL    fdrDonut    fdrH    fdrV
     *
     * The "hiccups" output is apparently not standardized as this is found at ENCODE, with a non-helpful "tsv" extension
     *
     * chr1    x1    x2    chr2    y1    y2    color    observed    expectedBL    expectedDonut    expectedH    expectedV    fdrBL    fdrDonut    fdrH    fdrV    numCollapsed    centroid1    centroid2    radius
     * chr9    136790000    136795000    chr9    136990000    136995000    0,255,255    101.0    31.100368    38.40316    56.948116    34.040756    1.1876738E-13    1.05936405E-13    2.5148233E-4    1.7220993E-13    1    136792500    136992500    25590
     *
     * The "hiccups" documentation specfies yet another set of column headers
     * chromosome1    x1    x2    chromosome2    y1    y2    color    observed expected_bottom_left    expected_donut    expected_horizontal    expected_vertical fdr_bottom_left    fdr_donut    fdr_horizontal    fdr_vertical number_collapsed    centroid1    centroid2    radius
     *
     * @param tokens
     * @param ignore
     * @returns {{start1: number, end2: number, end1: number, chr1: *, chr2: *, start2: number}|undefined}
     */function decodeBedpe(z,K){if(z.length<6){console.log("Skipping line: "+z.join(" "));return}var ee={chr1:z[0],start1:Number.parseInt(z[1]),end1:Number.parseInt(z[2]),chr2:z[3],start2:Number.parseInt(z[4]),end2:Number.parseInt(z[5])};if(isNaN(ee.start1)||isNaN(ee.end1)||isNaN(ee.start2)||isNaN(ee.end2))return;K&&void 0===K.hiccups&&(K.hiccups=!!K.columnNames&&isHiccups(K.columnNames));const te=K&&K.hiccups;const ne=te?6:10;if(!te){z.length>6&&"."!==z[6]&&(ee.name=z[6]);z.length>7&&"."!==z[7]&&(ee.score=Number(z[7]));z.length>8&&"."!==z[8]&&(ee.strand1=z[8]);z.length>9&&"."!==z[9]&&(ee.strand2=z[9])}if(K){const te=K.colorColumn;te&&te<z.length&&(ee.color=$o.createColorString(z[te]));const re=K.thicknessColumn;re&&re<z.length&&(ee.thickness=z[re]);z.length>ne&&K.columnNames&&K.columnNames.length===z.length&&(ee.extras=z.slice(ne))}if(ee.chr1===ee.chr2){ee.chr=ee.chr1;ee.start=Math.min(ee.start1,ee.start2);ee.end=Math.max(ee.end1,ee.end2)}return ee}
/**
     * Hack for non-standard bedPE formats, where numeric score can be in column 7 (name field from spec)
     * @param features
     */function fixBedPE(z){if(0==z.length)return;const K=z[0];if(void 0===K.score&&void 0!==K.name){for(let K of z)if(!(isNumber(K.name)||"."===K.name))return;for(let K of z){K.score=Number(K.name);delete K.name}}const ee=z.filter((z=>z.chr1!==z.chr2));for(let K of ee){const ee=Object.assign({},K);ee.dup=true;z.push(ee);K.chr=K.chr1;K.start=K.start1;K.end=K.end1;ee.chr=ee.chr2;ee.start=ee.start2;ee.end=ee.end2}}
/**
     * Special decoder for Hic Domain files.   In these files feature1 == feature2, they are really bed records.
     * @param tokens
     * @param ignore
     * @returns {*}
     */function decodeBedpeDomain(z,K){if(!(z.length<8))return{chr:z[0],start:Number.parseInt(z[1]),end:Number.parseInt(z[2]),color:$o.createColorString(z[6]),value:Number(z[7])}}function isHiccups(z){return z&&(z.includes("fdrDonut")||z.includes("fdr_donut"))}const ta=new Set(["narrowpeak","broadpeak","regionpeak","peaks","bedgraph","wig","gff3","gff","gtf","fusionjuncspan","refflat","seg","aed","bed","vcf","bb","bigbed","biginteract","biggenepred","bignarrowpeak","bw","bigwig","bam","tdf","refgene","genepred","genepredext","bedpe","bp","snp","rmsk","cram","gwas","maf","mut","tsv","hiccups","fasta","fa","fna","pytor"]);
/**
     * Return a custom format object with the given name.
     * @param name
     * @returns {*}
     */function getFormat(z){return ea&&ea[z]?expandFormat(ea[z]):void 0;function expandFormat(z){const K=z.fields;const ee=["chr","start","end"];for(let te=0;te<K.length;te++)for(let ne of ee)ne===K[te]&&(z[ne]=te);return z}}function inferFileFormat(z){var K,ee;z=z.toLowerCase();if(z.endsWith("refgene.txt.gz")||z.endsWith("refgene.txt.bgz")||z.endsWith("refgene.txt")||z.endsWith("refgene.sorted.txt.gz")||z.endsWith("refgene.sorted.txt.bgz"))return"refgene";K=z.indexOf("?");K>0&&(z=z.substr(0,K));z.endsWith(".gz")&&(z=z.substr(0,z.length-3));(z.endsWith(".txt")||z.endsWith(".tab")||z.endsWith(".bgz"))&&(z=z.substr(0,z.length-4));K=z.lastIndexOf(".");ee=K<0?z:z.substr(K+1);switch(ee){case"bw":return"bigwig";case"bb":return"bigbed";case"fasta":case"fa":case"fna":return"fasta";default:return ta.has(ee)?ee:void 0}}function inferIndexPath(z,K){if(isString$2(z)){if(z.includes("?")){const ee=z.indexOf("?");return z.substring(0,ee)+"."+K+z.substring(ee)}return z+"."+K}}function inferTrackType(z){translateDeprecatedTypes(z);if(z.type)return z.type;if(z.format){const K=z.format.toLowerCase();switch(K){case"bw":case"bigwig":case"wig":case"bedgraph":case"tdf":return"wig";case"vcf":return"variant";case"seg":return"seg";case"mut":case"maf":return"mut";case"bam":case"cram":return"alignment";case"hiccups":case"bedpe":case"bedpe-loop":case"biginteract":return"interact";case"bp":return"arc";case"gwas":return"gwas";case"bed":case"bigbed":case"bb":case"biggenepred":case"bignarrowpeak":return"bedtype";case"fasta":return"sequence";case"pytor":return"cnvpytor";default:return"annotation"}}}function translateDeprecatedTypes(z){if(z.featureType){z.type=z.type||z.featureType;z.featureType=void 0}if("junctions"===z.type)z.type="junction";else if("bed"===z.type){z.type="annotation";z.format=z.format||"bed"}else if("annotations"===z.type)z.type="annotation";else if("alignments"===z.type)z.type="alignment";else if("bam"===z.type){z.type="alignment";z.format="bam"}else if("vcf"===z.type){z.type="variant";z.format="vcf"}else if("t2d"===z.type)z.type="gwas";else if("FusionJuncSpan"!==z.type||z.format){if("aed"===z.type){z.type="annotation";z.format=z.format||"aed"}}else z.format="fusionjuncspan"}
/**
     * Attempt to infer the file format by reading a few lines from the header.  Currently this only supports "tsv" extensions,
     * it was added specifically for "hiccups" type tsv files in ENCODE.  Might be expanded in the future.
     *
     * @param url
     * @returns {Promise<void>}
     */async function inferFileFormatFromHeader(z){if(z.url){const K=await Wo.loadString(z.url,buildOptions(z,{range:{start:0,size:1e3}}));if(K){const z=K.split("\n")[0].split("\t");if(isHiccups(z))return"hiccups"}}}function registerFileFormats(z,K){ea[z]={fields:K}}var na=Object.freeze({__proto__:null,knownFileExtensions:ta,getFormat:getFormat,inferFileFormat:inferFileFormat,inferFileFormatFromHeader:inferFileFormatFromHeader,inferTrackType:inferTrackType,inferIndexPath:inferIndexPath,registerFileFormats:registerFileFormats});const ra=[["A","T"],["G","C"],["Y","R"],["W","S"],["K","M"],["D","H"],["B","V"]];const ia=new Map;for(let Rp of ra){const Ip=Rp[0];const Fp=Rp[1];ia.set(Ip,Fp);ia.set(Fp,Ip);ia.set(Ip.toLowerCase(),Fp.toLowerCase());ia.set(Fp.toLowerCase(),Ip.toLowerCase())}function reverseComplementSequence(z){let K="";let ee=z.length;while(ee-- >0){const te=z[ee];K+=ia.has(te)?ia.get(te):te}return K}class Chromosome{constructor(z,K,ee){this.name=z;this.order=K;this.bpLength=ee}}const sa=splitLines$5;const oa=new Set(["fastaURL","indexURL","cytobandURL","indexed"]);class NonIndexedFasta{constructor(z){this.fastaURL=z.fastaURL;this.withCredentials=z.withCredentials;this.chromosomeNames=[];this.chromosomes={};this.sequences=new Map;const K={};for(let ee in z)z.hasOwnProperty(ee)&&!oa.has(ee)&&(K[ee]=z[ee]);this.config=K}async init(){return this.loadAll()}async getSequence(z,K,ee){if(!this.sequences.has(z))return;let te=this.sequences.get(z).find((z=>z.contains(K,ee)));if(!te){te=this.sequences.get(z).find((z=>z.overlaps(K,ee)));if(!te)return}K-=te.offset;ee-=te.offset;let ne="";if(K<0)for(let z=K;z<Math.min(ee,0);z++)ne+="*";if(ee<=0)return Promise.resolve(ne);const re=te.sequence;const ie=Math.min(ee,re.length);return ne+re.substring(K,ie)}async loadAll(){let z;if(isDataURL(this.fastaURL)){let K=decodeDataURI$1(this.fastaURL);z="";for(let ee of K)z+=String.fromCharCode(ee)}else z=await Wo.load(this.fastaURL,buildOptions(this.config));const K=new Set;const ee=sa(z);const te=ee.length;let ne=0;let re=0;let ie;let se={};while(ne<te){ie=ee[ne++].trim();if(ie.startsWith("#")||0===ie.length);else if(ie.startsWith(">")){se&&se.seq&&pushChromosome.call(this,se,re++);const z=ie.substr(1).split(/\s+/);const K=z[0].split(":");se.chr=K[0];se.seq="";se.offset=0;if(K.length>1&&K[1].indexOf("-")>0){const ee=K[1].split("-");2===ee.length&&/^[0-9]+$/.test(ee[0])&&/^[0-9]+$/.test(ee[1]);const te=Number.parseInt(ee[0]);const ne=Number.parseInt(ee[1]);ne>te&&(se.offset=te-1);if(z.length>1&&z[1].startsWith("@len="))try{se.length=parseInt(z[1].trim().substring(5))}catch(z){se.length=void 0;console.error(`Error parsing sequence length for ${ie}`)}else se.length=void 0}}else se.seq+=ie;se&&se.seq&&pushChromosome.call(this,se,re)}function pushChromosome(z,ee){const te=z.length||z.offset+z.seq.length;if(K.has(z.chr)){const K=this.chromosomes[z.chr];K.bpLength=Math.max(K.bpLength,te)}else{this.chromosomeNames.push(z.chr);this.sequences.set(z.chr,[]);this.chromosomes[z.chr]=new Chromosome(z.chr,ee,te);K.add(z.chr)}this.sequences.get(z.chr).push(new SequenceSlice(z.offset,z.seq))}}}class SequenceSlice{constructor(z,K){this.offset=z;this.sequence=K}contains(z,K){return this.offset<=z&&this.end>=K}overlaps(z,K){return this.offset<K&&this.end>z}get end(){return this.offset+this.sequence.length}}const GenomicInterval=function(z,K,ee,te){this.chr=z;this.start=K;this.end=ee;this.features=te};GenomicInterval.prototype.contains=function(z,K,ee){return this.chr===z&&this.start<=K&&this.end>=ee};GenomicInterval.prototype.containsRange=function(z){return this.chr===z.chr&&this.start<=z.start&&this.end>=z.end};const aa=splitLines$5;const la=new Set(["fastaURL","indexURL","compressedIndexURL","cytobandURL","indexed"]);class FastaSequence{constructor(z){this.file=z.fastaURL;this.indexFile=z.indexURL||z.indexFile||this.file+".fai";this.compressedIndexFile=z.compressedIndexURL||false;this.withCredentials=z.withCredentials;this.chromosomeNames=[];this.chromosomes={};this.sequences={};this.offsets={};const K={};for(let ee in z)z.hasOwnProperty(ee)&&!la.has(ee)&&(K[ee]=z[ee]);this.config=K}async init(){return this.getIndex()}async getSequence(z,K,ee){const te=this.interval&&this.interval.contains(z,K,ee);if(!te){let te=K;let ne=ee;if(ee-K<5e4){const z=ee-K;const re=Math.round(K+z/2);te=Math.max(0,re-25e3);ne=re+25e3}const re=await this.readSequence(z,te,ne);this.interval=new GenomicInterval(z,te,ne,re)}const ne=K-this.interval.start;const re=ee-K;const ie=this.interval.features?this.interval.features.substr(ne,re):null;return ie}async getIndex(){if(this.index)return this.index;{const z=await Wo.load(this.indexFile,buildOptions(this.config));const K=aa(z);const ee=K.length;let te=0;let ne=0;this.index={};while(te<ee){const z=K[te++].split("\t");const ee=z.length;if(5===ee){const K=z[0];const ee=parseInt(z[1]);const te=parseInt(z[2]);const re=parseInt(z[3]);const ie=parseInt(z[4]);const se={size:ee,position:te,basesPerLine:re,bytesPerLine:ie};this.chromosomeNames.push(K);this.index[K]=se;this.chromosomes[K]=new Chromosome(K,ne++,ee)}}return this.index}}async getCompressedIndex(){const z=8;const K=8;if(this.compressedIndex)return this.compressedIndex;if(!this.compressedIndexFile){this.compressedIndex=[];return this.compressedIndex}this.compressedIndex=[];const ee=await Wo.loadArrayBuffer(this.compressedIndexFile,buildOptions(this.config));const te=ee.byteLength;if(te<z){console.log("Cannot parse GZI index file: length ("+te+" bytes) is insufficient to determine content of index.");return this.compressedIndex}const ne=ee.slice(0,z);const re=Number(new DataView(ne).getBigUint64(0,true));const ie=z+2*re*K;if(te!=ie){console.log("Incorrect file size of reference genome index. Expected : "+ie+". Received : "+te);return this.compressedIndex}this.compressedIndex.push([0,0]);for(let te=0;te<re;te++){const ne=z+2*te*K;const re=z+2*te*K+2*K;const ie=ee.slice(ne,re);const se=new DataView(ie);const oe=Number(se.getBigUint64(0,true));const ae=Number(se.getBigUint64(K,true));this.compressedIndex.push([oe,ae])}return this.compressedIndex}async getRelevantCompressedBlockNumbers(z,K){const ee=1;if(z<0||K<0||K<z){console.log("Incompatible query positions for reference-genome. Start:"+z+" | End:"+K);return[]}await this.getCompressedIndex();let te=[];const ne=0;const re=this.compressedIndex.length-1;if(0==this.compressedIndex.length){console.log("Compressed index does not contain any content");return[]}if(z>this.compressedIndex[re][ee])return[re];let ie=ne;let se=re;let oe=Math.floor(this.compressedIndex.length/2);let ae=this.compressedIndex.length+1;let le=false;for(let K=0;K<ae;K++){const K=this.compressedIndex[oe][ee];const te=oe<this.compressedIndex.length-1?this.compressedIndex[oe+1][ee]:Infinity;if(K<=z&&te>z){le=true;break}K<z?ie=oe+1:se=oe-1;oe=Math.ceil((se-ie)/2)+ie}if(!le){console.log("No blocks within compressed index found that correspond with query positions "+z+","+K);console.log(this.compressedIndex);return[]}te.push(oe);for(let z=oe+1;z<this.compressedIndex.length;z++){te.push(z);const ne=this.compressedIndex[z][ee];if(ne>=K)break}const ce=te[te.length-1];const he=this.compressedIndex.length-1;ce===he&&this.compressedIndex[ce][ee]<K&&te.push(-1);return te}async loadAndUncompressBlocks(z,K){const ee=0;const te=1;await this.getCompressedIndex();if(0==z.length)return"";let ne=Array(z.length-1);for(let K=0;K<z.length-1;K++){const te=z[K];const re=this.compressedIndex[te];const ie=re[ee];const se=z[K+1];let oe=[];if(-1!=se){const z=this.compressedIndex[se];const K=z[ee];const te=K-ie;oe=await Wo.loadArrayBuffer(this.file,buildOptions(this.config,{range:{start:ie,size:te}}))}else oe=await Wo.loadArrayBuffer(this.file,buildOptions(this.config,{range:{start:ie}}));const ae=await unbgzf(oe);ne[K]=ae}let re="";for(let z=0;z<ne.length;z++)for(let K=0;K<ne[z].length;K++){const ee=String.fromCharCode(ne[z][K]);re+=ee}const ie=this.compressedIndex[z[0]];const se=K-ie[te];re=re.substring(se);return re}async readSequence(z,K,ee){await this.getIndex();await this.getCompressedIndex();const te=this.index[z];if(!te){console.log("No index entry for chr: "+z);this.interval=new GenomicInterval(z,K,ee,null);return null}const ne=Math.max(0,K);const re=Math.min(te.size,ee);const ie=te.bytesPerLine;const se=te.basesPerLine;const oe=te.position;const ae=ie-se;const le=Math.floor(ne/se);const ce=Math.floor(re/se);const he=le*se;const ue=ne-he;const de=oe+le*ie+ue;const fe=ce*se;const pe=re-fe;const ge=oe+ce*ie+pe-1;const me=ge-de+1;if(me<=0){console.error("No sequence for "+z+":"+K+"-"+ee);return null}let be;if(this.compressedIndexFile){let z=await this.getRelevantCompressedBlockNumbers(de,ge);if(0===z.length){console.log("No blocks in the compressed index that correspond with the requested byte positions ("+de+","+ge+")");return null}be=await this.loadAndUncompressBlocks(z,de)}else be=await Wo.load(this.file,buildOptions(this.config,{range:{start:de,size:me}}));if(!be)return null;let ve,we="",ye=0,_e=be.length;if(ue>0){ve=Math.min(re-ne,se-ue);we+=be.substr(ye,ve);ye+=ve+ae}while(ye<_e){ve=Math.min(se,_e-ye);we+=be.substr(ye,ve);ye+=ve+ae}return we}}const ca=splitLines$5;class ChromSizes{constructor(z){this.url=z;this.chromosomeNames=[];this.chromosomes={}}async init(){return this.loadAll()}async getSequence(z,K,ee){}async loadAll(){let z;if(isDataURL(this.url)){let K=decodeDataURI$1(this.fastaURL);z="";for(let ee of K)z+=String.fromCharCode(ee)}else z=await Wo.load(this.url,{});this.chromosomeNames=[];this.chromosomes={};const K=ca(z);let ee=0;for(let z of K){const K=z.split("\t");this.chromosomeNames.push(K[0]);const te=Number.parseInt(K[1]);const ne=new Chromosome(K[0],ee++,te);this.chromosomes[K[0]]=ne}}}async function loadFasta(z){let K;K="chromsizes"===z.format?new ChromSizes(z.fastaURL):isDataURL(z.fastaURL)||false===z.indexed?new NonIndexedFasta(z):new FastaSequence(z);await K.init();return K}const ha={A:"rgb(  0, 200,   0)",C:"rgb(  0,0,200)",T:"rgb(255,0,0)",G:"rgb(209,113,  5)",N:"rgb(80,80,80)"};const ua=Number.MIN_SAFE_INTEGER;const da={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"STOP",TAG:"STOP",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"STOP",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};const fa={};const pa=["A","G","C","T","Y","R","W","S","K","M","D","V","H","B","N","X"];const ga=["T","C","G","A","R","Y","W","S","M","K","H","B","D","V","N","X"];for(let Lp=0;Lp<pa.length;Lp++){fa[pa[Lp]]=ga[Lp];fa[pa[Lp].toLowerCase()]=ga[Lp].toLowerCase()}const ma=25;const ba=115;const va=15;const wa=25;const ya=5;const _a=.1;const ka=10;class SequenceTrack{constructor(z,K){this.config=z;this.browser=K;this.type="sequence";this.removable=void 0===z.removable||z.removable;this.name=z.name;this.id=z.id;this.sequenceType=z.sequenceType||"dna";this.disableButtons=false;this.order=z.order||ua;this.ignoreTrackMenu=false;this.reversed=true===z.reversed;this.frameTranslate=true===z.frameTranslate;this.height=this.frameTranslate?ba:ma;z.url&&(z.fastaURL=z.url);z.fastaURL||(this.id=z.id||"sequence")}menuItemList(){return[{name:this.reversed?"Forward":"Reverse",click:()=>{this.reversed=!this.reversed;this.trackView.repaintViews()}},{name:this.frameTranslate?"Close Translation":"Three-frame Translate",click:()=>{this.frameTranslate=!this.frameTranslate;if(this.frameTranslate){for(let z of this.trackView.viewports)z.setContentHeight(ba);this.trackView.setTrackHeight(ba)}else{for(let z of this.trackView.viewports)z.setContentHeight(ma);this.trackView.setTrackHeight(ma)}this.trackView.repaintViews()}}]}contextMenuItemList(z){const K=z.viewport;if(K.referenceFrame.bpPerPixel<=1){const z=K.getWidth();const ee=z*K.referenceFrame.bpPerPixel;const te=K.referenceFrame.chr;const ne=Math.floor(K.referenceFrame.start);const re=Math.ceil(ne+ee);const ie=[{label:this.reversed?"View visible sequence (reversed)...":"View visible sequence...",click:async()=>{let z=await this.browser.genome.sequence.getSequence(te,ne,re);z?this.reversed&&(z=reverseComplementSequence(z)):z="Unknown sequence";this.browser.alert.present(z)}}];isSecureContext()&&ie.push({label:"Copy visible sequence",click:async()=>{let z=await this.browser.genome.sequence.getSequence(te,ne,re);z?this.reversed&&(z=reverseComplementSequence(z)):z="Unknown sequence";try{await navigator.clipboard.writeText(z)}catch(z){console.error(z);this.browser.alert.present(`error copying sequence to clipboard ${z}`)}}});ie.push("<hr/>");return ie}}translateSequence(z){const K=[[],[],[]];for(let ee of[0,1,2]){let te=ee;while(z.length-te>=3){let ne=z.slice(te,te+3);this.reversed&&(ne=ne.split("").reverse().join(""));const re=da[ne.toUpperCase()]||"";K[ee].push({codons:ne,aminoA:re});te+=3}}return K}
/**
         * Return the source for sequence.  If an explicit fasta url is defined, use it, otherwise fetch sequence
         * from the current genome
         * *
         * @returns {Promise<WrappedFasta|*>}
         */async getSequenceSource(){if(this.config.fastaURL){if(!this.fasta){this.fasta=new WrappedFasta(this.config,this.browser.genome);await this.fasta.init()}return this.fasta}return this.browser.genome.sequence}async getFeatures(z,K,ee,te){K=Math.floor(K);ee=Math.floor(ee);if(te&&te>ka)return null;{const te=await this.getSequenceSource();const ne=await te.getSequence(z,K,ee);return{bpStart:K,sequence:ne}}}draw(z){const K=z.context;if(z.features){let ee=z.features.sequence;if(!ee)return;this.reversed&&(ee=ee.split("").map((function(z){return fa[z]})).join(""));const te=z.features.bpStart;const ne=1+z.bpStart+z.pixelWidth*z.bpPerPixel;for(let re=Math.floor(z.bpStart);re<=ne;re++){const ne=Math.floor(re-te);if(ne>=0&&ne<ee.length){const te=re-z.bpStart;const ie=te/z.bpPerPixel;const se=1/z.bpPerPixel;const oe=ee[ne];const ae=this.fillColor(oe.toUpperCase());if(z.bpPerPixel>_a)Jo.fillRect(K,ie,ya,se,va-ya,{fillStyle:ae});else{const ee=ie+.5*(se-K.measureText(oe).width);if("y"===z.axis){K.save();Jo.labelTransformWithContext(K,ee);Jo.strokeText(K,oe,ee,va,{strokeStyle:ae});K.restore()}else Jo.strokeText(K,oe,ee,va,{strokeStyle:ae})}}}if(this.frameTranslate){let ne=va+2*ya;const re=this.translateSequence(ee);for(let ee=0;ee<re.length;ee++){const ie=re[ee];for(let re=0;re<ie.length;re++){let se=0===re%2?"rgb(160,160,160)":"rgb(224,224,224)";const oe=ie[re];const ae=te+ee+3*re;const le=ae-z.bpStart;const ce=Math.floor(le/z.bpPerPixel);const he=Math.floor((le+3)/z.bpPerPixel);const ue=Math.round((ce+he)/2);if(he<0)continue;if(ce>z.pixelWidth)break;let de=oe.aminoA;if(oe.aminoA.indexOf("STOP")>-1){se="rgb(255, 0, 0)";de="STOP"}else if("M"===oe.aminoA){se="rgb(0, 153, 0)";de="START"}Jo.fillRect(K,ce,ne,he-ce,wa,{fillStyle:se});z.bpPerPixel<=.1&&Jo.strokeText(K,de,ue-K.measureText(de).width/2,ne+15)}ne+=wa+ya}}}}get supportsWholeGenome(){return false}computePixelHeight(z){this.height=this.frameTranslate?ba:ma;return this.height}fillColor(z){return this.color?this.color:"dna"===this.sequenceType?ha[z]||"gray":"rgb(0, 0, 150)"}
/**
         * Return the current state of the track.  Used to create sessions and bookmarks.
         *
         * @returns {*|{}}
         */getState(){const z={type:"sequence"};this.order!==ua&&(z.order=this.order);this.reversed&&(z.revealed=true);return z}}class WrappedFasta{constructor(z,K){this.config=z;this.genome=K}async init(){this.fasta=await loadFasta(this.config);this.chrNameMap=new Map;for(let z of this.fasta.chromosomeNames)this.chrNameMap.set(this.genome.getChromosomeName(z),z)}async getSequence(z,K,ee){const te=this.chrNameMap.has(z)?this.chrNameMap.get(z):z;return this.fasta.getSequence(te,K,ee)}}class Viewport{constructor(z,K,ee,te){this.guid=gt.guid();this.trackView=z;this.referenceFrame=ee;this.browser=z.browser;this.$viewport=pt('<div class="igv-viewport">');K.appendChild(this.$viewport.get(0));z.track.height&&(this.$viewport.get(0).style.height=`${z.track.height}px`);z.track instanceof SequenceTrack&&(this.alert=new AlertDialog(this.$viewport.get(0)));this.contentTop=0;this.contentHeight=this.$viewport.height();this.$viewport.width(te);this.initializationHelper()}initializationHelper(){}showMessage(z){if(!this.messageDiv){this.messageDiv=document.createElement("div");this.messageDiv.className="igv-viewport-message";this.$viewport.append(pt(this.messageDiv))}this.messageDiv.textContent=z;this.messageDiv.style.display="inline-block"}hideMessage(z){this.messageDiv&&(this.messageDiv.style.display="none")}setTrackLabel(z){}startSpinner(){}stopSpinner(){}checkZoomIn(){return true}shift(){}setTop(z){this.contentTop=z;this.$viewport.height()}async loadFeatures(){}clearCache(){}async repaint(){}draw(z,K,ee){console.log("Viewport - draw(drawConfiguration, features, roiFeatures)")}checkContentHeight(z){let K=this.trackView.track;z=z||this.cachedFeatures;if("FILL"===K.displayMode)this.setContentHeight(this.$viewport.height());else if("function"===typeof K.computePixelHeight&&z&&z.length>0){let ee=K.computePixelHeight(z);let te=this.contentHeight;ee!==te&&this.setContentHeight(ee)}}getContentHeight(){return this.contentHeight}setContentHeight(z){this.contentHeight=z}isLoading(){return false}saveSVG(){}isVisible(){return this.$viewport.width()}setWidth(z){this.$viewport.width(z)}getWidth(){return this.$viewport.width()}getContentTop(){return this.contentTop}containsPosition(z,K){console.log("Viewport - containsPosition(chr, position)")}addMouseHandlers(){}removeMouseHandlers(){}dispose(){this.popover&&this.popover.dispose();this.$viewport.get(0).remove();for(let z of Object.keys(this))this[z]=void 0}}function format(z,K){var ee,te=Object.keys(K);for(ee=0;ee<te.length;ee++)z=z.replace(new RegExp("\\{"+te[ee]+"\\}","gi"),K[te[ee]]);return z}function randomString(z){var K,ee,te;if(!z)throw new Error("cannot create a random attribute name for an undefined object");K="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";ee="";do{ee="";for(te=0;te<12;te++)ee+=K[Math.floor(Math.random()*K.length)]}while(z[ee]);return ee}function createNamedToNumberedLookup(z,K){var ee,te,ne,re={};z=z.split(",");K=K||10;for(ee=0;ee<z.length;ee+=2){te="&"+z[ee+1]+";";ne=parseInt(z[ee],K);re[te]="&#"+ne+";"}re["\\xa0"]="&#160;";return re}function getTextAnchor(z){var K={left:"start",right:"end",center:"middle",start:"start",end:"end"};return K[z]||K.start}function getDominantBaseline(z){var K={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return K[z]||K.alphabetic}function normalize(z){var K=Math.sqrt(z[0]*z[0]+z[1]*z[1]);return[z[0]/K,z[1]/K]}function intersectRect(z,K){return z.x<K.x+K.width&&z.x+z.width>K.x&&z.y<K.y+K.height&&z.y+z.height>K.y}const xa=createNamedToNumberedLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);const Ca={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}};
/**
     *
     * @param gradientNode - reference to the gradient
     * @constructor
     */class CanvasGradient{constructor(z,K){this.__root=z;this.__ctx=K}addColorStop(z,K){var ee,te,ne=this.__ctx.__createElement("stop");ne.setAttribute("offset",z);if(K&&-1!==K.indexOf("rgba")){ee=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi;te=ee.exec(K);ne.setAttribute("stop-color",format("rgb({r},{g},{b})",{r:te[1],g:te[2],b:te[3]}));ne.setAttribute("stop-opacity",te[4])}else ne.setAttribute("stop-color",K);this.__root.appendChild(ne)}}class CanvasPattern{constructor(z,K){this.__root=z;this.__ctx=K}}
/**
     * The mock canvas context
     * @param config - options include:
     * ctx - existing Context2D to wrap around
     * width - width of your canvas (defaults to 500)
     * height - height of your canvas (defaults to 500)
     * enableMirroring - enables canvas mirroring (get image data) (defaults to false)
     * document - the document object (defaults to the current document)
     */class ctx{constructor(z){if(!(this instanceof ctx))return new ctx(z);this.config=z;this.width=z.width;this.height=z.height;this.enableMirroring=z.enableMirroring||false;this.canvas=this;this.__document=document;if(z.ctx)this.__ctx=z.ctx;else{this.__canvas=this.__document.createElement("canvas");this.__ctx=this.__canvas.getContext("2d")}this.isSVG=true;this.__setDefaultStyles();this.__stack=[this.__getStyleState()];this.__groupStack=[];this.__root=this.__createElement("svg");this.__root.setAttribute("width",this.width);this.__root.setAttribute("height",this.height);this.__root.setAttribute("overflow","visible");if(z.viewbox){const K=z.viewbox.x+" "+z.viewbox.y+" "+z.viewbox.width+" "+z.viewbox.height;this.__root.setAttribute("viewBox",K);this.viewbox=z.viewbox}this.__ids={};this.__defs=this.__createElement("defs");this.__root.appendChild(this.__defs);this.multiLocusGap=z.multiLocusGap;let K={id:"svg_output_backdrop",width:"100%",height:"100%",fill:z.backdropColor||"white"};let ee=this.__createElement("rect",K);this.__root.appendChild(ee);this.__rootGroup=this.__createElement("g",{id:"root-group"});this.__root.appendChild(this.__rootGroup);this.__currentElement=this.__rootGroup}setWidth(z){this.width=z;this.__root.setAttribute("width",this.width);const K=this.config.viewbox.x+" "+this.config.viewbox.y+" "+z+" "+this.config.viewbox.height;this.__root.setAttribute("viewBox",K)}setHeight(z){this.height=z;this.__root.setAttribute("height",this.height);const K=this.config.viewbox.x+" "+this.config.viewbox.y+" "+this.config.viewbox.width+" "+z;this.__root.setAttribute("viewBox",K)}__createElement(z,K,ee){"undefined"===typeof K&&(K={});let te=this.__document.createElementNS("http://www.w3.org/2000/svg",z);if(ee){te.setAttribute("fill","none");te.setAttribute("stroke","none")}for(let z of Object.keys(K))te.setAttribute(z,K[z]);return te}__setDefaultStyles(){var z,K,ee=Object.keys(Ca);for(z=0;z<ee.length;z++){K=ee[z];this[K]=Ca[K].canvas}}
/**
         * Applies styles on restore
         * @param styleState
         * @private
         */
__applyStyleState(z){var K,ee,te=Object.keys(z);for(K=0;K<te.length;K++){ee=te[K];this[ee]=z[ee]}}__getStyleState(){var z,K,ee={},te=Object.keys(Ca);for(z=0;z<te.length;z++){K=te[z];ee[K]=this[K]}return ee}
/**
         * Apples the current styles to the current SVG element. On "ctx.fill" or "ctx.stroke"
         * @param type
         * @private
         */
__applyStyleToCurrentElement(z){var K=this.__currentElement;var ee=this.__currentElementsToStyle;if(ee){K.setAttribute(z,"");K=ee.element;ee.children.forEach((function(K){K.setAttribute(z,"")}))}var te,ne,re,ie,se,oe,ae=Object.keys(Ca);for(te=0;te<ae.length;te++){ne=Ca[ae[te]];re=this[ae[te]];if(ne.apply)if(re instanceof CanvasPattern){if(re.__ctx)while(re.__ctx.__defs.childNodes.length){ie=re.__ctx.__defs.childNodes[0].getAttribute("id");this.__ids[ie]=ie;this.__defs.appendChild(re.__ctx.__defs.childNodes[0])}K.setAttribute(ne.apply,format("url(#{id})",{id:re.__root.getAttribute("id")}))}else if(re instanceof CanvasGradient)K.setAttribute(ne.apply,format("url(#{id})",{id:re.__root.getAttribute("id")}));else if(ne&&-1!==ne.apply.indexOf(z)&&ne.svg!==re)if("stroke"!==ne.svgAttr&&"fill"!==ne.svgAttr||!re||-1===re.indexOf("rgba")){var le=ne.svgAttr;if("globalAlpha"===ae[te]){le=z+"-"+ne.svgAttr;if(K.getAttribute(le))continue}K.setAttribute(le,re)}else{se=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi;oe=se.exec(re);K.setAttribute(ne.svgAttr,format("rgb({r},{g},{b})",{r:oe[1],g:oe[2],b:oe[3]}));var ce=oe[4];var he=this.globalAlpha;null!=he&&(ce*=he);K.setAttribute(ne.svgAttr+"-opacity",ce)}}}__closestGroupOrSvg(z){z=z||this.__currentElement;return"g"===z.nodeName||"svg"===z.nodeName?z:this.__closestGroupOrSvg(z.parentNode)}
/**
         * Returns the serialized value of the svg so far
         * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.
         *                           If true, we attempt to find all named entities and encode it as a numeric entity.
         * @return serialized svg
         */
getSerializedSvg(z){var K,ee,te,ne,re,ie=(new XMLSerializer).serializeToString(this.__root);if(z){K=Object.keys(xa);for(ee=0;ee<K.length;ee++){te=K[ee];ne=xa[te];re=new RegExp(te,"gi");re.test(ie)&&(ie=ie.replace(re,ne))}}return ie}getSvg(){return this.__root}saveWithTranslationAndClipRect(z,K,ee,te,ne,re){const ie=`${z}_clip_rect`;let se=this.__createElement("clipPath",{id:ie});this.__defs.appendChild(se);const oe={x:"0",y:re.toString(),width:te.toString(),height:ne.toString()};se.appendChild(this.__createElement("rect",oe));const ae=this.__createElement("g");ae.setAttribute("transform",format("translate({x},{y})",{x:K,y:ee}));ae.setAttribute("clip-path",format("url(#{id})",{id:ie}));const le=this.__closestGroupOrSvg();le.appendChild(ae);this.__groupStack.push(le);this.__currentElement=ae;this.__stack.push(this.__getStyleState())}save(){var z=this.__createElement("g");var K=this.__closestGroupOrSvg();this.__groupStack.push(K);K.appendChild(z);this.__currentElement=z;this.__stack.push(this.__getStyleState())}restore(){this.__currentElement=this.__groupStack.pop();this.__currentElementsToStyle=null;this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var z=this.__stack.pop();this.__applyStyleState(z)}__addTransform(z){var K=this.__closestGroupOrSvg();if(K.childNodes.length>0){if("path"===this.__currentElement.nodeName){this.__currentElementsToStyle||(this.__currentElementsToStyle={element:K,children:[]});this.__currentElementsToStyle.children.push(this.__currentElement);this.__applyCurrentDefaultPath()}var ee=this.__createElement("g");K.appendChild(ee);this.__currentElement=ee}var te=this.__currentElement.getAttribute("transform");te?te+=" ":te="";te+=z;this.__currentElement.setAttribute("transform",te)}addTrackGroupWithTranslationAndClipRect(z,K,ee,te,ne,re){const ie=z+"_clip_rect";let se=this.__createElement("clipPath",{id:ie});this.__defs.appendChild(se);se.appendChild(this.__createElement("rect",{x:"0",y:re.toString(),width:te.toString(),height:ne.toString()}));let oe=this.__createElement("g");this.__rootGroup.appendChild(oe);oe.setAttribute("transform",format("translate({x},{y})",{x:K,y:ee}));oe.setAttribute("id",z+"_group");oe.setAttribute("clip-path",format("url(#{id})",{id:ie}));this.__currentElement=oe}scale(z,K){void 0===K&&(K=z);this.__addTransform(format("scale({x},{y})",{x:z,y:K}))}rotate(z){var K=180*z/Math.PI;this.__addTransform(format("rotate({angle},{cx},{cy})",{angle:K,cx:0,cy:0}))}translate(z,K){this.__addTransform(format("translate({x},{y})",{x:z,y:K}))}transform(z,K,ee,te,ne,re){this.__addTransform(format("matrix({a},{b},{c},{d},{e},{f})",{a:z,b:K,c:ee,d:te,e:ne,f:re}))}beginPath(){var z,K;this.__currentDefaultPath="";this.__currentPosition={};z=this.__createElement("path",{},true);K=this.__closestGroupOrSvg();K.appendChild(z);this.__currentElement=z}__applyCurrentDefaultPath(){var z=this.__currentElement;"path"===z.nodeName?z.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",z.nodeName)}__addPathCommand(z){this.__currentDefaultPath+=" ";this.__currentDefaultPath+=z}moveTo(z,K){"path"!==this.__currentElement.nodeName&&this.beginPath();this.__currentPosition={x:z,y:K};this.__addPathCommand(format("M {x} {y}",{x:z,y:K}))}closePath(){this.__currentDefaultPath&&this.__addPathCommand("Z")}lineTo(z,K){this.__currentPosition={x:z,y:K};this.__currentDefaultPath&&this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(format("L {x} {y}",{x:z,y:K})):this.__addPathCommand(format("M {x} {y}",{x:z,y:K}))}bezierCurveTo(z,K,ee,te,ne,re){this.__currentPosition={x:ne,y:re};this.__addPathCommand(format("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:z,cp1y:K,cp2x:ee,cp2y:te,x:ne,y:re}))}quadraticCurveTo(z,K,ee,te){this.__currentPosition={x:ee,y:te};this.__addPathCommand(format("Q {cpx} {cpy} {x} {y}",{cpx:z,cpy:K,x:ee,y:te}))}arcTo(z,K,ee,te,ne){var re=this.__currentPosition&&this.__currentPosition.x;var ie=this.__currentPosition&&this.__currentPosition.y;if("undefined"!=typeof re&&"undefined"!=typeof ie){if(ne<0)throw new Error("IndexSizeError: The radius provided ("+ne+") is negative.");if(re===z&&ie===K||z===ee&&K===te||0===ne)this.lineTo(z,K);else{var se=normalize([re-z,ie-K]);var oe=normalize([ee-z,te-K]);if(se[0]*oe[1]!==se[1]*oe[0]){var ae=se[0]*oe[0]+se[1]*oe[1];var le=Math.acos(Math.abs(ae));var ce=normalize([se[0]+oe[0],se[1]+oe[1]]);var he=ne/Math.sin(le/2);var ue=z+he*ce[0];var de=K+he*ce[1];var fe=[-se[1],se[0]];var pe=[oe[1],-oe[0]];var getAngle=function(z){var K=z[0];var ee=z[1];return ee>=0?Math.acos(K):-Math.acos(K)};var ge=getAngle(fe);var me=getAngle(pe);this.lineTo(ue+fe[0]*ne,de+fe[1]*ne);this.arc(ue,de,ne,ge,me)}else this.lineTo(z,K)}}}stroke(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers");this.__applyCurrentDefaultPath();this.__applyStyleToCurrentElement("stroke")}fill(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers");this.__applyCurrentDefaultPath();this.__applyStyleToCurrentElement("fill")}rect(z,K,ee,te){"path"!==this.__currentElement.nodeName&&this.beginPath();this.moveTo(z,K);this.lineTo(z+ee,K);this.lineTo(z+ee,K+te);this.lineTo(z,K+te);this.lineTo(z,K);this.closePath()}fillRect(z,K,ee,te){if(te<0){K+=te;te=-te}if(ee<0){z+=ee;ee=-ee}var ne={x:z,y:K,width:ee,height:te};if(!this.viewbox||intersectRect(this.viewbox,ne)){var re,ie;re=this.__createElement("rect",ne,true);ie=this.__closestGroupOrSvg();ie.appendChild(re);this.__currentElement=re;this.__applyStyleToCurrentElement("fill")}}
/**
         * Draws a rectangle with no fill
         * @param x
         * @param y
         * @param width
         * @param height
         */
strokeRect(z,K,ee,te){var ne,re;ne=this.__createElement("rect",{x:z,y:K,width:ee,height:te},true);re=this.__closestGroupOrSvg();re.appendChild(ne);this.__currentElement=ne;this.__applyStyleToCurrentElement("stroke")}strokeEllipse(z,K,ee,te,ne,re,ie,se){this.__ellipse(z,K,ee,te,ne,re,ie,se,"stroke")}fillEllipse(z,K,ee,te,ne,re,ie,se){this.__ellipse(z,K,ee,te,ne,re,ie,se,"fill")}__ellipse(z,K,ee,te,ne,re,ie,se,oe){const ae={cx:z,cy:K,rx:ee,ry:te};const le=this.__createElement("ellipse",ae,true);const ce=this.__closestGroupOrSvg();ce.appendChild(le);this.__currentElement=le;this.__applyStyleToCurrentElement(oe)}__clearCanvas(){var z=this.__closestGroupOrSvg(),K=z.getAttribute("transform");var ee=this.__root.childNodes[1];var te=ee.childNodes;for(var ne=te.length-1;ne>=0;ne--)te[ne]&&ee.removeChild(te[ne]);this.__currentElement=ee;this.__groupStack=[];K&&this.__addTransform(K)}clearRect(z,K,ee,te){if(0!==z||0!==K||ee!==this.width||te!==this.height){var ne,re=this.__closestGroupOrSvg();ne=this.__createElement("rect",{x:z,y:K,width:ee,height:te,fill:"#FFFFFF"},true);re.appendChild(ne)}else this.__clearCanvas()}createLinearGradient(z,K,ee,te){var ne=this.__createElement("linearGradient",{id:randomString(this.__ids),x1:z+"px",x2:ee+"px",y1:K+"px",y2:te+"px",gradientUnits:"userSpaceOnUse"},false);this.__defs.appendChild(ne);return new CanvasGradient(ne,this)}createRadialGradient(z,K,ee,te,ne,re){var ie=this.__createElement("radialGradient",{id:randomString(this.__ids),cx:te+"px",cy:ne+"px",r:re+"px",fx:z+"px",fy:K+"px",gradientUnits:"userSpaceOnUse"},false);this.__defs.appendChild(ie);return new CanvasGradient(ie,this)}__parseFont(){var z=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i;var K=z.exec(this.font);var ee={style:K[1]||"normal",size:K[4]||"10px",family:K[6]||"sans-serif",weight:K[3]||"normal",decoration:K[2]||"normal",href:null};"underline"===this.__fontUnderline&&(ee.decoration="underline");this.__fontHref&&(ee.href=this.__fontHref);return ee}
/**
         * Helper to link text fragments
         * @param font
         * @param element
         * @return {*}
         * @private
         */
__wrapTextLink(z,K){if(z.href){var ee=this.__createElement("a");ee.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",z.href);ee.appendChild(K);return ee}return K}
/**
         * Fills or strokes text
         * @param text
         * @param x
         * @param y
         * @param action - stroke or fill
         * @private
         */
__applyText(z,K,ee,te){var ne=this.__parseFont(),re=this.__closestGroupOrSvg(),ie=this.__createElement("text",{"font-family":ne.family,"font-size":ne.size,"font-style":ne.style,"font-weight":ne.weight,"text-decoration":ne.decoration,x:K,y:ee,"text-anchor":getTextAnchor(this.textAlign),"dominant-baseline":getDominantBaseline(this.textBaseline)},true);ie.appendChild(this.__document.createTextNode(z));this.__currentElement=ie;this.__applyStyleToCurrentElement(te);re.appendChild(this.__wrapTextLink(ne,ie))}
/**
         * Creates a text element
         * @param text
         * @param x
         * @param y
         */
fillText(z,K,ee){this.__applyText(z,K,ee,"fill")}
/**
         * Strokes text
         * @param text
         * @param x
         * @param y
         */
strokeText(z,K,ee){this.__applyText(z,K,ee,"stroke")}
/**
         * No need to implement this for svg.
         * @param text
         * @return {TextMetrics}
         */
measureText(z){this.__ctx.font=this.font;return this.__ctx.measureText(z)}arc(z,K,ee,te,ne,re){if(te!==ne){te%=2*Math.PI;ne%=2*Math.PI;te===ne&&(ne=(ne+2*Math.PI-.001*(re?-1:1))%(2*Math.PI));var ie=z+ee*Math.cos(ne),se=K+ee*Math.sin(ne),oe=z+ee*Math.cos(te),ae=K+ee*Math.sin(te),le=re?0:1,ce=0,he=ne-te;he<0&&(he+=2*Math.PI);ce=re?he>Math.PI?0:1:he>Math.PI?1:0;this.lineTo(oe,ae);this.__addPathCommand(format("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:ee,ry:ee,xAxisRotation:0,largeArcFlag:ce,sweepFlag:le,endX:ie,endY:se}));this.__currentPosition={x:ie,y:se}}}clip(){var z=this.__closestGroupOrSvg(),K=this.__createElement("clipPath"),ee=randomString(this.__ids),te=this.__createElement("g");this.__applyCurrentDefaultPath();z.removeChild(this.__currentElement);K.setAttribute("id",ee);K.appendChild(this.__currentElement);this.__defs.appendChild(K);z.setAttribute("clip-path",format("url(#{id})",{id:ee}));z.appendChild(te);this.__currentElement=te}drawImage(){var z,K,ee,te,ne,re,ie,se,oe,ae,le,ce,he,ue,de=Array.prototype.slice.call(arguments),fe=de[0],pe=0,ge=0;if(3===de.length){z=de[1];K=de[2];ne=fe.width;re=fe.height;ee=ne;te=re}else if(5===de.length){z=de[1];K=de[2];ee=de[3];te=de[4];ne=fe.width;re=fe.height}else{if(9!==de.length)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);pe=de[1];ge=de[2];ne=de[3];re=de[4];z=de[5];K=de[6];ee=de[7];te=de[8]}ie=this.__closestGroupOrSvg();this.__currentElement;var me="translate("+z+", "+K+")";if(fe instanceof ctx){se=fe.getSvg().cloneNode(true);if(se.childNodes&&se.childNodes.length>1){oe=se.childNodes[0];while(oe.childNodes.length){ue=oe.childNodes[0].getAttribute("id");this.__ids[ue]=ue;this.__defs.appendChild(oe.childNodes[0])}ae=se.childNodes[1];if(ae){var be=ae.getAttribute("transform");var ve;ve=be?be+" "+me:me;ae.setAttribute("transform",ve);ie.appendChild(ae)}}}else if("CANVAS"===fe.nodeName||"IMG"===fe.nodeName){le=this.__createElement("image");le.setAttribute("width",ee);le.setAttribute("height",te);le.setAttribute("preserveAspectRatio","none");if(pe||ge||ne!==fe.width||re!==fe.height){ce=this.__document.createElement("canvas");ce.width=ee;ce.height=te;he=ce.getContext("2d");he.drawImage(fe,pe,ge,ne,re,0,0,ee,te);fe=ce}le.setAttribute("transform",me);le.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===fe.nodeName?fe.toDataURL():fe.getAttribute("src"));ie.appendChild(le)}}createPattern(z,K){let ee=this.__document.__createElement("pattern");let te=randomString(this.__ids);let ne;ee.setAttribute("id",te);ee.setAttribute("width",z.width);ee.setAttribute("height",z.height);if("CANVAS"===z.nodeName||"IMG"===z.nodeName){ne=this.__createElement("image");ne.setAttribute("width",z.width);ne.setAttribute("height",z.height);ne.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===z.nodeName?z.toDataURL():z.getAttribute("src"));ee.appendChild(ne);this.__defs.appendChild(ee)}else if(z instanceof ctx){ee.appendChild(z.__root.childNodes[1]);this.__defs.appendChild(ee)}return new CanvasPattern(ee,this)}setLineDash(z){z&&z.length>0?this.lineDash=z.join(","):this.lineDash=null}drawFocusRing(){}createImageData(){}getImageData(){}putImageData(){}globalCompositeOperation(){}setTransform(){}}const Cytoband=function(z,K,ee,te){this.start=z;this.end=K;this.name=ee;this.stain=0;if("acen"===te)this.type="c";else{this.type=te.charAt(1);"p"===this.type&&(this.stain=parseInt(te.substring(4)))}};const Sa="2.15.11";function version(){return Sa}const Aa="https://igv.org/genomes/genomes.json";const Ta="https://s3.amazonaws.com/igv.org.genomes/genomes.json";const Ea=splitLines$5;const Ma={loadGenome:async function(z){const K=z.cytobandURL;const ee=z.aliasURL;const te=await loadFasta(z);let ne;ee&&(ne=await loadAliases(ee,te.config));const re=new Genome(z,te,ne);K&&(re.cytobands=await loadCytobands(K,te.config,re));return re},initializeGenomes:async function(z){if(!Ma.KNOWN_GENOMES){const K={};if(false!==z.loadDefaultGenomes)try{const te=Aa+`?randomSeed=${Math.random().toString(36)}&version=${version()}`;const ne=await Wo.loadJson(te,{timeout:5e3});processJson(ne)}catch(re){console.error(re);try{const ie=Ta+`?randomSeed=${Math.random().toString(36)}&version=${version()}`;const se=await Wo.loadJson(ie,{});processJson(se)}catch(oe){console.error(oe);console.warn("Errors loading default genome definitions.")}}const ee=z.genomeList||z.genomes;if(ee)if("string"===typeof ee){const ae=await Wo.loadJson(ee,{});processJson(ae)}else processJson(ee);Ma.KNOWN_GENOMES=K;function processJson(z){z.forEach((function(z){K[z.id]=z}));return K}}},isWholeGenomeView:function(z){return"all"===z.toLowerCase()},expandReference:function(z,K){if(isString$2(K)&&K.startsWith("{"))try{K=JSON.parse(K)}catch(z){}let ee;isString$2(K)?ee=K:K.genome?ee=K.genome:void 0!==K.id&&void 0===K.fastaURL&&(ee=K.id);if(ee){const K=Ma.KNOWN_GENOMES;const te=K[ee];te||z.present(new Error(`Unknown genome id: ${ee}`),void 0);return te}return K}};class Genome{constructor(z,K,ee){this.config=z;this.id=z.id||generateGenomeID(z);this.sequence=K;this.chromosomeNames=K.chromosomeNames;this.chromosomes=K.chromosomes;this.featureDB=new Map;this.wholeGenomeView=void 0===z.wholeGenomeView||z.wholeGenomeView;this.wholeGenomeView&&Object.keys(K.chromosomes).length>1?constructWG(this,z):this.wgChromosomeNames=K.chromosomeNames
/**
             * Return the official chromosome name for the (possibly) alias.  Deals with
             * 1 <-> chr1,  chrM <-> MT,  IV <-> chr4, etc.
             * @param str
             */;var te={},ne=this;te.all="all";this.chromosomeNames.forEach((function(z){var K=z.startsWith("chr")?z.substring(3):"chr"+z;te[K.toLowerCase()]=z;"chrM"===z&&(te.mt="chrM");"MT"===z&&(te.chrm="MT");te[z.toLowerCase()]=z}));ee&&ee.forEach((function(z){var K,ee;for(ee=0;ee<z.length;ee++)if(ne.chromosomes[z[ee]]){K=z[ee];break}K&&z.forEach((function(z){if(z!==K){te[z.toLowerCase()]=K;te[z]=K}}))}));this.chrAliasTable=te}showWholeGenomeView(){return false!==this.config.wholeGenomeView}toJSON(){return Object.assign({},this.config,{tracks:void 0})}getInitialLocus(){}getHomeChromosomeName(){return this.showWholeGenomeView()&&this.chromosomes.hasOwnProperty("all")?"all":this.chromosomeNames[0]}getChromosomeName(z){const K=z?this.chrAliasTable[z.toLowerCase()]:z;return K||z}getChromosome(z){z=this.getChromosomeName(z);return this.chromosomes[z]}getCytobands(z){return this.cytobands?this.cytobands[z]:null}getLongestChromosome(){var z,K=this.chromosomes;for(let te in K){if(K.hasOwnProperty(te)){var ee=K[te];(void 0===z||ee.bpLength>z.bpLength)&&(z=ee)}return z}}getChromosomes(){return this.chromosomes}getGenomeCoordinate(z,K){var ee=this.getCumulativeOffset(z);if(void 0!==ee)return ee+K}getChromosomeCoordinate(z){void 0===this.cumulativeOffsets&&(this.cumulativeOffsets=computeCumulativeOffsets.call(this));let K;let ee=0;for(let te of this.wgChromosomeNames){const ne=this.cumulativeOffsets[te];if(ne>z){const te=z-ee;return{chr:K,position:te}}K=te;ee=ne}return{chr:this.wgChromosomeNames[this.wgChromosomeNames.length-1],position:0}}getCumulativeOffset(z){void 0===this.cumulativeOffsets&&(this.cumulativeOffsets=computeCumulativeOffsets.call(this));const K=this.getChromosomeName(z);return this.cumulativeOffsets[K];function computeCumulativeOffsets(){let z=this;let K={};let ee=0;for(let te of z.wgChromosomeNames){K[te]=Math.floor(ee);const ne=z.getChromosome(te);ee+=ne.bpLength}return K}}getGenomeLength(){let z=this;if(!this.bpLength){let K=0;z.wgChromosomeNames.forEach((function(ee){let te=z.chromosomes[ee];K+=te.bpLength}));this.bpLength=K}return this.bpLength}async getSequence(z,K,ee){z=this.getChromosomeName(z);return this.sequence.getSequence(z,K,ee)}addFeaturesToDB(z,K){const insertFeature=(z,K)=>{const ee=this.featureDB.get(z);ee&&(K=K.end-K.start>ee.end-ee.start?K:ee);this.featureDB.set(z,K)};for(let ee of z){ee.name&&insertFeature(ee.name.toUpperCase(),ee);ee.gene&&ee.gene.name&&insertFeature(ee.gene.name.toUpperCase(),ee);if(K.searchableFields)for(let z of K.searchableFields){const K=ee.getAttributeValue(z);K&&(K.indexOf(" ")>0?insertFeature(K.replaceAll(" ","+").toUpperCase(),ee):insertFeature(K.toUpperCase(),ee))}}}}async function loadCytobands(z,K,ee){let te;if(isDataURL(z)){const K=decodeDataURI$1(z);te="";const ee=K.length;for(let z=0;z<ee;z++)te+=String.fromCharCode(K[z])}else te=await Wo.loadString(z,buildOptions(K));const ne={};let re;let ie=[];const se=Ea(te);for(let z of se){var oe=z.split("\t");var ae=ee.getChromosomeName(oe[0]);re||(re=ae);if(ae!==re){ne[re]=ie;ie=[];re=ae}if(5===oe.length){var le=parseInt(oe[1]);var ce=parseInt(oe[2]);var he=oe[3];var ue=oe[4];ie.push(new Cytoband(le,ce,he,ue))}}return ne}function loadAliases(z,K){return Wo.loadString(z,buildOptions(K)).then((function(z){var K=Ea(z),ee=[];K.forEach((function(z){!z.startsWith("#")&&z.length>0&&ee.push(z.split("\t"))}));return ee}))}function constructWG(z,K){let ee;if(K.chromosomeOrder){Array.isArray(K.chromosomeOrder)?z.wgChromosomeNames=K.chromosomeOrder:z.wgChromosomeNames=K.chromosomeOrder.split(",").map((z=>z.trim()));ee=z.wgChromosomeNames.map((K=>z.chromosomes[K])).filter((z=>void 0!==z))}else{const K=Object.keys(z.chromosomes).map((K=>z.chromosomes[K].bpLength));const te=K.reduce(((z,K)=>Math.max(z,K)));const ne=te/50;ee=Object.values(z.chromosomes).filter((z=>z.bpLength>ne));const re=ee.filter((z=>isDigit(z.name.replace("chr",""))));const ie=ee.filter((z=>!isDigit(z.name.replace("chr",""))));re.sort(((z,K)=>Number.parseInt(z.name.replace("chr",""))-Number.parseInt(K.name.replace("chr",""))));const se=re.map((z=>z.name));for(let z of ie)se.push(z.name);z.wgChromosomeNames=se}const te=ee.reduce(((z,K)=>z+K.bpLength),0);z.chromosomes.all={name:"all",bpLength:te};function isDigit(z){return/^\d+$/.test(z)}}function generateGenomeID(z){return void 0!==z.id?z.id:z.fastaURL&&isString$2(z.fastaURL)?z.fastaURL:z.fastaURL&&z.fastaURL.name?z.fastaURL.name:("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}const Ra="Error loading track data";let Ia=0;let Fa=0;let La;class TrackViewport extends Viewport{constructor(z,K,ee,te){super(z,K,ee,te)}initializationHelper(){this.$spinner=pt("<div>",{class:"igv-loading-spinner-container"});this.$viewport.append(this.$spinner);this.$spinner.append(pt("<div>"));const z=this.trackView.track;"sequence"!==z.type&&(this.$zoomInNotice=this.createZoomInNotice(this.$viewport));if(z.name&&"sequence"!==z.id){this.$trackLabel=pt('<div class="igv-track-label">');this.$viewport.append(this.$trackLabel);this.setTrackLabel(z.name);false===this.browser.trackLabelsVisible&&this.$trackLabel.hide()}this.stopSpinner();this.addMouseHandlers()}setContentHeight(z){super.setContentHeight(z);this.featureCache&&(this.featureCache.redraw=true)}setTrackLabel(z){this.$trackLabel.empty();this.$trackLabel.html(z);const K=this.$trackLabel.text();this.$trackLabel.attr("title",K)}startSpinner(){this.$spinner.show()}stopSpinner(){this.$spinner&&this.$spinner.hide()}
/**
         * Test to determine if we are zoomed in far enough to see features. Applicable to tracks with visibility windows.
         *
         * As a side effect the viewports canvas is removed if zoomed out.
         *
         * @returns {boolean} true if we are zoomed in past visibility window, false otherwise
         */checkZoomIn(){const zoomedOutOfWindow=()=>{if("all"!==this.referenceFrame.chr.toLowerCase()||this.trackView.track.supportsWholeGenome){const z=this.trackView.track.visibilityWindow;return void 0!==z&&z>0&&this.referenceFrame.bpPerPixel*this.$viewport.width()>z}return true};if(this.trackView.track&&"sequence"===this.trackView.track.type&&this.referenceFrame.bpPerPixel>ka){pt(this.canvas).remove();this.canvas=void 0;return false}if(!this.viewIsReady())return false;if(zoomedOutOfWindow()){if(this.canvas){pt(this.canvas).remove();this.canvas=void 0}if(this.trackView.track.autoHeight){const z=this.trackView.minHeight||0;this.setContentHeight(z)}this.$zoomInNotice&&this.$zoomInNotice.show();return false}this.$zoomInNotice&&this.$zoomInNotice.hide();return true}shift(){const z=this.referenceFrame;if(this.canvas&&this.canvas._data&&this.canvas._data.referenceFrame.chr===this.referenceFrame.chr&&this.canvas._data.bpPerPixel===z.bpPerPixel){const K=Math.round((this.canvas._data.bpStart-z.start)/z.bpPerPixel);this.canvas.style.left=K+"px"}}
/**
         * Set the content top of the current view.  This is triggered by scrolling.   If the current canvas extent is not
         * sufficient to cover the new vertical range repaint.
         *
         * @param contentTop - the "top" property of the virtual content div, 0 unless track is scrolled vertically
         *
         *
         */setTop(z){super.setTop(z);if(this.canvas){const K=this.$viewport.height();const ee=z+this.canvas._data.pixelTop;const te=ee+this.canvas._data.pixelHeight;(ee>0||te<K)&&this.repaint()}else this.repaint();let K=z+this.canvas._data.pixelTop;this.canvas.style.top=`${K}px`}async loadFeatures(){const z=this.referenceFrame;const K=z.chr;const ee=this.browser.genome.getChromosome(K).bpLength;const te=this.$viewport.width();const ne=te*z.bpPerPixel;const re=Math.floor(Math.max(0,z.start-ne));const ie=Math.ceil(Math.min(ee,z.start+ne+ne));if(!this.loading||this.loading.start!==re||this.loading.end!==ie){this.loading={start:re,end:ie};this.startSpinner();try{const ee=this.trackView.track;const te=await this.getFeatures(ee,K,re,ie,z.bpPerPixel);if(te){let ne=[];if(ee.roiSets&&ee.roiSets.length>0)for(let te of ee.roiSets){const ee=await te.getFeatures(K,re,ie,z.bpPerPixel);ne.push({track:te,features:ee})}const se=ee&&("wig"===ee.type||"merged"===ee.type);this.featureCache=new FeatureCache(K,re,ie,z.bpPerPixel,te,ne,se);this.loading=false;this.hideMessage();this.stopSpinner();return this.featureCache}}catch(z){if(this.trackView&&true!==this.trackView.disposed){this.showMessage(Ra);this.browser.alert.present(z);console.error(z)}}finally{this.loading=false;this.stopSpinner()}}}
/**
         * Compute the genomic extent and needed pixelWidth to repaint the canvas for the current genomic state.
         * Normally the canvas is size 3X the width of the viewport, however there is no left-right panning for WGV so
         * canvas width is viewport width.
         * @returns {{bpEnd: *, pixelWidth: (*|number), bpStart: number}}
         */repaintDimensions(){const z=Ma.isWholeGenomeView(this.referenceFrame.chr);const K=z?this.$viewport.width():3*this.$viewport.width();const ee=this.referenceFrame.bpPerPixel;const te=this.referenceFrame.start-(z?0:K/3*ee);const ne=this.referenceFrame.end+(z?0:K/3*ee);return{bpStart:te,bpEnd:ne,pixelWidth:K}}repaint(){if(void 0===this.featureCache)return;const{features:z,roiFeatures:K}=this.featureCache;const{bpStart:ee,bpEnd:te,pixelWidth:ne}=this.repaintDimensions();const re=this.$viewport.height();const ie=this.getContentHeight();const se=K?Math.max(ie,re):ie;const oe=Math.min(se,3*re);if(0===ne||0===oe){this.canvas&&pt(this.canvas).remove();return}const ae=Math.max(0,-this.contentTop-Math.floor(oe/3));const le=this.referenceFrame.bpPerPixel;const ce=Math.round((ee-this.referenceFrame.start)/le);const he=(this.contentTop||0)+ae;const ue=document.createElement("canvas");ue.style.position="relative";ue.style.display="block";ue.style.width=ne+"px";ue.style.height=oe+"px";ue.style.left=ce+"px";ue.style.top=he+"px";const de="FILL"===this.trackView.track.displayMode||false!==this.trackView.track.supportHiDPI?window.devicePixelRatio:1;ue.width=de*ne;ue.height=de*oe;const fe=ue.getContext("2d");fe.scale(de,de);fe.translate(0,-ae);const pe={context:fe,pixelXOffset:ce,pixelWidth:ne,pixelHeight:oe,pixelTop:ae,bpStart:ee,bpEnd:te,bpPerPixel:le,referenceFrame:this.referenceFrame,selection:this.selection,viewport:this,viewportWidth:this.$viewport.width()};this.draw(pe,z,K);this.canvas&&pt(this.canvas).remove();ue._data=pe;this.canvas=ue;this.$viewport.append(pt(ue))}refresh(){if(!(this.canvas&&this.featureCache))return;const z=this.canvas._data;z.context.clearRect(0,0,this.canvas.width,this.canvas.height);const{features:K,roiFeatures:ee}=this.featureCache;this.draw(z,K,ee)}
/**
         * Draw the associated track.
         *
         * @param drawConfiguration
         * @param features
         * @param roiFeatures
         */draw(z,K,ee){if(K){z.features=K;this.trackView.track.draw(z)}if(ee&&ee.length>0)for(let K of ee){z.features=K.features;K.track.draw(z)}}containsPosition(z,K){return this.referenceFrame.chr===z&&K>=this.referenceFrame.start&&K<=this.referenceFrame.calculateEnd(this.getWidth())}isLoading(){return this.loading}savePNG(){if(!this.canvas)return;const z=this.canvas._data;const K=z?z.pixelTop:0;const ee=window.devicePixelRatio;const te=this.$viewport.width()*ee;const ne=this.$viewport.height()*ee;const re=-pt(this.canvas).position().left*ee;const ie=(-this.contentTop-K)*ee;const se=this.canvas.getContext("2d");const oe=se.getImageData(re,ie,te,ne);const ae=document.createElement("canvas");const le=ae.getContext("2d");ae.width=oe.width;ae.height=oe.height;le.putImageData(oe,0,0);const ce=(this.$trackLabel.text()?this.$trackLabel.text():"image")+".png";const he=ae.toDataURL("image/png");download(ce,he)}saveSVG(){const z=32;const K=32;let{width:ee,height:te}=this.browser.columnContainer.getBoundingClientRect();const ne=8e3;const re={width:ee,height:ne,backdropColor:"white",multiLocusGap:0,viewbox:{x:0,y:0,width:ee,height:ne}};const ie=new ctx(re);const se={deltaX:K,deltaY:z};this.renderViewportToSVG(ie,se);ie.setHeight(te);const oe=(this.trackView.track.name||this.trackView.track.id).replace(/\W/g,"");const ae=this.browser.referenceFrameList.indexOf(this.referenceFrame);const le=ie.getSerializedSvg(true);const ce=URL.createObjectURL(new Blob([le],{type:"application/octet-stream"}));const he=`${oe}_referenceFrame_${ae}_guid_${gt.guid()}`;download(`${he}.svg`,ce)}renderViewportToSVG(z,{deltaX:K,deltaY:ee}){if(this.$zoomInNotice&&this.$zoomInNotice.is(":visible"))return;const{width:te,height:ne}=this.$viewport.get(0).getBoundingClientRect();const re=(this.trackView.track.name||this.trackView.track.id).replace(/\W/g,"");const ie=this.browser.referenceFrameList.indexOf(this.referenceFrame);const se=`${re}_referenceFrame_${ie}_guid_${gt.guid()}`;this.drawSVGWithContext(z,te,ne,se,K,ee+this.contentTop,-this.contentTop)}renderSVGContext(z,{deltaX:K,deltaY:ee}){this.renderViewportToSVG(z,{deltaX:K,deltaY:ee});if((!this.$zoomInNotice||!this.$zoomInNotice.is(":visible"))&&this.$trackLabel&&true===this.browser.trackLabelsVisible){const{x:te,y:ne,width:re,height:ie}=gt.relativeDOMBBox(this.$viewport.get(0),this.$trackLabel.get(0));this.renderTrackLabelSVG(z,K+te,ee+ne,re,ie)}}renderTrackLabelSVG(z,K,ee,te,ne){const re=(this.trackView.track.name||this.trackView.track.id).replace(/\W/g,"");const ie=`${re}_track_label_guid_${gt.guid()}`;z.saveWithTranslationAndClipRect(ie,K,ee,te,ne,0);z.fillStyle="white";z.fillRect(0,0,te,ne);z.font="12px Arial";z.fillStyle="rgb(68, 68, 68)";const{width:se}=z.measureText(this.$trackLabel.text());const oe=.25*(te-se);const ae=.7*(ne-12);z.fillText(this.$trackLabel.text(),oe,ne-ae);z.strokeStyle="rgb(68, 68, 68)";z.strokeRect(0,0,te,ne);z.restore()}drawSVGWithContext(z,K,ee,te,ne,re,ie){z.saveWithTranslationAndClipRect(te,ne,re,K,ee,ie);let{start:se,bpPerPixel:oe}=this.referenceFrame;const ae={context:z,viewport:this,referenceFrame:this.referenceFrame,top:ie,pixelTop:ie,pixelWidth:K,pixelHeight:ee,bpStart:se,bpEnd:se+K*oe,bpPerPixel:oe,viewportWidth:K,selection:this.selection};const le=this.featureCache?this.featureCache.features:void 0;const ce=this.featureCache?this.featureCache.roiFeatures:void 0;this.draw(ae,le,ce);z.restore()}get cachedFeatures(){return this.featureCache?this.featureCache.features:[]}clearCache(){this.featureCache=void 0;this.canvas&&(this.canvas._data=void 0)}async getFeatures(z,K,ee,te,ne){if(this.featureCache&&this.featureCache.containsRange(K,ee,te,ne))return this.featureCache.features;if("function"===typeof z.getFeatures){const re=await z.getFeatures(K,ee,te,ne,this);this.checkContentHeight(re);return re}}needsRepaint(){if(!this.canvas)return true;const z=this.canvas._data;return!z||this.referenceFrame.start<z.bpStart||this.referenceFrame.end>z.bpEnd||this.referenceFrame.chr!==z.referenceFrame.chr||this.referenceFrame.bpPerPixel!=z.bpPerPixel}needsReload(){if(!this.featureCache)return true;const{chr:z,bpPerPixel:K}=this.referenceFrame;const{bpStart:ee,bpEnd:te}=this.repaintDimensions();return!this.featureCache.containsRange(z,ee,te,K)}createZoomInNotice(z){const K=pt("<div>",{class:"igv-zoom-in-notice-container"});z.append(K);const ee=pt("<div>");K.append(ee);ee.text("Zoom in to see features");K.hide();return K}viewIsReady(){return this.browser&&this.browser.referenceFrameList&&this.referenceFrame}addMouseHandlers(){const z=this.$viewport.get(0);this.addViewportContextMenuHandler(z);const md=z=>{this.enableClick=true;this.browser.mouseDownOnViewport(z,this);gt.pageCoordinates(z)};z.addEventListener("mousedown",md);z.addEventListener("touchstart",md);const mu=z=>{if(this.browser.dragObject||this.browser.isScrolling){this.browser.cancelTrackPan();this.enableClick=false}else{this.browser.cancelTrackPan();this.browser.endTrackDrag()}};z.addEventListener("mouseup",mu);z.addEventListener("touchend",mu);"function"===typeof this.trackView.track.hoverText&&z.addEventListener("mousemove",(z=>{if(0===z.buttons&&Date.now()-Fa>100){Fa=Date.now();const K=this.createClickState(z);if(K){const z=this.trackView.track.hoverText(K);z?this.$viewport[0].setAttribute("title",z):this.$viewport[0].removeAttribute("title")}}}));this.addViewportClickHandler(this.$viewport.get(0));this.trackView.track.name&&"sequence"!==this.trackView.track.config.type&&this.addTrackLabelClickHandler(this.$trackLabel.get(0))}addViewportContextMenuHandler(z){z.addEventListener("contextmenu",(z=>{if(this.browser.dragObject)return false;const K=this.createClickState(z);if(void 0===K)return false;z.preventDefault();let ee=[];if("function"===typeof this.trackView.track.contextMenuItemList){const z=this.trackView.track.contextMenuItemList(K);z&&(ee=z)}ee.length>0&&ee.push({label:pt("<HR>")});ee.push({label:"Save Image (PNG)",click:()=>this.savePNG()});ee.push({label:"Save Image (SVG)",click:()=>this.saveSVG()});this.browser.menuPopup.presentTrackContextMenu(z,ee)}))}addViewportClickHandler(z){z.addEventListener("click",(z=>{if(this.enableClick&&this.canvas){if(3===z.which||z.ctrlKey)return;pt(".igv-popover").hide();if(this.browser.dragObject||this.browser.isScrolling)return;z.preventDefault();const K=gt.translateMouseCoordinates(z,this.$viewport.get(0)).x;const ee=gt.translateMouseCoordinates(z,this.canvas).x;const te=this.referenceFrame;const ne=Math.floor(te.start+te.toBP(ee));const re=Date.now();if(re-Ia<this.browser.constants.doubleClickDelay){if(La){window.clearTimeout(La);La=void 0}const z=Math.round(te.start+te.toBP(K));let ee;if("all"===this.referenceFrame.chr.toLowerCase()){const K=this.browser.genome.getChromosomeCoordinate(z).chr;if(1===this.browser.referenceFrameList.length)ee=K;else{const z=this.browser.referenceFrameList.map((({locusSearchString:z})=>z));const te=this.browser.referenceFrameList.indexOf(this.referenceFrame);z[te]=K;ee=z.join(" ")}this.browser.search(ee)}else this.browser.zoomWithScaleFactor(.5,z,this.referenceFrame)}else z.shiftKey&&"function"===typeof this.trackView.track.shiftClick?this.trackView.track.shiftClick(ne,z):"function"===typeof this.trackView.track.popupData&&(La=setTimeout((()=>{const K=this.getPopupContent(z);if(K){this.popover&&this.popover.dispose();this.popover=new Popover(this.browser.columnContainer);this.popover.presentContentWithEvent(z,K)}window.clearTimeout(La);La=void 0}),this.browser.constants.doubleClickDelay));Ia=re}}))}addTrackLabelClickHandler(z){z.addEventListener("click",(z=>{z.stopPropagation();const{track:K}=this.trackView;let ee;"function"===typeof K.description?ee=K.description():K.description&&(ee=`<div>${K.description}</div>`);if(ee){this.popover&&this.popover.dispose();this.popover=new Popover(this.browser.columnContainer,K.name||"");this.popover.presentContentWithEvent(z,ee)}}))}createClickState(z){if(!this.canvas)return;const K=this.referenceFrame;const ee=gt.translateMouseCoordinates(z,this.$viewport.get(0));const te=gt.translateMouseCoordinates(z,this.canvas);const ne=K.start+K.toBP(ee.x);return{event:z,viewport:this,referenceFrame:K,genomicLocation:ne,y:ee.y-this.contentTop,canvasX:te.x,canvasY:te.y}}getPopupContent(z){const K=this.createClickState(z);if(void 0===K)return;let ee=this.trackView.track;const te=ee.popupData(K);const ne=this.browser.fireEvent("trackclick",[ee,te]);let re;void 0===ne||true===ne?te&&te.length>0&&(re=formatPopoverText(te)):"string"===typeof ne&&(re=ne);return re}}function formatPopoverText(z){const K=z.map((z=>{if(z.name){const K=`<span>${z.name}</span>&nbsp&nbsp&nbsp${z.value}`;return`<div title="${z.value}">${K}</div>`}return"<hr>"===z?z:z.html?z.html:`<div title="${z}">${z}</div>`}));return K.join("")}class FeatureCache{constructor(z,K,ee,te,ne,re,ie){this.chr=z;this.bpStart=K;this.bpEnd=ee;this.bpPerPixel=te;this.features=ne;this.roiFeatures=re;this.multiresolution=ie}containsRange(z,K,ee,te){const ne=this.multiresolution?this.bpPerPixel/te:1;return K>=this.bpStart&&ee<=this.bpEnd&&z===this.chr&&ne>.5&&ne<2}overlapsRange(z,K,ee){return this.chr===z&&ee>=this.bpStart&&K<=this.bpEnd}}
/**
     * Decode UCSC "interact" files.  See https://genome.ucsc.edu/goldenpath/help/interact.html
     *
     0  string chrom;        "Chromosome (or contig, scaffold, etc.). For interchromosomal, use 2 records"
     1  uint chromStart;     "Start position of lower region. For interchromosomal, set to chromStart of this region"
     2  uint chromEnd;       "End position of upper region. For interchromosomal, set to chromEnd of this region"
     3  string name;         "Name of item, for display.  Usually 'sourceName/targetName/exp' or empty"
     4  uint score;          "Score (0-1000)"
     5  double value;        "Strength of interaction or other data value. Typically basis for score"
     6  string exp;          "Experiment name (metadata for filtering). Use . if not applicable"
     7  string color;        "Item color.  Specified as r,g,b or hexadecimal #RRGGBB or html color name, as in //www.w3.org/TR/css3-color/#html4. Use 0 and spectrum setting to shade by score"
     8  string sourceChrom;  "Chromosome of source region (directional) or lower region. For non-directional interchromosomal, chrom of this region."
     9  uint sourceStart;    "Start position in chromosome of source/lower/this region"
     10 uint sourceEnd;      "End position in chromosome of source/lower/this region"
     11 string sourceName;   "Identifier of source/lower/this region"
     12 string sourceStrand; "Orientation of source/lower/this region: + or -.  Use . if not applicable"
     13 string targetChrom;  "Chromosome of target region (directional) or upper region. For non-directional interchromosomal, chrom of other region"
     14 uint targetStart;    "Start position in chromosome of target/upper/this region"
     15 uint targetEnd;      "End position in chromosome of target/upper/this region"
     16 string targetName;   "Identifier of target/upper/this region"
     17 string targetStrand; "Orientation of target/upper/this region: + or -.  Use . if not applicable"
     *
     * @param tokens
     * @param ignore
     * @returns {*}
     */function decodeInteract(z,K){if(!(z.length<6)){var ee={chr:z[0],start:z[1],end:z[2],chr1:z[8],start1:Number.parseInt(z[9]),end1:Number.parseInt(z[10]),chr2:z[13],start2:Number.parseInt(z[14]),end2:Number.parseInt(z[15]),name:z[3],score:Number(z[4]),value:Number(z[5]),color:"."===z[7]?void 0:"0"===z[7]?"rgb(0,0,0)":z[7]};return ee}console.log("Skipping line: "+z.join(" "))}const Ba=new Set(["transcript","primary_transcript","processed_transcript","mRNA","mrna","lnc_RNA","miRNA","ncRNA","rRNA","scRNA","snRNA","snoRNA","tRNA"]);const Na=new Set(["CDS","cds"]);const Da=new Set(["start_codon","stop_codon"]);const Pa=new Set(["5UTR","3UTR","UTR","five_prime_UTR","three_prime_UTR","3'-UTR","5'-UTR"]);const Oa=new Set(["exon","coding-exon"]);const za=new Set;for(let Bp of[Na,Da,Pa,Oa])for(let Np of Bp)za.add(Np);function isExon(z){return Oa.has(z)}function isIntron(z){return z.includes("intron")}function isCoding(z){return Na.has(z)||Da.has(z)}function isUTR(z){return Pa.has(z)}function isTranscript(z){return Ba.has(z)||z.endsWith("RNA")||z.endsWith("transcript")}function isTranscriptPart(z){return za.has(z)||z.endsWith("RNA")||isIntron(z)}const Ha=new Set(["id","parent","name"]);class GFFFeature{constructor(z){Object.assign(this,z)}popupData(z){const K=this.geneObject?this.geneObject.popupData():[];this.geneObject&&K.push("<hr/>");this.name&&K.push({name:"Name",value:this.name});K.push({name:"Type",value:this.type});K.push({name:"Source",value:this.source});void 0!==this.score&&K.push({name:"Score",value:this.score});if(this.attributeString){const z=parseAttributeString(this.attributeString,this.delim);for(let[ee,te]of z)void 0!==te&&te.length>0&&!Ha.has(ee.toLowerCase())&&K.push({name:ee+":",value:te})}K.push({name:"Location",value:`${this.chr}:${numberFormatter$1(this.start+1)}-${numberFormatter$1(this.end)}`});return K}getAttributeValue(z){if(this.hasOwnProperty(z))return this[z];this._attributeCache||(this._attributeCache=new Map);if(this._attributeCache.has(z))return this._attributeCache.get(z);{const K=parseAttributeString(this.attributeString,this.delim);let ee;for(let[te,ne]of K)if(te===z){ee=ne;break}this._attributeCache.set(z,ee);return ee}}}class GFFTranscript extends GFFFeature{constructor(z){super(z);this.exons=[];this.parts=[]}addExon(z){this.exons.push(z);this.start=Math.min(this.start,z.start);this.end=Math.max(this.end,z.end)}addPart(z){this.parts.push(z)}assembleParts(){if(0===this.parts.length)return;this.parts.sort((function(z,K){return z.start-K.start}));let z=this.parts[0].start;let K=this.parts[0].end;for(let ee=1;ee<this.parts.length;ee++){const te=this.parts[ee];if(!isIntron(te.type))if(te.start<=K)K=Math.max(K,te.end);else{let ee=this.findExonContaining({start:z,end:K});ee||this.exons.push({start:z,end:K,psuedo:true});z=te.start;K=te.end}}let ee=this.findExonContaining({start:z,end:K});if(!ee){this.exons.push({start:z,end:K,psuedo:true});this.start=Math.min(this.start,z);this.end=Math.max(this.end,K)}for(let z of this.parts){const K=z.type;isCoding(K)?this.addCDS(z):isUTR(K)&&this.addUTR(z)}}findExonContaining({start:z,end:K}){for(let ee of this.exons)if(ee.end>=K&&ee.start<=z)return ee}addCDS(z){let K;const ee=this.exons;for(let te of ee)if(te.start<=z.start&&te.end>=z.end){K=te;break}if(K){K.cdStart=K.cdStart?Math.min(z.start,K.cdStart):z.start;K.cdEnd=K.cdEnd?Math.max(z.end,K.cdEnd):z.end}else console.error("No exon found spanning "+z.start+"-"+z.end);this.cdStart=this.cdStart?Math.min(z.start,this.cdStart):z.start;this.cdEnd=this.cdEnd?Math.max(z.end,this.cdEnd):z.end}addUTR(z){let K;const ee=this.exons;for(let te=0;te<ee.length;te++)if(ee[te].start<=z.start&&ee[te].end>=z.end){K=ee[te];break}if(K)if(z.start===K.start&&z.end===K.end)K.utr=true;else{z.end<K.end&&(K.cdStart=z.end);z.start>K.start&&(K.cdEnd=z.start)}else console.error("No exon found spanning "+cds.start+"-"+cds.end)}finish(){this.assembleParts();var z=this.cdStart;var K=this.cdEnd;this.exons.sort((function(z,K){return z.start-K.start}));z&&this.exons.forEach((function(ee){(ee.end<z||ee.start>K)&&(ee.utr=true)}))}popupData(z){const K=super.popupData(z);for(let ee of this.exons)if(!ee.pseudo&&z>=ee.start&&z<ee.end&&"function"===typeof ee.popupData){K.push("<hr/>");const te=ee.popupData(z);for(let z of te)K.push(z)}for(let ee of this.parts)if(z>=ee.start&&z<ee.end&&"function"===typeof ee.popupData){K.push("<hr/>");const te=ee.popupData(z);for(let z of te)K.push(z)}return K}}function decode(z,K){const ee=K.format;if(z.length<9)return;const te="gff3"===ee?"=":" ";return new GFFFeature({source:decodeGFFAttribute(z[1]),type:z[2],chr:z[0],start:parseInt(z[3])-1,end:parseInt(z[4]),score:"."===z[5]?void 0:Number(z[5]),strand:z[6],phase:"."===z[7]?0:parseInt(z[7]),attributeString:z[8],delim:te})}
/**
     * Decode a single gff record (1 line in file).  Aggregations such as gene models are constructed at a higher level.
     *      ctg123 . mRNA            1050  9000  .  +  .  ID=mRNA00001;Parent=gene00001
     * @param tokens
     * @param ignore
     * @returns {*}
     */function decodeGFF3(z,K){const ee=decode(z,K);if(!ee)return;const te=parseAttributeString(ee.attributeString,ee.delim);for(let[z,K]of te){const te=z.toLowerCase();"color"===te||"colour"===te?ee.color=$o.createColorString(K):"ID"===z?ee.id=K:"Parent"===z&&(ee.parent=K)}return ee}
/**
     * GTF format example:
     NC_000008.11    BestRefSeq    gene    127735434    127742951    .    +    .    gene_id "MYC"; transcript_id ""; db_xref "GeneID:4609"; db_xref "HGNC:HGNC:7553"; db_xref "MIM:190080"; description "MYC proto-oncogene, bHLH transcription factor"; gbkey "Gene"; gene "MYC"; gene_biotype "protein_coding"; gene_synonym "bHLHe39"; gene_synonym "c-Myc"; gene_synonym "MRTL"; gene_synonym "MYCC";
     NC_000008.11    BestRefSeq    transcript    127735434    127742951    .    +    .    gene_id "MYC"; transcript_id "NM_001354870.1"; db_xref "GeneID:4609"; gbkey "mRNA"; gene "MYC"; product "MYC proto-oncogene, bHLH transcription factor, transcript variant 2"; transcript_biotype "mRNA";
     NC_000008.11    BestRefSeq    exon    127735434    127736623    .    +    .    gene_id "MYC"; transcript_id "NM_001354870.1"; db_xref "GeneID:4609"; gene "MYC"; product "MYC proto-oncogene, bHLH transcription factor, transcript variant 2"; transcript_biotype "mRNA"; exon_number "1";
     *
     * @param tokens
     * @param ignore
     * @returns {*}
     */function decodeGTF(z,K){const ee=decode(z,K);if(!ee)return;const te=parseAttributeString(ee.attributeString,ee.delim);let ne;let re;switch(ee.type){case"gene":ne="gene_id";break;case"transcript":ne="transcript_id";re="gene_id";break;default:re="transcript_id"}for(let[z,K]of te){const te=z.toLowerCase();"color"===te||"colour"===te?ee.color=$o.createColorString(K):z===ne?ee.id=K:z===re&&(ee.parent=K)}return ee}
/**
     * Parse the attribute string, returning an array of key-value pairs.  An array is used rather than a map as attribute
     * keys are not required to be unique.
     *
     * @param attributeString
     * @param keyValueDelim
     * @returns {[]}
     */function parseAttributeString(z,K,ee=false){var te=[];for(let ne of z.split(";")){ne=ne.trim();const z=ne.indexOf(K);if(z>0&&z<ne.length-1){const K=stripQuotes(decodeGFFAttribute(ne.substring(0,z).trim(),ee));let re=stripQuotes(decodeGFFAttribute(ne.substring(z+1).trim(),ee));te.push([K,re])}}return te}function stripQuotes(z){z.startsWith('"')&&z.endsWith('"')&&(z=z.substr(1,z.length-2));return z}const Ua=new Map([["%09","\t"],["%0A","\n"],["%0D","\r"],["%25","%"],["%3B",";"],["%3D","="],["%26","&"],["%2C",","]]);function decodeGFFAttribute(z,K=false){if(!z.includes("%"))return z;if(K)return decodeURIComponent(z);let ee="";for(let K=0;K<z.length;K++)if(37===z.charCodeAt(K)&&K<z.length-2){const te=z.substring(K,K+3);Ua.has(te)?ee+=Ua.get(te):ee+=te;K+=2}else ee+=z.charAt(K);return ee}class DecodeError{constructor(z){this.message=z}}
/**
     * Decode the UCSC bed format.  Only the first 3 columns (chr, start, end) are required.   The remaining columns
     * must follow standard bed order, but we will tolerate deviations after column 3.
     *
     * @param tokens
     * @param ignore
     * @returns decoded feature, or null if this is not a valid record
     */function decodeBed(z,K){if(z.length<3)return;K&&K.gffTags;const ee=z[0];const te=parseInt(z[1]);const ne=z.length>2?parseInt(z[2]):te+1;if(isNaN(te)||isNaN(ne))return new DecodeError("Unparsable bed record.");const re=new UCSCBedFeature({chr:ee,start:te,end:ne,score:1e3});try{if(z.length>3){if(z[3].indexOf(";")>0&&z[3].indexOf("=")>0){const ee=parseAttributeString(z[3],"=",true);re.attributes={};for(let z of ee){re.attributes[z[0]]=z[1];void 0!=K.nameField&&z[0]===K.nameField&&(re.name=z[1])}}re.name||(re.name="."===z[3]?"":z[3])}if(z.length>4){re.score="."===z[4]?0:Number(z[4]);if(isNaN(re.score))return re}if(z.length>5){re.strand=z[5];if(!("."===re.strand||"+"===re.strand||"-"===re.strand))return re}if(z.length>6){re.cdStart=parseInt(z[6]);if(isNaN(re.cdStart))return re}if(z.length>7){re.cdEnd=parseInt(z[7]);if(isNaN(re.cdEnd))return re}z.length>8&&"."!==z[8]&&"0"!==z[8]&&(re.color=$o.createColorString(z[8]));if(z.length>11){const K=parseInt(z[9]);if(K>1e3)return re;const ee=z[10].replace(/,$/,"").split(",");const ne=z[11].replace(/,$/,"").split(",");if(!(ee.length===ne.length&&K===ee.length))return re;const ie=[];for(let z=0;z<K;z++){const K=te+parseInt(ne[z]);const re=K+parseInt(ee[z]);ie.push({start:K,end:re})}if(ie.length>0){findUTRs$1(ie,re.cdStart,re.cdEnd);re.exons=ie}}if(K){let ee=K.thicknessColumn;let te=K.colorColumn;te&&te<z.length&&(re.color=$o.createColorString(z[te]));ee&&ee<z.length&&(re.thickness=z[ee])}}catch(z){}return re}function decodeRepeatMasker(z,K){if(z.length<=15)return;const ee={swScore:Number.parseInt(z[1]),milliDiv:Number.parseInt(z[2]),milliDel:Number.parseInt(z[3]),milliIns:Number.parseInt(z[4]),chr:z[5],start:Number.parseInt(z[6]),end:Number.parseInt(z[7]),strand:z[9],repName:z[10],repClass:z[11],repFamily:z[12],repStart:Number.parseInt(z[13]),repEnd:Number.parseInt(z[14]),repLeft:Number.parseInt(z[15])};return ee}
/**
     * Decode a UCSC "genePred" record.
     *
     * @param tokens
     * @param ignore
     * @returns {*}
     */function decodeGenePred(z,K){var ee=void 0===K.shift?0:1;if(z.length<=9+ee)return;const te=parseInt(z[5+ee]);const ne=parseInt(z[6+ee]);var re={name:z[0+ee],chr:z[1+ee],strand:z[2+ee],start:parseInt(z[3+ee]),end:parseInt(z[4+ee]),cdStart:te,cdEnd:ne,id:z[0+ee]};const ie=decodeExons(parseInt(z[7+ee]),z[8+ee],z[9+ee]);findUTRs$1(ie,te,ne);re.exons=ie;return re}
/**
     * Decode a UCSC "genePredExt" record.  refGene files are in this format.
     *
     * @param tokens
     * @param ignore
     * @returns {*}
     */function decodeGenePredExt(z,K){var ee=void 0===K.shift?0:1;if(z.length<=11+ee)return;const te=parseInt(z[5+ee]);const ne=parseInt(z[6+ee]);const re={name:z[11+ee],chr:z[1+ee],strand:z[2+ee],start:parseInt(z[3+ee]),end:parseInt(z[4+ee]),cdStart:te,cdEnd:ne,id:z[0+ee]};const ie=decodeExons(parseInt(z[7+ee]),z[8+ee],z[9+ee]);findUTRs$1(ie,te,ne);re.exons=ie;return re}
/**
     * Decode a UCSC "refFlat" record
     * @param tokens
     * @param ignore
     * @returns {*}
     */function decodeReflat(z,K){var ee=void 0===K.shift?0:1;if(z.length<=10+ee)return;const te=parseInt(z[6+ee]);const ne=parseInt(z[7+ee]);var re={name:z[0+ee],id:z[1+ee],chr:z[2+ee],strand:z[3+ee],start:parseInt(z[4+ee]),end:parseInt(z[5+ee]),cdStart:te,cdEnd:ne};const ie=decodeExons(parseInt(z[8+ee]),z[9+ee],z[10+ee]);findUTRs$1(ie,te,ne);re.exons=ie;return re}
/**
     * Decode a UCS PSL record *
     * @param tokens
     * @param header
     * @returns {DecodeError|UCSCBedFeature|undefined}
     */function decodePSL(z,K){if(z.length<21)return;const ee=z[13];const te=parseInt(z[15]);const ne=parseInt(z[16]);const re=z[8].charAt(0);const ie=parseInt(z[17]);const se=[];const oe=z[20].replace(/,$/,"").split(",");const ae=z[18].replace(/,$/,"").split(",");for(let z=0;z<ie;z++){const K=parseInt(oe[z]);const ee=K+parseInt(ae[z]);se.push({start:K,end:ee})}return new PSLFeature({chr:ee,start:te,end:ne,strand:re,exons:se,tokens:z})}function decodeExons(z,K,ee){const te=parseInt(z);const ne=K.replace(/,$/,"").split(",");const re=ee.replace(/,$/,"").split(",");const ie=[];for(let z=0;z<te;z++){const K=parseInt(ne[z]);const ee=parseInt(re[z]);ie.push({start:K,end:ee})}return ie}function findUTRs$1(z,K,ee){for(let te of z){const z=te.end;const ne=te.start;if(z<K||ne>ee)te.utr=true;else{K>=ne&&K<=z&&(te.cdStart=K);ee>=ne&&ee<=z&&(te.cdEnd=ee)}}}function decodePeak(z,K){var ee,te,ne,re,ie,se,oe,ae,le,ce;ee=z.length;if(!(ee<9)){te=z[0];ne=parseInt(z[1]);re=parseInt(z[2]);se=z[3];oe=Number(z[4]);ie=z[5].trim();le=Number(z[6]);ce=Number(z[7]);ae=Number(z[8]);0===oe&&(oe=le);return{chr:te,start:ne,end:re,name:se,score:oe,strand:ie,signal:le,pValue:ce,qValue:ae}}}function decodeBedGraph(z,K){var ee,te,ne,re;if(z.length<=3)return;ee=z[0];te=parseInt(z[1]);ne=parseInt(z[2]);re=Number(z[3]);const ie={chr:ee,start:te,end:ne,value:re};if(K){let ee=K.colorColumn;ee&&ee<z.length&&(ie.color=$o.createColorString(z[ee]))}return ie}function decodeWig(z,K){const ee=K.wig;if(ee&&"fixedStep"===ee.format){const K=ee.index*ee.step+ee.start;const te=K+ee.span;const ne=Number(z[0]);++ee.index;return isNaN(ne)?null:{chr:ee.chrom,start:K,end:te,value:ne}}if(ee&&"variableStep"===ee.format){if(z.length<2)return null;const K=parseInt(z[0],10)-1;const te=K+ee.span;const ne=Number(z[1]);return isNaN(ne)?null:{chr:ee.chrom,start:K,end:te,value:ne}}return decodeBedGraph(z)}function decodeSNP(z,K){if(z.length<6)return;const ee=["bin","chr","start","end","name","score","strand","refNCBI","refUCSC","observed","molType","class","valid","avHet","avHetSE","func","locType","weight","exceptions","submitterCount","submitters","alleleFreqCount","alleles","alleleNs","alleleFreqs","bitfields"];const te={chr:z[1],start:Number.parseInt(z[2]),end:Number.parseInt(z[3]),name:z[4],score:Number.parseInt(z[5])};const ne=Math.min(z.length,ee.length);for(let K=6;K<ne;K++)te[ee[K]]=z[K];return te}class UCSCBedFeature{constructor(z){Object.assign(this,z)}getAttributeValue(z){return this.hasOwnProperty(z)?this[z]:this.attributes?this.attributes[z]:void 0}}class PSLFeature{constructor(z){Object.assign(this,z)}get score(){const z=this.tokens;const K=parseInt(z[0]);const ee=parseInt(z[2]);const te=parseInt(z[1]);const ne=parseInt(z[4]);const re=parseInt(z[6]);const ie=parseInt(z[10]);return Math.floor(1e3*(K+ee-te-ne-re)/ie)}get matches(){return this.tokens[0]}get misMatches(){return this.tokens[1]}get repMatches(){return this.tokens[2]}get nCount(){return this.tokens[3]}get qNumInsert(){return this.tokens[4]}get qBaseInsert(){return this.tokens[5]}get tNumInsert(){return this.tokens[6]}get tBaseInsert(){return this.tokens[7]}popupData(){return[{name:"chr",value:this.chr},{name:"start",value:this.start+1},{name:"end",value:this.end},{name:"strand",value:this.strand},{name:"score",value:this.score},{name:"match",value:this.matches},{name:"mis-match",value:this.misMatches},{name:"rep. match",value:this.repMatches},{name:"N's",value:this.nCount},{name:"Q gap count",value:this.qNumInsert},{name:"Q gap bases",value:this.qBaseInsert},{name:"T gap count",value:this.tNumInsert},{name:"T gap bases",value:this.tBaseInsert}]}}function decodeFusionJuncSpan(z,K){if(!(z.length<7)){var ee=z[0];var te=z[1];var ne=parseInt(z[2]);var re=parseInt(z[3]);var ie=parseInt(z[4]);var se=parseInt(z[5]);var oe=z[6];var ae={chr:ee,name:te,junction_left:ne,junction_right:re,num_junction_reads:ie,num_spanning_frags:se,spanning_frag_coords:[],start:-1,end:-1};var le=ne;var ce=re;if(se>0){var he=oe.split(",");for(var ue=0;ue<he.length;ue++){var de=he[ue].split("-");var fe=de[0];var pe=de[1];fe<le&&(le=fe);pe>ce&&(ce=pe);ae.spanning_frag_coords.push({left:fe,right:pe})}}ae.start=le;ae.end=ce;return ae}}function decodeGtexGWAS(z,K){const ee=z.length;if(ee<7)return null;const te={chr:z[0],start:parseInt(z[1])-1,end:parseInt(z[2]),"Strongest SNP-risk allele":z[3],"Disease/Phenotype":z[4],"P-value":z[5],"Odds ratio or beta":z[6]};z.length>6&&(te.PUBMEDID=`<a target = "blank" href = "https://www.ncbi.nlm.nih.gov/pubmed/${z[7]}">${z[7]}</a>`);return te}
/**
     * Decode a custom columnar format.  Required columns are 'chr' and 'start'
     *
     * @param tokens
     * @param ignore
     * @returns decoded feature, or null if this is not a valid record
     */function decodeCustom(z,K){const ee=K.customFormat;if(z.length<ee.fields.length)return;const te=ee.coords||0;const ne=z[ee.chr];const re=parseInt(z[ee.start])-te;const ie=void 0!==ee.end?parseInt(z[ee.end]):re+1;const se={chr:ne,start:re,end:ie};ee.fields&&ee.fields.forEach((function(K,te){te!==ee.chr&&te!==ee.start&&te!==ee.end&&(se[K]=z[te])}));return se}
/**
     * Decode a gcnv record, a bed style format encoding copy number variation
     *
     * @param tokens
     * @param header
     */function decodeGcnv(z,K){const ee=K.columnNames;if(!ee)throw Error("Sample names are not defined.   Missing column headers?");const te=ee.length-3;const ne=z[0];const re=parseInt(z[1]);const ie=parseInt(z[2]);const se=z.slice(3).map(Number);if(se.length==te)return{chr:ne,start:re,end:ie,values:se};console.warn(`${ne}:${re}-${ie} row contains ${se.length} sample columns instead of the expected ${te} columns. Skipping...`)}class FeatureParser{constructor(z){this.config=z;this.header={};z.nameField&&(this.header.nameField=z.nameField);this.skipRows=0;if(z.decode){this.decode=z.decode;this.delimiter=z.delimiter||"\t"}else if(z.format){this.header.format=z.format.toLowerCase();this.setDecoder(this.header.format)}this.delimiter||(this.delimiter="\t")}
/**
         * Parse metadata from the file.   A variety of conventions are in use to supply metadata about file contents
         * through header lines (e.g. 'track') and # directives. This method unifies metadata as properties of a
         * 'header' object.
         *
         * @param data
         * @returns {{}}
         */async parseHeader(z){let K=this.header;let ee;let te;while(void 0!==(te=await z.nextLine()))if(te.startsWith("track")||te.startsWith("#track")){let z=parseTrackLine$1(te);Object.assign(K,z)}else if(te.startsWith("browser"));else if(te.startsWith("#columns")){let z=parseColumnsDirective$1(te);Object.assign(K,z)}else if(te.startsWith("##gff-version 3"))K.format="gff3";else if(te.startsWith("#gffTags"))K.gffTags=true;else{if(te.startsWith("fixedStep")||te.startsWith("variableStep"))break;if(te.startsWith("#")){const z=te.split(this.delimiter||"\t");z.length>1&&(ee=z)}else{this.setDecoder(K.format);const z=te.split(this.delimiter||"\t");try{const te=Object.assign({columnNames:ee},K);if(this.decode(z,te))break;z.length>1&&(ee=z)}catch(K){z.length>1&&(ee=z)}}}if(ee){K.columnNames=ee;for(let z=0;z<ee.length;z++)"color"===ee[z]||"colour"===ee[z]?K.colorColumn=z:"thickness"===ee[z]&&(K.thicknessColumn=z)}this.header=K;return K}async parseFeatures(z){const K=[];const ee=this.decode;const te=this.header.format;const ne=this.delimiter||"\t";let re=0;let ie=0;let se;while(void 0!==(se=await z.nextLine())){re++;if(re<=this.skipRows)continue;if(!se||se.startsWith("track")||se.startsWith("#")||se.startsWith("browser"))continue;if("wig"===te&&se.startsWith("fixedStep")){this.header.wig=parseFixedStep(se);continue}if("wig"===te&&se.startsWith("variableStep")){this.header.wig=parseVariableStep(se);continue}const z=se.split(ne);if(z.length<1)continue;const oe=ee(z,this.header);if(oe instanceof DecodeError){ie++;ie>0&&console.error(`Error parsing line '${se}': ${oe.message}`)}else oe&&K.push(oe)}ee===decodeBedpe&&fixBedPE(K);return K}setDecoder(z){switch(z){case"narrowpeak":case"broadpeak":case"regionpeak":case"peaks":this.decode=decodePeak;this.delimiter=this.config.delimiter||/\s+/;break;case"bedgraph":this.decode=decodeBedGraph;this.delimiter=/\s+/;break;case"wig":this.decode=decodeWig;this.delimiter=this.config.delimiter||/\s+/;break;case"gff3":case"gff":this.decode=decodeGFF3;this.delimiter="\t";break;case"gtf":this.decode=decodeGTF;this.delimiter="\t";break;case"fusionjuncspan":this.decode=decodeFusionJuncSpan;this.delimiter=this.config.delimiter||/\s+/;break;case"gtexgwas":this.skipRows=1;this.decode=decodeGtexGWAS;this.delimiter="\t";break;case"refflat":this.decode=decodeReflat;this.delimiter=this.config.delimiter||/\s+/;break;case"genepred":this.decode=decodeGenePred;this.delimiter=this.config.delimiter||/\s+/;break;case"genepredext":this.decode=decodeGenePredExt;this.delimiter=this.config.delimiter||/\s+/;break;case"ensgene":this.decode=decodeGenePred;this.header.shift=1;this.delimiter=this.config.delimiter||/\s+/;break;case"refgene":this.decode=decodeGenePredExt;this.delimiter=this.config.delimiter||/\s+/;this.header.shift=1;break;case"bed":this.decode=decodeBed;this.delimiter=this.config.delimiter||/\s+/;break;case"bedpe":case"hiccups":this.decode=decodeBedpe;this.delimiter=this.config.delimiter||"\t";break;case"bedpe-domain":this.decode=decodeBedpeDomain;this.headerLine=true;this.delimiter=this.config.delimiter||"\t";break;case"bedpe-loop":this.decode=decodeBedpe;this.delimiter=this.config.delimiter||"\t";this.header={colorColumn:7};break;case"interact":this.decode=decodeInteract;this.delimiter=this.config.delimiter||/\s+/;break;case"snp":this.decode=decodeSNP;this.delimiter="\t";break;case"rmsk":this.decode=decodeRepeatMasker;this.delimiter="\t";break;case"gcnv":this.decode=decodeGcnv;this.delimiter="\t";break;default:const K=getFormat(z);if(void 0!==K){this.decode=decodeCustom;this.header.customFormat=K;this.delimiter=K.delimiter||"\t"}else{this.decode=decodeBed;this.delimiter=this.config.delimiter||/\s+/}}}}function parseTrackLine$1(z){const K={};const ee=z.split(/(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g);let te;const ne=[];for(let z of ee)if(z&&0!==z.trim().length)if(z.endsWith("="))te=z;else if(te){ne.push(te+z);te=void 0}else ne.push(z);for(let z of ne){if(!z)return;var re=z.split("=",2);if(2===re.length){const z=re[0].trim();const ee=re[1].trim();if(K.hasOwnProperty(z)){let te=K[z];Array.isArray(te)?te.push(ee):K[z]=[te,ee]}else K[z]=ee}}"interact"==K.type?K.format="interact":"gcnv"===K.type&&(K.format="gcnv");return K}function parseColumnsDirective$1(z){let K={};let ee=z.split(/\s+/);if(2===ee.length){let z=ee[1].split(";");z.forEach((function(z){let ee=z.split("=");"color"===ee[0]?K.colorColumn=Number.parseInt(ee[1])-1:"thickness"===ee[0]&&(K.thicknessColumn=Number.parseInt(ee[1])-1)}))}return K}function parseFixedStep(z){const K=z.split(/\s+/);const ee=K[1].split("=")[1];const te=parseInt(K[2].split("=")[1],10)-1;const ne=parseInt(K[3].split("=")[1],10);const re=K.length>4?parseInt(K[4].split("=")[1],10):1;return{format:"fixedStep",chrom:ee,start:te,step:ne,span:re,index:0}}function parseVariableStep(z){const K=z.split(/\s+/);const ee=K[1].split("=")[1];const te=K.length>2?parseInt(K[2].split("=")[1],10):1;return{format:"variableStep",chrom:ee,span:te}}const fixColor=z=>isString$2(z)&&z.indexOf(",")>0&&!(z.startsWith("rgb(")||z.startsWith("rgba("))?`rgb(${z})`:z;
/**
     * A collection of properties and methods shared by all (or most) track types.
     *
     * @param config
     * @param browser
     * @constructor
     */class TrackBase{static defaults={height:50,autoHeight:false,visibilityWindow:void 0,color:void 0,altColor:void 0,supportHiDPI:true};constructor(z,K){this.browser=K;this.init(z)}
/**
         * Initialize track properties from the config object.  This method is typically overriden in subclasses, which
         * will call this implementation as super.init(config).
         *
         * @param config
         */init(z){this.config=z;z.displayMode&&(z.displayMode=z.displayMode.toUpperCase());const K=Object.assign({},TrackBase.defaults);if(this.constructor.defaults)for(let z of Object.keys(this.constructor.defaults))K[z]=this.constructor.defaults[z];for(let ee of Object.keys(K)){this[ee]=z.hasOwnProperty(ee)?z[ee]:K[ee];"color"!==ee&&"altColor"!==ee||(this[ee]=fixColor(this[ee]))}z.name||z.label?this.name=z.name||z.label:isFile(z.url)?this.name=z.url.name:isString$2(z.url)&&!z.url.startsWith("data:")&&(this.name=getFilename$2(z.url));this.url=z.url;this.config.type&&(this.type=this.config.type);this.id=void 0===this.config.id?this.name:this.config.id;this.order=z.order;this.autoscaleGroup=z.autoscaleGroup;this.removable=void 0===z.removable||z.removable;this.minHeight=z.minHeight||Math.min(25,this.height);this.maxHeight=z.maxHeight||Math.max(1e3,this.height);if(z.onclick){this.onclick=z.onclick;z.onclick=void 0}z.description&&("function"===typeof z.description?this.description=z.description:this.description=()=>z.description);z.hoverTextFields?this.hoverText=hoverText.bind(this):"function"===typeof this.config.hoverText&&(this.hoverText=this.config.hoverText)}get name(){return this._name}set name(z){this._name=z;this.trackView&&this.trackView.setTrackLabelName(z)}
/**
         * Update track properties from the config object.
         *
         * @param config
         */updateConfig(z){this.init(z)}clearCachedFeatures(){this.trackView&&this.trackView.clearCachedFeatures()}updateViews(){this.trackView&&this.trackView.updateViews()}getState(){const jsonable=z=>!(void 0===z||"function"===typeof z||z instanceof File||z instanceof Promise);const z={};for(let K of Object.keys(this.config))!K.startsWith("_")&&jsonable(this.config[K])&&(z[K]=this.config[K]);for(let K of Object.keys(z)){if(K.startsWith("_"))continue;const ee=this[K];ee&&(isSimpleType(ee)||"boolean"===typeof ee||"metadata"===K)&&(z[K]=ee)}const K=TrackBase.defaults;if(this.constructor.defaults)for(let z of Object.keys(this.constructor.defaults))K[z]=this.constructor.defaults[z];for(let ee of Object.keys(K))void 0!==this[ee]&&K[ee]!==this[ee]&&(z[ee]=this[ee]);if(!this.autoscale&&this.dataRange){z.min=this.dataRange.min;z.max=this.dataRange.max}return z}get supportsWholeGenome(){return true===this.config.supportsWholeGenome}
/**
         * Does the track support sample names.  Current sample aware tracks include VCF (with genotypes), MUT, MAF, and SEG
         * @returns {boolean}
         */hasSamples(){return false}getGenomeId(){return this.browser.genome?this.browser.genome.id:void 0}
/**
         * Set certain track properties, usually from a "track" line.  Not all UCSC properties are supported.
         *
         * Track configuration settings have precendence over track line properties, so if both are present ignore the
         * track line.
         *
         * @param properties
         */setTrackProperties(z){if(this.disposed)return;const K={};let ee;for(let te of Object.keys(z))switch(te.toLowerCase()){case"usescore":K.useScore=1===z[te]||"1"===z[te]||"on"===z[te]||true===z[te];break;case"visibility":switch(z[te]){case"2":case"3":case"pack":case"full":K.displayMode="EXPANDED";break;case"4":case"squish":K.displayMode="SQUISHED";break;case"1":case"dense":K.displayMode="COLLAPSED"}break;case"color":case"altcolor":K[te]=z[te].startsWith("rgb(")?z[te]:"rgb("+z[te]+")";break;case"featurevisiblitywindow":case"visibilitywindow":K.visibilityWindow=Number.parseInt(z[te]);break;case"maxheightpixels":ee=z[te].split(":");if(3===ee.length){K.minHeight=Number.parseInt(ee[2]);K.height=Number.parseInt(ee[1]);K.maxHeight=Number.parseInt(ee[0])}break;case"viewlimits":if(!this.config.autoscale){ee=z[te].split(":");let ne=0;let re;if(1==ee.length)re=Number(ee[0]);else if(2==ee.length){ne=Number(ee[0]);re=Number(ee[1])}K.autoscale=false;K.dataRange={min:ne,max:re};this.viewLimitMin=ne;this.viewLimitMax=re}case"name":K[te]=z[te];break;case"url":K.infoURL=z[te];break;case"type":const ne=z[te];Va.has(ne)?K[te]=Va.get(ne):K[te]=ne;break;case"graphtype":K.graphType=z[te];break;default:K[te]=z[te]}for(let z of Object.keys(K))if(!this.config.hasOwnProperty(z)||"name"===z&&this.config._derivedName){let ee=K[z];"true"===ee&&(ee=true);"false"===ee&&(ee=false);this[z]=ee;if("height"===z&&this.trackView)try{const z=Number.parseInt(ee);this.trackView.setTrackHeight(z)}catch(z){console.error(z)}}}
/**
         * Return the features clicked over.  Default implementation assumes an array of features and only considers
         * the genomic location.   Overriden by most subclasses.
         *
         * @param clickState
         * @param features
         * @returns {[]|*[]}
         */clickedFeatures(z){const K=z.viewport.cachedFeatures;if(!K||!Array.isArray(K)||0===K.length)return[];const ee=z.genomicLocation;const te=z.referenceFrame.bpPerPixel>.2?3*z.referenceFrame.bpPerPixel:.2;const ne=ee-te;const re=ee+te;return Xo.findOverlapping(K,ne,re)}
/**
         * Default popup text function -- just extracts string and number properties in random order.
         * @param feature
         * @returns {Array}
         */extractPopupData(z,K){const ee=new Set(["row","color","chr","start","end","cdStart","cdEnd","strand","alpha"]);const te=[];let ne,re;for(let K in z)if(z.hasOwnProperty(K)&&!ee.has(K)&&isSimpleType(z[K])){let ee=z[K];te.push({name:capitalize(K),value:ee});"alleles"===K?ne=z[K]:"alleleFreqs"===K&&(re=z[K])}if(ne&&re){ne.endsWith(",")&&(ne=ne.substr(0,ne.length-1));re.endsWith(",")&&(re=re.substr(0,re.length-1));let ee=ne.split(",");let ie=re.split(",");if(ie.length>1){let ne=[];for(let z=0;z<ie.length;z++)ne.push({a:ee[z],af:Number(ie[z])});ne.sort((function(z,K){return z.af-K.af}));let re=ne[ne.length-1].a;if(1===re.length)for(let ee=ne.length-2;ee>=0;ee--){let ie=ne[ee].a;if(1===ie.length){K||(K=this.getGenomeId());const ee=TrackBase.getCravatLink(z.chr,z.start+1,re,ie,K);console.log(ee);if(ee){te.push("<hr/>");te.push({html:ee});te.push("<hr/>")}}}}}if(z.attributes)for(let K of Object.keys(z.attributes))te.push({name:K,value:z.attributes[K]});let ie=`${z.chr}:${numberFormatter$1(z.start+1)}-${numberFormatter$1(z.end)}`;z.strand&&(ie+=` (${z.strand})`);te.push({name:"Location",value:ie});return te}description(){const wrapKeyValue=(z,K)=>`<div class="igv-track-label-popup-shim"><b>${z}: </b>${K}</div>`;let z='<div class="igv-track-label-popup">';this.url?isFile(this.url)?z+=wrapKeyValue("Filename",this.url.name):z+=wrapKeyValue("URL",this.url):z=this.name;if(this.config){if(this.config.metadata)for(let K of Object.keys(this.config.metadata)){const ee=this.config.metadata[K];z+=wrapKeyValue(K,ee)}for(let K of Object.keys(this.config)){if(K.startsWith("_"))continue;let ee=K.substr(0,1);if(ee!==ee.toLowerCase()){const ee=this.config[K];ee&&isSimpleType(ee)&&(z+=wrapKeyValue(K,ee))}}}z+="</div>";return z}
/**
         * Return color for a specific feature of this track.  This default implementation is overriden by subclasses*
         * @param f
         * @returns {*|string|string}
         */getColorForFeature(z){return"function"===typeof this.color?this.color(feature):this.color}dispose(){this.disposed=true;for(let z of Object.keys(this))this[z]=void 0}static getCravatLink(z,K,ee,te,ne){if("hg38"===ne||"GRCh38"===ne){const ne=z.startsWith("chr")?z:"chr"+z;return`<a target="_blank" href="https://run.opencravat.org/result/nocache/variant.html?chrom=${ne}&pos=${K}&ref_base=${ee}&alt_base=${te}"><b>Cravat ${ee}->${te}</b></a>`}}}function hoverText(z){if(!this.hoverTextFields)return;const K=this.clickedFeatures(z);if(K&&K.length>0){let z="";for(let ee=0;ee<K.length;ee++){if(10===ee){z+="; ...";break}if(!K[ee])continue;const te=K[ee]._f||K[ee];z.length>0&&(z+="\n");z="";for(let K of this.hoverTextFields){z.length>0&&(z+="\n");te.hasOwnProperty(K)?z+=te[K]:"function"===typeof te.getAttribute&&(z+=te.getAttribute(K))}}return z}}
/**
     * Map UCSC track line "type" setting to file format.  In igv.js "type" refers to the track type, not the input file format
     * @type {Map<string, string>}
     */const Va=new Map([["wiggle_0","wig"],["bed","bed"],["bigBed","bigBed"],["bigWig","bigWig"]]);class SegParser{constructor(z){this.type=z||"seg";switch(this.type){case"mut":this.sampleColumn=3;this.chrColumn=0;this.startColumn=1;this.endColumn=2;this.dataColumn=4;break;case"maf":this.sampleColumn=15;this.chrColumn=4;this.startColumn=5;this.endColumn=6;this.dataColumn=8;break;default:this.sampleColumn=0;this.chrColumn=1;this.startColumn=2;this.endColumn=3}}async parseHeader(z){let K;while(void 0!==(K=await z.nextLine()))if(!K.startsWith("#")){const z=K.split("\t");this.header={headings:z};break}return this.header}async parseFeatures(z){const K=[];let ee;this.header||(this.header=await this.parseHeader(z));"seg"===this.type&&(this.dataColumn=this.header.headings.length-1);this.header.headings.length>5&&(ee=this.extractExtraColumns(this.header.headings));const te=this.header.headings[this.dataColumn];let ne;while(void 0!==(ne=await z.nextLine())){const z=ne.split("\t");const re="seg"===this.type?Number(z[this.dataColumn]):z[this.dataColumn];if(z.length>this.dataColumn){const ne=new SegFeature({sample:z[this.sampleColumn],chr:z[this.chrColumn],start:parseInt(z[this.startColumn])-1,end:parseInt(z[this.endColumn]),value:re,valueColumnName:te});if(ee){const K=this.extractExtraColumns(z);ne.setAttributes({names:ee,values:K})}K.push(ne)}}return K}extractExtraColumns(z){const K=[];for(let ee=0;ee<z.length;ee++)ee!==this.chrColumn&&ee!==this.startColumn&&ee!==this.endColumn&&ee!==this.sampleColumn&&K.push(z[ee]);return K}}class SegFeature{constructor({sample:z,chr:K,start:ee,end:te,value:ne,valueColumnName:re}){this.sample=z;this.chr=K;this.start=ee;this.end=te;this.value=ne;this.valueColumnName=re}setAttributes({names:z,values:K}){this.attributeNames=z;this.attributeValues=K}getAttribute(z){if(this.attributeNames){const K=this.attributeNames.indexOf(z);if(K>=0)return this.attributeValues[K]}}popupData(z,K){const ee=new Set(["chr","start","end","sample","value","row","color","sampleKey","uniqueSampleKey","sampleId","chromosome","uniquePatientKey"]);const te=this.chr+":"+numberFormatter$1(this.start+1)+"-"+numberFormatter$1(this.end);const ne=[{name:"Sample",value:this.sample},{name:"Location",value:te},{name:this.valueColumnName?capitalize(this.valueColumnName):"Value",value:this.value}];if("mut"===z&&"hg38"===K){const z=this.extractCravatLink(K);if(z){ne.push("<hr/>");ne.push({html:z});ne.push("<hr/>")}}if(this.attributeNames&&this.attributeNames.length>0)for(let z=0;z<this.attributeNames.length;z++)!ee.has(this.attributeNames[z])&this.valueColumnName!==this.attributeNames[z]&&ne.push({name:capitalize(this.attributeNames[z]),value:this.attributeValues[z]});return ne}extractCravatLink(z){let K,ee;if(this.attributeNames&&this.attributeNames.length>0)for(let te=0;te<this.attributeNames.length;te++){K||"Reference_Allele"!==this.attributeNames[te]||(K=this.attributeValues[te]);!ee&&this.attributeNames[te].startsWith("Tumor_Seq_Allele")&&this.attributeValues[te]!==K&&(ee=this.attributeValues[te]);if(K&&ee)return TrackBase.getCravatLink(this.chr,this.start+1,K,ee,z)}}}
/**
     * Create a variant from an array of tokens representing a line in a "VCF" file
     * @param tokens
     */function createVCFVariant(z){const K=new Variant;K.chr=z[0];K.pos=parseInt(z[1]);K.names=z[2];K.referenceBases=z[3];K.alternateBases=z[4];K.quality=z[5];K.filter=z[6];K.info={};const ee=z[7];if(ee)for(let z of ee.split(";")){var te=z.split("=");K.info[te[0]]=te[1]}K.init();return K}
/**
     * @deprecated - the GA4GH API has been deprecated.  This code no longer maintained.
     * @param json
     * @returns {Variant}
     */function createGAVariant(z){var K=new Variant;K.chr=z.referenceName;K.start=parseInt(z.start);K.end=parseInt(z.end);K.pos=K.start+1;K.names=arrayToString(z.names,"; ");K.referenceBases=z.referenceBases;K.alternateBases=arrayToString(z.alternateBases);K.quality=z.quality;K.filter=arrayToString(z.filter);K.info={};z.info&&Object.keys(z.info).forEach((function(ee){var te,ne=z.info[ee];te=Array.isArray(ne)?ne.join(","):ne;K.info[ee]=te}));K.calls={};var ee;z.calls&&z.calls.forEach((function(z){ee=z.callSetId;K.calls[ee]=z}));init(K);return K}class Variant{init(){const z=this.referenceBases;const K=this.alternateBases;this.info&&(this.info.VT?this.type=this.info.VT:this.info.SVTYPE?this.type="SV":this.info.PERIOD&&(this.type="STR"));void 0===this.type&&(this.type=determineType(z,K));"NONVARIANT"===this.type&&(this.heterozygosity=0);if(this.info.END){this.start=this.pos-1;this.info.CHR2&&this.info.CHR2!==this.chr?this.end=this.start+1:this.end=Number.parseInt(this.info.END)}else if("NONVARIANT"===this.type){this.start=this.pos-1;this.end=this.start+z.length}else{const ee=K.split(",").filter((z=>z.length>0));this.alleles=[];this.start=void 0;this.end=void 0;for(let K of ee){this.alleles.push(K);if("SV"!==this.type&&isKnownAlt(K)){let ee=K.length;let te=z.length;const ne=Math.min(ee,te);let re=0;while(re<ne&&z.charCodeAt(re)===K.charCodeAt(re)){re++;ee--;te--}while(ee>0&&te>0){const ne=re+ee-1;const ie=re+te-1;if(K.charCodeAt(ne)!==z.charCodeAt(ie))break;ee--;te--}while(ee>0&&te>0){const ne=re;const ie=re;if(K.charCodeAt(ne)!==z.charCodeAt(ie))break;re++;ee--;te--}const ie=this.pos+re-1;const se=ie+te;this.start=void 0===this.start?ie:Math.min(this.start,ie);this.end=void 0===this.end?se:Math.max(this.end,se)}}if(void 0===this.start){this.start=this.pos-1;this.end=this.pos}}}popupData(z,K){const ee=`${numberFormatter$1(this.pos)}`;const te=this.start===this.end?`${numberFormatter$1(this.start)} | ${numberFormatter$1(this.start+1)}`:`${numberFormatter$1(this.start+1)}-${numberFormatter$1(this.end)}`;const ne=[{name:"Chr",value:this.chr},{name:"Pos",value:ee},{name:"Loc",value:te},{name:"ID",value:this.names?this.names:""},{name:"Ref",value:this.referenceBases},{name:"Alt",value:this.alternateBases.replace("<","&lt;")},{name:"Qual",value:this.quality},{name:"Filter",value:this.filter}];if("SNP"===this.type){let z=this.referenceBases;if(1===z.length){let ee=this.alternateBases.split(",");for(let te of ee)if(1===te.length){let ee=TrackBase.getCravatLink(this.chr,this.pos,z,te,K);if(ee){ne.push("<hr/>");ne.push({html:ee})}}}}this.hasOwnProperty("heterozygosity")&&ne.push({name:"Heterozygosity",value:this.heterozygosity});if(this.info){ne.push({html:'<hr style="border-top: dotted 1px;border-color: #c9c3ba" />'});for(let z of Object.keys(this.info))ne.push({name:z,value:arrayToString(decodeURIComponent(this.info[z]))})}return ne}getInfo(z){return this.info?this.info[z]:void 0}isRefBlock(){return"NONVARIANT"===this.type}}const $a=new Set(["A","C","T","G"].map((z=>z.charCodeAt(0))));function isKnownAlt(z){for(let K=0;K<z.length;K++)if(!$a.has(z.charCodeAt(K)))return false;return true}function determineType(z,K){const ee=z.length;if(void 0===K)return"UNKNOWN";if(0===K.trim().length||"<NON_REF>"===K||"<*>"===K||"."===K)return"NONVARIANT";{const z=K.split(",");const te=z.map((function(z){return 1===ee&&1===z.length?"SNP":"<NON_REF>"===z?"NONVARIANT":"OTHER"}));let ne=te[0];for(let z of te)if(z!==ne)return"MIXED";return ne}}function arrayToString(z,K){void 0===K&&(K=",");return Array.isArray(z)?z.join(K):z}class VcfParser{construtor(){}async parseHeader(z,K){const ee={};ee.chrAliasTable=new Map;let te=await z.nextLine();if(!te.startsWith("##fileformat"))throw new Error("Invalid VCF file: missing fileformat line");ee.version=te.substr(13);while(void 0!==(te=await z.nextLine())){if(!te.startsWith("#"))break;{let z;const re={};if(te.startsWith("##")){if(te.startsWith("##INFO")||te.startsWith("##FILTER")||te.startsWith("##FORMAT")){const K=te.indexOf("<");const ie=te.lastIndexOf(">");if(!(K>2&&ie>0)){console.log("Malformed VCF header line: "+te);continue}const se=te.substring(2,K-1);ee[se]||(ee[se]={});const oe=splitStringRespectingQuotes(te.substring(K+1,ie-1),",");for(let K of oe){var ne=K.split("=");ne.length>1&&("ID"===ne[0]?z=ne[1]:re[ne[0]]=ne[1])}z&&(ee[se][z]=re)}else if(te.startsWith("##contig")&&K){const z=te.indexOf("<ID=");let ne=te.indexOf(",",z);-1==ne&&(ne=te.indexOf(">",z));const re=te.substring(z+4,ne);const ie=K.getChromosomeName(re);ee.chrAliasTable.set(ie,re)}}else if(te.startsWith("#CHROM")){const z=te.split("\t");if(z.length>8){ee.callSets=[];for(let K=9;K<z.length;K++)ee.callSets.push({id:K,name:z[K]})}}}}this.header=ee;return ee}
/**
         * Parse data as a collection of Variant objects.
         *
         * @param data
         * @returns {Array}
         */async parseFeatures(z){const K=[];const ee=this.header.callSets;const te=8+(ee?ee.length+1:0);let ne;while(void 0!==(ne=await z.nextLine()))if(ne&&!ne.startsWith("#")){const z=ne.split("\t");if(z.length===te){const te=createVCFVariant(z);te.header=this.header;K.push(te);if(z.length>9){const K=extractCallFields(z[8].split(":"));te.calls={};for(let ne=9;ne<z.length;ne++){const re=z[ne];const ie=ee[ne-9];const se={callSetName:ie.name,info:{}};te.calls[ie.id]=se;re.split(":").forEach((function(z,ee){switch(ee){case K.genotypeIndex:se.genotype=[];z.split(/[\|\/]/).forEach((function(z){se.genotype.push("."===z?z:parseInt(z))}));break;default:se.info[K.fields[ee]]=z}}))}}te.info&&te.info.CHR2&&te.info.END&&K.push(svComplement(te))}}return K}}function extractCallFields(z){const K={genotypeIndex:-1,fields:z};for(let ee=0;ee<z.length;ee++)"GT"===z[ee]&&(K.genotypeIndex=ee);return K}function svComplement(z){const K=z.info.CHR2;const ee=Number.parseInt(z.info.END);return{chr:K,start:ee-1,end:ee,_f:z}}class GWASParser{constructor(z){this.config=z;if(z.columns){if(void 0===z.columns.chromosome||void 0===z.columns.position||void 0===z.columns.value)throw Error("columns property must define chrCol, posCol, and valueCol");this.posCol=z.columns.position-1;this.chrCol=z.columns.chromosome-1;this.valueCol=z.columns.value-1}else{this.posCol=2;this.chrCol=1;this.valueCol=3}}async parseHeader(z){const K=await z.nextLine();return this.parseHeaderLine(K)}parseHeaderLine(z){this.columns=z.split(/\t/);if(!this.config.columns)for(let z=0;z<this.columns.length;z++){const K=this.columns[z].toLowerCase();switch(K){case"chr":case"chromosome":case"chr_id":this.chrCol=z;break;case"bp":case"pos":case"position":case"chr_pos":this.posCol=z;break;case"p":case"pval":case"pvalue":case"p-value":case"p.value":this.valueCol=z;break}}return this.columns}async parseFeatures(z){const K=[];const ee=z.nextLine();this.columns||this.parseHeaderLine(ee);let te;while(void 0!==(te=z.nextLine())){const z=te.split(/\t/);if(z.length===this.columns.length){const ee=z[this.chrCol];const ne=parseInt(z[this.posCol])-1;const re=ne+1;const ie=Number(z[this.valueCol]);K.push(new GWASFeature({chr:ee,start:ne,end:re,value:ie,line:te,columns:this.columns}))}}return K}}class GWASFeature{constructor({chr:z,start:K,end:ee,value:te,line:ne,columns:re}){this.chr=z;this.start=K;this.end=ee;this.value=te;this.line=ne;this.columns=re}popupData(){const z=this.line.split(/\t/);return this.columns.map((function(K,ee){return{name:K,value:z[ee]}}))}getAttribute(z){const K=this.line.split(/\t/);for(let ee=0;ee<this.columns.length;ee++)if(this.columns[ee]===z)return K[ee]}}var qa=new RegExp("([^:]*)\\(([^)]*)\\)");var ja=new RegExp("([^:]*):([^(]*)\\(([^)]*)\\)");class AEDParser{constructor(z){const K=z?z.decode:void 0;this.nameField=z?z.nameField:void 0;this.skipRows=0;this.decode=K||decodeAed;this.delimiter="\t"}async parseHeader(z){let K;let ee;while(K=await z.nextLine()){if(!(K.startsWith("track")||K.startsWith("#")||K.startsWith("browser")))break;if(K.startsWith("track")||K.startsWith("#track")){let z=parseTrackLine(K);ee?Object.assign(ee,z):ee=z}else if(K.startsWith("#columns")){let z=parseColumnsDirective(K);ee?Object.assign(ee,z):ee=z}else if(K.startsWith("##gff-version 3")){this.format="gff3";ee||(ee={});ee.format="gff3"}}this.header=ee;return ee}async parseFeatures(z){const K=[];const ee=this.decode;const te=this.delimiter||"\t";let ne=0;let re;let ie;while(void 0!==(re=z.nextLine())){ne++;if(ne<=this.skipRows||re.startsWith("track")||re.startsWith("#")||re.startsWith("browser"))continue;let z=readTokensAed();if(z.length<1)continue;if(!this.aed){this.aed=parseAedHeaderRow(z);continue}const te=ee.call(this,z,ie);te&&K.push(te)}return K;function readTokensAed(){var z,K,ee=[],ne="",ie=false;while(re||""===re){for(z=0;z<re.length;z++){K=re.charAt(z);if(K===te)if(ie)ne+=K;else{ee.push(ne);ne=""}else if('"'===K)if(z+1<re.length&&'"'===re.charAt(z+1)){ie&&(ne+='"');z++}else ie=!ie;else ne+=K}if(!ie)break;ne+="\n";re=nextLine()}ee.push(ne);return ee}}}function parseAedToken(z){var K=ja.exec(z);if(K)return{namespace:K[1],name:K[2],type:K[3]};K=qa.exec(z);if(K)return{namespace:"?",name:K[1],type:K[2]};throw new Error("Error parsing the header row of AED file - column not in ns:name(ns:type) format")}function parseAedHeaderRow(z){var K,ee,te,ne;K={columns:[],metadata:{}};for(ee=0;ee<z.length;ee++){te=z[ee];ne=parseAedToken(te);K.columns.push(ne)}return K}function parseTrackLine(z){const K={};const ee=z.split(/(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g);let te;const ne=[];for(let z of ee)if(z&&0!==z.trim().length)if(z.endsWith("=")>0)te=z;else if(te){ne.push(te+z);te=void 0}else ne.push(z);for(let z of ne){if(!z)return;var re=z.split("=",2);if(2===re.length){const z=re[0].trim();const ee=re[1].trim();K[z]=ee}}return K}function parseColumnsDirective(z){let K={};let ee=z.split(/\s+/);if(2===ee.length){let z=ee[1].split(";");z.forEach((function(z){let ee=z.split("=");"color"===ee[0]?K.colorColumn=Number.parseInt(ee[1])-1:"thickness"===ee[0]&&(K.thicknessColumn=Number.parseInt(ee[1])-1)}))}return K}
/**
     * AED file feature.
     *
     * @param aed link to the AED file object containing file-level metadata and column descriptors
     * @param allColumns All columns as parsed from the AED
     *
     * Other values are parsed one by one
     */function AedFeature(z,K){var ee,te,ne=z.columns;this.aed=z;this.allColumns=K;this.chr=null;this.start=null;this.end=null;this.score=1e3;this.strand=".";this.cdStart=null;this.cdEnd=null;this.name=null;this.color=null;for(let z=0;z<K.length;z++){ee=K[z];if(ee){te=ne[z];"aed:Integer"===te.type&&(ee=parseInt(ee));var re=[];if(te.namespace.length>0)for(let z=0;z<te.namespace.length;z++)re.push(te.namespace.charCodeAt(z));"bio"===te.namespace.trim()?"sequence"===te.name?this.chr=ee:"start"===te.name?this.start=ee:"end"===te.name?this.end=ee:"cdsMin"===te.name?this.cdStart=ee:"cdsMax"===te.name?this.cdEnd=ee:"strand"===te.name&&(this.strand=ee):"aed"===te.namespace?"name"===te.name&&(this.name=ee):"style"===te.namespace&&"color"===te.name&&(this.color=$o.createColorString(ee))}}}AedFeature.prototype.popupData=function(){var z=[],K=this.aed;for(var ee=0;ee<this.allColumns.length;ee++){var te=this.allColumns[ee];var ne=K.columns[ee].name;"sequence"!==ne&&"color"!==ne&&te&&z.push({name:ne,value:te})}return z};
/**
     * Decode the AED file format
     * @param tokens
     * @param ignore
     * @returns decoded feature, or null if this is not a valid record
     */function decodeAed(z,K){var ee,te,ne,re,ie,se,oe=0,ae=this.aed.columns;if(z.length===ae.length){for(se=0;se<z.length;se++){re=ae[se];ne=z[se];""!==ne&&oe++;"name"===re.name&&"aed"===re.namespace?ee=ne:"value"===re.name&&"aed"===re.namespace&&(te=ne)}if(2===oe&&ee&&te){ie=parseAedToken(ee);this.aed.metadata[ie.namespace]||(this.aed.metadata[ie.namespace]={});this.aed.metadata[ie.namespace][ie.name]||(this.aed.metadata[ie.namespace][ie.name]={type:ie.type,value:te})}else{var le=new AedFeature(this.aed,z);if(le.chr&&(le.start||0===le.start)&&le.end)return le;console.log("Cannot parse feature: "+z.join(","))}}else console.log("Corrupted AED file row: "+z.join(","))}class BinaryParser{constructor(z,K){this.littleEndian=void 0===K||K;this.position=0;this.view=z;this.length=z.byteLength}available(){return this.length-this.position}remLength(){return this.length-this.position}hasNext(){return this.position<this.length-1}getByte(){var z=this.view.getUint8(this.position,this.littleEndian);this.position++;return z}getShort(){var z=this.view.getInt16(this.position,this.littleEndian);this.position+=2;return z}getUShort(){var z=this.view.getUint16(this.position,this.littleEndian);this.position+=2;return z}getInt(){var z=this.view.getInt32(this.position,this.littleEndian);this.position+=4;return z}getUInt(){var z=this.view.getUint32(this.position,this.littleEndian);this.position+=4;return z}getLong(){var z=[];z[0]=this.view.getUint8(this.position);z[1]=this.view.getUint8(this.position+1);z[2]=this.view.getUint8(this.position+2);z[3]=this.view.getUint8(this.position+3);z[4]=this.view.getUint8(this.position+4);z[5]=this.view.getUint8(this.position+5);z[6]=this.view.getUint8(this.position+6);z[7]=this.view.getUint8(this.position+7);var K=0;if(this.littleEndian)for(let ee=z.length-1;ee>=0;ee--)K=256*K+z[ee];else for(let ee=0;ee<z.length;ee++)K=256*K+z[ee];this.position+=8;return K}getString(z){var K="";var ee;while(0!==(ee=this.view.getUint8(this.position++))){K+=String.fromCharCode(ee);if(z&&K.length===z)break}return K}getFixedLengthString(z){var K="";var ee;var te;for(ee=0;ee<z;ee++){te=this.view.getUint8(this.position++);te>0&&(K+=String.fromCharCode(te))}return K}getFixedLengthTrimmedString(z){var K="";var ee;var te;for(ee=0;ee<z;ee++){te=this.view.getUint8(this.position++);te>32&&(K+=String.fromCharCode(te))}return K}getFloat(){var z=this.view.getFloat32(this.position,this.littleEndian);this.position+=4;return z}getDouble(){var z=this.view.getFloat64(this.position,this.littleEndian);this.position+=8;return z}skip(z){this.position+=z;return this.position}
/**
         * Return a BGZip (bam and tabix) virtual pointer
         * TODO -- why isn't 8th byte used ?
         * @returns {*}
         */getVPointer(){var z=this.position,K=this.view.getUint8(z+1)<<8|this.view.getUint8(z),ee=4294967296*(255&this.view.getUint8(z+6)),te=16777216*(255&this.view.getUint8(z+5)),ne=65536*(255&this.view.getUint8(z+4)),re=256*(255&this.view.getUint8(z+3)),ie=255&this.view.getUint8(z+2),se=ee+te+ne+re+ie;this.position+=8;return new VPointer(se,K)}}class VPointer{constructor(z,K){this.block=z;this.offset=K}isLessThan(z){return this.block<z.block||this.block===z.block&&this.offset<z.offset}isGreaterThan(z){return this.block>z.block||this.block===z.block&&this.offset>z.offset}isEqualTo(z){return this.block===z.block&&this.offset===z.offset}print(){return this.block+":"+this.offset}}function optimizeChunks(z,K){if(0===z.length)return z;z.sort((function(z,K){const ee=z.minv.block-K.minv.block;return 0!==ee?ee:z.minv.offset-K.minv.offset}));if(z.length<=1)return z;K&&(z=z.filter((z=>z.maxv.isGreaterThan(K))));const ee=[];let te;for(let K of z)if(te)if(canMerge(te,K))K.maxv.isGreaterThan(te.maxv)&&(te.maxv=K.maxv);else{ee.push(K);te=K}else{ee.push(K);te=K}return ee}
/**
     * Merge 2 blocks if the file position gap between them is < 16 kb, and the total size is < ~5 mb
     * @param chunk1
     * @param chunk2
     * @returns {boolean|boolean}
     */function canMerge(z,K){K.minv.block-z.maxv.block;const ee=z.maxv.block-z.minv.block;return ee<5e6}const Wa=21582659;const Ga=38359875;async function parseCsiIndex(z,K){const ee=new CSIIndex;ee.parse(z,K);return ee}class CSIIndex{constructor(z){this.tabix=true}parse(z,K){const ee=new BinaryParser(new DataView(z));const te=ee.getInt();if(te!==Wa)throw te===Ga?Error("CSI version 2 is not supported.  Please enter an issue at https://github.com/igvteam/igv.js"):Error("Not a CSI index");this.indices=[];this.blockMin=Number.MAX_SAFE_INTEGER;this.lastBlockPosition=[];this.sequenceIndexMap={};this.minShift=ee.getInt();this.depth=ee.getInt();const ne=ee.getInt();const re=[];let ie=0;if(ne>=28){ee.getInt();ee.getInt();ee.getInt();ee.getInt();ee.getInt();ee.getInt();const z=ee.getInt();const te=ee.position+z;let ne=0;while(ee.position<te){let z=ee.getString();K&&(z=K.getChromosomeName(z));this.sequenceIndexMap[z]=ne;re[ne]=z;ne++}}const se=this.bin_limit()+1;const oe=ee.getInt();for(let z=0;z<oe;z++){const K=[];const te=[];const ne=ee.getInt();for(let z=0;z<ne;z++){const z=ee.getInt();te[z]=ee.getVPointer();if(z>se){ee.getInt();ee.getVPointer();ee.getVPointer();ee.getLong();ee.getLong()}else{K[z]=[];const te=ee.getInt();for(let ne=0;ne<te;ne++){const te=ee.getVPointer();const ne=ee.getVPointer();if(te&&ne){te.block<this.blockMin&&(this.blockMin=te.block);ne.block>ie&&(ie=ne.block);K[z].push([te,ne])}}}}ne>0&&(this.indices[z]={binIndex:K,loffset:te})}this.lastBlockPosition=ie}get chromosomeNames(){return Object.keys(this.sequenceIndexMap)}
/**
         * Fetch blocks for a particular genomic range.  This method is public so it can be unit-tested.
         *
         * @param refId  the sequence dictionary index of the chromosome
         * @param min  genomic start position
         * @param max  genomic end position
         * @param return an array of {minv: {filePointer, offset}, {maxv: {filePointer, offset}}
         */chunksForRange(z,K,ee){const te=this.indices[z];if(te){const z=this.reg2bins(K,ee);if(0==z.length)return[];const ne=[];for(let K of z)for(let z=K[0];z<=K[1];z++)if(te.binIndex[z]){const K=te.binIndex[z];for(let ee of K){const K=ee[0];const te=ee[1];ne.push({minv:K,maxv:te,bin:z})}}const re=te.loffset[z[0]];return optimizeChunks(ne,re)}return[]}reg2bins(z,K){z-=1;z<1&&(z=1);K>2**34&&(K=2**34);K-=1;let ee=0;let te=0;let ne=this.minShift+3*this.depth;const re=[];for(;ee<=this.depth;ne-=3,te+=1<<3*ee,ee+=1){const ee=te+(z>>ne);const ie=te+(K>>ne);re.push([ee,ie])}return re}bin_limit(){return((1<<3*(this.depth+1))-1)/7}}const Za=21578050;const Qa=21578324;async function parseBamIndex(z,K){const ee=new BamIndex;await ee.parse(z,false,K);return ee}async function parseTabixIndex(z,K){const ee=new BamIndex;await ee.parse(z,true,K);return ee}class BamIndex{constructor(){}async parse(z,K,ee){const te=[];let ne=Number.MAX_SAFE_INTEGER;let re=0;const ie=new BinaryParser(new DataView(z));const se=ie.getInt();const oe={};if(!(se===Za||K&&se===Qa))throw new Error(indexURL+" is not a "+(K?"tabix":"bai")+" file");{const z=ie.getInt();if(K){ie.getInt();ie.getInt();ie.getInt();ie.getInt();ie.getInt();ie.getInt();ie.getInt();for(let K=0;K<z;K++){let z=ie.getString();ee&&(z=ee.getChromosomeName(z));oe[z]=K}}for(let K=0;K<z;K++){const z={};const ee=[];const se=ie.getInt();for(let K=0;K<se;K++){const K=ie.getInt();if(37450===K){ie.getInt();ie.getVPointer();ie.getVPointer();ie.getLong();ie.getLong()}else{z[K]=[];const ee=ie.getInt();for(let te=0;te<ee;te++){const ee=ie.getVPointer();const te=ie.getVPointer();if(ee&&te){ee.block<ne&&(ne=ee.block);te.block>re&&(re=te.block);z[K].push([ee,te])}}}}const oe=ie.getInt();for(let z=0;z<oe;z++){const z=ie.getVPointer();ee.push(z)}se>0&&(te[K]={binIndex:z,linearIndex:ee})}this.firstBlockPosition=ne;this.lastBlockPosition=re;this.indices=te;this.sequenceIndexMap=oe;this.tabix=K}}get chromosomeNames(){return Object.keys(this.sequenceIndexMap)}
/**
         * Fetch chunks for a particular genomic range.  This method is public so it can be unit-tested.
         *
         * @param refId  the sequence dictionary index of the chromosome
         * @param min  genomic start position
         * @param max  genomic end position
         * @param return an array of objects representing chunks (file spans) {minv: {block, offset}, {maxv: {block, offset}}
         */chunksForRange(z,K,ee){const te=this;const ne=te.indices[z];if(ne){const z=reg2bins(K,ee);const te=[];for(let K of z)for(let z=K[0];z<=K[1];z++)if(ne.binIndex[z]){const K=ne.binIndex[z];for(let z of K){const K=z[0];const ee=z[1];te.push({minv:K,maxv:ee})}}const re=ne.linearIndex.length;let ie;const se=Math.min(K>>14,re-1);const oe=Math.min(ee>>14,re-1);for(let z=se;z<=oe;z++){const K=ne.linearIndex[z];if(K){ie=K;break}}return optimizeChunks(te,ie)}return[]}}function reg2bins(z,K){const ee=[];K>=1<<29&&(K=1<<29);--K;ee.push([0,0]);ee.push([1+(z>>26),1+(K>>26)]);ee.push([9+(z>>23),9+(K>>23)]);ee.push([73+(z>>20),73+(K>>20)]);ee.push([585+(z>>17),585+(K>>17)]);ee.push([4681+(z>>14),4681+(K>>14)]);return ee}async function parseTribbleIndex(z,K){const ee=new TribbleIndex;ee.parse(z,K);return ee}class TribbleIndex{constructor(){}async parse(z,K){let ee=0;this.chrIndex={};this.lastBlockPosition=[];const te=new BinaryParser(new DataView(z));readHeader(te);let ne=te.getInt();while(ne-- >0){let z=te.getString();K&&(z=K.getChromosomeName(z));const ne=te.getInt();const re=te.getInt();const ie=te.getInt();te.getInt()>0;te.getInt();let se=te.getLong();const oe=[];for(let z=0;z<re;z++){const z=te.getLong();oe.push({min:se,max:z});se=z;z>ee&&(ee=z)}this.chrIndex[z]={chr:z,blocks:oe,longestFeature:ie,binWidth:ne}}this.lastBlockPosition=ee;
/**
             * Read the header .   Data here is not used in igv.js but we need to read it to advance the pointer.
             * @param parser
             */function readHeader(z){z.getInt();z.getInt();const K=z.getInt();z.getString();z.getLong();z.getLong();z.getString();z.getInt();if(K>=3){let K=z.getInt();while(K-- >0){z.getString();z.getString()}}}}get chromosomeNames(){return Object.keys(this.chrIndex)}
/**
         * Fetch blocks for a particular genomic range.
         *
         * @param queryChr the sequence dictionary index of the chromosome
         * @param min  genomic start position
         * @param max  genomic end position
         */chunksForRange(z,K,ee){const te=this.chrIndex[z];if(te){const z=te.blocks;const ne=te.longestFeature;const re=te.binWidth;const ie=Math.max(K-ne,0);const se=Math.floor(ie/re);if(se>=z.length)return[];{const K=Math.min(Math.floor((ee-1)/re),z.length-1);const te=z[se].min;const ne=z[K].max;const ie=ne-te;if(0===ie)return[];{const z={minv:{block:te,offset:0},maxv:{block:ne,offset:0}};return[z]}}}}}const Xa=21582659;const Ya=38359875;const Ka=21578050;const Ja=21578324;const el=1480870228;
/**
     * @param indexURL
     * @param config
     * @param tabix
     *
     */async function loadIndex(z,K,ee){let te=await Wo.loadArrayBuffer(z,buildOptions(K));let ne=new DataView(te);if(31===ne.getUint8(0)&&139===ne.getUint8(1)){const z=unbgzf(te);te=z.buffer;ne=new DataView(te)}const re=ne.getInt32(0,true);switch(re){case Ka:return parseBamIndex(te,ee);case Ja:return parseTabixIndex(te,ee);case Xa:return parseCsiIndex(te,ee);case el:return parseTribbleIndex(te,ee);case Ya:throw Error("CSI version 2 is not supported.");default:throw Error(`Unrecognized index type: ${z}`)}}function getDataWrapper(z){return"string"==typeof z||z instanceof String?new StringDataWrapper(z):new ByteArrayDataWrapper(z)}class StringDataWrapper{constructor(z){this.data=z;this.ptr=0}nextLine(){var z=this.ptr,K=this.data.indexOf("\n",z),ee=this.data;if(K>0){this.ptr=K+1;return K>z&&"\r"===ee.charAt(K-1)?ee.substring(z,K-1):ee.substring(z,K)}var te=ee.length;this.ptr=te;return z>=te?void 0:ee.substring(z)}}class ByteArrayDataWrapper{constructor(z){this.data=z;this.length=this.data.length;this.ptr=0}nextLine(){var z,K;K="";if(!(this.ptr>=this.length)){for(var ee=this.ptr;ee<this.length;ee++){z=String.fromCharCode(this.data[ee]);if("\r"!==z){if("\n"===z)break;K+=z}}this.ptr=ee+1;return K}}}class BGZLineReader{constructor(z){this.config=z;this.filePtr=0;this.bufferPtr=0;this.buffer}async nextLine(){let z;try{while(true){const K=this.buffer?this.buffer.length:0;while(this.bufferPtr<K){const K=String.fromCharCode(this.buffer[this.bufferPtr++]);if("\r"!==K){if("\n"===K)return z;z=z?z+K:K}}if(this.eof)return z;await this.readNextBlock()}}catch(K){console.warn(K);this.eof=true;return z}}async readNextBlock(){const z=buildOptions(this.config,{range:{start:this.filePtr,size:26}});const K=await Wo.loadArrayBuffer(this.config.url,z);const ee=bgzBlockSize$1(K);if(0===ee){this.eof=true;this.buffer=void 0}else{const z=buildOptions(this.config,{range:{start:this.filePtr,size:ee}});const K=await Wo.loadArrayBuffer(this.config.url,z);K.byteLength<ee&&(this.eof=true);this.buffer=unbgzf(K);0==this.buffer.byteLength&&(this.eof=true);this.bufferPtr=0;this.filePtr+=K.byteLength}}}function concatenateArrayBuffers(z){if(1===z.length)return z[0];let K=0;for(const ee of z)K+=ee.byteLength;const ee=new Uint8Array(K);let te=0;for(const K of z){ee.set(new Uint8Array(K),te);te+=K.byteLength}return ee.buffer}
/**
     * Return the block size for the data buffer.
     * @param data
     * @returns {number}
     */const bgzBlockSize=z=>{const K=ArrayBuffer.isView(z)?z:new Uint8Array(z);const ee=1+(K[17]<<8|K[16]);return ee};class BGZBlockLoader{constructor(z){this.config=z;this.cacheBlocks=false!=z.cacheBlocks;this.cache=void 0}
/**
         * Return inflated data from startBlock through endBlock as an UInt8Array
         *
         * @param minv minimum virtual pointer  {block, offset}
         * @param maxv maximum virtual pointer  {block, offset}
         * @returns {Promise<Uint8Array>}
         */async getData(z,K){const ee=z.block;const te=K.block;const ne=0===K.offset;const re=await this.getInflatedBlocks(ee,te,ne);if(1===re.length)return re[0];let ie=0;for(const z of re)ie+=z.byteLength;const se=new Uint8Array(ie);let oe=0;for(const z of re){se.set(z,oe);oe+=z.byteLength}return se}
/**
         * Return the inflated data for the specified blocks as an array of Uint8Arrays.  This method is public so
         * it can be unit tested. *
         * @param startBlock
         * @param endBlock
         * @returns {Promise<*[Uint8Array]>}
         */async getInflatedBlocks(z,K,ee){if(this.cacheBlocks){const te=this.cache;if(te&&te.startBlock<=z&&(te.endBlock>=K||ee&&te.nextEndBlock===K)){const ee=z-te.startBlock;const ne=K-te.startBlock;return inflateBlocks(te.buffer,ee,ne)}{let ne;if(!te||te.startBlock>K||te.endBlock<z)ne=await this.loadBLockData(z,K,{skipEnd:ee});else{const re=[];if(z<te.startBlock){const K=await this.loadBLockData(z,te.startBlock,{skipEnd:true});re.push(K)}let ie;if(z<=te.startBlock&&K>=te.endBlock)ie=te.buffer;else{const ee=Math.max(0,z-te.startBlock);let ne;if(K>=te.endBlock)ne=te.buffer.byteLength;else{const z=findBlockBoundaries(te.buffer);for(let ee=0;ee<z.length-1;ee++)if(te.startBlock+z[ee]===K){ne=z[ee+1];break}}ie=te.buffer.slice(ee,ne)}re.push(ie);if(K>te.endBlock){const z=await this.loadBLockData(te.endBlock,K,{skipStart:true,skipEnd:ee});re.push(z)}ne=concatenateArrayBuffers(re)}let re=K;if(ee){const z=findBlockBoundaries(ne);K=z[z.length-1]}this.cache={startBlock:z,endBlock:K,nextEndBlock:re,buffer:ne};return inflateBlocks(ne)}}{const te=await this.loadBLockData(z,K,{skipEnd:ee});return inflateBlocks(te)}}async loadBLockData(z,K,ee){const te=this.config;const ne=ee&&ee.skipStart;const re=ee&&ee.skipEnd;let ie=0;if(!re){const z=buildOptions(te,{range:{start:K,size:26}});const ee=await Wo.loadArrayBuffer(te.url,z);ie=bgzBlockSize(ee)}if(ne){const K=buildOptions(te,{range:{start:z,size:26}});const ee=await Wo.loadArrayBuffer(te.url,K);z+=bgzBlockSize(ee)}const se=buildOptions(te,{range:{start:z,size:K+ie-z}});return Wo.loadArrayBuffer(te.url,se)}}function findBlockBoundaries(z){const K=z.byteLength;let ee=0;const te=[0];while(ee<K){const ne=new Uint8Array(z,ee);const re=1+(ne[17]<<8|ne[16]);ee+=re;ee<K&&te.push(ee)}return te}
/**
     * Inflate compressed blocks within the data buffer*
     * @param data
     * @param startBlock - optional file location for start block.  Default == 0
     * @param endBlock - optional file location for last block to decompress.
     * @returns {*[]}
     */function inflateBlocks(z,K,ee){K=K||0;const te=[];let ne=K;const re=z.byteLength-18;while(ne<re)try{const K=new Uint8Array(z,ne,18);const re=K[11]<<8|K[10];const ie=K[17]<<8|K[16];const se=12+re+ne;const oe=z.byteLength-se;const ae=ie-re-18;if(oe<ae||ae<=0)break;const le=new Uint8Array(z,se,ae);const ce=Po(le);te.push(ce);if(ee===ne)break;ne+=ie+1}catch(z){console.error(z);break}return te}
/**
     * Reader for "bed like" files (tab delimited files with 1 feature per line: bed, gff, vcf, etc)
     *
     * @param config
     * @constructor
     */class FeatureFileReader{constructor(z,K){var ee;this.config=z||{};this.genome=K;this.indexURL=z.indexURL;this.indexed=z.indexed||void 0!==this.indexURL;this.queryable=this.indexed;if(isFile(this.config.url))this.filename=this.config.url.name;else if(isDataURL(this.config.url)){this.indexed=false;this.dataURI=z.url}else{ee=parseUri(this.config.url);this.filename=z.filename||ee.file}this.parser=this.getParser(this.config);"vcf"!==this.config.format||this.config.indexURL||console.warn("Warning: index file not specified.  The entire vcf file will be loaded.")}async defaultVisibilityWindow(){if(this.config.indexURL){const z=await this.getIndex();if(z&&z.lastBlockPosition){let K=0;const ee=1e4;for(let ee of z.chromosomeNames){const z=this.genome.getChromosome(ee);z&&(K+=z.bpLength)}return Math.round(K/z.lastBlockPosition*ee)}}}
/**
         * Return a promise to load features for the genomic interval
         * @param chr
         * @param start
         * @param end
         */async readFeatures(z,K,ee){const te=await this.getIndex();if(te){this.indexed=true;return this.loadFeaturesWithIndex(z,K,ee)}if(this.dataURI){this.indexed=false;return this.loadFeaturesFromDataURI()}this.indexed=false;return this.loadFeaturesNoIndex()}async readHeader(){if(this.dataURI){await this.loadFeaturesFromDataURI(this.dataURI);return this.header}if(this.config.indexURL){const z=await this.getIndex();if(!z)throw new Error("Unable to load index: "+this.config.indexURL);let K;if(z.tabix){this._blockLoader=new BGZBlockLoader(this.config);K=new BGZLineReader(this.config)}else{const ee=Object.values(z.chrIndex).flatMap((z=>z.blocks)).map((z=>z.max)).reduce(((z,K)=>Math.min(z,K)),Number.MAX_SAFE_INTEGER);const te=buildOptions(this.config,{bgz:z.tabix,range:{start:0,size:ee}});const ne=await Wo.loadString(this.config.url,te);K=getDataWrapper(ne)}this.header=await this.parser.parseHeader(K);return this.header}{const z=buildOptions(this.config);const K=await Wo.loadString(this.config.url,z);let ee=getDataWrapper(K);this.header=await this.parser.parseHeader(ee);ee=getDataWrapper(K);this.features=await this.parser.parseFeatures(ee);return this.header}}getParser(z){switch(z.format){case"vcf":return new VcfParser(z);case"seg":return new SegParser("seg");case"mut":return new SegParser("mut");case"maf":return new SegParser("maf");case"gwas":return new GWASParser(z);case"aed":return new AEDParser(z);default:return new FeatureParser(z)}}async loadFeaturesNoIndex(){if(this.features){const z=this.features;delete this.features;return z}{const z=buildOptions(this.config);const K=await Wo.loadString(this.config.url,z);if(!this.header){const z=getDataWrapper(K);this.header=await this.parser.parseHeader(z)}const ee=getDataWrapper(K);const te=await this.parser.parseFeatures(ee);return te}}async loadFeaturesWithIndex(z,K,ee){this.dataURI||this.header||await this.readHeader();const te=this.config;const ne=this.parser;const re=this.index.tabix;const ie=re?this.index.sequenceIndexMap[z]:z;if(void 0===ie)return[];const se=this.genome;const oe=this.index.chunksForRange(ie,K,ee);if(oe&&0!==oe.length){const ie=[];for(let ae of oe){let oe;if(re)oe=await this._blockLoader.getData(ae.minv,ae.maxv);else{const z=buildOptions(te,{range:{start:ae.minv.block,size:ae.maxv.block-ae.minv.block+1}});oe=await Wo.loadString(te.url,z)}const le=ae.minv.offset?oe.slice(ae.minv.offset):oe;const ce=getDataWrapper(le);let he=await ne.parseFeatures(ce);he=he.filter((z=>void 0===z._f));let ue=false;for(let te=0;te<he.length;te++){const ne=he[te];const re=se?se.getChromosomeName(ne.chr):ne.chr;if(re!==z){if(0===ie.length)continue;break}if(ne.start>ee){ie.push(ne);break}if(ne.end>=K&&ne.start<=ee){if(!ue){ue=true;te>0&&ie.push(he[te-1])}ie.push(ne)}}}ie.sort((function(z,K){return z.start-K.start}));return ie}return[]}async getIndex(){if(this.index)return this.index;if(this.config.indexURL){this.index=await this.loadIndex();return this.index}}async loadIndex(){const z=this.config.indexURL;return loadIndex(z,this.config,this.genome)}async loadFeaturesFromDataURI(){if(this.features){const z=this.features;delete this.features;return z}{const z=decodeDataURI$1(this.dataURI);let K=getDataWrapper(z);this.header=await this.parser.parseHeader(K);this.header instanceof String&&this.header.startsWith("##gff-version 3")&&(this.format="gff3");K=getDataWrapper(z);this.features=await this.parser.parseFeatures(K);return this.features}}}const tl=isString$2;class CustomServiceReader{constructor(z){this.config=z}async readFeatures(z,K,ee){let te;te="function"===typeof this.config.url?this.config.url({chr:z,start:K,end:ee}):this.config.url.replace("$CHR",z).replace("$START",K).replace("$END",ee);let ne=Object.assign({},this.config);void 0!==this.config.body&&("function"===typeof this.config.body?ne.body=this.config.body({chr:z,start:K,end:ee}):ne.body=this.config.body.replace("$CHR",z).replace("$START",K).replace("$END",ee));let re;const ie=await Wo.load(te,ne);ie&&(re="function"===typeof this.config.parser?this.config.parser(ie):tl(ie)?JSON.parse(ie):ie);if(this.config.mappings){let z=Object.keys(this.config.mappings);for(let K of re)for(let ee of z)K[ee]=K[this.config.mappings[ee]]}return re}}const UCSCServiceReader=function(z,K){this.config=z;this.genome=K;this.expandQueryInterval=false};UCSCServiceReader.prototype.readFeatures=function(z,K,ee){const te=Math.max(0,Math.floor(K));let ne=Math.ceil(ee);if(this.genome){const K=this.genome.getChromosome(z);K&&ne>K.bpLength&&(ne=K.bpLength)}const re=this.config.url+"?db="+this.config.db+"&table="+this.config.tableName+"&chr="+z+"&start="+te+"&end="+ne;return Wo.loadJson(re,this.config).then((function(z){if(z){z.forEach((function(z){z.hasOwnProperty("exonStarts")&&z.hasOwnProperty("exonEnds")&&z.hasOwnProperty("exonCount")&&z.hasOwnProperty("cdsStart")&&z.hasOwnProperty("cdsEnd")&&addExons(z)}));return z}return null}))};function addExons(z){var K,ee,te,ne,re,ie;K=z.exonCount;ee=z.exonStarts.split(",");te=z.exonEnds.split(",");ne=[];for(var se=0;se<K;se++){re=parseInt(ee[se]);ie=parseInt(te[se]);var oe={start:re,end:ie};(z.cdsStart>ie||z.cdsEnd<z.cdsStart)&&(oe.utr=true);z.cdsStart>=re&&z.cdsStart<=ie&&(oe.cdStart=z.cdsStart);z.cdsEnd>=re&&z.cdsEnd<=ie&&(oe.cdEnd=z.cdsEnd);ne.push(oe)}z.exons=ne}const nl=["Name","gene_name","gene","gene_id","alias","locus","name"];class GFFHelper{constructor(z){this.format=z.format;this.nameField=z.nameField;this.filterTypes=void 0===z.filterTypes?new Set(["chromosome"]):new Set(z.filterTypes)}combineFeatures(z,K){let ee;const te=this.filterTypes;z=z.filter((z=>void 0===te||!te.has(z.type)));if("gff3"===this.format){const K=this.combineFeaturesById(z);ee=this.combineFeaturesByType(K)}else ee=this.combineFeaturesByType(z);ee.sort((function(z,K){return z.start-K.start}));this.numberExons(ee,K);this.nameFeatures(ee);return ee}
/**
         * Combine multiple non-transcript model features with the same ID on the same chromosome into a single feature.
         * Features that are part of the transcript model (e.g. exon, mRNA, etc) are combined later.
         *
         * @param features
         * @returns {[]}
         */combineFeaturesById(z){const K=new Map;const ee=[];for(let te of z)if(isTranscriptPart(te.type)||isTranscript(te.type)||!te.id)ee.push(te);else{let z=K.get(te.chr);if(!z){z=new Map;K.set(te.chr,z)}let ee=z.get(te.id);ee?ee.push(te):z.set(te.id,[te])}for(let z of K.values())for(let K of z.values())if(K.length>1){const z=K[0];z.exons=[];for(let ee of K){z.start=Math.min(z.start,ee.start);z.end=Math.max(z.end,ee.end);z.exons.push({start:ee.start,end:ee.end})}ee.push(z)}else ee.push(K[0]);return ee}combineFeaturesByType(z){const K=z.filter((z=>"gene"===z.type||z.type.endsWith("_gene")));const ee=Object.create(null);for(let z of K)ee[z.id]=z;const te=Object.create(null);const ne=[];const re=new Set;const ie=this.filterTypes;z=z.filter((z=>void 0===ie||!ie.has(z.type)));for(let K of z){"biological_region"===K.type&&console.log();if(isTranscript(K.type)){const z=K.id;if(void 0!==z){const ie=new GFFTranscript(K);te[z]=ie;ne.push(ie);re.add(K);const se=ee[K.parent];if(se){ie.geneObject=se;re.add(se)}}}}for(let K of z)if(isTranscriptPart(K.type)){const z=getParents(K);if(z)for(let ee of z){let ie=te[ee];if(!ie&&"gtf"===this.format){const z=Object.assign({},K);z.type="transcript";ie=new GFFTranscript(z);te[ee]=ie;ne.push(ie)}if(void 0!==ie){if(isExon(K.type))if(z.length>1){const z=new GFFFeature(K);ie.addExon(z)}else ie.addExon(K);else ie.addPart(K);re.add(K)}}}ne.forEach((function(z){"function"===typeof z.finish&&z.finish()}));const se=z.filter((z=>!re.has(z)));for(let z of se)ne.push(z);return ne;function getParents(z){return z.parent&&""!==z.parent.trim()?z.parent.trim().split(","):null}}numberExons(z,K){for(let ee of z)if(ee.exons&&(!K||ee.end<=K.end&&ee.start>K.start))for(let z=0;z<ee.exons.length;z++){const K=ee.exons[z];K.number="-"===ee.strand?ee.exons.length-z:z+1}}nameFeatures(z){for(let K of z)if(K.attributeString){const z="gff3"===this.format?"=":" ";const ee=parseAttributeString(K.attributeString,z);const te=new Map(ee);if(this.nameField)K.name=te.get(this.nameField);else for(let z of nl)if(te.has(z)){K.name=te.get(z);break}}}}const GtexReader=function(z){this.config=z;this.url=z.url;this.tissueId=z.tissueSiteDetailId;this.indexed=true;this.datasetId=z.datasetId||"gtex_v8"};GtexReader.prototype.readFeatures=async function(z,K,ee){let te=this,ne=z.startsWith("chr")?z:"chr"+z,re=Math.floor(K),ie=Math.ceil(ee),se=this.datasetId,oe=this.url+"?chromosome="+ne+"&start="+re+"&end="+ie+"&tissueSiteDetailId="+this.tissueId+"&datasetId="+se;const ae=await Wo.loadJson(oe,{withCredentials:te.config.withCredentials});if(ae&&ae.singleTissueEqtl){ae.singleTissueEqtl.forEach((function(z){z.chr=z.chromosome;z.position=z.pos;z.start=z.pos-1;z.end=z.start+1;z.snp=z.snpId;z.geneName=z.geneSymbol;z.geneId=z.gencodeId}));return ae.singleTissueEqtl}};const ImmVarReader=function(z){this.config=z;this.url=z.url;this.cellConditionId=z.cellConditionId;this.valueThreshold=z.valueThreshold?z.valueThreshold:.05};ImmVarReader.prototype.readFeatures=function(z,K,ee){var te=this,ne=this.url+"?chromosome="+z+"&start="+K+"&end="+ee+"&cell_condition_id="+this.cellConditionId;return new Promise((function(z,K){Wo.loadJson(ne,{withCredentials:te.config.withCredentials}).then((function(K){if(K){K.eqtls.forEach((function(z){z.chr=z.chromosome;z.start=z.position;z.end=z.position+1}));z(K.eqtls)}else z(null)})).catch((function(z){K(z)}))}))};const rl=Wo.apiKey;function ga4ghGet(z){var K=z.url+"/"+z.entity+"/"+z.entityId;z.headers=ga4ghHeaders();return Wo.loadJson(K,z)}function ga4ghSearch(z){return new Promise((function(K,ee){var te=z.results?z.results:[],ne=z.url,re=z.body,ie=z.decode,se="?",oe=z.fields;if(rl){ne=ne+se+"key="+rl;se="&"}oe&&(ne=ne+se+"fields="+oe);return loadChunk();function loadChunk(z){z?re.pageToken=z:void 0!==re.pageToken&&delete re.pageToken;var se=JSON.stringify(re);Wo.loadJson(ne,{sendData:se,contentType:"application/json",headers:ga4ghHeaders()}).then((function(z){var ee,ne;if(z){ne=ie?ie(z):z;ne&&ne.forEach((function(z){te.push(z)}));ee=z.nextPageToken;ee?loadChunk(ee):K(te)}else K(te)})).catch((function(z){ee(z)}))}}))}function ga4ghHeaders(){return{"Cache-Control":"no-cache"}}const Ga4ghVariantReader=function(z,K){this.config=z;this.genome=K;this.url=z.url;this.variantSetId=z.variantSetId;this.callSetIds=z.callSetIds;this.includeCalls=void 0===z.includeCalls||z.includeCalls};Ga4ghVariantReader.prototype.readHeader=function(){var z=this;if(z.header)return Promise.resolve(z.header);z.header={};if(false===z.includeCalls)return Promise.resolve(z.header);var K=z.url+"/callsets/search";return ga4ghSearch({url:K,fields:"nextPageToken,callSets(id,name)",body:{variantSetIds:Array.isArray(z.variantSetId)?z.variantSetId:[z.variantSetId],pageSize:"10000"},decode:function(K){if(z.callSetIds){var ee=[],te=new Set;z.callSetIds.forEach((function(z){te.add(z)}));K.callSets.forEach((function(z){te.has(z.id)&&ee.push(z)}));return ee}return K.callSets}}).then((function(K){z.header.callSets=K;return z.header}))};Ga4ghVariantReader.prototype.readFeatures=function(z,K,ee){const te=this;const ne=this.genome;return te.readHeader().then((function(z){return getChrAliasTable()})).then((function(ne){var re=ne.hasOwnProperty(z)?ne[z]:z,ie=te.url+"/variants/search";return ga4ghSearch({url:ie,fields:te.includeCalls?void 0:"nextPageToken,variants(id,variantSetId,names,referenceName,start,end,referenceBases,alternateBases,quality,filter,info)",body:{variantSetIds:Array.isArray(te.variantSetId)?te.variantSetId:[te.variantSetId],callSetIds:te.callSetIds?te.callSetIds:void 0,referenceName:re,start:K.toString(),end:ee.toString(),pageSize:"10000"},decode:function(z){var K;var ee=[];z.variants.forEach((function(z){K=createGAVariant(z);K.isRefBlock()||ee.push(K)}));return ee}})}));function getChrAliasTable(){return new Promise((function(z,K){te.chrAliasTable?z(te.chrAliasTable):te.readMetadata().then((function(K){te.metadata=K.metadata;te.chrAliasTable={};K.referenceBounds&&ne&&K.referenceBounds.forEach((function(z){var K=z.referenceName,ee=ne.getChromosomeName(K);te.chrAliasTable[ee]=K}));z(te.chrAliasTable)}))}))}};Ga4ghVariantReader.prototype.readMetadata=function(){return ga4ghGet({url:this.url,entity:"variantsets",entityId:this.variantSetId})};class CivicReader{constructor(z){this.config=z}async readFeatures(z,K,ee){const te=await Wo.loadJson(this.config.url+"/variants/?count=50000");const ne=te.records;const re=[];for(let z of ne)if(z.coordinates){z.id;const K=z.coordinates;K.chromosome&&re.push(new CivicVariant(K.chromosome,K.start-1,K.stop,z));K.chromosome2&&re.push(new CivicVariant(K.chromosome2,K.start2-1,K.stop2,z))}return re}}class CivicVariant{constructor(z,K,ee,te){this.chr=z;this.start=K;this.end=ee;this.id=te.id;this.entrezName=te.entrez_name;this.name=te.name;this.actionabilityScore=te.civic_actionability_score;te.coordinates.reference_bases&&(this.refBases=te.coordinates.reference_bases);te.coordinates.variant_bases&&(this.altBases=te.coordinates.variant_bases);te.variant_types&&(this.variant_types=te.variant_types);this.locationString=this.chr+":"+numberFormatter$1(this.start+1)+"-"+numberFormatter$1(this.end);if(void 0!==this.actionabilityScore){let z;if(this.actionabilityScore<=10)z=.2;else{const K=Math.min(30,this.actionabilityScore);z=.2+.8*Math.log10((K-10)/2)}this.alpha=z}}popupData(){const z=createLink("CIViC","https://civicdb.org/links/variants/"+this.id);this.refBases!==this.altBases&&this.refBases&&1===this.refBases.length&&this.altBases&&1===this.altBases.length;const K=[z];K.push({name:"Entrez",value:createLink(this.entrezName,"https://ghr.nlm.nih.gov/gene/"+this.entrezName)});K.push({name:"Name",value:this.name});if(this.variant_types&&this.variant_types.length>0){const z=1===this.variant_types.length?"Type":"Types";let ee;for(let z of this.variant_types)ee?ee+=", "+z.display_name:ee=z.display_name;K.push({name:z,value:ee})}K.push({name:"Actionability",value:this.actionabilityScore});K.push({name:"Location",value:this.locationString});return K;function createLink(z,K){return"<a target='_blank' href='"+K+"'>"+z+"</a>"}}}class HtsgetReader{constructor(z,K){this.config=z;this.genome=K;this.format=z.format?z.format.toUpperCase():"BAM";if(!("BAM"===this.format||"VCF"===this.format))throw Error(`htsget format ${z.format} is not supported`)}async readHeaderData(){const z=`${getUrl(this.config)}?class=header&format=${this.format}`;const K=await Wo.loadJson(z,buildOptions(this.config));return await this.loadUrls(K.htsget.urls)}async readData(z,K,ee){const te=`${getUrl(this.config)}?format=${this.format}&referenceName=${z}&start=${Math.floor(K)}&end=${Math.ceil(ee)}`;const ne=await Wo.loadJson(te,buildOptions(this.config));return this.loadUrls(ne.htsget.urls)}async loadUrls(z){const K=[];for(let ee of z)if(ee.url.startsWith("data:"))K.push(Promise.resolve(dataUriToBytes(ee.url)));else{const z=buildOptions(this.config||{});ee.headers&&(z.headers=Object.assign(z.headers||{},ee.headers));K.push(Wo.loadArrayBuffer(ee.url,z))}const ee=await Promise.all(K);return concatArrays(ee)}static async inferFormat(z){try{const K=getUrl(z);const ee=`${K}${K.includes("?")?"&":"?"}class=header`;const te=await Wo.loadJson(ee,buildOptions(z));if(te.htsget){const K=te.htsget.format;if(!("BAM"===K||"VCF"===K))throw Error(`htsget format ${K} is not supported`);z.format=K.toLowerCase();z.sourceType="htsget";z.name||(z.name=await getFilename$1(z.url))}}catch(z){}}}
/**
     * Extract the full url from the config.  Striving for backward compatibility, "endpoint" and "id" are deprecated.
     *
     * @param config
     */function getUrl(z){if(z.url&&z.endpoint&&z.id)return z.url+z.endpoint+z.id;if(z.endpoint&&z.id)return z.endpoint+z.id;if(z.url)return z.url.startsWith("htsget://")?z.url.replace("htsget://","https://"):z.url;throw Error("Must specify either 'url', or 'endpoint' and 'id")}
/**
     * Concatenate a list of array buffers, returning an UInt8Array
     * @param arrayBuffers
     */function concatArrays(z){let K=0;for(let ee of z)K+=ee.byteLength;let ee=0;const te=new Uint8Array(K);for(let K of z){const z=new Uint8Array(K);te.set(z,ee);ee+=z.length}return te}function dataUriToBytes(z){const K=z.split(",");const ee=K[0].split(":")[1];let te=K[1];te=ee.indexOf("base64")>=0?atob(te):decodeURI(te);const ne=new Uint8Array(te.length);for(var re=0;re<te.length;re++)ne[re]=te.charCodeAt(re);return ne}class HtsgetVariantReader extends HtsgetReader{constructor(z,K){super(z,K);this.parser=new VcfParser}async readHeader(){if(!this.header){const z=await this.readHeaderData();const K=getDataWrapper(z);this.header=await this.parser.parseHeader(K,this.genome);this.chrAliasTable=this.header.chrAliasTable}return this.header}async readFeatures(z,K,ee){if(this.config.format&&"VCF"!==this.config.format.toUpperCase())throw Error(`htsget format ${this.config.format} is not supported`);this.chrAliasTable||await this.readHeader();let te=this.chrAliasTable.has(z)?this.chrAliasTable.get(z):z;const ne=await this.readData(te,K,ee);const re=getDataWrapper(ne);return this.parser.parseFeatures(re)}}function pack(z,K){K=K||Number.MAX_SAFE_INTEGER;const ee=[];z.sort((function(z,K){return z.start-K.start}));ee.push(-1e3);for(let te of z){let z=0;const ne=Math.min(ee.length,K);for(z=0;z<ne;z++)if(te.start>=ee[z]){te.row=z;ee[z]=te.end;break}te.row=z;ee[z]=te.end}}const il=1e4;
/**
     * Return a collection of "whole genome" features wrapping the supplied features, possibly downsampled.  The purpose
     * is to support painting features in "whole genome view".
     *
     * @param allFeatures - dictionary (object), keys are chromosome names, values are lists of features
     * @param genome
     * @param maxWGCount - optional, maximum # of whole genome features to computer
     * @returns {*[]}
     */function computeWGFeatures(z,K,ee){const te=ee||il;const makeWGFeature=z=>{const ee=Object.assign({},z);ee.chr="all";ee.start=K.getGenomeCoordinate(z.chr,z.start);ee.end=K.getGenomeCoordinate(z.chr,z.end);ee._f=z;ee.exons&&delete ee.exons;return ee};const ne=new Set(K.wgChromosomeNames);const re=[];let ie=0;for(let ee of K.wgChromosomeNames){if(Array.isArray(z)){const ee={};for(let te of z){const z=K.getChromosomeName(te.chr);ee.hasOwnProperty(z)||(ee[z]=[]);ee[z].push(te)}z=ee}const se=z[ee];if(se)for(let z of se){let ee=K.getChromosomeName(z.chr);if(ne.has(ee))if(re.length<te)re.push(makeWGFeature(z));else{const K=te/(ie+1);if(Math.random()<K){const K=Math.floor(Math.random()*(te-1));re[K]=makeWGFeature(z)}}ie++}}re.sort((function(z,K){return z.start-K.start}));return re}function packFeatures(z,K){K=K||1e3;if(null==z||0===z.length)return;const ee={};const te=[];for(let K of z){const z=K.chr;let ne=ee[z];if(!ne){ne=[];ee[z]=ne;te.push(z)}ne.push(K)}for(let z of te)pack(ee[z],K)}const sl=1e4;
/**
     * feature source for "bed like" files (tab or whitespace delimited files with 1 feature per line: bed, gff, vcf, etc)
     *
     * @param config
     * @constructor
     */class TextFeatureSource{constructor(z,K){this.config=z||{};this.genome=K;this.sourceType=void 0===z.sourceType?"file":z.sourceType;this.maxWGCount=z.maxWGCount||sl;const ee=new Set(["bigwig","bw","bigbed","bb","biginteract","biggenepred","bignarrowpeak","tdf"]);this.queryable=z.indexURL||true===z.queryable;if(z.reader){this.reader=z.reader;this.queryable=false!==z.queryable}else if("ga4gh"===z.sourceType){this.reader=new Ga4ghVariantReader(z,K);this.queryable=true}else if("immvar"===z.sourceType){this.reader=new ImmVarReader(z);this.queryable=true}else if("eqtl"===z.type&&"gtex-ws"===z.sourceType){this.reader=new GtexReader(z);this.queryable=true}else if("htsget"===z.sourceType){this.reader=new HtsgetVariantReader(z,K);this.queryable=true}else if("ucscservice"===z.sourceType){this.reader=new UCSCServiceReader(z.source);this.queryable=true}else if("custom"===z.sourceType){this.reader=new CustomServiceReader(z.source);this.queryable=false!==z.source.queryable}else if("civic-ws"===z.sourceType){this.reader=new CivicReader(z);this.queryable=false}else{this.reader=new FeatureFileReader(z,K);void 0!==z.queryable?this.queryable=z.queryable:(ee.has(z.format)||this.reader.indexed)&&(this.queryable=true)}this.searchable=true===z.searchable||z.searchableFields||false!==z.searchable&&!this.queryable}async defaultVisibilityWindow(){if(this.reader&&"function"===typeof this.reader.defaultVisibilityWindow)return this.reader.defaultVisibilityWindow()}async trackType(){const z=await this.getHeader();return z?z.type:void 0}async getHeader(){if(!this.header)if(this.reader&&"function"===typeof this.reader.readHeader){const z=await this.reader.readHeader();if(z){this.header=z;z.format&&(this.config.format=z.format)}else this.header={}}else this.header={};return this.header}
/**
         * Required function for all data source objects.  Fetches features for the
         * range requested.
         *
         * This function is quite complex due to the variety of reader types backing it, some indexed, some queryable,
         * some not.
         *
         * @param chr
         * @param start
         * @param end
         * @param bpPerPixel
         */async getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,visibilityWindow:ne}){const re=this.genome;const ie=re?re.getChromosomeName(z):z;const se="all"===ie.toLowerCase();(se&&!this.wgFeatures&&this.supportsWholeGenome()||this.config.disableCache||!this.featureCache||!this.featureCache.containsRange(new GenomicInterval(ie,K,ee)))&&await this.loadFeatures(ie,K,ee,ne);if(se){this.wgFeatures||(this.supportsWholeGenome()?this.wgFeatures=computeWGFeatures(this.featureCache.getAllFeatures(),this.genome,this.maxWGCount):this.wgFeatures=[]);return this.wgFeatures}return this.featureCache.queryFeatures(ie,K,ee)}supportsWholeGenome(){return!this.queryable}getAllFeatures(){return this.queryable||!this.featureCache?[]:this.featureCache.getAllFeatures()}async loadFeatures(z,K,ee,te){const ne=this.reader;let re=K;let ie=ee;if((!te||te<=0)&&false!==this.config.expandQuery){const K=this.genome?this.genome.getChromosome(z):void 0;re=0;ie=Math.max(K?K.bpLength:Number.MAX_SAFE_INTEGER,ee)}else if(te>ee-K&&false!==this.config.expandQuery){const z=Math.min(4.1*(ee-K),te);re=Math.max(0,(K+ee)/2-z);ie=K+z}let se=await ne.readFeatures(z,re,ie);void 0===this.queryable&&(this.queryable=ne.indexed);const oe=this.queryable?new GenomicInterval(z,re,ie):void 0;if(se){false===this.config.assembleGFF||"gtf"!==this.config.format&&"gff3"!==this.config.format&&"gff"!==this.config.format||(se=new GFFHelper(this.config).combineFeatures(se,oe));if("wig"!==this.config.format&&"junctions"!==this.config.type){const z=this.config.maxRows||Number.MAX_SAFE_INTEGER;packFeatures(se,z)}this.featureCache=new FeatureCache$1(se,this.genome,oe);this.searchable&&this.genome.addFeaturesToDB(se,this.config)}else this.featureCache=new FeatureCache$1([],oe)}}class BufferedReader{constructor(z,K,ee){this.path=z.url;this.bufferSize=ee||512e3;this.range={start:-1,size:-1};this.config=z}
/**
         *
         * @param requestedRange - byte rangeas {start, size}
         * @param fulfill - function to receive result
         * @param asUint8 - optional flag to return result as an UInt8Array
         */async dataViewForRange(z,K,ee=0){try{const ee=this.data&&this.range.start<=z.start&&this.range.start+this.range.size>=z.start+z.size;if(!ee){let K;K=z.size?Math.max(this.bufferSize,z.size):this.bufferSize;this.contentLength&&(K=Math.min(K,this.contentLength-z.start));const ee={start:z.start,size:K};const te=await Wo.loadArrayBuffer(this.path,buildOptions(this.config,{range:ee}));this.data=te;this.range=ee}const te=this.data.byteLength;const ne=z.start-this.range.start;return K?new Uint8Array(this.data,ne,te-ne):new DataView(this.data,ne,te-ne)}catch(te){if(0===ee&&te.message&&te.message.startsWith("416")){try{this.contentLength=await Wo.getContentLength(this.path,buildOptions(this.config));return this.dataViewForRange(z,K,++ee)}catch(z){console.error(z)}throw te}}}}function getDecoder(z,K,ee,te){if("biginteract"===te||ee&&"chromatinInteract"===ee.table||"interact"===ee.table)return decodeInteract;{const te=z-3;return function(ne,re){te>0&&(ne.name=re[0]);te>1&&(ne.score=Number(re[1]));te>2&&(ne.strand=re[2]);te>3&&(ne.cdStart=parseInt(re[3]));te>4&&(ne.cdEnd=parseInt(re[4]));if(te>5&&"."!==re[5]&&"0"!==re[5]&&"-1"!==re[5]){const z=$o.createColorString(re[5]);ne.color=z.startsWith("rgb")?z:void 0}if(te>8){const z=parseInt(re[6]);const K=re[7].split(",");const ee=re[8].split(",");const te=[];for(let re=0;re<z;re++){const z=ne.start+parseInt(ee[re]);const ie=z+parseInt(K[re]);te.push({start:z,end:ie})}findUTRs(te,ne.cdStart,ne.cdEnd);ne.exons=te}if(ee){const te=z;for(let z=te;z<K;z++)if(z<ee.fields.length){const K=ee.fields[z].name;const te=re[z-3];ne[K]=te}}}}function decodeInteract(z,K){z.chr1=K[5];z.start1=Number.parseInt(K[6]);z.end1=Number.parseInt(K[7]);z.chr2=K[10];z.start2=Number.parseInt(K[11]);z.end2=Number.parseInt(K[12]);z.name=K[0];z.score=Number(K[1]);z.value=Number(K[2]);z.color="."===K[4]?void 0:"0"===K[4]?"rgb(0,0,0)":K[4];return z}}function findUTRs(z,K,ee){for(let te of z){const z=te.end;const ne=te.start;if(z<K||ne>ee)te.utr=true;else{K>=ne&&K<=z&&(te.cdStart=K);ee>=ne&&ee<=z&&(te.cdEnd=ee)}}}function scoreShade(z,K){const ee=Math.min(1,.11+z/779*.89);return ee.toString()}function parseAutoSQL(z){let K;const ee=[];let te=false;const ne=z.trim().split(/\s*[\r\n]+\s*/g);for(let z of ne)if(z.startsWith("table"))K=z.split(/\s+/)[1].trim();else if(z.startsWith("("))te=true;else if(z.startsWith(")"));else if(te&&z.length>0){const K=z.indexOf(";");const te=z.substr(0,K).split(/\s+/);const ne=z.substr(K+1).replace(/"/g,"").trim();ee.push({type:te[0],name:te[1],description:ne})}return{table:K,fields:ee}}let ol=2291137574;let al=654085990;let ll=2273964779;let cl=3958540679;let hl=64;let ul=48;let dl=32;let fl=24;let pl=512e3;class BWReader{constructor(z,K){this.path=z.url;this.format=z.format||"bigwig";this.genome=K;this.rpTreeCache={};this.config=z;this.loader=isDataURL(this.path)?new DataBuffer(this.path):Wo}async readWGFeatures(z,K){await this.loadHeader();const ee=0;const te=this.chromTree.idToChrom.length-1;const ne=this.chromTree.idToChrom[ee];const re=this.chromTree.idToChrom[te];return this.readFeatures(ne,0,re,Number.MAX_VALUE,z,K)}async readFeatures(z,K,ee,te,ne,re){await this.loadHeader();const ie=this.chromTree.chromToID[z];const se=this.chromTree.chromToID[ee];if(void 0===ie||void 0===se)return[];let oe;let ae;if("bigwig"===this.type){const z=await this.getZoomHeaders();let K=ne?zoomLevelForScale$1(ne,z):void 0;if(K){oe=K.indexOffset;ae=decodeZoomData}else{oe=this.header.fullIndexOffset;ae=decodeWigData}}else{oe=this.header.fullIndexOffset;ae=getBedDataDecoder.call(this)}const le=await this.loadRPTree(oe);const ce=await le.findLeafItemsOverlapping(ie,K,se,te);if(ce&&0!==ce.length){let z=Number.MAX_VALUE;let ee=0;for(let K of ce){z=Math.min(z,K.dataOffset);ee=Math.max(ee,K.dataOffset+K.dataSize)}const ne=ee-z;const oe=await this.loader.loadArrayBuffer(this.config.url,buildOptions(this.config,{range:{start:z,size:ne}}));const le=[];for(let ee of ce){const ne=new Uint8Array(oe,ee.dataOffset-z,ee.dataSize);let ce;const he=this.header.uncompressBuffSize>0;ce=he?Do(ne):ne;ae.call(this,new DataView(ce.buffer),ie,K,se,te,le,this.chromTree.idToChrom,re)}le.sort((function(z,K){return z.start-K.start}));return le}return[]}async getZoomHeaders(){if(this.zoomLevelHeaders)return this.zoomLevelHeaders;await this.loadHeader();return this.zoomLevelHeaders}async loadHeader(){if(this.header)return this.header;{let z=await this.loader.loadArrayBuffer(this.path,buildOptions(this.config,{range:{start:0,size:hl}}));let K;this.littleEndian=true;let ee=new BinaryParser(new DataView(z));let te=ee.getUInt();if(te===ol)this.type="bigwig";else if(te===ll)this.type="bigbed";else{this.littleEndian=false;ee.littleEndian=false;ee.position=0;let z=ee.getUInt();z===al?this.type="bigwig":z===cl&&(this.type="bigbed")}K={bwVersion:ee.getUShort(),nZoomLevels:ee.getUShort(),chromTreeOffset:ee.getLong(),fullDataOffset:ee.getLong(),fullIndexOffset:ee.getLong(),fieldCount:ee.getUShort(),definedFieldCount:ee.getUShort(),autoSqlOffset:ee.getLong(),totalSummaryOffset:ee.getLong(),uncompressBuffSize:ee.getInt(),extensionOffset:ee.getLong()};const ne=hl;let re={start:ne,size:K.fullDataOffset-ne+5};z=await this.loader.loadArrayBuffer(this.path,buildOptions(this.config,{range:re}));const ie=K.nZoomLevels;ee=new BinaryParser(new DataView(z));this.zoomLevelHeaders=[];this.firstZoomDataOffset=Number.MAX_SAFE_INTEGER;for(let z=1;z<=ie;z++){const K=ie-z;const te=new ZoomLevelHeader(K,ee);this.firstZoomDataOffset=Math.min(te.dataOffset,this.firstZoomDataOffset);this.zoomLevelHeaders[K]=te}if(K.autoSqlOffset>0){ee.position=K.autoSqlOffset-ne;const z=ee.getString();z&&(this.autoSql=parseAutoSQL(z))}if(K.totalSummaryOffset>0){ee.position=K.totalSummaryOffset-ne;this.totalSummary=new BWTotalSummary(ee)}if(!(K.chromTreeOffset>0))throw"BigWig chromosome tree offset <= 0";ee.position=K.chromTreeOffset-ne;this.chromTree=new BPTree(ee,ne,this.genome);ee.position=K.fullDataOffset-ne;K.dataCount=ee.getInt();this.setDefaultVisibilityWindow(K);this.header=K;return this.header}}async loadRPTree(z){let K=this.rpTreeCache[z];if(K)return K;K=new RPTree(z,this.config,this.littleEndian,this.loader);await K.load();this.rpTreeCache[z]=K;return K}async getType(){await this.loadHeader();return this.type}async getTrackType(){await this.loadHeader();return"bigwig"===this.type?"wig":this.autoSql&&"chromatinInteract"===this.autoSql.table?"interact":"annotation"}setDefaultVisibilityWindow(z){if("bigwig"===this.type)this.visibilityWindow=-1;else{let K=this.genome?this.genome.getGenomeLength():3088286401;this.visibilityWindow=z.dataCount<1e3?-1:K/z.dataCount*1e3}}}class ZoomLevelHeader{constructor(z,K){this.index=z;this.reductionLevel=K.getInt();this.reserved=K.getInt();this.dataOffset=K.getLong();this.indexOffset=K.getLong()}}class RPTree{constructor(z,K,ee,te){this.config=K;this.loader=te;this.fileOffset=z;this.path=K.url;this.littleEndian=ee}async load(){const z=this.fileOffset+ul;const K=isDataURL(this.path)?this.loader:new BufferedReader(this.config,pl);this.rootNode=await this.readNode(z,K);return this}async readNode(z,K){let ee=await K.dataViewForRange({start:z,size:4},false);let te=new BinaryParser(ee,this.littleEndian);const ne=te.getByte();const re=1===ne;te.getByte();const ie=te.getUShort();z+=4;let se=ie*(re?dl:fl);let oe={start:z,size:se};ee=await K.dataViewForRange(oe,false);const ae=new Array(ie);te=new BinaryParser(ee);if(re){for(let z=0;z<ie;z++){let K={isLeaf:true,startChrom:te.getInt(),startBase:te.getInt(),endChrom:te.getInt(),endBase:te.getInt(),dataOffset:te.getLong(),dataSize:te.getLong()};ae[z]=K}return new RPTreeNode(ae)}for(let z=0;z<ie;z++){let K={isLeaf:false,startChrom:te.getInt(),startBase:te.getInt(),endChrom:te.getInt(),endBase:te.getInt(),childOffset:te.getLong()};ae[z]=K}return new RPTreeNode(ae)}async findLeafItemsOverlapping(z,K,ee,te){let ne=this;return new Promise((function(re,ie){let se=[],oe=new Set,ae=isDataURL(ne.path)?ne.loader:new BufferedReader(ne.config,pl);oe.add(0);findLeafItems(ne.rootNode,0);function findLeafItems(le,ce){if(overlaps(le,z,K,ee,te)){let re=le.items;re.forEach((function(re){if(overlaps(re,z,K,ee,te))if(re.isLeaf)se.push(re);else if(re.childNode)findLeafItems(re.childNode);else{oe.add(re.childOffset);ne.readNode(re.childOffset,ae).then((function(z){re.childNode=z;findLeafItems(z,re.childOffset)})).catch(ie)}}))}void 0!==ce&&oe.delete(ce);0===oe.size&&re(se)}}))}}class RPTreeNode{constructor(z){this.items=z;let K,ee,te=Number.MAX_SAFE_INTEGER,ne=0,re=Number.MAX_SAFE_INTEGER,ie=0;for(K=0;K<z.length;K++){ee=z[K];te=Math.min(te,ee.startChrom);ne=Math.max(ne,ee.endChrom);re=Math.min(re,ee.startBase);ie=Math.max(ie,ee.endBase)}this.startChrom=te;this.endChrom=ne;this.startBase=re;this.endBase=ie}}class BPTree{constructor(z,K,ee){let te=z.getInt();let ne=z.getInt();let re=z.getInt();let ie=z.getInt();let se=z.getLong();let oe=z.getLong();let ae={};let le=[];this.header={magic:te,blockSize:ne,keySize:re,valSize:ie,itemCount:se,reserved:oe};this.chromToID=ae;this.idToChrom=le;readTreeNode(z,-1);function readTreeNode(z,te){te>=0&&(z.position=te);let ne=z.getByte();z.getByte();let ie,se,oe,ce,he,ue,de=z.getUShort();if(1===ne)for(ie=0;ie<de;ie++){se=z.getFixedLengthTrimmedString(re);oe=z.getInt();z.getInt();ee&&(se=ee.getChromosomeName(se));ae[se]=oe;le[oe]=se}else for(ie=0;ie<de;ie++){se=z.getFixedLengthTrimmedString(re);ce=z.getLong();he=ce-K;ue=z.position;readTreeNode(z,he);z.position=ue}}}}
/**
     * Return true if {chrIdx1:startBase-chrIdx2:endBase} overlaps item's interval
     * @returns {boolean}
     */function overlaps(z,K,ee,te,ne){if(!z){console.log("null item for "+K+" "+ee+" "+ne);return false}return(te>z.startChrom||te===z.startChrom&&ne>=z.startBase)&&(K<z.endChrom||K===z.endChrom&&ee<=z.endBase)}class BWTotalSummary{constructor(z){if(z){this.basesCovered=z.getLong();this.minVal=z.getDouble();this.maxVal=z.getDouble();this.sumData=z.getDouble();this.sumSquares=z.getDouble();computeStats.call(this)}else{this.basesCovered=0;this.minVal=0;this.maxVal=0;this.sumData=0;this.sumSquares=0;this.mean=0;this.stddev=0}}}function computeStats(){let z=this.basesCovered;if(z>0){this.mean=this.sumData/z;this.stddev=Math.sqrt(this.sumSquares/(z-1));let K=this.minVal<0?this.mean-2*this.stddev:0,ee=this.maxVal>0?this.mean+2*this.stddev:0;this.defaultRange={min:K,max:ee}}}function zoomLevelForScale$1(z,K){let ee;for(let te=0;te<K.length;te++){const ne=K[te];if(ne.reductionLevel<z){ee=ne;break}}return ee}function decodeWigData(z,K,ee,te,ne,re,ie){const se=new BinaryParser(z);const oe=se.getInt();const ae=se.getInt();let le=ae;let ce=se.getInt();const he=se.getInt();const ue=se.getInt();const de=se.getByte();se.getByte();let fe=se.getUShort();if(oe>=K&&oe<=te){let z=0;while(fe-- >0){let fe;switch(de){case 1:le=se.getInt();ce=se.getInt();fe=se.getFloat();break;case 2:le=se.getInt();fe=se.getFloat();ce=le+ue;break;case 3:fe=se.getFloat();le=ae+z*he;ce=le+ue;z++;break}if(!(oe<K||oe===K&&ce<ee)){if(oe>te||oe===te&&le>=ne)break;if(Number.isFinite(fe)){const z=ie[oe];re.push({chr:z,start:le,end:ce,value:fe})}}}}}function getBedDataDecoder(){const z=13;const K=getDecoder(this.header.definedFieldCount,this.header.fieldCount,this.autoSql,this.format);return function(ee,te,ne,re,ie,se,oe){const ae=new BinaryParser(ee);while(ae.remLength()>=z){const z=ae.getInt();const ee=oe[z];const le=ae.getInt();const ce=ae.getInt();const he=ae.getString();if(!(z<te||z===te&&ce<ne)){if(z>re||z===re&&le>=ie)break;if(ce>0){const z={chr:ee,start:le,end:ce};se.push(z);const te=he.split("\t");K(z,te)}}}}}function decodeZoomData(z,K,ee,te,ne,re,ie,se){const oe=new BinaryParser(z);const ae=32;while(oe.remLength()>=ae){const z=oe.getInt();const ae=ie[z];const le=oe.getInt();const ce=oe.getInt();const he=oe.getInt();const ue=oe.getFloat();const de=oe.getFloat();const fe=oe.getFloat();oe.getFloat();let pe;switch(se){case"min":pe=ue;break;case"max":pe=de;break;default:pe=0===he?0:fe/he}if(!(z<K||z===K&&ce<ee)){if(z>te||z===te&&le>=ne)break;Number.isFinite(pe)&&re.push({chr:ae,start:le,end:ce,value:pe})}}}class DataBuffer{constructor(z){this.data=decodeDataURI$1(z).buffer}
/**
         * igvxhr interface
         * @param ignore
         * @param options
         * @returns {any}
         */loadArrayBuffer(z,K){const ee=K.range;return ee?this.data.slice(ee.start,ee.start+ee.size):this.data}
/**
         * BufferedReader interface
         *
         * @param requestedRange - byte rangeas {start, size}
         * @param fulfill - function to receive result
         * @param asUint8 - optional flag to return result as an UInt8Array
         */async dataViewForRange(z,K){const ee=Math.min(this.data.byteLength-z.start,z.size);return K?new Uint8Array(this.data,z.start,ee):new DataView(this.data,z.start,ee)}}class BWSource{constructor(z,K){this.reader=new BWReader(z,K);this.genome=K;this.format=z.format||"bigwig";this.wgValues={};this.queryable=true}async getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,windowFunction:ne}){const re="bigwig"===this.reader.type;const ie="all"===z.toLowerCase()?re?await this.getWGValues(ne):[]:await this.reader.readFeatures(z,K,z,ee,te,ne);re||pack(ie);return ie}async getHeader(){return this.reader.loadHeader()}getDefaultRange(){return void 0!==this.reader.totalSummary?this.reader.totalSummary.defaultRange:void 0}async defaultVisibilityWindow(){return this.reader.defaultVisibilityWindow}async getWGValues(z){const K=1e3;const ee=this.genome;if(this.wgValues[z])return this.wgValues[z];{const te=ee.getGenomeLength()/K;const ne=await this.reader.readWGFeatures(te,z);let re=[];for(let z of ne){const K=z.chr;const te=ee.getCumulativeOffset(K);const ne=Object.assign({},z);ne.chr="all";ne.start=te+z.start;ne.end=te+z.end;re.push(ne)}this.wgValues[z]=re;return re}}supportsWholeGenome(){return"bigwig"===this.reader.type}async trackType(){return this.reader.getTrackType()}}const gl=1;class TDFReader{constructor(z,K){this.config=z;this.genome=K;this.path=z.url;this.groupCache={};this.datasetCache={}}async readHeader(){if(void 0!==this.magic)return this;let z=await Wo.loadArrayBuffer(this.path,buildOptions(this.config,{range:{start:0,size:64e3}}));let K=new BinaryParser(new DataView(z));this.magic=K.getInt();this.version=K.getInt();this.indexPos=K.getLong();this.indexSize=K.getInt();K.getInt();if(this.version>=2){let z=K.getInt();this.windowFunctions=[];while(z-- >0)this.windowFunctions.push(K.getString())}this.trackType=K.getString();this.trackLine=K.getString();let ee=K.getInt();this.trackNames=[];while(ee-- >0)this.trackNames.push(K.getString());this.genomeID=K.getString();this.flags=K.getInt();this.compressed=0!==(this.flags&gl);z=await Wo.loadArrayBuffer(this.path,buildOptions(this.config,{range:{start:this.indexPos,size:this.indexSize}}));K=new BinaryParser(new DataView(z));this.datasetIndex={};let te=K.getInt();while(te-- >0){const z=K.getString();const ee=K.getLong();const te=K.getInt();this.datasetIndex[z]={position:ee,size:te}}this.groupIndex={};te=K.getInt();while(te-- >0){const z=K.getString();const ee=K.getLong();const te=K.getInt();this.groupIndex[z]={position:ee,size:te}}return this}async readDataset(z,K,ee){const te=z+"_"+K+"_"+ee;if(this.datasetCache[te])return this.datasetCache[te];{await this.readHeader();const ne=this.version<2?"":"/"+K;const re="all"===z.toLowerCase()||void 0===ee?"0":ee.toString();let ie;ie="raw"===K?"/"+z+"/raw":"/"+z+"/z"+re+ne;const se=this.datasetIndex[ie];if(void 0===se)return;const oe=await Wo.loadArrayBuffer(this.path,buildOptions(this.config,{range:{start:se.position,size:se.size}}));if(!oe)return;const ae=new BinaryParser(new DataView(oe));let le=ae.getInt();const ce={};while(le-- >0)ce[ae.getString()]=ae.getString();const he=ae.getString();const ue=ae.getFloat();let de=ae.getInt();const fe=[];while(de-- >0)fe.push({position:ae.getLong(),size:ae.getInt()});const pe={name:ie,attributes:ce,dataType:he,tileWidth:ue,tiles:fe};this.datasetCache[te]=pe;return pe}}async readRootGroup(){const z=this.genome;const K=this.groupCache["/"];if(K)return K;{const K=await this.readGroup("/");const ee=K.chromosomes;const te=K.maxZoom;te&&(this.maxZoom=Number(te));const ne=K.totalCount;ne&&(K.totalCount=Number(ne));const re={};ee&&ee.split(",").forEach((function(K){const ee=z.getChromosomeName(K);re[ee]=K}));this.chrAliasTable=re;this.groupCache["/"]=K;return K}}async readGroup(z){const K=this.groupCache[z];if(K)return K;{await this.readHeader();const K=this.groupIndex[z];if(void 0===K)return;const ee=await Wo.loadArrayBuffer(this.path,buildOptions(this.config,{range:{start:K.position,size:K.size}}));if(!ee)return;const te=new BinaryParser(new DataView(ee));const ne={name:z};let re=te.getInt();while(re-- >0){const z=te.getString();const K=te.getString();ne[z]=K}this.groupCache[z]=ne;return ne}}async readTiles(z,K){z.sort((function(z,K){return z.position-K.position}));z=z.filter((function(z){return z.size>0}));if(0===z.length)return Promise.resolve([]);const ee=z[0];const te=z[z.length-1];const ne=ee.position;const re=te.position+te.size-ne;const ie=await Wo.loadArrayBuffer(this.path,buildOptions(this.config,{range:{start:ne,size:re}}));const se=[];for(let ee of z){const z=ee.position-ne;const te=ee.size;if(te>0){let ee;if(this.compressed){const K=Do(ie.slice(z,z+te));ee=K.buffer}else ee=ie.slice(z,z+te);const ne=new BinaryParser(new DataView(ee));const re=ne.getString();let oe;switch(re){case"fixedStep":oe=createFixedStep(ne,K);break;case"variableStep":oe=createVariableStep(ne,K);break;case"bed":case"bedWithName":oe=createBed(ne,K,re);break;default:throw"Unknown tile type: "+re}se.push(oe)}}return se}async readTile(z,K){let ee=await Wo.loadArrayBuffer(this.path,buildOptions(this.config,{range:{start:z.position,size:z.size}}));if(this.compressed){const z=Do(ee);ee=z.buffer}const te=new BinaryParser(new DataView(ee));const ne=te.getString();switch(ne){case"fixedStep":return createFixedStep(te,K);case"variableStep":return createVariableStep(te,K);case"bed":case"bedWithName":return createBed(te,K,ne);default:throw"Unknown tile type: "+ne}}}function createFixedStep(z,K){const ee=z.getInt();const te=z.getInt();const ne=z.getFloat();const re=[];let ie=K;while(ie-- >0){let K=ee;const te=[];while(K-- >0)te.push(z.getFloat());re.push(te)}return{type:"fixedStep",start:te,span:ne,data:re,nTracks:K,nPositions:ee}}function createVariableStep(z,K){const ee=z.getInt();const te=z.getFloat();const ne=z.getInt();const re=[];let ie=ne;while(ie-- >0)re.push(z.getInt());z.getInt();const se=[];let oe=K;while(oe-- >0){ie=ne;const K=[];while(ie-- >0)K.push(z.getFloat());se.push(K)}return{type:"variableStep",tileStart:ee,span:te,start:re,data:se,nTracks:K,nPositions:ne}}function createBed(z,K,ee){const te=z.getInt();let ne=te;const re=[];while(ne-- >0)re.push(z.getInt());ne=te;const ie=[];while(ne-- >0)ie.push(z.getInt());z.getInt();const se=[];let oe=K;while(oe-- >0){let K=te;const ee=[];while(K-- >0)ee.push(z.getFloat());se.push(ee)}if("bedWithName"===ee){ne=te;const K=[];while(ne-- >0)K.push(z.getString())}return{type:ee,start:re,end:ie,data:se,nTracks:K,nPositions:te}}class TDFSource{constructor(z,K){this.genome=K;this.windowFunction=z.windowFunction||"mean";this.reader=new TDFReader(z,K);this.queryable=true}async getFeatures({chr:z,start:K,end:ee,bpPerPixel:te}){if("all"===z.toLowerCase()){const z=[];const K=this.genome;const ee=this.genome.wgChromosomeNames;if(ee)for(let ee of K.wgChromosomeNames){const ne=K.getChromosome(ee).bpLength;te=ne/1e3;const re=await this._getFeatures(ee,0,ne,te);if(re)for(let ee of re){const te=Object.assign({},ee);te.chr="all";te.start=K.getGenomeCoordinate(ee.chr,ee.start);te.end=K.getGenomeCoordinate(ee.chr,ee.end);te._f=ee;z.push(te)}}return z}return this._getFeatures(z,K,ee,te)}async _getFeatures(z,K,ee,te){const ne=new GenomicInterval(z,K,ee);const re=this.genome;if(!this.rootGroup){this.rootGroup=await this.reader.readRootGroup();if(!this.normalizationFactor){const z=this.rootGroup.totalCount;z&&(this.normalizationFactor=1e6/z)}}ne.bpPerPixel=te;const ie=zoomLevelForScale(z,te,re);let se=this.reader.chrAliasTable[z];let oe=this.reader.maxZoom;void 0===se&&(se=z);void 0===oe&&(oe=-1);const ae=ie>oe?"raw":this.windowFunction;const le=await this.reader.readDataset(se,ae,ie);if(null==le)return[];const ce=le.tileWidth;const he=Math.floor(K/ce);const ue=Math.floor(ee/ce);const de=1;const fe=await this.reader.readTiles(le.tiles.slice(he,ue+1),de);const pe=[];for(let ne of fe)switch(ne.type){case"bed":decodeBedTile(ne,z,K,ee,te,pe);break;case"variableStep":decodeVaryTile(ne,z,K,ee,te,pe);break;case"fixedStep":decodeFixedTile(ne,z,K,ee,te,pe);break;default:throw"Unknown tile type: "+ne.type}pe.sort((function(z,K){return z.start-K.start}));return pe}get supportsWholeGenome(){return true}}function decodeBedTile(z,K,ee,te,ne,re){const ie=z.nPositions;const se=z.start;const oe=z.end;const ae=z.data[0];for(let z=0;z<ie;z++){const ne=se[z];const ie=oe[z];if(!(ie<ee)){if(ne>te)break;re.push({chr:K,start:ne,end:ie,value:ae[z]})}}}function decodeVaryTile(z,K,ee,te,ne,re){const ie=z.nPositions;const se=z.start;const oe=z.span;const ae=z.data[0];for(let z=0;z<ie;z++){const ne=se[z];const ie=ne+oe;if(!(ie<ee)){if(ne>te)break;re.push({chr:K,start:ne,end:ie,value:ae[z]})}}}function decodeFixedTile(z,K,ee,te,ne,re){const ie=z.nPositions;let se=z.start;const oe=z.span;const ae=z.data[0];for(let z=0;z<ie;z++){const ne=se+oe;if(se>te)break;ne>=ee&&(Number.isNaN(ae[z])||re.push({chr:K,start:se,end:ne,value:ae[z]}));se=ne}}var ml=Math.log(2);function zoomLevelForScale(z,K,ee){var te=ee.getChromosome(z).bpLength;return Math.ceil(Math.log(Math.max(0,te/(700*K)))/ml)}
/**
     * feature source for features supplied directly, as opposed to reading and parsing from a file or webservice
     *
     * @param config
     * @constructor
     */class StaticFeatureSource{constructor(z,K){this.config=z;this.genome=K;this.queryable=false;this.searchable=false!==z.searchable;this.updateFeatures(z.features)}updateFeatures(z){z=fixFeatures(z,this.genome);packFeatures(z);this.config.mappings&&mapProperties(z,this.config.mappings);this.featureCache=new FeatureCache$1(z,this.genome);(this.searchable||this.config.searchableFields)&&this.genome.addFeaturesToDB(z,this.config)}
/**
         * Required function for all data source objects.  Fetches features for the
         * range requested.
         *
         * This function is complex due to the variety of reader types backing it, some indexed, some queryable,
         * some not.
         *
         * @param chr
         * @param start
         * @param end
         * @param bpPerPixel
         */async getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,visibilityWindow:ne}){const re=this.genome;const ie=re?re.getChromosomeName(z):z;const se="all"===ie.toLowerCase();return se?computeWGFeatures(this.featureCache.getAllFeatures(),this.genome,this.maxWGCount):this.featureCache.queryFeatures(ie,K,ee)}getAllFeatures(){return this.featureCache.getAllFeatures()}supportsWholeGenome(){return true}}
/**
     * This function is used to apply properties normally added during parsing to  features supplied directly in the
     * config as an array of objects.   At the moment the only application is bedpe type features.
     * @param features
     */function fixFeatures(z,K){if(K)for(let ee of z)ee.chr=K.getChromosomeName(ee.chr);return z}function mapProperties(z,K){let ee=Object.keys(K);z.forEach((function(z){ee.forEach((function(ee){z[ee]=z[K[ee]]}))}))}const bl=new Set(["bigwig","bw","bigbed","bb","biginteract","biggenepred","bignarrowpeak"]);function FeatureSource(z,K){const ee=z.format?z.format.toLowerCase():void 0;return z.features?new StaticFeatureSource(z,K):bl.has(ee)?new BWSource(z,K):"tdf"===ee?new TDFSource(z,K):new TextFeatureSource(z,K)}const vl="nickel";const wl=2/16;const yl=appleCrayonRGBA(vl,wl);const _l="rgb(190,190,190)";const kl="rgba(155,185,129)";const xl=yl;class ROISet{constructor(z,K){this.url=z.url;z.name?this.name=z.name:z.url&&isFile(z.url)?this.name=z.url.name:z.url&&isString$2(z.url)&&!z.url.startsWith("data:")&&(this.name=getFilename$2(z.url));this.isUserDefined=z.isUserDefined;if(z.features)this.featureSource=new DynamicFeatureSource(z.features,K);else{if(z.format)z.format=z.format.toLowerCase();else{const K=getFilename$2(z.url);z.format=inferFileFormat(K)}this.featureSource=z.featureSource||FeatureSource(z,K)}if(true===this.isUserDefined){this.color=z.color||xl;this.headerColor=kl}else{this.color=z.color||yl;this.headerColor=_l}}async getFeatures(z,K,ee){return this.featureSource.getFeatures({chr:z,start:K,end:ee})}async getAllFeatures(){return"function"===typeof this.featureSource.getAllFeatures?await this.featureSource.getAllFeatures():{}}addFeature(z){this.isUserDefined?this.featureSource.addFeature(z):console.error("Attempt to add ROI to non user-defined set")}removeFeature(z){this.isUserDefined?this.featureSource.removeFeature(z):console.error("Attempt to remove ROI from non user-defined set")}toJSON(){if(this.url)return{name:this.name,color:this.color,url:this.url,isUserDefined:this.isUserDefined};{const z=this.featureSource.getAllFeatures();const K=[];for(let ee of Object.keys(z))for(let te of z[ee])K.push(te);return{name:this.name,color:this.color,features:K,isUserDefined:this.isUserDefined}}}dispose(){for(let z of Object.keys(this))this[z]=void 0}}const Cl=3;function screenCoordinates(z,K,ee,te){let ne=Math.round((z-ee)/te);const re=Math.round((K-ee)/te);let ie=re-ne;if(ie<Cl){ie=Cl;ne-=1}return{x:ne,width:ie}}class DynamicFeatureSource{constructor(z,K){this.featureMap={};this.genome=K;for(let ee of z){const z=K?K.getChromosomeName(ee.chr):ee.chr;let te=this.featureMap[z];if(!te){te=[];this.featureMap[z]=te}te.push(ee)}for(let z of Object.keys(this.featureMap))this.featureMap[z].sort(((z,K)=>z.start-K.start))}getFeatures({chr:z,start:K,end:ee}){if("all"===z.toLowerCase())return computeWGFeatures(this.featureMap,this.genome);{const te=this.featureMap[z];return te?te.filter((z=>z.end>K&&z.start<ee)):[]}}getAllFeatures(){return this.featureMap}supportsWholeGenome(){return true}addFeature(z){let K=this.featureMap[z.chr];if(!K){K=[];this.featureMap[z.chr]=K}K.push(z);K.sort(((z,K)=>z.start-K.start))}removeFeature({chr:z,start:K,end:ee}){if(this.featureMap[z]){const te=`${z}-${K}-${ee}`;this.featureMap[z]=this.featureMap[z].filter((z=>te!==`${z.chr}-${z.start}-${z.end}`))}}}const Sl="rgba(68, 134, 247, 0.25)";class RulerSweeper{constructor(z,K,ee,te){this.rulerViewport=z;this.rulerSweeper=gt.div({class:"igv-ruler-sweeper"});K.appendChild(this.rulerSweeper);this.browser=ee;this.referenceFrame=te;this.isMouseHandlers=void 0;this.addBrowserObserver()}addBrowserObserver(){const observerHandler=()=>{this.referenceFrame&&(Ma.isWholeGenomeView(this.referenceFrame.chr)?this.removeMouseHandlers():this.addMouseHandlers())};this.boundObserverHandler=observerHandler.bind(this);this.browser.on("locuschange",this.boundObserverHandler)}removeBrowserObserver(){this.browser.off("locuschange",this.boundObserverHandler)}addMouseHandlers(){if(true===this.isMouseHandlers)return;const z=1;let K;let ee;let te;let ne;let re;let ie;this.boundContentMouseDownHandler=contentMouseDownHandler.bind(this);this.rulerViewport.contentDiv.addEventListener("mousedown",this.boundContentMouseDownHandler);function contentMouseDownHandler(ie){K=true;ee=true;const{x:se}=gt.translateMouseCoordinates(ie,this.rulerViewport.contentDiv);ne=te=se;re=z;this.rulerSweeper.style.display="block";this.rulerSweeper.style.backgroundColor=true===ie.shiftKey?xl:Sl;this.rulerSweeper.style.left=`${ne}px`;this.rulerSweeper.style.width=`${re}px`}this.boundDocumentMouseMoveHandler=documentMouseMoveHandler.bind(this);document.addEventListener("mousemove",this.boundDocumentMouseMoveHandler);function documentMouseMoveHandler(z){let se;if(K&&ee){const{x:K}=gt.translateMouseCoordinates(z,this.rulerViewport.contentDiv);se=Math.max(Math.min(K,this.rulerViewport.contentDiv.clientWidth),0);ie=se-te;re=Math.abs(ie);this.rulerSweeper.style.width=`${re}px`;if(ie<0){ne=te+ie;this.rulerSweeper.style.left=`${ne}px`}}}this.boundDocumentMouseUpHandler=documentMouseUpHandler.bind(this);document.addEventListener("mouseup",this.boundDocumentMouseUpHandler);function documentMouseUpHandler(te){let ie;if(true===K&&true===ee){K=ee=void 0;this.rulerSweeper.style.display="none";if(re>z){ie={start:Math.floor(this.referenceFrame.calculateEnd(ne)),end:Math.floor(this.referenceFrame.calculateEnd(ne+re))};const z=te.shiftKey;if(true===z)this.browser.roiManager.updateUserDefinedROISet(Object.assign({chr:this.referenceFrame.chr},ie));else{validateGenomicExtent(this.browser.genome.getChromosome(this.referenceFrame.chr).bpLength,ie,this.browser.minimumBases());updateReferenceFrame(this.referenceFrame,ie,this.rulerViewport.contentDiv.clientWidth);this.browser.updateViews(this.referenceFrame)}}}}this.isMouseHandlers=true}removeMouseHandlers(){this.rulerViewport.contentDiv.removeEventListener("mousedown",this.boundContentMouseDownHandler);document.removeEventListener("mousemove",this.boundDocumentMouseMoveHandler);document.removeEventListener("mouseup",this.boundDocumentMouseUpHandler);this.isMouseHandlers=false}dispose(){this.removeBrowserObserver();this.removeMouseHandlers();this.rulerSweeper.remove()}}function updateReferenceFrame(z,K,ee){z.start=Math.round(K.start);z.end=Math.round(K.end);z.bpPerPixel=(z.end-z.start)/ee}class PairedAlignment{constructor(z){this.paired=true;this.firstAlignment=z;this.chr=z.chr;this.readName=z.readName;if(z.start<z.mate.position){this.start=z.start;this.scStart=z.scStart;this.connectingStart=z.start+z.lengthOnRef;this.connectingEnd=z.mate.position}else{this.start=z.mate.position;this.scStart=this.start;this.connectingStart=z.mate.position;this.connectingEnd=z.start}this.end=Math.max(z.mate.position,z.start+z.lengthOnRef);this.lengthOnRef=this.end-this.start;let K=Math.max(this.end,z.scStart+z.scLengthOnRef);this.scLengthOnRef=K-this.scStart}setSecondAlignment(z){this.secondAlignment=z;const K=this.firstAlignment;z.start>K.start?this.connectingEnd=z.start:this.connectingStart=z.start+z.lengthOnRef;this.start=Math.min(K.start,z.start);this.end=Math.max(K.start+K.lengthOnRef,z.start+z.lengthOnRef);this.lengthOnRef=this.end-this.start;this.scStart=Math.min(K.scStart,z.scStart);const ee=Math.max(K.scStart+K.scLengthOnRef,z.scStart+z.scLengthOnRef);this.scLengthOnRef=ee-this.scStart}containsLocation(z,K){const ee=K?this.scStart:this.start;const te=K?this.scLengthOnRef:this.lengthOnRef;return z>=ee&&z<=ee+te}alignmentContaining(z,K){return this.firstAlignment.containsLocation(z,K)?this.firstAlignment:this.secondAlignment&&this.secondAlignment.containsLocation(z,K)?this.secondAlignment:void 0}popupData(z){let K=this.firstAlignment.popupData(z);if(this.secondAlignment){K.push("-------------------------------");K=K.concat(this.secondAlignment.popupData(z))}return K}isPaired(){return true}isMateMapped(){return true}isProperPair(){return this.firstAlignment.isProperPair()}get fragmentLength(){return Math.abs(this.firstAlignment.fragmentLength)}firstOfPairStrand(){return this.firstAlignment.isFirstOfPair()?this.firstAlignment.strand:this.secondAlignment&&this.secondAlignment.isFirstOfPair()?this.secondAlignment.strand:this.firstAlignment.mate.strand}hasTag(z){return this.firstAlignment.hasTag(z)||this.secondAlignment&&this.secondAlignment.hasTag(z)}}class BamAlignmentRow{constructor(){this.alignments=[];this.score=void 0}findAlignment(z){const alignmentContains=(z,K)=>K>=z.start&&K<z.start+z.lengthOnRef;let K;for(let ee=0;ee<this.alignments.length;ee++){const te=this.alignments[ee];if(z>=te.start&&z<te.start+te.lengthOnRef){te.paired?te.firstAlignment&&alignmentContains(te.firstAlignment,z)?K=te.firstAlignment:te.secondAlignment&&alignmentContains(te.secondAlignment,z)&&(K=te.secondAlignment):K=te;break}}return K}getSortValue({position:z,option:K,tag:ee},te){K||(K="BASE");const ne=this.findAlignment(z);if(void 0===ne)return Number.MAX_VALUE;switch(K){case"NUCLEOTIDE":case"BASE":return calculateBaseScore(ne,te,z);case"STRAND":return ne.strand?1:-1;case"START":return ne.start;case"TAG":return ne.tags()[ee];case"READ_NAME":return ne.readName;case"INSERT_SIZE":return-Math.abs(ne.fragmentLength);case"GAP_SIZE":return-ne.gapSizeAt(z);case"MATE_CHR":return ne.mate;case"MQ":return void 0===ne.mq?Number.MAX_VALUE:-ne.mq;case"ALIGNED_READ_LENGTH":return-ne.lengthOnRef;default:return Number.MAX_VALUE}function calculateBaseScore(z,K,ee){let te;const ne=Math.floor(ee)-K.start;ne<K.sequence.length&&(te=K.sequence.charAt(ne));if(!te)return 0;const re=z.readBaseAt(ee);const ie=z.readBaseQualityAt(ee);const se=K.coverageMap;const oe=Math.floor(ee-se.bpStart);const ae=se.coverage[oe];let le=0;if(z.insertions)for(let K of z.insertions)K.start===ee&&(le=-ae.ins);if(re){te=te.toUpperCase();if("N"===re&&0===le)le=2;else if(te!==re&&"="!==re||0!==le){if("X"===re||te!==re){const z=ae["pos"+re]+ae["neg"+re];le-=z+ie/1e3}}else le=4-ie/1e3}else{const z=ae.del;z>0?le-=z:0===le&&(le=1)}return le}}}const Al=2;function canBePaired(z){return z.isPaired()&&z.mate&&z.isMateMapped()&&z.chr===z.mate.chr&&(z.isFirstOfPair()||z.isSecondOfPair())&&!(z.isSecondary()||z.isSupplementary())}function pairAlignments(z){const K={};const ee=[];for(let te of z)for(let z of te.alignments)if(canBePaired(z)){let te=K[z.readName];if(te){te.setSecondAlignment(z);K[z.readName]=void 0}else{te=new PairedAlignment(z);K[z.readName]=te;ee.push(te)}}else ee.push(z);return ee}function unpairAlignments(z){const K=[];for(let ee of z)for(let z of ee.alignments)if(z instanceof PairedAlignment){z.firstAlignment&&K.push(z.firstAlignment);z.secondAlignment&&K.push(z.secondAlignment)}else K.push(z);return K}function packAlignmentRows(z,K,ee,te){if(z){if(0===z.length)return[];{z.sort((function(z,K){return te?z.scStart-K.scStart:z.start-K.start}));const K=[];let ee;let ne=0;let re=0;const ie=new Set;const startNewRow=()=>{ee=new BamAlignmentRow;K.push(ee);ne=0;re=0;ie.clear()};startNewRow();while(z.length>0)if(re>=0&&re<z.length){const K=z[re];ie.add(K);ee.alignments.push(K);ne=te?K.scStart+K.scLengthOnRef+Al:K.start+K.lengthOnRef+Al;re=binarySearch$1(z,(z=>(te?z.scStart:z.start)>ne),re)}else{z=z.filter((z=>!ie.has(z)));startNewRow()}return K}}}function binarySearch$1(z,K,ee){let te=ee-1,ne=z.length;while(1+te<ne){const ee=te+(ne-te>>1);K(z[ee])?ne=ee:te=ee}return ne}class AlignmentContainer{constructor(z,K,ee,{samplingWindowSize:te,samplingDepth:ne,pairsSupported:re,alleleFreqThreshold:ie}){this.chr=z;this.start=Math.floor(K);this.end=Math.ceil(ee);this.length=ee-K;this.alleleFreqThreshold=void 0===ie?.2:ie;this.coverageMap=new CoverageMap(z,K,ee,this.alleleFreqThreshold);this.alignments=[];this.downsampledIntervals=[];this.samplingWindowSize=void 0===te?100:te;this.samplingDepth=void 0===ne?1e3:ne;this.pairsSupported=void 0===re||re;this.paired=false;this.pairsCache={};this.downsampledReads=new Set;this.currentBucket=new DownsampleBucket(this.start,this.start+this.samplingWindowSize,this);this.filter=function filter(z){return z.isMapped()&&!z.isFailsVendorQualityCheck()}}push(z){if(false!==this.filter(z)){this.coverageMap.incCounts(z);if(!this.pairsSupported||!this.downsampledReads.has(z.readName)){if(z.start>=this.currentBucket.end){this.finishBucket();this.currentBucket=new DownsampleBucket(z.start,z.start+this.samplingWindowSize,this)}this.currentBucket.addAlignment(z)}}}forEach(z){this.alignments.forEach(z)}finish(){void 0!==this.currentBucket&&this.finishBucket();this.alignments.sort((function(z,K){return z.start-K.start}));this.pairsCache=void 0;this.downsampledReads=void 0}contains(z,K,ee){return this.chr===z&&this.start<=K&&this.end>=ee}hasDownsampledIntervals(){return this.downsampledIntervals&&this.downsampledIntervals.length>0}finishBucket(){this.alignments=this.alignments.concat(this.currentBucket.alignments);this.currentBucket.downsampledCount>0&&this.downsampledIntervals.push(new DownsampledInterval(this.currentBucket.start,this.currentBucket.end,this.currentBucket.downsampledCount));this.paired=this.paired||this.currentBucket.paired}setViewAsPairs(z){let K;K=z?pairAlignments(this.packedAlignmentRows):unpairAlignments(this.packedAlignmentRows);this.packedAlignmentRows=packAlignmentRows(K,this.start,this.end)}setShowSoftClips(z){const K=this.allAlignments();this.packedAlignmentRows=packAlignmentRows(K,this.start,this.end,z)}repack(z,K){const ee=this.allAlignments();this.packedAlignmentRows=packAlignmentRows(ee,this.start,this.end,K)}allAlignments(){const z=[];for(let K of this.packedAlignmentRows)for(let ee of K.alignments)z.push(ee);return z}getMax(z,K){return this.coverageMap.getMax(z,K)}sortRows(z){const K=[];const ee=[];for(let te of this.packedAlignmentRows){const ne=te.findAlignment(z.position);void 0!==ne?K.push(te):ee.push(te)}K.sort(((K,ee)=>{const te=z.direction;const ne=K.getSortValue(z,this);const re=ee.getSortValue(z,this);if(void 0===re&&void 0!==re)return 1;if(void 0!==ne&&void 0===re)return-1;const ie=ne>re?1:ne<re?-1:0;return true===te?ie:-ie}));for(let z of ee)K.push(z);this.packedAlignmentRows=K}}class DownsampleBucket{constructor(z,K,ee){this.start=z;this.end=K;this.alignments=[];this.downsampledCount=0;this.samplingDepth=ee.samplingDepth;this.pairsSupported=ee.pairsSupported;this.downsampledReads=ee.downsampledReads;this.pairsCache=ee.pairsCache}addAlignment(z){var K,ee,te;if(this.pairsSupported&&canBePaired(z)){te=this.pairsCache[z.readName];if(te){te.setSecondAlignment(z);this.pairsCache[z.readName]=void 0;return}}if(this.alignments.length<this.samplingDepth)if(this.pairsSupported&&canBePaired(z)){te=new PairedAlignment(z);this.paired=true;this.pairsCache[z.readName]=te;this.alignments.push(te)}else this.alignments.push(z);else{K=Math.floor(Math.random()*(this.samplingDepth+this.downsampledCount-1));if(K<this.samplingDepth){ee=this.alignments[K];if(this.pairsSupported&&canBePaired(z)){void 0!==this.pairsCache[ee.readName]&&(this.pairsCache[ee.readName]=void 0);te=new PairedAlignment(z);this.paired=true;this.pairsCache[z.readName]=te;this.alignments[K]=te}else this.alignments[K]=z;this.downsampledReads.add(ee.readName)}else this.downsampledReads.add(z.readName);this.downsampledCount++}}}class CoverageMap{constructor(z,K,ee,te){this.chr=z;this.bpStart=K;this.length=ee-K;this.coverage=new Array(this.length);this.maximum=0;this.threshold=te;this.qualityWeight=true}
/**
         * Return the maximum coverage value between start and end.  This is used for autoscaling.
         * @param start
         * @param end
         */getMax(z,K){let ee=0;const te=this.coverage.length;for(let ne=0;ne<te;ne++){const te=this.bpStart+ne;if(te>K)break;const re=this.coverage[ne];te>=z&&re&&(ee=Math.max(ee,re.total))}return ee}incCounts(z){var K=this;void 0===z.blocks?incBlockCount(z):z.blocks.forEach((function(z){incBlockCount(z)}));if(z.gaps)for(let ee of z.gaps)if("D"===ee.type){const z=ee.start-K.bpStart;for(let te=z;te<z+ee.len;te++)if(!(te<0)){this.coverage[te]||(this.coverage[te]=new Coverage(K.threshold));this.coverage[te].del++}}if(z.insertions)for(let ee of z.insertions){const z=ee.start-this.bpStart;if(!(z<0)){this.coverage[z]||(this.coverage[z]=new Coverage(K.threshold));this.coverage[z].ins++}}function incBlockCount(ee){if("S"===ee.type)return;const te=z.seq;const ne=z.qual;const re=ee.seqOffset;for(let ie=ee.start-K.bpStart,se=0;se<ee.len;ie++,se++){K.coverage[ie]||(K.coverage[ie]=new Coverage(K.threshold));const ee=void 0==te?"N":te.charAt(re+se);const oe=z.strand?"pos"+ee:"neg"+ee;const ae=ne&&re+se<ne.length?ne[re+se]:30;K.coverage[ie][oe]+=1;K.coverage[ie]["qual"+ee]+=ae;K.coverage[ie].total+=1;K.coverage[ie].qual+=ae;K.maximum=Math.max(K.coverage[ie].total,K.maximum)}}}}class Coverage{constructor(z){this.qualityWeight=true;this.posA=0;this.negA=0;this.posT=0;this.negT=0;this.posC=0;this.negC=0;this.posG=0;this.negG=0;this.posN=0;this.negN=0;this.pos=0;this.neg=0;this.qualA=0;this.qualT=0;this.qualC=0;this.qualG=0;this.qualN=0;this.qual=0;this.total=0;this.del=0;this.ins=0;this.threshold=z}hoverText(){const z=this.posA+this.posT+this.posC+this.posG+this.posN;const K=this.negA+this.negT+this.negC+this.negG+this.negN;return`${this.total} (${z}+, ${K}-)`}isMismatch(z){const K=this.threshold*(this.qualityWeight&&this.qual?this.qual:this.total);let ee=0;for(let K of["A","T","C","G"])K!==z&&(ee+=this.qualityWeight&&this.qual?this["qual"+K]:this["pos"+K]+this["neg"+K]);return ee>=K}}class DownsampledInterval{constructor(z,K,ee){this.start=z;this.end=K;this.counts=ee}popupData(z){return[{name:"start",value:this.start+1},{name:"end",value:this.end},{name:"# downsampled:",value:this.counts}]}}class SupplementaryAlignment{constructor(z){const K=z.split(",");this.chr=K[0];this.start=parseInt(K[1]);this.strand=K[2].charAt(0);this.mapQ=parseInt(K[4]);this.numMismatches=parseInt(K[5]);this.lenOnRef=Yl.computeLengthOnReference(K[3])}printString(){return this.chr+":"+numberFormatter$1(this.start)+"-"+numberFormatter$1(this.start+this.lenOnRef)+" ("+this.strand+") = "+numberFormatter$1(this.lenOnRef)+"bp @MAPQ: "+this.mapQ+" NM: "+this.numMismatches}}function createSupplementaryAlignments(z){const K=z.split(";");return K.filter((z=>z.length>0)).map((z=>new SupplementaryAlignment(z)))}const Tl=1;const El=2;const Ml=4;const Rl=8;const Il=16;const Fl=32;const Ll=64;const Bl=128;const Nl=256;const Dl=512;const Pl=1024;const Ol=2048;const zl={c:1,C:1,s:2,S:2,i:4,I:4,f:4};const Hl=50;class BamAlignment{constructor(){this.hidden=false}isMapped(){return 0===(this.flags&Ml)}isPaired(){return 0!==(this.flags&Tl)}isProperPair(){return 0!==(this.flags&El)}isFirstOfPair(){return 0!==(this.flags&Ll)}isSecondOfPair(){return 0!==(this.flags&Bl)}isSecondary(){return 0!==(this.flags&Nl)}isSupplementary(){return 0!==(this.flags&Ol)}isFailsVendorQualityCheck(){return 0!==(this.flags&Dl)}isDuplicate(){return 0!==(this.flags&Pl)}isMateMapped(){return 0===(this.flags&Rl)}isNegativeStrand(){return 0!==(this.flags&Il)}isMateNegativeStrand(){return 0!==(this.flags&Fl)}hasTag(z){const K=this.tagDict||decodeTags(this.tagBA);return K.hasOwnProperty(z)}tags(){if(!this.tagDict)if(this.tagBA){this.tagDict=decodeTags(this.tagBA);this.tagBA=void 0}else this.tagDict={};return this.tagDict}
/**
         * Does alignment (or alignment extended by soft clips) contain the genomic location?
         *
         * @param genomicLocation
         * @param showSoftClips
         * @returns {boolean|boolean}
         */containsLocation(z,K){const ee=K?this.scStart:this.start;const te=K?this.scLengthOnRef:this.lengthOnRef;return z>=ee&&z<=ee+te}popupData(z){const K=[];z=Math.floor(z);if(this.insertions){const te=this.seq;for(let ne of this.insertions){var ee=ne.start;if(z===ee||z===ee-1){K.push({name:"Insertion",value:te.substr(ne.seqOffset,ne.len)});K.push({name:"Location",value:ee});return K}}}K.push({name:"Read Name",value:this.readName});K.push("<hr/>");K.push({name:"Alignment Start",value:numberFormatter$1(1+this.start),borderTop:true});K.push({name:"Read Strand",value:true===this.strand?"(+)":"(-)",borderTop:true});let te=this.cigar;if(te&&te.length>Hl){const z=Hl/2;te=`${te.substring(0,z-2)} ... ${te.substring(te.length-z+2)}`}K.push({name:"Cigar",value:te});K.push({name:"Mapping Quality",value:this.mq});K.push({name:"Secondary",value:yesNo(this.isSecondary())});K.push({name:"Supplementary",value:yesNo(this.isSupplementary())});K.push({name:"Duplicate",value:yesNo(this.isDuplicate())});K.push({name:"Failed QC",value:yesNo(this.isFailsVendorQualityCheck())});if(this.isPaired()){K.push("<hr/>");K.push({name:"First in Pair",value:!this.isSecondOfPair(),borderTop:true});K.push({name:"Mate is Mapped",value:yesNo(this.isMateMapped())});this.pairOrientation&&K.push({name:"Pair Orientation",value:this.pairOrientation});if(this.isMateMapped()){K.push({name:"Mate Chromosome",value:this.mate.chr});K.push({name:"Mate Start",value:this.mate.position+1});K.push({name:"Mate Strand",value:true===this.mate.strand?"(+)":"(-)"});K.push({name:"Insert Size",value:this.fragmentLength})}}const ne=this.tags();if(ne.hasOwnProperty("SA")){K.push("<hr/>");K.push({name:"Supplementary Alignments",value:""});const z=createSupplementaryAlignments(ne.SA);if(z){K.push("<ul>");for(let ee of z)K.push(`<li>${ee.printString()}</li>`);K.push("</ul>")}}const re=new Set(["SA","MD"]);K.push("<hr/>");for(let z in ne)re.has(z)||K.push({name:z,value:ne[z]});K.push({name:"Hidden Tags",value:"SA, MD"});K.push("<hr/>");K.push({name:"Genomic Location: ",value:numberFormatter$1(1+z)});K.push({name:"Read Base:",value:this.readBaseAt(z)});K.push({name:"Base Quality:",value:this.readBaseQualityAt(z)});return K;function yesNo(z){return z?"Yes":"No"}}readBaseAt(z){const K=blockAtGenomicLocation(this.blocks,z);if(K){if("*"===this.seq)return"*";{const ee=K.seqIndexAt(z);return this.seq[ee]}}}readBaseQualityAt(z){const K=blockAtGenomicLocation(this.blocks,z);if(K){if("*"===this.qual)return 30;{const ee=K.seqIndexAt(z);return ee>=0&&this.qual&&ee<this.qual.length?this.qual[ee]:30}}}gapSizeAt(z){if(this.gaps)for(let K of this.gaps)if(z>=K.start&&z<K.start+K.len)return K.len;return 0}softClippedBlocks(){let z;let K;let ee;for(let te of this.blocks)"S"===te.type?ee?K=te:z=te:"H"!==te.type&&(ee=true);return{left:z,right:K}}}function blockAtGenomicLocation(z,K){for(let ee=0;ee<z.length;ee++){const te=z[ee];if(K>=te.start&&K<te.start+te.len)return te}}function decodeTags(z){let K=0;const ee=z.length;const te={};while(K<ee){const ee=String.fromCharCode(z[K])+String.fromCharCode(z[K+1]);K+=2;const re=String.fromCharCode(z[K++]);let ie;if("A"===re){ie=String.fromCharCode(z[K]);K++}else if("i"===re||"I"===re){ie=readInt$1(z,K);K+=4}else if("c"===re){ie=readInt8(z,K);K++}else if("C"===re){ie=readUInt8(z,K);K++}else if("s"===re||"S"===re){ie=readShort(z,K);K+=2}else if("f"===re){ie=readFloat(z,K);K+=4}else if("Z"===re){ie="";for(;;){var ne=z[K++];if(0===ne)break;ie+=String.fromCharCode(ne)}}else{if("B"!==re){ie="Error unknown type: "+re;te[ee]=ie;break}{const ne=String.fromCharCode(z[K++]);let re=zl[ne];if(void 0===re){te[ee]=`Error: unknown element type '${ne}'`;break}const se=readInt$1(z,K);K+=4+se*re;ie="[not shown]"}}te[ee]=ie}return te}function readInt$1(z,K){return z[K+3]<<24|z[K+2]<<16|z[K+1]<<8|z[K]}function readShort(z,K){return z[K+1]<<8|z[K]}function readFloat(z,K){const ee=new DataView(z.buffer);return ee.getFloat32(K)}function readInt8(z,K){const ee=new DataView(z.buffer);return ee.getInt8(K)}function readUInt8(z,K){const ee=new DataView(z.buffer);return ee.getUint8(K)}class AlignmentBlock{constructor(z){z&&Object.assign(this,z)}seqIndexAt(z){return Math.floor(z)-this.start+this.seqOffset}}class BamFilter{constructor(z){z||(z={});this.vendorFailed=void 0===z.vendorFailed||z.vendorFailed;this.duplicates=void 0===z.duplicates||z.duplicates;this.secondary=z.secondary||false;this.supplementary=z.supplementary||false;this.mqThreshold=void 0===z.mqThreshold?0:z.mqThreshold;z.readgroups&&(this.readgroups=new Set(z.readgroups))}pass(z){if(this.vendorFailed&&z.isFailsVendorQualityCheck())return false;if(this.duplicates&&z.isDuplicate())return false;if(this.secondary&&z.isSecondary())return false;if(this.supplementary&&z.isSupplementary())return false;if(z.mq<this.mqThreshold)return false;if(this.readgroups){var K=z.tags().RG;return this.readgroups.has(K)}return true}}const Ul=["=","A","C","x","G","x","x","x","T","x","x","x","x","x","x","N"];const Vl=["M","I","D","N","S","H","P","=","X","?","?","?","?","?","?","?"];const $l=16;const ql=32;const jl=new Uint8Array([66,65,77,1]);const Wl=readInt(jl,0);const Gl=.2;const Zl=100;const Ql=500;const Xl=1e4;const Yl={readHeader:function(z,K,ee){return Wo.loadArrayBuffer(z,K).then((function(z){var K,te,ne;te=unbgzf(z);ne=te;K=Yl.decodeBamHeader(ne,ee);return K}))},
/**
         *
         * @param ba  bytes to decode as a UInt8Array
         * @param genome  optional igv genome object
         * @returns {{ magicNumer: number, size: number, chrNames: Array, chrToIndex: ({}|*), chrAliasTable: ({}|*) }}
         */
decodeBamHeader:function(z,K){var ee,te,ne,re,ie,se,oe;ee=readInt(z,0);if(ee!==Wl)throw new Error("BAM header errror: bad magic number.  This could be caused by either a corrupt or missing file.");te=readInt(z,4);ne="";for(var ae=0;ae<te;++ae)ne+=String.fromCharCode(z[ae+8]);var le=readInt(z,te+8);var ce=te+12;re={};ie=[];se={};for(ae=0;ae<le;++ae){var he=readInt(z,ce);var ue="";for(var de=0;de<he-1;++de)ue+=String.fromCharCode(z[ce+4+de]);readInt(z,ce+he+4);re[ue]=ae;ie[ae]=ue;if(K){oe=K.getChromosomeName(ue);se[oe]=ue}ce=ce+8+he}return{magicNumber:ee,size:ce,chrNames:ie,chrToIndex:re,chrAliasTable:se}},bam_tag2cigar:function(z,K,ee,te,ne,re){function type2size(z){return"C"===z||"c"===z||"A"===z?1:"S"===z||"s"===z?2:"I"===z||"i"===z||"f"===z?4:0}if(1!==re.length||ne.start<0)return false;var ie=ee+(te+1>>1)+te;while(ie+4<K){var se=String.fromCharCode(z[ie])+String.fromCharCode(z[ie+1]);if("CG"===se)break;var oe=String.fromCharCode(z[ie+2]);if("B"===oe){oe=String.fromCharCode(z[ie+3]);var ae=type2size(oe);var le=readInt(z,ie+4);ie+=8+ae*le}else if("Z"===oe||"H"===oe){ie+=3;while(0!==z[ie++]);}else ie+=3+type2size(oe)}if(ie>=K)return false;if("B"!==String.fromCharCode(z[ie+2])||"I"!==String.fromCharCode(z[ie+3]))return false;var ce=readInt(z,ie+4);var he=ie+8;if(he+4*ce>K)return false;var ue="";var de=0;re.length=0;ie=he;for(var fe=0;fe<ce;++fe,ie+=4){var pe=readInt(z,ie);var ge=pe>>4;var me=Vl[15&pe];"M"!==me&&"EQ"!==me&&"X"!==me&&"D"!==me&&"N"!==me&&"="!==me||(de+=ge);ue=ue+ge+me;re.push({len:ge,ltr:me})}ne.cigar=ue;ne.lengthOnRef=de;return true},
/**
         *
         * @param ba                 bytes to decode as an UInt8Array
         * @param offset             offset position of ba array to start decoding
         * @param alignmentContainer container to receive the decoded alignments
         * @param min                minimum genomic position
         * @param max                maximum genomic position
         * @param chrIdx             chromosome index
         * @param chrNames            array of chromosome names
         * @param filter             a BamFilter object
         *
         * @return true if we have moved beyond the right end of the genomic range.
         */
decodeBamRecords:function(z,K,ee,te,ne,re,ie,se){while(K<z.length){const he=readInt(z,K);const ue=K+he+4;const de=new BamAlignment;const fe=readInt(z,K+4);const pe=readInt(z,K+8);if(ue>z.length)return;if(fe<0){K=ue;continue}if(void 0!==ne&&(fe>ne||pe>ie))return true;if(void 0!==ne&&fe<ne){K=ue;continue}const ge=readInt(z,K+12);const me=(65280&ge)>>8;const be=255&ge;const ve=readInt(z,K+16);const we=(4294901760&ve)>>16;const ye=65535&ve;const _e=readInt(z,K+20);const ke=readInt(z,K+24);const xe=readInt(z,K+28);const Ce=readInt(z,K+32);let Se=[];for(let ee=0;ee<be-1;++ee)Se.push(String.fromCharCode(z[K+36+ee]));Se=Se.join("");let Ae=0;let Te="";let Ee=K+36+be;const Me=[];let Re;for(let K=0;K<ye;++K){var oe=readInt(z,Ee);var ae=oe>>4;var le=Vl[15&oe];"M"!==le&&"EQ"!==le&&"X"!==le&&"D"!==le&&"N"!==le&&"="!==le||(Ae+=ae);Te=Te+ae+le;Ee+=4;Re={len:ae,ltr:le};Me.push(Re)}de.chr=te[fe];de.start=pe;de.flags=we;de.strand=!(we&$l);de.readName=Se;de.cigar=Te;de.lengthOnRef=Ae;de.fragmentLength=Ce;de.mq=me;Yl.bam_tag2cigar(z,ue,Ee,_e,de,Me);de.end=de.start+de.lengthOnRef;if(de.end<re){K=ue;continue}let Ie=[];const Fe=_e+1>>1;for(let K=0;K<Fe;++K){var ce=z[Ee+K];Ie.push(Ul[(240&ce)>>4]);Ie.push(Ul[15&ce])}Ie=Ie.slice(0,_e).join("");Ee+=Fe;const Le=[];for(let K=0;K<_e;++K)Le.push(z[Ee+K]);Ee+=_e;ke>=0&&(de.mate={chr:te[ke],position:xe,strand:!(we&ql)});de.seq=Ie;de.qual=Le;de.tagBA=new Uint8Array(z.buffer.slice(Ee,ue));this.setPairOrientation(de);if(void 0===se||se.pass(de)){makeBlocks(de,Me);ee.push(de)}K=ue}},decodeSamRecords:function(z,K,ee,te,ne,re){var ie,se,oe,ae,le,ce,he,ue,de,fe,pe;ie=splitLines$5(z);ae=ie.length;pe=false;for(se=0;se<ae;se++){le=ie[se].split("\t");de=new BamAlignment;de.chr=le[2];de.start=Number.parseInt(le[3])-1;de.flags=Number.parseInt(le[1]);de.readName=le[0];de.strand=!(de.flags&$l);de.mq=Number.parseInt(le[4]);de.cigar=le[5];de.fragmentLength=Number.parseInt(le[8]);de.seq=le[9];if("*"!==de.chr&&de.isMapped())if(de.chr===ee){if(de.start>ne)break;ue=0;fe=buildOperators(de.cigar);fe.forEach((function(z){var K=z.len;var ee=z.ltr;"M"!==ee&&"EQ"!==ee&&"X"!==ee&&"D"!==ee&&"N"!==ee&&"="!==ee||(ue+=K)}));de.lengthOnRef=ue;if(!(de.start+ue<te)){ce=le[10];de.qual=[];for(oe=0;oe<ce.length;oe++)de.qual[oe]=ce.charCodeAt(oe)-33;de.tagDict=le.length<11?{}:decodeSamTags(le.slice(11));if(de.isMateMapped()){he=le[6];de.mate={chr:"="===he?de.chr:he,position:Number.parseInt(le[7]),strand:!(de.flags&ql)}}this.setPairOrientation(de);if(void 0===re||re.pass(de)){makeBlocks(de,fe);K.push(de)}}}else if(pe)break}},setReaderDefaults:function(z,K){z.filter=new BamFilter(K.filter);K.readgroup&&(z.filter.readgroups=new Set([K.readgroup]));z.alleleFreqThreshold=void 0===K.alleleFreqThreshold?Gl:K.alleleFreqThreshold;z.samplingWindowSize=void 0===K.samplingWindowSize?Zl:K.samplingWindowSize;z.samplingDepth=void 0===K.samplingDepth?Ql:K.samplingDepth;if(z.samplingDepth>Xl){console.log("Warning: attempt to set sampling depth > maximum value of "+Xl);z.samplingDepth=Xl}K.viewAsPairs?z.pairsSupported=true:z.pairsSupported=void 0===K.pairsSupported||K.pairsSupported},setPairOrientation:function(z){if(z.isMapped()&&z.mate&&z.isMateMapped()&&z.mate.chr===z.chr){var K=z.strand?"F":"R";var ee=z.mate;var te=ee.strand?"F":"R";var ne=" ";var re=" ";if(z.isFirstOfPair()){ne="1";re="2"}else if(z.isSecondOfPair()){ne="2";re="1"}var ie=[];var se=z.fragmentLength;var oe=z.end-z.start;if(0===se){var ae=z.start<ee.position?ee.position+oe:ee.position-oe;se=ae-z.start}if(se>0){ie[0]=K;ie[1]=ne;ie[2]=te;ie[3]=re}else{ie[2]=K;ie[3]=ne;ie[0]=te;ie[1]=re}z.pairOrientation=ie.join("")}},computeLengthOnReference:function(z){let K=0;let ee="";for(let te=0;te<z.length;te++){const ne=z.charCodeAt(te);if(ne>47&&ne<58)ee+=z.charAt(te);else{switch(ne){case 78:case 68:case 77:case 61:case 88:K+=parseInt(ee.toString())}ee=""}}return K}};
/**
     * Split the alignment record into blocks as specified in the cigarArray.  Each aligned block contains
     * its portion of the read sequence and base quality strings.  A read sequence or base quality string
     * of "*" indicates the value is not recorded.  In all other cases the length of the block sequence (block.seq)
     * and quality string (block.qual) must == the block length.
     *
     * @param alignment
     * @param cigarArray
     * @returns array of blocks
     */function makeBlocks(z,K){const ee=[];let te;let ne;let re=0;let ie=z.start;z.scStart=z.start;z.scLengthOnRef=z.lengthOnRef;for(let se of K){let K;switch(se.ltr){case"H":break;case"P":break;case"S":K=ie;z.scLengthOnRef+=se.len;if(0===ee.length){z.scStart-=se.len;K-=se.len}ee.push(new AlignmentBlock({start:K,seqOffset:re,len:se.len,type:"S"}));re+=se.len;break;case"N":case"D":void 0===ne&&(ne=[]);ne.push({start:ie,len:se.len,type:se.ltr});ie+=se.len;break;case"I":void 0===te&&(te=[]);te.push(new AlignmentBlock({start:ie,len:se.len,seqOffset:re,type:"I"}));re+=se.len;break;case"M":case"EQ":case"=":case"X":ee.push(new AlignmentBlock({start:ie,seqOffset:re,len:se.len,type:"M"}));re+=se.len;ie+=se.len;break;default:console.log("Error processing cigar element: "+se.len+se.ltr)}}z.blocks=ee;z.insertions=te;z.gaps=ne}function readInt(z,K){return z[K+3]<<24|z[K+2]<<16|z[K+1]<<8|z[K]}
/**
     * Build a list of cigar operators from a cigarString.  Removes padding operators and concatenates consecutive
     * operators of the same type
     *
     * @param cigarString
     * @return
     */function buildOperators(z){var K,ee,te,ne,re,ie,se,oe;K=[];ee=[];re=null;ne=z.length;for(te=0;te<ne;te++){ie=z.charAt(te);if(isDigit(ie))ee.push(ie);else{se=ie;oe=Number.parseInt(ee.join(""));ee=[];if(null!==re&&re.ltr===se)re.len+=oe;else{re={len:oe,ltr:se};K.push(re)}}}return K}function isDigit(z){var K=z.charCodeAt(0);return K>=48&&K<=57}function decodeSamTags(z){var K={};z.forEach((function(z){var ee=z.split(":");K[ee[0]]=ee[2]}));return K}
/**
     * Class for reading a bam file
     *
     * @param config
     * @constructor
     */class BamReaderNonIndexed{constructor(z,K){this.config=z;this.genome=K;this.bamPath=z.url;this.isDataUri=isDataURL(z.url);Yl.setReaderDefaults(this,z)}async readAlignments(z,K,ee){if(this.alignmentCache){const te=this.header;const ne=te.chrAliasTable.hasOwnProperty(z)?te.chrAliasTable[z]:z;const re=this.alignmentCache.queryFeatures(ne,K,ee);const ie=new AlignmentContainer(z,K,ee,this.config);for(let z of re)ie.push(z);ie.finish();return ie}if(this.isDataUri){const te=decodeDataURI(this.bamPath);const ne=unbgzf(te.buffer);this.parseAlignments(ne);return this.fetchAlignments(z,K,ee)}{const te=await Wo.loadArrayBuffer(this.bamPath,buildOptions(this.config));const ne=unbgzf(te);this.parseAlignments(ne);return this.fetchAlignments(z,K,ee)}}parseAlignments(z){const K=[];this.header=Yl.decodeBamHeader(z);Yl.decodeBamRecords(z,this.header.size,K,this.header.chrNames);this.alignmentCache=new FeatureCache$1(K,this.genome)}fetchAlignments(z,K,ee){const te=this.header.chrAliasTable.hasOwnProperty(z)?this.header.chrAliasTable[z]:z;const ne=this.alignmentCache.queryFeatures(te,K,ee);const re=new AlignmentContainer(z,K,ee,this.config);for(let z of ne)re.push(z);re.finish();return re}}function decodeDataURI(z){const K=z.split(",");const ee=K[0].split(":")[1];let te=K[1];te=ee.indexOf("base64")>=0?atob(te):decodeURI(te);const ne=new Uint8Array(te.length);for(var re=0;re<te.length;re++)ne[re]=te.charCodeAt(re);return ne}
/**
     * Class for reading a bam file
     *
     * @param config
     * @constructor
     */class BamReader{constructor(z,K){this.config=z;this.genome=K;this.bamPath=z.url;this.baiPath=z.indexURL;Yl.setReaderDefaults(this,z);this._blockLoader=new BGZBlockLoader(z)}async readAlignments(z,K,ee){const te=await this.getChrIndex();const ne=this.chrAliasTable.hasOwnProperty(z)?this.chrAliasTable[z]:z;const re=te[ne];const ie=new AlignmentContainer(z,K,ee,this.config);if(void 0===re)return ie;{const z=await this.getIndex();const te=z.chunksForRange(re,K,ee);if(!te||0===te.length)return ie;for(let z of te){const te=await this._blockLoader.getData(z.minv,z.maxv);const ne=Yl.decodeBamRecords(te,z.minv.offset,ie,this.indexToChr,re,K,ee,this.filter);if(ne)break}ie.finish();return ie}}async getHeader(){if(!this.header){const z=this.genome;const K=await this.getIndex();let ee;if(K.firstBlockPosition){const z=buildOptions(this.config,{range:{start:K.firstBlockPosition,size:26}});const te=await Wo.loadArrayBuffer(this.bamPath,z);const ne=bgzBlockSize$1(te);ee=K.firstBlockPosition+ne}else ee=64e3;const te=buildOptions(this.config,{range:{start:0,size:ee}});this.header=await Yl.readHeader(this.bamPath,te,z)}return this.header}async getIndex(){const z=this.genome;this.index||(this.index=await loadIndex(this.baiPath,this.config,z));return this.index}async getChrIndex(){if(this.chrToIndex)return this.chrToIndex;{const z=await this.getHeader();this.chrToIndex=z.chrToIndex;this.indexToChr=z.chrNames;this.chrAliasTable=z.chrAliasTable;return this.chrToIndex}}}class ShardedBamReader{constructor(z,K){this.config=z;this.genome=K;const ee={};z.sources.sequences.forEach((function(te){const ne=K?K.getChromosomeName(te):te;ee[ne]=getReader(z,K,te)}));this.bamReaders=ee;Yl.setReaderDefaults(this,z)}async readAlignments(z,K,ee){if(this.bamReaders.hasOwnProperty(z)){let te=this.bamReaders[z];const ne=await te.readAlignments(z,K,ee);return ne}return new AlignmentContainer(z,K,ee,this.config)}}function getReader(z,K,ee){const te={url:z.sources.url.replace("$CHR",ee)};z.sources.indexURL&&(te.indexURL=z.sources.indexURL.replace("$CHR",ee));const ne=Object.assign(z,te);return new BamReader(ne,K)}
/**
     * Class for reading bam records from an igv.js-flask server backed by pysam.  Deprecated.
     *
     * @param config
     * @constructor
     */const BamWebserviceReader=function(z,K){this.config=z;this.genome=K;Yl.setReaderDefaults(this,z)};BamWebserviceReader.prototype.readAlignments=function(z,K,ee){var te=this;return getHeader.call(te).then((function(ne){var re,ie;re=ne.chrAliasTable.hasOwnProperty(z)?ne.chrAliasTable[z]:z;ie=te.config.url+"?reference="+te.config.referenceFile+"&file="+te.config.alignmentFile+"&region="+re+":"+K+"-"+ee;return Wo.loadString(ie,buildOptions(te.config)).then((function(ie){var se;ne.chrToIndex[re];se=new AlignmentContainer(z,K,ee,te.config);Yl.decodeSamRecords(ie,se,re,K,ee,te.filter);return se}))}))};function getHeader(){const z=this;const K=this.genome;if(this.header)return Promise.resolve(this.header);{const ee=this.config.url+"?file="+this.config.alignmentFile+"&options=-b,-H";const te=buildOptions(this.config);return Yl.readHeader(ee,te,K).then((function(K){z.header=K;return K}))}}class HtsgetBamReader extends HtsgetReader{constructor(z,K){super(z,K);Yl.setReaderDefaults(this,z)}async readAlignments(z,K,ee){if(!this.header){const z=await this.readHeaderData();const K=unbgzf(z.buffer);this.header=Yl.decodeBamHeader(K,this.genome);this.chrAliasTable=new Map;for(let z of Object.keys(this.header.chrAliasTable))this.chrAliasTable.set(z,this.header.chrAliasTable[z])}let te=this.chrAliasTable.has(z)?this.chrAliasTable.get(z):z;const ne=await this.readData(te,K,ee);const re=unbgzf(ne.buffer);const ie=this.header.chrToIndex[z];const se=new AlignmentContainer(z,K,ee,this.config);Yl.decodeBamRecords(re,this.header.size,se,this.header.chrNames,ie,K,ee);se.finish();return se}}const fn=()=>{var z={368:function(z,K,ee){var te=this&&this.__awaiter||function(z,K,ee,te){return new(ee||(ee=Promise))((function(ne,re){function s(z){try{f(te.next(z))}catch(z){re(z)}}function a(z){try{f(te.throw(z))}catch(z){re(z)}}function f(z){var K;z.done?ne(z.value):(K=z.value,K instanceof ee?K:new ee((function(z){z(K)}))).then(s,a)}f((te=te.apply(z,K||[])).next())}))},ne=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const re=ne(ee(4105)),ie=ne(ee(1269)),se=ee(597),oe=ee(3427),ae=ee(8577);function l(z,K){if(K.some((z=>void 0===z)))throw new ae.CramMalformedError("invalid .crai index file");const[ee,te,ne,re,ie,se]=K;z[ee]||(z[ee]=[]),z[ee].push({start:te,span:ne,containerStart:re,sliceStart:ie,sliceBytes:se})}K.default=class{constructor(z){this.filehandle=(0,oe.open)(z.url,z.path,z.filehandle),this._parseCache=new re.default({cache:new ie.default({maxSize:1}),fill:(z,K)=>this.parseIndex()})}parseIndex(){const z={};return this.filehandle.readFile().then((z=>31===z[0]&&139===z[1]?(0,se.unzip)(z):z)).then((K=>{if(K.length>4&&21578050===K.readUInt32LE(0))throw new ae.CramMalformedError("invalid .crai index file. note: file appears to be a .bai index. this is technically legal but please open a github issue if you need support");let ee=[],te="";for(let ne=0;ne<K.length;ne+=1){const re=K[ne];if(re>=48&&re<=57||!te&&45===re)te+=String.fromCharCode(re);else if(9===re)ee.push(Number.parseInt(te,10)),te="";else if(10===re)ee.push(Number.parseInt(te,10)),te="",l(z,ee),ee=[];else if(13!==re&&32!==re)throw new ae.CramMalformedError("invalid .crai index file")}return te&&ee.push(Number.parseInt(te,10)),6===ee.length&&l(z,ee),Object.entries(z).forEach((([K,ee])=>{z[K]=ee.sort(((z,K)=>z.start-K.start||z.span-K.span))})),z}))}getIndex(z={}){return this._parseCache.get("index",null,z.signal)}hasDataForReferenceSequence(z){return te(this,void 0,void 0,(function*(){return!!(yield this.getIndex())[z]}))}getEntriesForRange(z,K,ee){return te(this,void 0,void 0,(function*(){const te=(yield this.getIndex())[z];if(!te)return[];const i=z=>{const te=z.start,ne=z.start+z.span;return te>ee?-1:ne<=K?1:0},ne=[];for(let z=0;z<te.length;z+=1)0===i(te[z])&&ne.push(te[z]);return ne}))}}},1050:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.default=class{constructor(z,K){this.parameters=z,this.dataType=K}}},4863:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=te(ee(1050)),ie=ee(1074);class a extends re.default{constructor(z,K){if(super(z,K),"int"!==this.dataType)throw new ne.CramUnimplementedError(`${this.dataType} decoding not yet implemented by BETA codec`)}decode(z,K,ee,te){return(0,ie.getBits)(K.content,te.coreBlock,this.parameters.length)-this.parameters.offset}}K.default=a},1738:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(9488),re=te(ee(1050));class s extends re.default{constructor(z,K,ee){if(super(z,K),this.instantiateCodec=ee,"byteArray"!==K)throw new TypeError(`byteArrayLength does not support data type ${K}`)}decode(z,K,ee,te){const ne=this._getLengthCodec().decode(z,K,ee,te),re=this._getDataCodec(),ie=new Uint8Array(ne);for(let se=0;se<ne;se+=1)ie[se]=re.decode(z,K,ee,te);return ie}_getLengthCodec(){const z=this.parameters.lengthsEncoding;return this.instantiateCodec(z,"int")}_getDataCodec(){const z=this.parameters.valuesEncoding;return this.instantiateCodec(z,"byte")}}K.default=s,"_getLengthCodec _getDataCodec".split(" ").forEach((z=>(0,ne.tinyMemoize)(s,z)))},1405:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=te(ee(1050)),ie=ee(1074);class a extends re.default{constructor(z,K){if(super(z,K),"byteArray"!==K)throw new TypeError(`byteArrayStop codec does not support data type ${K}`)}decode(z,K,ee,te){const{blockContentId:re}=this.parameters,ie=ee[re];if(!ie)throw new ne.CramMalformedError(`no block found with content ID ${re}`);const se=te.externalBlocks.getCursor(re);return this._decodeByteArray(ie,se)}_decodeByteArray(z,K){const ee=z.content,{stopByte:te}=this.parameters,ne=K.bytePosition;let re=K.bytePosition;for(;ee[re]!==te&&re<ee.length;){if(re===ee.length)throw new ie.CramBufferOverrunError("byteArrayStop reading beyond length of data buffer?");re+=1}return K.bytePosition=re+1,ee.subarray(ne,re)}}K.default=a},5844:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=te(ee(1050)),ie=ee(9488),se=ee(1074);class f extends re.default{constructor(z,K){if(super(z,K),"int"===this.dataType)this._decodeData=this._decodeInt;else{if("byte"!==this.dataType)throw new ne.CramUnimplementedError(`${this.dataType} decoding not yet implemented by EXTERNAL codec`);this._decodeData=this._decodeByte}}decode(z,K,ee,te){const{blockContentId:re}=this.parameters,ie=ee[re];if(!ie)throw new ne.CramMalformedError(`no block found with content ID ${re}`);const se=te.externalBlocks.getCursor(re);return this._decodeData(ie,se)}_decodeInt(z,K){const[ee,te]=(0,ie.parseItf8)(z.content,K.bytePosition);return K.bytePosition=K.bytePosition+te,ee}_decodeByte(z,K){if(K.bytePosition>=z.content.length)throw new se.CramBufferOverrunError("attempted to read beyond end of block. this file seems truncated.");return z.content[K.bytePosition++]}}K.default=f},4229:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=te(ee(1050)),ie=ee(1074);class a extends re.default{constructor(z,K){if(super(z,K),"int"!==this.dataType)throw new ne.CramUnimplementedError(`${this.dataType} decoding not yet implemented by GAMMA codec`)}decode(z,K,ee,te){let ne=1;for(;0===(0,ie.getBits)(K.content,te.coreBlock,1);)ne+=1;return((0,ie.getBits)(K.content,te.coreBlock,ne-1)|1<<ne-1)-this.parameters.offset}}K.default=a},1074:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.getBits=K.CramBufferOverrunError=void 0;class r extends Error{}K.CramBufferOverrunError=r,K.getBits=function(z,K,ee){let te=0;if(K.bytePosition+(7-K.bitPosition+ee)/8>z.length)throw new r("read error during decoding. the file seems to be truncated.");for(let ne=ee;ne;ne--)te<<=1,te|=z[K.bytePosition]>>K.bitPosition&1,K.bitPosition-=1,K.bitPosition<0&&(K.bytePosition+=1),K.bitPosition&=7;return te}},2082:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=te(ee(1050)),ie=ee(1074);class a extends re.default{constructor(z,K){if(super(z,K),this.codes={},this.codeBook={},this.sortedByValue=[],this.sortedCodes=[],this.sortedValuesByBitCode=[],this.sortedBitCodes=[],this.sortedBitLengthsByBitCode=[],this.bitCodeToValue=[],!["byte","int"].includes(this.dataType))throw new TypeError(`${this.dataType} decoding not yet implemented by HUFFMAN_INT codec`);this.buildCodeBook(),this.buildCodes(),this.buildCaches(),0===this.sortedCodes[0].bitLength&&(this._decode=this._decodeZeroLengthCode)}buildCodeBook(){let z=new Array(this.parameters.numCodes);for(let K=0;K<this.parameters.numCodes;K+=1)z[K]={symbol:this.parameters.symbols[K],bitLength:this.parameters.bitLengths[K]};z=z.sort(((z,K)=>z.bitLength-K.bitLength||z.symbol-K.symbol)),this.codeBook={},z.forEach((z=>{this.codeBook[z.bitLength]||(this.codeBook[z.bitLength]=[]),this.codeBook[z.bitLength].push(z.symbol)}))}buildCodes(){this.codes={};let z=0,K=-1;Object.entries(this.codeBook).forEach((([ee,te])=>{const re=parseInt(ee,10);te.forEach((ee=>{const te={bitLength:re,value:ee,bitCode:0};K+=1;const ie=re-z;if(K<<=ie,te.bitCode=K,z+=ie,function(z){let K=z-(z>>1)&1431655765;return K=(858993459&K)+(K>>2&858993459),16843009*(K+(K>>4)&252645135)>>24}(K)>re)throw new ne.CramMalformedError("Symbol out of range");this.codes[ee]=te}))}))}buildCaches(){this.sortedCodes=Object.values(this.codes).sort(((z,K)=>z.bitLength-K.bitLength||z.bitCode-K.bitCode)),this.sortedByValue=Object.values(this.codes).sort(((z,K)=>z.value-K.value)),this.sortedValuesByBitCode=this.sortedCodes.map((z=>z.value)),this.sortedBitCodes=this.sortedCodes.map((z=>z.bitCode)),this.sortedBitLengthsByBitCode=this.sortedCodes.map((z=>z.bitLength));const z=Math.max(...this.sortedBitCodes);this.bitCodeToValue=new Array(z+1).fill(-1);for(let z=0;z<this.sortedBitCodes.length;z+=1)this.bitCodeToValue[this.sortedCodes[z].bitCode]=z}decode(z,K,ee,te){return this._decode(z,K,te.coreBlock)}_decodeZeroLengthCode(){return this.sortedCodes[0].value}_decode(z,K,ee){const te=K.content;let re=0,se=0;for(let z=0;z<this.sortedCodes.length;z+=1){const K=this.sortedCodes[z].bitLength;se<<=K-re,se|=(0,ie.getBits)(te,ee,K-re),re=K;{const ee=this.bitCodeToValue[se];if(ee>-1&&this.sortedBitLengthsByBitCode[ee]===K)return this.sortedValuesByBitCode[ee];for(let ee=z;this.sortedCodes[ee+1].bitLength===K&&ee<this.sortedCodes.length;ee+=1)z+=1}}throw new ne.CramMalformedError("Huffman symbol not found.")}}K.default=a},8772:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0}),K.instantiateCodec=void 0;const ne=ee(8577),re=te(ee(2082)),ie=te(ee(5844)),se=te(ee(1405)),oe=te(ee(1738)),ae=te(ee(4863)),le=te(ee(4229)),ce=te(ee(8821)),he={1:ie.default,3:re.default,4:oe.default,5:se.default,6:ae.default,7:ce.default,9:le.default};K.instantiateCodec=function e(z,K){const ee=(te="ignore"===K?0:z.codecId,he[te]);var te;if(!ee)throw new ne.CramUnimplementedError(`no codec implemented for codec ID ${z.codecId}`);return new ee(z.parameters,K,e)}},8821:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=te(ee(1050)),ie=ee(1074);class a extends re.default{constructor(z,K){if(super(z,K),"int"!==this.dataType)throw new ne.CramUnimplementedError(`${this.dataType} decoding not yet implemented by SUBEXP codec`)}decode(z,K,ee,te){let ne,re,se=0;for(;(0,ie.getBits)(K.content,te.coreBlock,1);)se+=1;return 0===se?(ne=this.parameters.K,re=(0,ie.getBits)(K.content,te.coreBlock,ne)):(ne=se+this.parameters.K-1,re=1<<ne|(0,ie.getBits)(K.content,te.coreBlock,ne)),re-this.parameters.offset}}K.default=a},2615:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.default={CRAM_FLAG_PRESERVE_QUAL_SCORES:1,CRAM_FLAG_DETACHED:2,CRAM_FLAG_MATE_DOWNSTREAM:4,CRAM_FLAG_NO_SEQ:8,CRAM_FLAG_MASK:15,CRAM_M_REVERSE:1,CRAM_M_UNMAP:2,BAM_FPAIRED:1,BAM_FPROPER_PAIR:2,BAM_FUNMAP:4,BAM_FMUNMAP:8,BAM_FREVERSE:16,BAM_FMREVERSE:32,BAM_FREAD1:64,BAM_FREAD2:128,BAM_FSECONDARY:256,BAM_FQCFAIL:512,BAM_FDUP:1024,BAM_FSUPPLEMENTARY:2048,BAM_CMATCH:0,BAM_CINS:1,BAM_CDEL:2,BAM_CREF_SKIP:3,BAM_CSOFT_CLIP:4,BAM_CHARD_CLIP:5,BAM_CPAD:6,BAM_CEQUAL:7,BAM_CDIFF:8,BAM_CBACK:9,BAM_CIGAR_STR:"MIDNSHP:XB",BAM_CIGAR_SHIFT:4,BAM_CIGAR_MASK:15,BAM_CIGAR_TYPE:246183}},8543:(z,K,ee)=>{Object.defineProperty(K,"__esModule",{value:!0});const te=ee(8772),ne=ee(8577),re={BF:"int",CF:"int",RI:"int",RL:"int",AP:"int",RG:"int",MF:"int",NS:"int",NP:"int",TS:"int",NF:"int",TC:"byte",TN:"int",FN:"int",FC:"byte",FP:"int",BS:"byte",IN:"byteArray",SC:"byteArray",DL:"int",BA:"byte",BB:"byteArray",RS:"int",PD:"int",HC:"int",MQ:"int",RN:"byteArray",QS:"byte",QQ:"byteArray",TL:"int"};K.default=class{constructor(z){this.dataSeriesCodecCache={},this.tagCodecCache={},this.tagEncoding={},this.readNamesIncluded=z.preservation.RN,this.APdelta=z.preservation.AP,this.referenceRequired=!!z.preservation.RR,this.tagIdsDictionary=z.preservation.TD,this.substitutionMatrix=function(z){const K=new Array(5);for(let z=0;z<5;z+=1)K[z]=new Array(4);return K[0][z[0]>>6&3]="C",K[0][z[0]>>4&3]="G",K[0][z[0]>>2&3]="T",K[0][z[0]>>0&3]="N",K[1][z[1]>>6&3]="A",K[1][z[1]>>4&3]="G",K[1][z[1]>>2&3]="T",K[1][z[1]>>0&3]="N",K[2][z[2]>>6&3]="A",K[2][z[2]>>4&3]="C",K[2][z[2]>>2&3]="T",K[2][z[2]>>0&3]="N",K[3][z[3]>>6&3]="A",K[3][z[3]>>4&3]="C",K[3][z[3]>>2&3]="G",K[3][z[3]>>0&3]="N",K[4][z[4]>>6&3]="A",K[4][z[4]>>4&3]="C",K[4][z[4]>>2&3]="G",K[4][z[4]>>0&3]="T",K}(z.preservation.SM),this.dataSeriesEncoding=z.dataSeriesEncoding,this.tagEncoding=z.tagEncoding,this.preservation=z.preservation,this._size=z._size,this._endPosition=z._endPosition}getCodecForTag(z){if(!this.tagCodecCache[z]){const K=this.tagEncoding[z];K&&(this.tagCodecCache[z]=(0,te.instantiateCodec)(K,"byteArray"))}return this.tagCodecCache[z]}getTagNames(z){return this.tagIdsDictionary[z]}getCodecForDataSeries(z){let K=this.dataSeriesCodecCache[z];if(void 0===K){const ee=this.dataSeriesEncoding[z];if(ee){const ie=re[z];if(!ie)throw new ne.CramMalformedError(`data series name ${z} not defined in file compression header`);K=(0,te.instantiateCodec)(ee,ie),this.dataSeriesCodecCache[z]=K}}return K}toJSON(){const z={};return Object.keys(this).forEach((K=>{/Cache$/.test(K)||(z[K]=this[K])})),z}}},6284:function(z,K,ee){var te=this&&this.__awaiter||function(z,K,ee,te){return new(ee||(ee=Promise))((function(ne,re){function s(z){try{f(te.next(z))}catch(z){re(z)}}function a(z){try{f(te.throw(z))}catch(z){re(z)}}function f(z){var K;z.done?ne(z.value):(K=z.value,K instanceof ee?K:new ee((function(z){z(K)}))).then(s,a)}f((te=te.apply(z,K||[])).next())}))},ne=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const re=ee(8577),ie=ee(9488),se=ne(ee(6601)),oe=ne(ee(8543));class h{constructor(z,K){this.file=z,this.filePosition=K}getHeader(){return this._readContainerHeader(this.filePosition)}getCompressionHeaderBlock(){return te(this,void 0,void 0,(function*(){if(!(yield this.getHeader()).numRecords)return null;const z=yield this.file.getSectionParsers(),K=yield this.getFirstBlock();if(void 0===K)return;if("COMPRESSION_HEADER"!==K.contentType)throw new re.CramMalformedError(`invalid content type ${K.contentType} in what is supposed to be the compression header block`);const ee=(0,ie.parseItem)(K.content,z.cramCompressionHeader.parser,0,K.contentPosition);return Object.assign(Object.assign({},K),{parsedContent:ee})}))}getFirstBlock(){return te(this,void 0,void 0,(function*(){const z=yield this.getHeader();return this.file.readBlock(z._endPosition)}))}getCompressionScheme(){return te(this,void 0,void 0,(function*(){const z=yield this.getCompressionHeaderBlock();if(z)return new oe.default(z.parsedContent)}))}getSlice(z,K){return new se.default(this,z,K)}_readContainerHeader(z){return te(this,void 0,void 0,(function*(){const K=yield this.file.getSectionParsers(),{cramContainerHeader1:ee,cramContainerHeader2:te}=K,{size:ne}=yield this.file.stat();if(z>=ne)return;const re=Buffer.allocUnsafe(ee.maxLength);yield this.file.read(re,0,ee.maxLength,z);const se=(0,ie.parseItem)(re,ee.parser),oe=(0,ie.itf8Size)(se.numLandmarks);if(z+se.length>=ne)return void console.warn(`${this.file}: container header at ${z} indicates that the container has length ${se.length}, which extends beyond the length of the file. Skipping this container.`);const ae=Buffer.allocUnsafe(te.maxLength(se.numLandmarks));yield this.file.read(ae,0,te.maxLength(se.numLandmarks),z+se._size-oe);const le=(0,ie.parseItem)(ae,te.parser);return this.file.validateChecksums&&void 0!==le.crc32&&(yield this.file.checkCrc32(z,se._size+le._size-oe-4,le.crc32,`container header beginning at position ${z}`)),Object.assign(se,le,{_size:se._size+le._size-oe,_endPosition:se._size+le._size-oe+z})}))}}K.default=h,"getHeader getCompressionHeaderBlock getCompressionScheme".split(" ").forEach((z=>(0,ie.tinyMemoize)(h,z)))},5457:function(z,K,ee){var te=this&&this.__awaiter||function(z,K,ee,te){return new(ee||(ee=Promise))((function(ne,re){function s(z){try{f(te.next(z))}catch(z){re(z)}}function a(z){try{f(te.throw(z))}catch(z){re(z)}}function f(z){var K;z.done?ne(z.value):(K=z.value,K instanceof ee?K:new ee((function(z){z(K)}))).then(s,a)}f((te=te.apply(z,K||[])).next())}))},ne=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const re=ee(597),ie=ne(ee(2779)),se=ne(ee(1269)),oe=ee(8577),ae=ne(ee(9675)),le=ee(6141),ce=ne(ee(3498)),he=ne(ee(6284)),ue=ee(3427),de=ee(9488),fe=ee(7578);class m{constructor(z){var K;if(this.file=(0,ue.open)(z.url,z.path,z.filehandle),this.validateChecksums=!0,this.fetchReferenceSequenceCallback=z.seqFetch,this.options={checkSequenceMD5:z.checkSequenceMD5,cacheSize:null!==(K=z.cacheSize)&&void 0!==K?K:2e4},this.featureCache=new se.default({maxSize:this.options.cacheSize}),function(){const z=new Uint32Array([287454020]),K=new Uint8Array(z.buffer);return 68===K[0]?0:17===K[0]?1:2}()>0)throw new Error("Detected big-endian machine, may be unable to run")}read(z,K,ee,te){return this.file.read(z,K,ee,te)}stat(){return this.file.stat()}getDefinition(){return te(this,void 0,void 0,(function*(){const z=Buffer.allocUnsafe(le.cramFileDefinition.maxLength);yield this.file.read(z,0,le.cramFileDefinition.maxLength,0);const K=le.cramFileDefinition.parser.parse(z).result;if(2!==K.majorVersion&&3!==K.majorVersion)throw new oe.CramUnimplementedError(`CRAM version ${K.majorVersion} not supported`);return K}))}getSamHeader(){return te(this,void 0,void 0,(function*(){const z=yield this.getContainerById(0);if(!z)throw new oe.CramMalformedError("file contains no containers");const K=yield z.getFirstBlock();if(void 0===K)return(0,fe.parseHeaderText)("");const ee=K.content,te=ee.readInt32LE(0),ne=ee.toString("utf8",4,4+te);return this.header=ne,(0,fe.parseHeaderText)(ne)}))}getHeaderText(){return te(this,void 0,void 0,(function*(){return yield this.getSamHeader(),this.header}))}getSectionParsers(){return te(this,void 0,void 0,(function*(){const{majorVersion:z}=yield this.getDefinition();return(0,le.getSectionParsers)(z)}))}getContainerById(z){return te(this,void 0,void 0,(function*(){const K=yield this.getSectionParsers();let ee=K.cramFileDefinition.maxLength;const{size:te}=yield this.file.stat(),{cramContainerHeader1:ne}=K;let re;for(let K=0;K<=z;K+=1){if(ee+ne.maxLength+8>=te)return;re=this.getContainerAtPosition(ee);const ie=yield re.getHeader();if(!ie)throw new oe.CramMalformedError(`container ${z} not found in file`);if(0===K){ee=ie._endPosition;for(let z=0;z<ie.numBlocks;z+=1){const z=yield this.readBlock(ee);if(void 0===z)return;ee=z._endPosition}}else ee+=ie._size+ie.length}return re}))}checkCrc32(z,K,ee,ne){return te(this,void 0,void 0,(function*(){const te=Buffer.allocUnsafe(K);yield this.file.read(te,0,K,z);const re=ie.default.unsigned(te);if(re!==ee)throw new oe.CramMalformedError(`crc mismatch in ${ne}: recorded CRC32 = ${ee}, but calculated CRC32 = ${re}`)}))}containerCount(){return te(this,void 0,void 0,(function*(){const z=yield this.getSectionParsers(),{size:K}=yield this.file.stat(),{cramContainerHeader1:ee}=z;let te=0,ne=z.cramFileDefinition.maxLength;for(;ne+ee.maxLength+8<K;){const z=yield this.getContainerAtPosition(ne).getHeader();if(!z)break;if(0===te){ne=z._endPosition;for(let K=0;K<z.numBlocks;K+=1){const z=yield this.readBlock(ne);if(void 0===z)return;ne=z._endPosition}}else ne+=z._size+z.length;te+=1}return te}))}getContainerAtPosition(z){return new he.default(this,z)}readBlockHeader(z){return te(this,void 0,void 0,(function*(){const K=yield this.getSectionParsers(),{cramBlockHeader:ee}=K,{size:te}=yield this.file.stat();if(z+ee.maxLength>=te)return;const ne=Buffer.allocUnsafe(ee.maxLength);return yield this.file.read(ne,0,ee.maxLength,z),(0,de.parseItem)(ne,ee.parser,0,z)}))}_parseSection(z,K,ee=z.maxLength,ne){return te(this,void 0,void 0,(function*(){let te;if(ne)te=ne;else{const{size:z}=yield this.file.stat();if(K+ee>=z)return;te=Buffer.allocUnsafe(ee),yield this.file.read(te,0,ee,K)}const re=(0,de.parseItem)(te,z.parser,0,K);if(re._size!==ee)throw new oe.CramMalformedError(`section read error: requested size ${ee} does not equal parsed size ${re._size}`);return re}))}_uncompress(z,K,ee){if("gzip"===z)(0,re.unzip)(K).copy(ee);else if("bzip2"===z){const z=bzip2.array(K);let te,ne=bzip2.header(z),re=0;do{te=bzip2.decompress(z,ne),-1!=te&&(Buffer.from(te).copy(ee,re),re+=te.length,ne-=te.length)}while(-1!=te)}else if("rans"===z)(0,ae.default)(K,ee);else if("rans4x16"===z)ce.default.r4x16_uncompress(K,ee);else if("arith"===z)ce.default.arith_uncompress(K,ee);else if("fqzcomp"===z)ce.default.fqzcomp_uncompress(K,ee);else{if("tok3"!==z)throw new oe.CramUnimplementedError(`${z} decompression not yet implemented`);ce.default.tok3_uncompress(K,ee)}}readBlock(z){return te(this,void 0,void 0,(function*(){const{majorVersion:K}=yield this.getDefinition(),ee=yield this.getSectionParsers(),te=yield this.readBlockHeader(z);if(void 0===te)return;const ne=te._endPosition,re=Buffer.allocUnsafe(te.uncompressedSize),ie=Object.assign(Object.assign({},te),{_endPosition:ne,contentPosition:ne,content:re});if("raw"!==te.compressionMethod){const z=Buffer.allocUnsafe(te.compressedSize);yield this.read(z,0,te.compressedSize,ne),this._uncompress(te.compressionMethod,z,re)}else yield this.read(re,0,te.uncompressedSize,ne);if(K>=3){const K=yield this._parseSection(ee.cramBlockCrc32,ne+te.compressedSize);if(void 0===K)return;ie.crc32=K.crc32,this.validateChecksums&&(yield this.checkCrc32(z,te._size+te.compressedSize,K.crc32,"block data")),ie._endPosition=K._endPosition,ie._size=ie.compressedSize+ee.cramBlockCrc32.maxLength}else ie._endPosition=ne+ie.compressedSize,ie._size=ie.compressedSize;return ie}))}}K.default=m,"getDefinition getSectionParsers getSamHeader".split(" ").forEach((z=>(0,de.tinyMemoize)(m,z)))},8222:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0}),K.CramRecord=void 0;const ne=te(ee(5457));var re=ee(8631);Object.defineProperty(K,"CramRecord",{enumerable:!0,get:function(){return te(re).default}}),K.default=ne.default},8631:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0}),K.MateFlagsDecoder=K.CramFlagsDecoder=K.BamFlagsDecoder=K.MateFlags=K.CramFlags=K.BamFlags=void 0;const ne=te(ee(2615)),re={a:0,A:0,c:1,C:1,g:2,G:2,t:3,T:3,n:4,N:4};function s(z){const K={};for(const[ee,te]of z)K["is"+te]=z=>!!(z&ee),K["set"+te]=z=>z|ee;return K}K.BamFlags=[[1,"Paired"],[2,"ProperlyPaired"],[4,"SegmentUnmapped"],[8,"MateUnmapped"],[16,"ReverseComplemented"],[32,"MateReverseComplemented"],[64,"Read1"],[128,"Read2"],[256,"Secondary"],[512,"FailedQc"],[1024,"Duplicate"],[2048,"Supplementary"]],K.CramFlags=[[1,"PreservingQualityScores"],[2,"Detached"],[4,"WithMateDownstream"],[8,"DecodeSequenceAsStar"]],K.MateFlags=[[1,"OnNegativeStrand"],[2,"Unmapped"]],K.BamFlagsDecoder=s(K.BamFlags),K.CramFlagsDecoder=s(K.CramFlags),K.MateFlagsDecoder=s(K.MateFlags),K.default=class{constructor({flags:z,cramFlags:K,readLength:ee,mappingQuality:te,lengthOnRef:ne,qualityScores:re,mateRecordNumber:ie,readBases:se,readFeatures:oe,mateToUse:ae,readGroupId:le,readName:ce,sequenceId:he,uniqueId:ue,templateSize:de,alignmentStart:fe,tags:pe}){this.flags=z,this.cramFlags=K,this.readLength=ee,this.mappingQuality=te,this.lengthOnRef=ne,this.qualityScores=re,se&&(this.readBases=se),this.readGroupId=le,this.readName=ce,this.sequenceId=he,this.uniqueId=ue,this.templateSize=de,this.alignmentStart=fe,this.tags=pe,oe&&(this.readFeatures=oe),ae&&(this.mate={flags:ae.mateFlags,readName:ae.mateReadName,sequenceId:ae.mateSequenceId,alignmentStart:ae.mateAlignmentStart}),ie&&(this.mateRecordNumber=ie)}isPaired(){return!!(this.flags&ne.default.BAM_FPAIRED)}isProperlyPaired(){return!!(this.flags&ne.default.BAM_FPROPER_PAIR)}isSegmentUnmapped(){return!!(this.flags&ne.default.BAM_FUNMAP)}isMateUnmapped(){return!!(this.flags&ne.default.BAM_FMUNMAP)}isReverseComplemented(){return!!(this.flags&ne.default.BAM_FREVERSE)}isMateReverseComplemented(){return!!(this.flags&ne.default.BAM_FMREVERSE)}isRead1(){return!!(this.flags&ne.default.BAM_FREAD1)}isRead2(){return!!(this.flags&ne.default.BAM_FREAD2)}isSecondary(){return!!(this.flags&ne.default.BAM_FSECONDARY)}isFailedQc(){return!!(this.flags&ne.default.BAM_FQCFAIL)}isDuplicate(){return!!(this.flags&ne.default.BAM_FDUP)}isSupplementary(){return!!(this.flags&ne.default.BAM_FSUPPLEMENTARY)}isDetached(){return!!(this.cramFlags&ne.default.CRAM_FLAG_DETACHED)}hasMateDownStream(){return!!(this.cramFlags&ne.default.CRAM_FLAG_MATE_DOWNSTREAM)}isPreservingQualityScores(){return!!(this.cramFlags&ne.default.CRAM_FLAG_PRESERVE_QUAL_SCORES)}isUnknownBases(){return!!(this.cramFlags&ne.default.CRAM_FLAG_NO_SEQ)}getReadBases(){if(!this.readBases&&this._refRegion){const z=function(z,K){if(!z.lengthOnRef&&!z.readLength)return null;if(z.isUnknownBases())return null;const ee=z.alignmentStart-K.start;if(!z.readFeatures)return K.seq.substr(ee,z.lengthOnRef).toUpperCase();let te="",ne=ee,re=0;for(;te.length<z.readLength;)if(re<z.readFeatures.length){const ee=z.readFeatures[re];if("Q"===ee.code||"q"===ee.code)re+=1;else if(ee.pos===te.length+1)if(re+=1,"b"===ee.code){const z=ee.data;te+=z,ne+=z.length}else"B"===ee.code?(te+=ee.data[0],ne+=1):"X"===ee.code?(te+=ee.sub,ne+=1):"I"===ee.code?te+=ee.data:"D"===ee.code?ne+=ee.data:"i"===ee.code?te+=ee.data:"N"===ee.code?ne+=ee.data:"S"===ee.code?te+=ee.data:"P"===ee.code||ee.code;else if(re<z.readFeatures.length){const ee=K.seq.substr(ne,z.readFeatures[re].pos-te.length-1);te+=ee,ne+=ee.length}}else{const ee=K.seq.substr(ne,z.readLength-te.length);te+=ee,ne+=ee.length}return te.toUpperCase()}(this,this._refRegion);z&&(this.readBases=z)}return this.readBases}getPairOrientation(){if(!this.isSegmentUnmapped()&&this.isPaired()&&!this.isMateUnmapped()&&this.mate&&this.sequenceId===this.mate.sequenceId){const z=this.isReverseComplemented()?"R":"F",K=this.isMateReverseComplemented()?"R":"F";let ee=" ",te=" ";this.isRead1()?(ee="1",te="2"):this.isRead2()&&(ee="2",te="1");const ne=[];let re=this.templateLength||this.templateSize;if(void 0===re)throw new Error("One of templateSize and templateLength must be set");return this.alignmentStart>this.mate.alignmentStart&&re>0&&(re=-re),re>0?(ne[0]=z,ne[1]=ee,ne[2]=K,ne[3]=te):(ne[2]=z,ne[3]=ee,ne[0]=K,ne[1]=te),ne.join("")}return null}addReferenceSequence(z,K){this.readFeatures&&this.readFeatures.forEach((ee=>{"X"===ee.code&&function(z,K,ee,te){if(!K)return;const ne=te.refPos-K.start,ie=K.seq.charAt(ne);ie&&(te.ref=ie);let se=re[ie];void 0===se&&(se=4);const oe=ee.substitutionMatrix[se][te.data];oe&&(te.sub=oe)}(0,z,K,ee)})),!this.readBases&&z.start<=this.alignmentStart&&z.end>=this.alignmentStart+(this.lengthOnRef||this.readLength)-1&&(this._refRegion=z)}toJSON(){const z={};return Object.keys(this).forEach((K=>{"_"!==K.charAt(0)&&(z[K]=this[K])})),z.readBases=this.getReadBases(),z}}},6141:(z,K,ee)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.getSectionParsers=K.cramFileDefinition=K.isMappedSliceHeader=void 0;const te=ee(9996),ne=(new te.Parser).itf8(),re={parser:(new te.Parser).string("magic",{length:4}).uint8("majorVersion").uint8("minorVersion").string("fileId",{length:20,stripNull:!0}),maxLength:26};K.cramFileDefinition=re;const ie={parser:(new te.Parser).uint8("compressionMethod",{formatter:z=>{const K=["raw","gzip","bzip2","lzma","rans","rans4x16","arith","fqzcomp","tok3"][z];if(!K)throw new Error(`compression method number ${z} not implemented`);return K}}).uint8("contentType",{formatter:z=>{const K=["FILE_HEADER","COMPRESSION_HEADER","MAPPED_SLICE_HEADER","UNMAPPED_SLICE_HEADER","EXTERNAL_DATA","CORE_DATA"][z];if(!K)throw new Error(`invalid block content type id ${z}`);return K}}).itf8("contentId").itf8("compressedSize").itf8("uncompressedSize"),maxLength:17},se={parser:(new te.Parser).uint32("crc32"),maxLength:4},oe=(new te.Parser).itf8("size").buffer("ents",{length:"size",formatter:z=>{function t(K,ee){const te=z.toString("utf8",K,ee),ne=[];for(let z=0;z<te.length;z+=3)ne.push(te.substr(z,3));return ne}var K,ee=[],te=0;for(K=0;K<z.length;K+=1)z[K]||(ee.push(t(te,K)),te=K+1);return K>te&&ee.push(t(te,K)),ee}}),ae=(new te.Parser).uint8(null,{formatter:z=>!!z}),le=(new te.Parser).itf8("mapSize").itf8("mapCount").array("ents",{length:"mapCount",type:(new te.Parser).string("key",{length:2,stripNull:!1}).choice("value",{tag:"key",choices:{MI:ae,UI:ae,PI:ae,RN:ae,AP:ae,RR:ae,SM:(new te.Parser).array(null,{type:"uint8",length:5}),TD:(new te.Parser).nest(null,{type:oe,formatter:z=>z.ents})}})});function u(z){const K={};for(let ee=0;ee<z.ents.length;ee+=1){const{key:te,value:ne}=z.ents[ee];K[te]&&console.warn(`duplicate key ${te} in map`),K[te]=ne}return K}const ce={cramFileDefinition:re,cramBlockHeader:ie,cramBlockCrc32:se};K.isMappedSliceHeader=function(z){return"number"==typeof z.refSeqId};const he={cramUnmappedSliceHeader(z){let K=0,ee=(new te.Parser).itf8("numRecords");return K+=5,z>=3?(ee=ee.ltf8("recordCounter"),K+=9):2===z&&(ee=ee.itf8("recordCounter"),K+=5),ee=ee.itf8("numBlocks").itf8("numContentIds").array("contentIds",{type:ne,length:"numContentIds"}),K+=10,z>=2&&(ee=ee.array("md5",{type:"uint8",length:16}),K+=16),{parser:ee,maxLength:z=>K+5*z}},cramMappedSliceHeader(z){let K=(new te.Parser).itf8("refSeqId").itf8("refSeqStart").itf8("refSeqSpan").itf8("numRecords"),ee=20;return z>=3?(K=K.ltf8("recordCounter"),ee+=9):2===z&&(K=K.itf8("recordCounter"),ee+=5),K=K.itf8("numBlocks").itf8("numContentIds").array("contentIds",{type:ne,length:"numContentIds"}).itf8("refBaseBlockId"),ee+=15,z>=2&&(K=K.array("md5",{type:"uint8",length:16}),ee+=16),{parser:K,maxLength:z=>ee+5*z}},cramEncoding:z=>({parser:(new te.Parser).namely("cramEncoding").itf8("codecId").itf8("parametersBytes").choice("parameters",{tag:"codecId",choices:{0:new te.Parser,1:(new te.Parser).itf8("blockContentId"),2:(new te.Parser).itf8("offset").itf8("M"),3:te.Parser.start().itf8("numCodes").array("symbols",{length:"numCodes",type:ne}).itf8("numLengths").array("bitLengths",{length:"numLengths",type:ne}),4:te.Parser.start().nest("lengthsEncoding",{type:"cramEncoding"}).nest("valuesEncoding",{type:"cramEncoding"}),5:(new te.Parser).uint8("stopByte").itf8("blockContentId"),6:(new te.Parser).itf8("offset").itf8("length"),7:(new te.Parser).itf8("offset").itf8("K"),8:(new te.Parser).itf8("offset").itf8("log2m"),9:(new te.Parser).itf8("offset")}})}),cramDataSeriesEncodingMap(z){return(new te.Parser).itf8("mapSize").itf8("mapCount").array("ents",{length:"mapCount",type:(new te.Parser).string("key",{length:2,stripNull:!1}).nest("value",{type:this.cramEncoding(z).parser})})},cramTagEncodingMap(z){return(new te.Parser).itf8("mapSize").itf8("mapCount").array("ents",{length:"mapCount",type:(new te.Parser).itf8("key",{formatter:z=>String.fromCharCode(z>>16&255)+String.fromCharCode(z>>8&255)+String.fromCharCode(255&z)}).nest("value",{type:this.cramEncoding(z).parser})})},cramCompressionHeader(z){let K=new te.Parser;return K=K.nest("preservation",{type:le,formatter:u}).nest("dataSeriesEncoding",{type:this.cramDataSeriesEncodingMap(z),formatter:u}).nest("tagEncoding",{type:this.cramTagEncodingMap(z),formatter:u}),{parser:K}},cramContainerHeader1(z){let K=(new te.Parser).int32("length").itf8("refSeqId").itf8("refSeqStart").itf8("alignmentSpan").itf8("numRecords"),ee=24;return z>=3?(K=K.ltf8("recordCounter"),ee+=9):2===z&&(K=K.itf8("recordCounter"),ee+=5),z>1&&(K=K.ltf8("numBases"),ee+=9),K=K.itf8("numBlocks").itf8("numLandmarks"),ee+=10,{parser:K,maxLength:ee}},cramContainerHeader2(z){let K=(new te.Parser).itf8("numLandmarks").array("landmarks",{type:(new te.Parser).itf8(),length:"numLandmarks"}),ee=0;return z>=3&&(K=K.uint32("crc32"),ee=4),{parser:K,maxLength:z=>5+5*z+ee}}};K.getSectionParsers=function(z){const K=Object.assign({},ce);return Object.keys(he).forEach((ee=>{K[ee]=he[ee](z)})),K}},3757:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=te(ee(3720)),re=ee(8577),ie=ee(8631),se=ee(6141);function f(z){let K="";for(let ee=0;ee<z.length&&0!==z[ee];ee++)K+=String.fromCharCode(z[ee]);return K}function h(z,K){if("Z"===z)return f(K);if("A"===z)return String.fromCharCode(K[0]);if("I"===z)return ne.default.fromBytesLE(K).toNumber();if("i"===z)return new Int32Array(K.buffer)[0];if("s"===z)return new Int16Array(K.buffer)[0];if("S"===z)return new Uint16Array(K.buffer)[0];if("c"===z)return new Int8Array(K.buffer)[0];if("C"===z)return K[0];if("f"===z)return new Float32Array(K.buffer)[0];if("H"===z)return Number.parseInt(f(K).replace(/^0x/,""),16);if("B"===z)return function(z){const K=String.fromCharCode(z[0]),ee=Int32Array.from(z.slice(1))[0],te=new Array(ee);if(z=z.slice(5),"c"===K){const K=new Int8Array(z.buffer);for(let z=0;z<ee;z+=1)te[z]=K[z]}else if("C"===K){const K=new Uint8Array(z.buffer);for(let z=0;z<ee;z+=1)te[z]=K[z]}else if("s"===K){const K=new Int16Array(z.buffer);for(let z=0;z<ee;z+=1)te[z]=K[z]}else if("S"===K){const K=new Uint16Array(z.buffer);for(let z=0;z<ee;z+=1)te[z]=K[z]}else if("i"===K){const K=new Int32Array(z.buffer);for(let z=0;z<ee;z+=1)te[z]=K[z]}else if("I"===K){const K=new Uint32Array(z.buffer);for(let z=0;z<ee;z+=1)te[z]=K[z]}else{if("f"!==K)throw new Error("unknown type: "+K);{const K=new Float32Array(z.buffer);for(let z=0;z<ee;z+=1)te[z]=K[z]}}return te}(K);throw new re.CramMalformedError(`Unrecognized tag type ${z}`)}K.default=function(z,K,ee,te,ne,oe,ae,le,ce){let he=K("BF");const ue=K("CF");if(!(0,se.isMappedSliceHeader)(te.parsedContent))throw new Error;let de;de=le>1&&-2===te.parsedContent.refSeqId?K("RI"):te.parsedContent.refSeqId;const fe=K("RL");let pe=K("AP");ee.APdelta&&(pe+=ae.lastAlignmentStart),ae.lastAlignmentStart=pe;const ge=K("RG");let me,be,ve,we;if(ee.readNamesIncluded&&(me=f(K("RN"))),ie.CramFlagsDecoder.isDetached(ue)){const z=K("MF");let te;ee.readNamesIncluded||(te=f(K("RN")),me=te);const ne=K("NS"),re=K("NP");(z||ne>-1)&&(be={mateFlags:z,mateSequenceId:ne,mateAlignmentStart:re,mateReadName:te}),ve=K("TS"),ie.MateFlagsDecoder.isUnmapped(z)&&(he=ie.BamFlagsDecoder.setMateUnmapped(he)),ie.MateFlagsDecoder.isOnNegativeStrand(z)&&(he=ie.BamFlagsDecoder.setMateReverseComplemented(he))}else ie.CramFlagsDecoder.isWithMateDownstream(ue)&&(we=K("NF")+ce+1);const ye=K("TL");if(ye<0)throw new re.CramMalformedError("invalid TL index");const _e={},ke=ee.getTagNames(ye),xe=ke.length;for(let K=0;K<xe;K+=1){const te=ke[K],ie=te.substr(0,2),se=te.substr(2,1),le=ee.getCodecForTag(te);if(!le)throw new re.CramMalformedError(`no codec defined for auxiliary tag ${te}`);const ce=le.decode(z,ne,oe,ae);_e[ie]=h(se,ce)}let Ce,Se,Ae,Te,Ee;if(ie.BamFlagsDecoder.isSegmentUnmapped(he))if(ie.CramFlagsDecoder.isDecodeSequenceAsStar(ue))Ee=null,Te=null;else{const z=new Array(fe);for(let ee=0;ee<z.length;ee+=1)z[ee]=K("BA");if(Ee=String.fromCharCode(...z),ie.CramFlagsDecoder.isPreservingQualityScores(ue)){Te=new Array(fe);for(let ee=0;ee<z.length;ee+=1)Te[ee]=K("QS")}}else{const z=K("FN");if(z&&(Ce=function(z,K,ee,te,ne){let ie=0,se=z-1;const oe=new Array(K);function h([z,K]){const te=ee(K);if("character"===z)return String.fromCharCode(te);if("string"===z){let z="";for(let K=0;K<te.byteLength;K++)z+=String.fromCharCode(te[K]);return z}return"numArray"===z?te.toArray():te}for(let z=0;z<K;z+=1){const K=String.fromCharCode(ee("FC")),te=ee("FP"),ae={B:["character","BA"],S:["string",ne>1?"SC":"IN"],X:["number","BS"],D:["number","DL"],I:["string","IN"],i:["character","BA"],b:["string","BB"],q:["numArray","QQ"],Q:["number","QS"],H:["number","HC"],P:["number","PD"],N:["number","RS"]}[K];if(!ae)throw new re.CramMalformedError(`invalid read feature code "${K}"`);let le=h(ae);const ce={B:["number","QS"]}[K];ce&&(le=[le,h(ce)]),ie+=te;const he=ie;se+=te;const ue=se;"D"===K||"N"===K?se+=le:"I"===K||"S"===K?se-=le.length:"i"===K&&(se-=1),oe[z]={code:K,pos:he,refPos:ue,data:le}}return oe}(pe,z,K,0,le)),Se=fe,Ce)for(const{code:z,data:K}of Ce)"D"===z||"N"===z?Se+=K:"I"===z||"S"===z?Se-=K.length:"i"===z&&(Se-=1);if(Number.isNaN(Se)&&(console.warn(`${me||`${de}:${pe}`} record has invalid read features`),Se=fe),Ae=K("MQ"),ie.CramFlagsDecoder.isPreservingQualityScores(ue)){Te=new Array(fe);for(let z=0;z<Te.length;z++)Te[z]=K("QS")}}return{readLength:fe,sequenceId:de,cramFlags:ue,flags:he,alignmentStart:pe,readGroupId:ge,readName:me,mateToUse:be,templateSize:ve,mateRecordNumber:we,readFeatures:Ce,lengthOnRef:Se,mappingQuality:Ae,qualityScores:Te,readBases:Ee,tags:_e}}},6601:function(z,K,ee){var te=this&&this.__awaiter||function(z,K,ee,te){return new(ee||(ee=Promise))((function(ne,re){function s(z){try{f(te.next(z))}catch(z){re(z)}}function a(z){try{f(te.throw(z))}catch(z){re(z)}}function f(z){var K;z.done?ne(z.value):(K=z.value,K instanceof ee?K:new ee((function(z){z(K)}))).then(s,a)}f((te=te.apply(z,K||[])).next())}))},ne=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const re=ee(8577),ie=ee(9488),se=ne(ee(2615)),oe=ne(ee(3757)),ae=ne(ee(8631)),le=ee(6141),ce=ee(1074);function c(z,K,ee,te){if(!te)throw new re.CramMalformedError("could not resolve intra-slice mate pairs, file seems truncated or malformed");const ne=!!(te.mate||void 0!==te.mateRecordNumber&&te.mateRecordNumber!==K);ee.readName||(ee.readName=String(ee.uniqueId),te.readName=ee.readName),ee.mate={sequenceId:te.sequenceId,alignmentStart:te.alignmentStart,uniqueId:te.uniqueId},te.readName&&(ee.mate.readName=te.readName),te.mate||void 0!==te.mateRecordNumber||(te.mate={sequenceId:ee.sequenceId,alignmentStart:ee.alignmentStart,uniqueId:ee.uniqueId},ee.readName&&(te.mate.readName=ee.readName)),ee.flags|=se.default.BAM_FPAIRED,te.flags&se.default.BAM_FUNMAP&&(ee.flags|=se.default.BAM_FMUNMAP),ee.flags&se.default.BAM_FUNMAP&&(te.flags|=se.default.BAM_FMUNMAP),te.flags&se.default.BAM_FREVERSE&&(ee.flags|=se.default.BAM_FMREVERSE),ee.flags&se.default.BAM_FREVERSE&&(te.flags|=se.default.BAM_FMREVERSE),void 0===ee.templateLength&&(ne?function(z,K,ee){const te=function t(K){const ee=[K];if(void 0!==K.mateRecordNumber&&K.mateRecordNumber>=0){const te=z[K.mateRecordNumber];if(!te)throw new re.CramMalformedError("intra-slice mate record not found, this file seems malformed");ee.push(...t(te))}return ee}(ee),ne=te.map((z=>z.alignmentStart)),ie=te.map((z=>z.alignmentStart+z.readLength-1)),se=Math.max(...ie)-Math.min(...ne)+1;se>=0&&te.forEach((z=>{if(void 0!==z.templateLength)throw new re.CramMalformedError("mate pair group has some members that have template lengths already, this file seems malformed");z.templateLength=se}))}(z,0,ee):function(z,K){const ee=Math.min(z.alignmentStart,K.alignmentStart),te=Math.max(z.alignmentStart+z.readLength-1,K.alignmentStart+K.readLength-1)-ee+1;z.templateLength=te,K.templateLength=te}(ee,te)),delete ee.mateRecordNumber}class d{constructor(z,K,ee){this.container=z,this.containerPosition=K,this.file=z.file}getHeader(){return te(this,void 0,void 0,(function*(){const z=yield this.file.getSectionParsers(),K=yield this.container.getHeader(),ee=yield this.file.readBlock(K._endPosition+this.containerPosition);if(void 0===ee)throw new Error;if("MAPPED_SLICE_HEADER"===ee.contentType){const te=(0,ie.parseItem)(ee.content,z.cramMappedSliceHeader.parser,0,K._endPosition);return Object.assign(Object.assign({},ee),{parsedContent:te})}if("UNMAPPED_SLICE_HEADER"===ee.contentType){const te=(0,ie.parseItem)(ee.content,z.cramUnmappedSliceHeader.parser,0,K._endPosition);return Object.assign(Object.assign({},ee),{parsedContent:te})}throw new re.CramMalformedError(`error reading slice header block, invalid content type ${ee.contentType}`)}))}getBlocks(){return te(this,void 0,void 0,(function*(){const z=yield this.getHeader();let K=z._endPosition;const ee=new Array(z.parsedContent.numBlocks);for(let z=0;z<ee.length;z+=1){const te=yield this.file.readBlock(K);if(void 0===te)throw new Error;ee[z]=te,K=ee[z]._endPosition}return ee}))}getCoreDataBlock(){return te(this,void 0,void 0,(function*(){return(yield this.getBlocks())[0]}))}_getBlocksContentIdIndex(){return te(this,void 0,void 0,(function*(){const z=yield this.getBlocks(),K={};return z.forEach((z=>{"EXTERNAL_DATA"===z.contentType&&(K[z.contentId]=z)})),K}))}getBlockByContentId(z){return te(this,void 0,void 0,(function*(){return(yield this._getBlocksContentIdIndex())[z]}))}getReferenceRegion(){return te(this,void 0,void 0,(function*(){const z=(yield this.getHeader()).parsedContent;if(!(0,le.isMappedSliceHeader)(z))throw new Error;if(z.refSeqId<0)return;const K=yield this.container.getCompressionScheme();if(void 0===K)throw new Error;if(z.refBaseBlockId>=0){const K=yield this.getBlockByContentId(z.refBaseBlockId);if(!K)throw new re.CramMalformedError("embedded reference specified, but reference block does not exist");return{seq:K.data.toString("utf8"),start:z.refSeqStart,end:z.refSeqStart+z.refSeqSpan-1,span:z.refSeqSpan}}if(K.referenceRequired||this.file.fetchReferenceSequenceCallback){if(!this.file.fetchReferenceSequenceCallback)throw new Error("reference sequence not embedded, and seqFetch callback not provided, cannot fetch reference sequence");const K=yield this.file.fetchReferenceSequenceCallback(z.refSeqId,z.refSeqStart,z.refSeqStart+z.refSeqSpan-1);if(K.length!==z.refSeqSpan)throw new re.CramArgumentError("seqFetch callback returned a reference sequence of the wrong length");return{seq:K,start:z.refSeqStart,end:z.refSeqStart+z.refSeqSpan-1,span:z.refSeqSpan}}}))}getAllRecords(){return this.getRecords((()=>!0))}_fetchRecords(){return te(this,void 0,void 0,(function*(){const{majorVersion:z}=yield this.file.getDefinition(),K=yield this.container.getCompressionScheme();if(void 0===K)throw new Error;const ee=yield this.getHeader();if(void 0===ee)throw new Error;const te=yield this._getBlocksContentIdIndex();if(z>1&&this.file.options.checkSequenceMD5&&(0,le.isMappedSliceHeader)(ee.parsedContent)&&ee.parsedContent.refSeqId>=0&&"0000000000000000"!==ee.parsedContent.md5.join("")){const z=yield this.getReferenceRegion();if(z){const{seq:K,start:te,end:ne}=z,se=(0,ie.sequenceMD5)(K),oe=ee.parsedContent.md5.map((z=>(z<16?"0":"")+z.toString(16))).join("");if(se!==oe)throw new re.CramMalformedError(`MD5 checksum reference mismatch for ref ${ee.parsedContent.refSeqId} pos ${te}..${ne}. recorded MD5: ${oe}, calculated MD5: ${se}`)}}const ne=yield this.getCoreDataBlock(),se={lastAlignmentStart:(0,le.isMappedSliceHeader)(ee.parsedContent)?ee.parsedContent.refSeqStart:0,coreBlock:{bitPosition:7,bytePosition:0},externalBlocks:{map:new Map,getCursor(z){let K=this.map.get(z);return void 0===K&&(K={bitPosition:7,bytePosition:0},this.map.set(z,K)),K}}},d=z=>{const ee=K.getCodecForDataSeries(z);if(!ee)throw new re.CramMalformedError(`no codec defined for ${z} data series`);return ee.decode(this,ne,te,se)};let he=new Array(ee.parsedContent.numRecords);for(let re=0;re<he.length;re+=1)try{const ie=(0,oe.default)(this,d,K,ee,ne,te,se,z,re);he[re]=new ae.default(Object.assign(Object.assign({},ie),{uniqueId:ee.contentPosition+ee.parsedContent.recordCounter+re+1}))}catch(z){if(z instanceof ce.CramBufferOverrunError){console.warn("read attempted beyond end of buffer, file seems truncated."),he=he.filter((z=>!!z));break}throw z}for(let z=0;z<he.length;z+=1){const{mateRecordNumber:K}=he[z];void 0!==K&&K>=0&&c(he,z,he[z],he[K])}return he}))}getRecords(z){return te(this,void 0,void 0,(function*(){const K=this.container.filePosition+this.containerPosition;let ee=this.file.featureCache.get(K.toString());ee||(ee=this._fetchRecords(),this.file.featureCache.set(K.toString(),ee));const ne=(yield ee).filter(z);if(ne.length&&this.file.fetchReferenceSequenceCallback){const z=yield this.getHeader();if((0,le.isMappedSliceHeader)(z.parsedContent)&&(z.parsedContent.refSeqId>=0||-2===z.parsedContent.refSeqId)){const K=z.parsedContent.refSeqId>=0?z.parsedContent.refSeqId:void 0,ee=yield this.container.getCompressionScheme();if(void 0===ee)throw new Error;const re={};for(let z=0;z<ne.length;z+=1){const ee=void 0!==K?K:ne[z].sequenceId;let te=re[ee];te||(te={id:ee,start:ne[z].alignmentStart,end:-1/0,seq:null},re[ee]=te);const ie=ne[z].alignmentStart+(ne[z].lengthOnRef||ne[z].readLength)-1;ie>te.end&&(te.end=ie),ne[z].alignmentStart<te.start&&(te.start=ne[z].alignmentStart)}yield Promise.all(Object.values(re).map((z=>te(this,void 0,void 0,(function*(){-1!==z.id&&z.start<=z.end&&(z.seq=yield this.file.fetchReferenceSequenceCallback(z.id,z.start,z.end))})))));for(let z=0;z<ne.length;z+=1){const te=re[void 0!==K?K:ne[z].sequenceId];if(te&&te.seq){const K=te.seq;ne[z].addReferenceSequence(Object.assign(Object.assign({},te),{seq:K}),ee)}}}}return ne}))}}K.default=d,"getHeader getBlocks _getBlocksContentIdIndex".split(" ").forEach((z=>(0,ie.tinyMemoize)(d,z)))},9488:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0}),K.sequenceMD5=K.tinyMemoize=K.parseItem=K.parseItf8=K.itf8Size=void 0;const ne=te(ee(2568)),re=ee(1074);K.itf8Size=function(z){return-128&z?-16384&z?-2097152&z?-268435456&z?5:4:3:2:1},K.parseItf8=function(z,K){let ee=K;const te=z[ee];let ne;if(te<128?(ne=te,ee+=1):te<192?(ne=16383&(te<<8|z[ee+1]),ee+=2):te<224?(ne=2097151&(te<<16|z[ee+1]<<8|z[ee+2]),ee+=3):te<240?(ne=268435455&(te<<24|z[ee+1]<<16|z[ee+2]<<8|z[ee+3]),ee+=4):(ne=(15&te)<<28|z[ee+1]<<20|z[ee+2]<<12|z[ee+3]<<4|15&z[ee+4],ee+=5),ee>z.length)throw new re.CramBufferOverrunError("Attempted to read beyond end of buffer; this file seems truncated.");return[ne,ee-K]},K.parseItem=function(z,K,ee=0,te=0){const{offset:ne,result:re}=K.parse(z);return Object.assign(Object.assign({},re),{_endPosition:ne+te,_size:ne-ee})},K.tinyMemoize=function(z,K){const ee=z.prototype[K],te=`_memo_${K}`;z.prototype[K]=function(){if(!(te in this)){const z=ee.call(this);this[te]=z,Promise.resolve(z).catch((()=>{delete this[te]}))}return this[te]}},K.sequenceMD5=function(z){return(0,ne.default)(z.toUpperCase().replace(/[^\x21-\x7e]/g,""))}},8577:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.CramArgumentError=K.CramSizeLimitError=K.CramMalformedError=K.CramUnimplementedError=K.CramError=void 0;class r extends Error{}K.CramError=r;class n extends Error{}K.CramUnimplementedError=n,K.CramMalformedError=class extends r{},K.CramSizeLimitError=class extends r{},K.CramArgumentError=class extends r{}},5590:function(z,K,ee){var te=this&&this.__createBinding||(Object.create?function(z,K,ee,te){void 0===te&&(te=ee);var ne=Object.getOwnPropertyDescriptor(K,ee);ne&&!("get"in ne?!K.__esModule:ne.writable||ne.configurable)||(ne={enumerable:!0,get:function(){return K[ee]}}),Object.defineProperty(z,te,ne)}:function(z,K,ee,te){void 0===te&&(te=ee),z[te]=K[ee]}),ne=this&&this.__setModuleDefault||(Object.create?function(z,K){Object.defineProperty(z,"default",{enumerable:!0,value:K})}:function(z,K){z.default=K}),re=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var K={};if(null!=z)for(var ee in z)"default"!==ee&&Object.prototype.hasOwnProperty.call(z,ee)&&te(K,z,ee);return ne(K,z),K},ie=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0}),K.CramRecord=K.CraiIndex=K.IndexedCramFile=K.CramFile=void 0;const se=re(ee(8222));K.CramFile=se.default,Object.defineProperty(K,"CramRecord",{enumerable:!0,get:function(){return se.CramRecord}});const oe=ie(ee(946));K.IndexedCramFile=oe.default;const ae=ie(ee(368));K.CraiIndex=ae.default},946:function(z,K,ee){var te=this&&this.__awaiter||function(z,K,ee,te){return new(ee||(ee=Promise))((function(ne,re){function s(z){try{f(te.next(z))}catch(z){re(z)}}function a(z){try{f(te.throw(z))}catch(z){re(z)}}function f(z){var K;z.done?ne(z.value):(K=z.value,K instanceof ee?K:new ee((function(z){z(K)}))).then(s,a)}f((te=te.apply(z,K||[])).next())}))},ne=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const re=ee(8577),ie=ne(ee(8222));K.default=class{constructor(z){if(z.cram?this.cram=z.cram:this.cram=new ie.default({url:z.cramUrl,path:z.cramPath,filehandle:z.cramFilehandle,seqFetch:z.seqFetch,checkSequenceMD5:z.checkSequenceMD5,cacheSize:z.cacheSize}),!(this.cram instanceof ie.default))throw new Error("invalid arguments: no cramfile");if(this.index=z.index,!this.index.getEntriesForRange)throw new Error("invalid arguments: not an index");this.fetchSizeLimit=z.fetchSizeLimit||3e6}getRecordsForRange(z,K,ee,ne={}){return te(this,void 0,void 0,(function*(){if(ne.viewAsPairs=ne.viewAsPairs||!1,ne.pairAcrossChr=ne.pairAcrossChr||!1,ne.maxInsertSize=ne.maxInsertSize||2e5,"string"==typeof z)throw new re.CramUnimplementedError("string sequence names not yet supported");const te=z,ie=yield this.index.getEntriesForRange(te,K,ee),se=ie.map((z=>z.sliceBytes)).reduce(((z,K)=>z+K),0);if(se>this.fetchSizeLimit)throw new re.CramSizeLimitError(`data size of ${se.toLocaleString()} bytes exceeded fetch size limit of ${this.fetchSizeLimit.toLocaleString()} bytes`);const f=te=>te.sequenceId===z&&te.alignmentStart<=ee&&void 0!==te.lengthOnRef&&te.alignmentStart+te.lengthOnRef-1>=K,oe=yield Promise.all(ie.map((z=>this.getRecordsInSlice(z,f))));let ae=Array.prototype.concat(...oe);if(ne.viewAsPairs){const z={},K={};for(let ee=0;ee<ae.length;ee+=1){const te=ae[ee].readName;if(void 0===te)throw new Error;const ne=ae[ee].uniqueId;z[te]||(z[te]=0),z[te]+=1,K[ne]=1}const ee={};Object.entries(z).forEach((([z,K])=>{1===K&&(ee[z]=!0)}));const re=[];for(let z=0;z<ae.length;z+=1){const K=ae[z],ie=K.readName;if(void 0===ie)throw new Error;if(ee[ie]&&K.mate&&(K.mate.sequenceId===te||ne.pairAcrossChr)&&Math.abs(K.alignmentStart-K.mate.alignmentStart)<ne.maxInsertSize){const z=this.index.getEntriesForRange(K.mate.sequenceId,K.mate.alignmentStart,K.mate.alignmentStart+1);re.push(z)}}const ie=yield Promise.all(re);let se=[];for(let z=0;z<ie.length;z+=1)se.push(...ie[z]);se=se.sort(((z,K)=>z.toString().localeCompare(K.toString()))).filter(((z,K,ee)=>!K||z.toString()!==ee[K-1].toString()));const oe=[],le=se.map((z=>z.sliceBytes)).reduce(((z,K)=>z+K),0);if(le>this.fetchSizeLimit)throw new Error(`mate data size of ${le.toLocaleString()} bytes exceeded fetch size limit of ${this.fetchSizeLimit.toLocaleString()} bytes`);se.forEach((z=>{let te=this.cram.featureCache.get(z.toString());te||(te=this.getRecordsInSlice(z,(()=>!0)),this.cram.featureCache.set(z.toString(),te));const ne=te.then((z=>{const te=[];for(let ne=0;ne<z.length;ne+=1){const re=z[ne];if(void 0===re.readName)throw new Error;ee[re.readName]&&!K[re.uniqueId]&&te.push(re)}return te}));oe.push(ne)}));const ce=yield Promise.all(oe);if(ce.length){const z=ce.reduce(((z,K)=>z.concat(K)));ae=ae.concat(z)}}return ae}))}getRecordsInSlice({containerStart:z,sliceStart:K,sliceBytes:ee},te){return this.cram.getContainerAtPosition(z).getSlice(K,ee).getRecords(te)}hasDataForReferenceSequence(z){return this.index.hasDataForReferenceSequence(z)}}},3427:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0}),K.open=K.fromUrl=K.RemoteFile=K.LocalFile=void 0;const ne=te(ee(8575)),re=ee(4319),ie=ee(2949);function a(z){const{protocol:K,pathname:ee}=ne.default.parse(z);return"file:"===K?new ie.LocalFile(unescape((0,re.ensureNotNullish)(ee))):new ie.RemoteFile(z)}Object.defineProperty(K,"LocalFile",{enumerable:!0,get:function(){return ie.LocalFile}}),Object.defineProperty(K,"RemoteFile",{enumerable:!0,get:function(){return ie.RemoteFile}}),K.fromUrl=a,K.open=function(z,K,ee){if(ee)return ee;if(z)return a(z);if(K)return new ie.LocalFile(K);throw new Error("no url, path, or filehandle provided, cannot open")}},5702:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.RANS_BYTE_L=K.TOTFREQ=K.TF_SHIFT=void 0,K.TF_SHIFT=12,K.TOTFREQ=4096,K.RANS_BYTE_L=1<<23},6484:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=ee(5702),ie=te(ee(7634));K.default=function(z,K,ee,te){let se=z.getInt(),oe=z.getInt(),ae=z.getInt(),le=z.getInt();const ce=te.remaining(),he=-4&ce;for(let ne=0;ne<he;ne+=4){const ce=K.R[ie.default.get(se,re.TF_SHIFT)],he=K.R[ie.default.get(oe,re.TF_SHIFT)],ue=K.R[ie.default.get(ae,re.TF_SHIFT)],de=K.R[ie.default.get(le,re.TF_SHIFT)];te.putAt(ne,ce),te.putAt(ne+1,he),te.putAt(ne+2,ue),te.putAt(ne+3,de),se=ie.default.advanceSymbolStep(se,ee[255&ce],re.TF_SHIFT),oe=ie.default.advanceSymbolStep(oe,ee[255&he],re.TF_SHIFT),ae=ie.default.advanceSymbolStep(ae,ee[255&ue],re.TF_SHIFT),le=ie.default.advanceSymbolStep(le,ee[255&de],re.TF_SHIFT),se=ie.default.renormalize(se,z),oe=ie.default.renormalize(oe,z),ae=ie.default.renormalize(ae,z),le=ie.default.renormalize(le,z)}let ue;switch(te.setPosition(he),3&ce){case 0:break;case 1:ue=K.R[ie.default.get(se,re.TF_SHIFT)],ie.default.advanceSymbol(se,z,ee[255&ue],re.TF_SHIFT),te.put(ue);break;case 2:ue=K.R[ie.default.get(se,re.TF_SHIFT)],ie.default.advanceSymbol(se,z,ee[255&ue],re.TF_SHIFT),te.put(ue),ue=K.R[ie.default.get(oe,re.TF_SHIFT)],ie.default.advanceSymbol(oe,z,ee[255&ue],re.TF_SHIFT),te.put(ue);break;case 3:ue=K.R[ie.default.get(se,re.TF_SHIFT)],ie.default.advanceSymbol(se,z,ee[255&ue],re.TF_SHIFT),te.put(ue),ue=K.R[ie.default.get(oe,re.TF_SHIFT)],ie.default.advanceSymbol(oe,z,ee[255&ue],re.TF_SHIFT),te.put(ue),ue=K.R[ie.default.get(ae,re.TF_SHIFT)],ie.default.advanceSymbol(ae,z,ee[255&ue],re.TF_SHIFT),te.put(ue);break;default:throw new ne.CramMalformedError("invalid output size encountered during rANS decoding")}te.setPosition(0)}},7121:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(5702),re=te(ee(7634));K.default=function(z,K,ee,te){const ie=K.remaining();let se=z.getInt(),oe=z.getInt(),ae=z.getInt(),le=z.getInt();const ce=ie>>2;let he=0,ue=ce,de=2*ce,fe=3*ce,pe=0,ge=0,me=0,be=0;for(;he<ce;he+=1,ue+=1,de+=1,fe+=1){const ie=255&ee[pe].R[re.default.get(se,ne.TF_SHIFT)],ce=255&ee[ge].R[re.default.get(oe,ne.TF_SHIFT)],ve=255&ee[me].R[re.default.get(ae,ne.TF_SHIFT)],we=255&ee[be].R[re.default.get(le,ne.TF_SHIFT)];K.putAt(he,ie),K.putAt(ue,ce),K.putAt(de,ve),K.putAt(fe,we),se=re.default.advanceSymbolStep(se,te[pe][ie],ne.TF_SHIFT),oe=re.default.advanceSymbolStep(oe,te[ge][ce],ne.TF_SHIFT),ae=re.default.advanceSymbolStep(ae,te[me][ve],ne.TF_SHIFT),le=re.default.advanceSymbolStep(le,te[be][we],ne.TF_SHIFT),se=re.default.renormalize(se,z),oe=re.default.renormalize(oe,z),ae=re.default.renormalize(ae,z),le=re.default.renormalize(le,z),pe=ie,ge=ce,me=ve,be=we}for(;fe<ie;fe+=1){const ie=255&ee[be].R[re.default.get(le,ne.TF_SHIFT)];K.putAt(fe,ie),le=re.default.advanceSymbol(le,z,te[be][ie],ne.TF_SHIFT),be=ie}}},7634:(z,K,ee)=>{Object.defineProperty(K,"__esModule",{value:!0});const te=ee(8577),ne=ee(5702);class o{constructor(){this.F=void 0,this.C=void 0}}function s(z,K,ee,te){return ee*(z>>te)+(z&(1<<te)-1)-K}const re={FC:o,AriDecoder:class{constructor(){this.fc=new Array(256);for(let z=0;z<this.fc.length;z+=1)this.fc[z]=new o;this.R=null}},Symbol:class{constructor(){this.start=void 0,this.freq=void 0}},symbolInit:function(z,K,ee){if(!(K<=65536))throw new te.CramMalformedError("assertion failed: start <= 1<<16");if(!(ee<=65536-K))throw new te.CramMalformedError("assertion failed: freq <= 1<<16");z.start=K,z.freq=ee},advanceStep:s,advanceSymbolStep:function(z,K,ee){return s(z,K.start,K.freq,ee)},get:function(z,K){return z&(1<<K)-1},advanceSymbol:function(z,K,ee,te){return function(z,K,ee,te,re){if((z=te*(z>>re)+(z&(1<<re)-1)-ee)<ne.RANS_BYTE_L)do{z=z<<8|255&K.get()}while(z<ne.RANS_BYTE_L);return z}(z,K,ee.start,ee.freq,te)},renormalize:function(z,K){if(z<ne.RANS_BYTE_L)do{z=z<<8|255&K.get()}while(z<ne.RANS_BYTE_L);return z}};K.default=re},696:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0}),K.readStatsO1=K.readStatsO0=void 0;const ne=ee(8577),re=ee(5702),ie=te(ee(7634));function a(z){if(!z)throw new ne.CramMalformedError("assertion failed")}K.readStatsO0=function(z,K,ee){let te=0,ne=0,se=255&z.get();do{null==K.fc[se]&&(K.fc[se]=new ie.default.FC),K.fc[se].F=255&z.get(),K.fc[se].F>=128&&(K.fc[se].F&=-129,K.fc[se].F=(127&K.fc[se].F)<<8|255&z.get()),K.fc[se].C=ne,ie.default.symbolInit(ee[se],K.fc[se].C,K.fc[se].F),K.R||(K.R=new Array(re.TOTFREQ)),K.R.fill(se,ne,ne+K.fc[se].F),ne+=K.fc[se].F,0===te&&se+1===(255&z.getByteAt(z.position()))?(se=255&z.get(),te=255&z.get()):0!==te?(te-=1,se+=1):se=255&z.get()}while(0!==se);a(ne<re.TOTFREQ)},K.readStatsO1=function(z,K,ee){let te=0,ne=255&z.get();do{let se=0,oe=0,ae=255&z.get();null==K[ne]&&(K[ne]=new ie.default.AriDecoder);do{null==K[ne].fc[ae]&&(K[ne].fc[ae]=new ie.default.FC),K[ne].fc[ae].F=255&z.get(),K[ne].fc[ae].F>=128&&(K[ne].fc[ae].F&=-129,K[ne].fc[ae].F=(127&K[ne].fc[ae].F)<<8|255&z.get()),K[ne].fc[ae].C=oe,0===K[ne].fc[ae].F&&(K[ne].fc[ae].F=re.TOTFREQ),null==ee[ne][ae]&&(ee[ne][ae]=new ie.default.RansDecSymbol),ie.default.symbolInit(ee[ne][ae],K[ne].fc[ae].C,K[ne].fc[ae].F),null==K[ne].R&&(K[ne].R=new Array(re.TOTFREQ)),K[ne].R.fill(ae,oe,oe+K[ne].fc[ae].F),oe+=K[ne].fc[ae].F,a(oe<=re.TOTFREQ),0===se&&ae+1===(255&z.getByteAt(z.position()))?(ae=255&z.get(),se=255&z.get()):0!==se?(se-=1,ae+=1):ae=255&z.get()}while(0!==ae);0===te&&ne+1===(255&z.getByteAt(z.position()))?(ne=255&z.get(),te=255&z.get()):0!==te?(te-=1,ne+=1):ne=255&z.get()}while(0!==ne)}},9675:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8577),re=te(ee(7634)),ie=ee(696),se=te(ee(6484)),oe=te(ee(7121));class h{constructor(z,K=0){this._buffer=z,this._position=K,this.length=z.length}get(){const z=this._buffer[this._position];return this._position+=1,z}getByte(){return this.get()}getByteAt(z){return this._buffer[z]}position(){return this._position}put(z){return this._buffer[this._position]=z,this._position+=1,z}putAt(z,K){return this._buffer[z]=K,K}setPosition(z){return this._position=z,z}getInt(){const z=this._buffer.readInt32LE(this._position);return this._position+=4,z}remaining(){return this._buffer.length-this._position}}K.default=function(z,K,ee=0){if(0===z.length)return K.fill(0),K;const te=new h(z,ee),ae=te.get();if(0!==ae&&1!==ae)throw new ne.CramMalformedError(`Invalid rANS order ${ae}`);if(te.getInt()!==te.remaining()-4)throw new ne.CramMalformedError("Incorrect input length.");const le=te.getInt(),ce=new h(K||Buffer.allocUnsafe(le));if(ce.length<le)throw new ne.CramMalformedError(`Output buffer too small to fit ${le} bytes.`);switch(ae){case 0:return function(z,K){const ee=new re.default.AriDecoder,te=new Array(256);for(let z=0;z<te.length;z+=1)te[z]=new re.default.Symbol;return(0,ie.readStatsO0)(z,ee,te),(0,se.default)(z,ee,te,K),K}(te,ce);case 1:return function(z,K){const ee=new Array(256);for(let z=0;z<ee.length;z+=1)ee[z]=new re.default.AriDecoder;const te=new Array(256);for(let z=0;z<te.length;z+=1){te[z]=new Array(256);for(let K=0;K<te[z].length;K+=1)te[z][K]=new re.default.Symbol}return(0,ie.readStatsO1)(z,ee,te),(0,oe.default)(z,K,ee,te),K}(te,ce);default:throw new ne.CramMalformedError(`Invalid rANS order: ${ae}`)}}},7578:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.parseHeaderText=void 0,K.parseHeaderText=function(z){const K=z.split(/\r?\n/),ee=[];return K.forEach((z=>{const[K,...te]=z.split(/\t/),ne=te.map((z=>{const[K,ee]=z.split(":",2);return{tag:K,value:ee}}));K&&ee.push({tag:K.substr(1),data:ne})})),ee}},4319:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.ensureNotNullish=void 0,K.ensureNotNullish=function(z){if(null==z)throw new Error("Value must not be nullish.");return z}},597:(z,K,ee)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.unzip=void 0;const te=ee(9591);K.unzip=function(z){return Buffer.from((0,te.inflate)(z))}},9996:(z,K,ee)=>{function n(z){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(z){return typeof z}:function(z){return z&&"function"==typeof Symbol&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},n(z)}var te=ee(8764).Buffer,ne=ee(22),re=ee(2961)._,ie=ee(3720);"undefined"!=typeof window&&(window.Buffer=te),"undefined"!=typeof self&&(self.Buffer=te);var se={UInt8:1,UInt16LE:2,UInt16BE:2,UInt32LE:4,UInt32BE:4,Int8:1,Int16LE:2,Int16BE:2,Int32LE:4,Int32BE:4,FloatLE:4,FloatBE:4,DoubleLE:8,DoubleBE:8,UInt64:8,Int64:8},oe={},ae="___parser_",le=[];!function(){var z;for(z=1;z<=32;z++)le.push(z)}();var ce={};Object.keys(se).concat(Object.keys({String:null,Buffer:null,Array:null,Skip:null,Choice:null,Nest:null,Bit:null,Itf8:null,Ltf8:null})).forEach((function(z){ce[z.toLowerCase()]=z}));var d=function(){this.varName="",this.type="",this.options={},this.next=null,this.head=null,this.compiled=null,this.endian="le",this.constructorFn=null,this.alias=null};d.start=function(){return new d},Object.keys(se).forEach((function(z){d.prototype[z.toLowerCase()]=function(K,ee){return this.setNextParser(z.toLowerCase(),K,ee)};var K=z.replace(/BE|LE/,"").toLowerCase();K in d.prototype||(d.prototype[K]=function(z,ee){return this[K+this.endian](z,ee)})})),le.forEach((function(z){d.prototype["bit".concat(z.toString())]=function(K,ee){return ee||(ee={}),ee.length=z,this.setNextParser("bit",K,ee)}})),d.prototype.namely=function(z){return oe[z]=this,this.alias=z,this},d.prototype.skip=function(z,K){if(K&&K.assert)throw new Error("assert option on skip is not allowed.");return this.setNextParser("skip","",{length:z})},d.prototype.string=function(z,K){if(!K.zeroTerminated&&!K.length&&!K.greedy)throw new Error("Neither length, zeroTerminated, nor greedy is defined for string.");if((K.zeroTerminated||K.length)&&K.greedy)throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.");if(K.stripNull&&!K.length&&!K.greedy)throw new Error("Length or greedy must be defined if stripNull is defined.");return K.encoding=K.encoding||"utf8",this.setNextParser("string",z,K)},d.prototype.buffer=function(z,K){if(!K.length&&!K.readUntil)throw new Error("Length nor readUntil is defined in buffer parser");return this.setNextParser("buffer",z,K)},d.prototype.array=function(z,K){if(!K.readUntil&&!K.length&&!K.lengthInBytes)throw new Error("Length option of array is not defined.");if(!K.type)throw new Error("Type option of array is not defined.");if("string"==typeof K.type&&!oe[K.type]&&Object.keys(se).indexOf(ce[K.type])<0)throw new Error('Specified primitive type "'.concat(K.type,'" is not supported.'));return this.setNextParser("array",z,K)},d.prototype.choice=function(z,K){if(1===arguments.length&&"object"===n(z)&&(K=z,z=null),!K.tag)throw new Error("Tag option of array is not defined.");if(!K.choices)throw new Error("Choices option of array is not defined.");return Object.keys(K.choices).forEach((function(ee){if(!K.choices[ee])throw new Error("Choice Case ".concat(ee," of ").concat(z," is not valid."));if("string"==typeof K.choices[ee]&&!oe[K.choices[ee]]&&Object.keys(se).indexOf(ce[K.choices[ee]])<0)throw new Error('Specified primitive type "'.concat(K.choices[ee],'" is not supported.'))}),this),this.setNextParser("choice",z,K)},d.prototype.nest=function(z,K){if(1===arguments.length&&"object"===n(z)&&(K=z,z=null),!K.type)throw new Error("Type option of nest is not defined.");if(!(K.type instanceof d||oe[K.type]))throw new Error("Type option of nest must be a Parser object.");if(!(K.type instanceof d||z))throw new Error("options.type must be a object if variable name is omitted.");return this.setNextParser("nest",z,K)},d.prototype.endianess=function(z){switch(z.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error("Invalid endianess: ".concat(z))}return this},d.prototype.create=function(z){if(!(z instanceof Function))throw new Error("Constructor must be a Function object.");return this.constructorFn=z,this},d.prototype.getCode=function(){var z=new re;return z.pushCode("if (!Buffer.isBuffer(buffer)) {"),z.generateError('"argument buffer is not a Buffer object"'),z.pushCode("}"),this.alias?this.addAliasedCode(z):this.addRawCode(z),this.alias?z.pushCode("return {0}(0)",ae+this.alias):z.pushCode("return { offset: offset, result: vars };"),z.code},d.prototype.addRawCode=function(z){z.pushCode("var offset = 0;"),this.constructorFn?z.pushCode("var vars = new constructorFn();"):z.pushCode("var vars = {};"),this.generate(z),this.resolveReferences(z),z.pushCode("return { offset: offset, result: vars };")},d.prototype.addAliasedCode=function(z){return z.pushCode("function {0}(offset) {",ae+this.alias),this.constructorFn?z.pushCode("var vars = new constructorFn();"):z.pushCode("var vars = {};"),this.generate(z),z.markResolved(this.alias),this.resolveReferences(z),z.pushCode("return { offset: offset, result: vars };"),z.pushCode("}"),z},d.prototype.resolveReferences=function(z){var K=z.getUnresolvedReferences();z.markRequested(K),K.forEach((function(K){oe[K].addAliasedCode(z)}))},d.prototype.compile=function(){var z="(function(buffer, constructorFn, Long) { ".concat(this.getCode()," })");this.compiled=ne.runInThisContext(z)},d.prototype.sizeOf=function(){var z=NaN;if(Object.keys(se).indexOf(this.type)>=0)z=se[this.type];else if("String"===this.type&&"number"==typeof this.options.length)z=this.options.length;else if("Buffer"===this.type&&"number"==typeof this.options.length)z=this.options.length;else if("Array"===this.type&&"number"==typeof this.options.length){var K=NaN;"string"==typeof this.options.type?K=se[ce[this.options.type]]:this.options.type instanceof d&&(K=this.options.type.sizeOf()),z=this.options.length*K}else"Skip"===this.type?z=this.options.length:"Nest"===this.type?z=this.options.type.sizeOf():this.type||(z=0);return this.next&&(z+=this.next.sizeOf()),z},d.prototype.parse=function(z){return this.compiled||this.compile(),this.compiled(z,this.constructorFn,ie)},d.prototype.setNextParser=function(z,K,ee){var te=new d;return te.type=ce[z],te.varName=K,te.options=ee||te.options,te.endian=this.endian,this.head?this.head.next=te:this.next=te,this.head=te,this},d.prototype.generate=function(z){this.type&&(this["generate".concat(this.type)](z),this.generateAssert(z));var K=z.generateVariable(this.varName);return this.options.formatter&&this.generateFormatter(z,K,this.options.formatter),this.generateNext(z)},d.prototype.generateAssert=function(z){if(this.options.assert){var K=z.generateVariable(this.varName);switch(n(this.options.assert)){case"function":z.pushCode("if (!({0}).call(vars, {1})) {",this.options.assert,K);break;case"number":z.pushCode("if ({0} !== {1}) {",this.options.assert,K);break;case"string":z.pushCode('if ("{0}" !== {1}) {',this.options.assert,K);break;default:throw new Error("Assert option supports only strings, numbers and assert functions.")}z.generateError('"Assert error: {0} is " + {0}',K),z.pushCode("}")}},d.prototype.generateNext=function(z){return this.next&&(z=this.next.generate(z)),z},Object.keys(se).forEach((function(z){d.prototype["generate".concat(z)]=function(K){"UInt64"===z?K.pushCode("{0} = Long.fromBytes(buffer.slice(offset,offset+8), true, this.endian === 'le').toNumber();",K.generateVariable(this.varName),z):"Int64"===z?K.pushCode("{0} = Long.fromBytes(buffer.slice(offset,offset+8), false, this.endian === 'le').toNumber();",K.generateVariable(this.varName),z):K.pushCode("{0} = buffer.read{1}(offset);",K.generateVariable(this.varName),z),K.pushCode("offset += {0};",se[z])}})),d.prototype.generateBit=function(z){var K=JSON.parse(JSON.stringify(this));if(K.varName=z.generateVariable(K.varName),z.bitFields.push(K),!this.next||this.next&&["Bit","Nest"].indexOf(this.next.type)<0){var ee=0;z.bitFields.forEach((function(z){ee+=z.options.length}));var te=z.generateTmpVariable();if(ee<=8)z.pushCode("var {0} = buffer.readUInt8(offset);",te),ee=8;else if(ee<=16)z.pushCode("var {0} = buffer.readUInt16BE(offset);",te),ee=16;else if(ee<=24){var ne=z.generateTmpVariable(),re=z.generateTmpVariable();z.pushCode("var {0} = buffer.readUInt16BE(offset);",ne),z.pushCode("var {0} = buffer.readUInt8(offset + 2);",re),z.pushCode("var {2} = ({0} << 8) | {1};",ne,re,te),ee=24}else{if(!(ee<=32))throw new Error("Currently, bit field sequence longer than 4-bytes is not supported.");z.pushCode("var {0} = buffer.readUInt32BE(offset);",te),ee=32}z.pushCode("offset += {0};",ee/8);var ie=0,se="be"===this.endian;z.bitFields.forEach((function(K){z.pushCode("{0} = {1} >> {2} & {3};",K.varName,te,se?ee-ie-K.options.length:ie,(1<<K.options.length)-1),ie+=K.options.length})),z.bitFields=[]}},d.prototype.generateSkip=function(z){var K=z.generateOption(this.options.length);z.pushCode("offset += {0};",K)},d.prototype.generateString=function(z){var K=z.generateVariable(this.varName),ee=z.generateTmpVariable();this.options.length&&this.options.zeroTerminated?(z.pushCode("var {0} = offset;",ee),z.pushCode("while(buffer.readUInt8(offset++) !== 0 && offset - {0}  < {1});",ee,this.options.length),z.pushCode("{0} = buffer.toString('{1}', {2}, offset - {2} < {3} ? offset - 1 : offset);",K,this.options.encoding,ee,this.options.length)):this.options.length?(z.pushCode("{0} = buffer.toString('{1}', offset, offset + {2});",K,this.options.encoding,z.generateOption(this.options.length)),z.pushCode("offset += {0};",z.generateOption(this.options.length))):this.options.zeroTerminated?(z.pushCode("var {0} = offset;",ee),z.pushCode("while(buffer.readUInt8(offset++) !== 0);"),z.pushCode("{0} = buffer.toString('{1}', {2}, offset - 1);",K,this.options.encoding,ee)):this.options.greedy&&(z.pushCode("var {0} = offset;",ee),z.pushCode("while(buffer.length > offset++);"),z.pushCode("{0} = buffer.toString('{1}', {2}, offset);",K,this.options.encoding,ee)),this.options.stripNull&&z.pushCode("{0} = {0}.replace(/\\x00+$/g, '')",K)},d.prototype.generateBuffer=function(z){"eof"===this.options.readUntil?z.pushCode("{0} = buffer.slice(offset);",z.generateVariable(this.varName)):(z.pushCode("{0} = buffer.slice(offset, offset + {1});",z.generateVariable(this.varName),z.generateOption(this.options.length)),z.pushCode("offset += {0};",z.generateOption(this.options.length))),this.options.clone&&z.pushCode("{0} = Buffer.from({0});",z.generateVariable(this.varName))},d.prototype.generateArray=function(z){var K=z.generateOption(this.options.length),ee=z.generateOption(this.options.lengthInBytes),te=this.options.type,ne=z.generateTmpVariable(),re=z.generateVariable(this.varName),ie=z.generateTmpVariable(),le=this.options.key,he="string"==typeof le;if(he?z.pushCode("{0} = {};",re):z.pushCode("{0} = [];",re),"function"==typeof this.options.readUntil?z.pushCode("do {"):"eof"===this.options.readUntil?z.pushCode("for (var {0} = 0; offset < buffer.length; {0}++) {",ne):void 0!==ee?z.pushCode("for (var {0} = offset; offset - {0} < {1}; ) {",ne,ee):z.pushCode("for (var {0} = 0; {0} < {1}; {0}++) {",ne,K),"string"==typeof te)if(oe[te]){var ue=z.generateTmpVariable();z.pushCode("var {0} = {1}(offset);",ue,ae+te),z.pushCode("var {0} = {1}.result; offset = {1}.offset;",ie,ue),te!==this.alias&&z.addReference(te)}else z.pushCode("var {0} = buffer.read{1}(offset);",ie,ce[te]),z.pushCode("offset += {0};",se[ce[te]]);else te instanceof d&&(z.pushCode("var {0} = {};",ie),z.pushScope(ie),te.generate(z),z.popScope());he?z.pushCode("{0}[{2}.{1}] = {2};",re,le,ie):z.pushCode("{0}.push({1});",re,ie),z.pushCode("}"),"function"==typeof this.options.readUntil&&z.pushCode(" while (!({0}).call(this, {1}, buffer.slice(offset)));",this.options.readUntil,ie)},d.prototype.generateChoiceCase=function(z,K,ee){if("string"==typeof ee)if(oe[ee]){var te=z.generateTmpVariable();z.pushCode("var {0} = {1}(offset);",te,ae+ee),z.pushCode("{0} = {1}.result; offset = {1}.offset;",z.generateVariable(this.varName),te),ee!==this.alias&&z.addReference(ee)}else z.pushCode("{0} = buffer.read{1}(offset);",z.generateVariable(this.varName),ce[ee]),z.pushCode("offset += {0};",se[ce[ee]]);else ee instanceof d&&(z.pushPath(K),ee.generate(z),z.popPath(K))},d.prototype.generateChoice=function(z){var K=z.generateOption(this.options.tag);this.varName&&z.pushCode("{0} = {};",z.generateVariable(this.varName)),z.pushCode("switch({0}) {",K),Object.keys(this.options.choices).forEach((function(K){var ee=this.options.choices[K];Number.isNaN(parseInt(K,10))?z.pushCode("case '{0}':",K):z.pushCode("case {0}:",K),this.generateChoiceCase(z,this.varName,ee),z.pushCode("break;")}),this),z.pushCode("default:"),this.options.defaultChoice?this.generateChoiceCase(z,this.varName,this.options.defaultChoice):z.generateError('"Met undefined tag value " + {0} + " at choice"',K),z.pushCode("}")},d.prototype.generateNest=function(z){var K=z.generateVariable(this.varName);if(this.options.type instanceof d)this.varName&&z.pushCode("{0} = {};",K),z.pushPath(this.varName),this.options.type.generate(z),z.popPath(this.varName);else if(oe[this.options.type]){var ee=z.generateTmpVariable();z.pushCode("var {0} = {1}(offset);",ee,ae+this.options.type),z.pushCode("{0} = {1}.result; offset = {1}.offset;",K,ee),this.options.type!==this.alias&&z.addReference(this.options.type)}},d.prototype.generateFormatter=function(z,K,ee){"function"==typeof ee&&z.pushCode("{0} = ({1}).call(this, {0});",K,ee)},d.prototype.isInteger=function(){return!!this.type.match(/U?Int[8|16|32][BE|LE]?|Bit\d+/)},d.prototype.itf8=function(z,K){return this.setNextParser("itf8",z,K)},d.prototype.itf8=function(z,K){return this.setNextParser("itf8",z,K)},d.prototype.generateItf8=function(z){var K=z.generateVariable(this.varName),ee=z.generateTmpVariable();z.pushCode("\n    var ".concat(ee," = buffer[offset];\n    if (").concat(ee," < 0x80) {\n      ").concat(K," = ").concat(ee,";\n      offset += 1;\n    } else if (").concat(ee," < 0xc0) {\n      ").concat(K," = ((").concat(ee,"<<8) | buffer[offset+1]) & 0x3fff;\n      offset += 2;\n    } else if (").concat(ee," < 0xe0) {\n      ").concat(K," = ((").concat(ee,"<<16) | (buffer[offset+1]<< 8) |  buffer[offset+2]) & 0x1fffff;\n      offset += 3;\n    } else if (").concat(ee," < 0xf0) {\n      ").concat(K," = ((").concat(ee,"<<24) | (buffer[offset+1]<<16) | (buffer[offset+2]<<8) | buffer[offset+3]) & 0x0fffffff;\n      offset += 4\n    } else {\n      ").concat(K," = ((").concat(ee," & 0x0f)<<28) | (buffer[offset+1]<<20) | (buffer[offset+2]<<12) | (buffer[offset+3]<<4) | (buffer[offset+4] & 0x0f);\n      // x=((0xff & 0x0f)<<28) | (0xff<<20) | (0xff<<12) | (0xff<<4) | (0x0f & 0x0f);\n      // TODO *val_p = uv < 0x80000000UL ? uv : -((int32_t) (0xffffffffUL - uv)) - 1;\n      offset += 5\n    }\n  "))},d.prototype.ltf8=function(z,K){return this.setNextParser("ltf8",z,K)},d.prototype.generateLtf8=function(z){var K=z.generateVariable(this.varName),ee=z.generateTmpVariable();z.pushCode("\n  var ".concat(ee," = buffer[offset];\n  if (").concat(ee," < 0x80) {\n    ").concat(K," = ").concat(ee,";\n    offset += 1;\n  } else if (").concat(ee," < 0xc0) {\n    ").concat(K," = ((buffer[offset]<<8) | buffer[offset+1]) & 0x3fff;\n    offset += 2;\n  } else if (").concat(ee," < 0xe0) {\n    ").concat(K," = ((buffer[offset]<<16) | (buffer[offset+1]<<8) | buffer[offset+2]) & 0x1fffff;\n    ").concat(K," = (((").concat(ee," & 63) << 16) | buffer.readUInt16LE(offset + 1));\n    offset += 3;\n  } else if (").concat(ee," < 0xf0) {\n    ").concat(K," = ((buffer[offset]<<24) | (buffer[offset+1]<<16) | (buffer[offset+2]<<8) | buffer[offset+3]) & 0x0fffffff;\n    offset += 4;\n  } else if (").concat(ee," < 0xf8) {\n    ").concat(K," = (((buffer[offset] & 15) * Math.pow(2,32))) +\n      (buffer[offset+1]<<24) | (buffer[offset+2]<<16 | buffer[offset+3]<<8 | buffer[offset+4])\n    // TODO *val_p = uv < 0x80000000UL ? uv : -((int32_t) (0xffffffffUL - uv)) - 1;\n    offset += 5;\n  } else if (").concat(ee," < 0xfc) {\n    ").concat(K," = ((((buffer[offset] & 7) << 8) | buffer[offset+1] )) * Math.pow(2,32) +\n      (buffer[offset+2]<<24) | (buffer[offset+3]<<16 | buffer[offset+4]<<8 | buffer[offset+5])\n    offset += 6;\n  } else if (").concat(ee," < 0xfe) {\n    ").concat(K," = ((((buffer[offset] & 3) << 16) | buffer[offset+1]<<8 | buffer[offset+2])) * Math.pow(2,32) +\n      (buffer[offset+3]<<24) | (buffer[offset+4]<<16 | buffer[offset+5]<<8 | buffer[offset+6])\n    offset += 7;\n  } else if (").concat(ee," < 0xff) {\n    ").concat(K," = Long.fromBytesBE(buffer.slice(offset+1,offset+8));\n    if (").concat(K,".greaterThan(Number.MAX_SAFE_INTEGER) || ").concat(K,".lessThan(Number.MIN_SAFE_INTEGER))\n      throw new Error('integer overflow')\n    ").concat(K," = ").concat(K,".toNumber()\n    offset += 8;\n  } else {\n    ").concat(K," = Long.fromBytesBE(buffer.slice(offset+1,offset+9));\n    if (").concat(K,".greaterThan(Number.MAX_SAFE_INTEGER) || ").concat(K,".lessThan(Number.MIN_SAFE_INTEGER))\n      throw new Error('integer overflow')\n    ").concat(K," = ").concat(K,".toNumber()\n    offset += 9;\n  }\n  "))},K.Parser=d},2961:(z,K)=>{function r(z){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(z){return typeof z}:function(z){return z&&"function"==typeof Symbol&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},r(z)}var n=function(){this.code="",this.scopes=[["vars"]],this.isAsync=!1,this.bitFields=[],this.tmpVariableCount=0,this.references={}};n.prototype.generateVariable=function(z){var K=[];for(Array.prototype.push.apply(K,this.scopes[this.scopes.length-1]);/^\$parent\./.test(z);)K.pop(),z=z.replace(/^\$parent\./,"");return z&&K.push(z),K.join(".")},n.prototype.generateOption=function(z){switch(r(z)){case"number":return z.toString();case"string":return this.generateVariable(z);case"function":return"(".concat(z,").call(").concat(this.generateVariable(),", vars)");default:return}},n.prototype.generateError=function(){var z=Array.prototype.slice.call(arguments),K=n.interpolate.apply(this,z);this.isAsync?this.pushCode("return process.nextTick(function() { callback(new Error(".concat(K,"), vars); });")):this.pushCode("throw new Error(".concat(K,");"))},n.prototype.generateTmpVariable=function(){return"$tmp".concat(this.tmpVariableCount++)},n.prototype.pushCode=function(){var z=Array.prototype.slice.call(arguments);this.code+="".concat(n.interpolate.apply(this,z),"\n")},n.prototype.pushPath=function(z){z&&this.scopes[this.scopes.length-1].push(z)},n.prototype.popPath=function(z){z&&this.scopes[this.scopes.length-1].pop()},n.prototype.pushScope=function(z){this.scopes.push([z])},n.prototype.popScope=function(){this.scopes.pop()},n.prototype.addReference=function(z){this.references[z]||(this.references[z]={resolved:!1,requested:!1})},n.prototype.markResolved=function(z){this.references[z].resolved=!0},n.prototype.markRequested=function(z){z.forEach(function(z){this.references[z].requested=!0}.bind(this))},n.prototype.getUnresolvedReferences=function(){var z=this.references;return Object.keys(this.references).filter((function(K){return!z[K].resolved&&!z[K].requested}))},n.interpolate=function(z){var K=/{\d+}/g,ee=z.match(K),te=Array.prototype.slice.call(arguments,1);return ee&&ee.forEach((function(K){var ee=parseInt(K.substr(1,K.length-2),10);z=z.replace(K,te[ee].toString())})),z},K._=n},22:z=>{z.exports.runInThisContext=function(z){return new Function("code","return eval(code);").call(globalThis,z)}},445:(z,K,ee)=>{const te=ee(7381),ne=ee(9260),re=ee(576),ie=ee(4693),se=128;z.exports=class{decode(z){return this.stream=new ne(z),this.decodeStream(this.stream)}decodeStream(z,K=0){var ee=this.stream.ReadByte();16&ee||(K=this.stream.ReadUint7());var te,ne=K,re=1&ee;if(8&ee)return this.decodeStripe(this.stream,K);if(ee&se&&([te,ne]=this.decodePackMeta(this.stream)),32&ee)var ie=this.decodeCat(this.stream,ne);else ie=4&ee?this.decodeExt(this.stream,ne):64&ee?re?this.decodeRLE1(this.stream,ne):this.decodeRLE0(this.stream,ne):re?this.decode1(this.stream,ne):this.decode0(this.stream,ne);return ee&se&&(ie=this.decodePack(ie,te,K)),ie}encode(z,K){if(this.stream=new ne("",0,1.1*z.length+100),this.stream.WriteByte(K),16&K||this.stream.WriteUint7(z.length),8&K)return Buffer.concat([this.stream.buf.slice(0,this.stream.pos),this.encodeStripe(this.stream,z,K>>8)]);var ee,te=1&K,re=z.length;return K&se&&([ee,z,re]=this.encodePack(z)),K&se&&this.stream.WriteStream(ee),64&K?te?this.encodeRLE1(z,re,this.stream):this.encodeRLE0(z,re,this.stream):te?this.encode1(z,re,this.stream):this.encode0(z,re,this.stream)}decode0(z,K){var ee=new Buffer.allocUnsafe(K),ne=z.ReadByte();0==ne&&(ne=256);var ie=new re(ne),se=new te(z);se.RangeStartDecode(z);for(var oe=0;oe<K;oe++)ee[oe]=ie.ModelDecode(z,se);return ee}encode0(z,K,ee){for(var ne=0,ie=0;ie<K;ie++)ne<z[ie]&&(ne=z[ie]);ne++;var se=new re(ne);ee.WriteByte(ne);var oe=new te(ee);for(ie=0;ie<K;ie++)se.ModelEncode(ee,oe,z[ie]);return oe.RangeFinishEncode(ee),ee.buf.slice(0,ee.pos)}decode1(z,K){var ee=new Buffer.allocUnsafe(K),ne=z.ReadByte();0==ne&&(ne=256);for(var ie=new Array(ne),se=0;se<ne;se++)ie[se]=new re(ne);var oe=new te(z);oe.RangeStartDecode(z);var ae=0;for(se=0;se<K;se++)ee[se]=ie[ae].ModelDecode(z,oe),ae=ee[se];return ee}encode1(z,K,ee){for(var ne=0,ie=0;ie<K;ie++)ne<z[ie]&&(ne=z[ie]);ne++;var se=new Array(ne);for(ie=0;ie<ne;ie++)se[ie]=new re(ne);ee.WriteByte(ne);var oe=new te(ee),ae=0;for(ie=0;ie<K;ie++)se[ae].ModelEncode(ee,oe,z[ie]),ae=z[ie];return oe.RangeFinishEncode(ee),ee.buf.slice(0,ee.pos)}decodeExt(z,K){var ee=new Buffer.allocUnsafe(K),te=ie.array(z.buf.slice(z.pos)),ne=ie.header(te),re=0;do{var se=ie.decompress(te,ne);-1!=se&&(Buffer.from(se).copy(ee,re),re+=se.length,ne-=se.length)}while(-1!=se);return ee}encodeExt(z,K){}decodeRLE0(z,K){var ee=new Buffer.allocUnsafe(K),ne=z.ReadByte();0==ne&&(ne=256);for(var ie=new re(ne),se=new Array(258),oe=0;oe<=257;oe++)se[oe]=new re(4);var ae=new te(z);for(ae.RangeStartDecode(z),oe=0;oe<K;){ee[oe]=ie.ModelDecode(z,ae);for(var le=se[ee[oe]].ModelDecode(z,ae),ce=le,he=256;3==le;)le=se[he].ModelDecode(z,ae),he=257,ce+=le;for(var ue=1;ue<=ce;ue++)ee[oe+ue]=ee[oe];oe+=ce+1}return ee}encodeRLE0(z,K,ee){for(var ne=0,ie=0;ie<K;ie++)ne<z[ie]&&(ne=z[ie]);ne++;var se=new re(ne),oe=new Array(258);for(ie=0;ie<=257;ie++)oe[ie]=new re(4);ee.WriteByte(ne);var ae=new te(ee);for(ie=0;ie<K;){se.ModelEncode(ee,ae,z[ie]);for(var le=1;ie+le<K&&z[ie+le]==z[ie];)le++;le--;var ce=z[ie];z[ie],ie+=le+1;var he=le>=3?3:le;for(oe[ce].ModelEncode(ee,ae,he),le-=he,ce=256;3==he;)he=le>=3?3:le,oe[ce].ModelEncode(ee,ae,he),ce=257,le-=he}return ae.RangeFinishEncode(ee),ee.buf.slice(0,ee.pos)}decodeRLE1(z,K){var ee=new Buffer.allocUnsafe(K),ne=z.ReadByte();0==ne&&(ne=256);for(var ie=new Array(ne),se=0;se<ne;se++)ie[se]=new re(ne);var oe=new Array(258);for(se=0;se<=257;se++)oe[se]=new re(4);var ae=new te(z);ae.RangeStartDecode(z);var le=0;for(se=0;se<K;){ee[se]=ie[le].ModelDecode(z,ae),le=ee[se];for(var ce=oe[ee[se]].ModelDecode(z,ae),he=ce,ue=256;3==ce;)ce=oe[ue].ModelDecode(z,ae),ue=257,he+=ce;for(var de=1;de<=he;de++)ee[se+de]=ee[se];se+=he+1}return ee}encodeRLE1(z,K,ee){for(var ne=0,ie=0;ie<K;ie++)ne<z[ie]&&(ne=z[ie]);ne++;var se=new Array(ne);for(ie=0;ie<ne;ie++)se[ie]=new re(ne);var oe=new Array(258);for(ie=0;ie<=257;ie++)oe[ie]=new re(4);ee.WriteByte(ne);for(var ae=new te(ee),le=(ie=0,0);ie<K;){se[le].ModelEncode(ee,ae,z[ie]);for(var ce=1;ie+ce<K&&z[ie+ce]==z[ie];)ce++;ce--;var he=z[ie];le=z[ie],ie+=ce+1;var ue=ce>=3?3:ce;for(oe[he].ModelEncode(ee,ae,ue),ce-=ue,he=256;3==ue;)ue=ce>=3?3:ce,oe[he].ModelEncode(ee,ae,ue),he=257,ce-=ue}return ae.RangeFinishEncode(ee),ee.buf.slice(0,ee.pos)}decodePackMeta(z){this.nsym=z.ReadByte();for(var K=new Array(this.nsym),ee=0;ee<this.nsym;ee++)K[ee]=z.ReadByte();return[K,z.ReadUint7()]}decodePack(z,K,ee){var te=new Buffer.allocUnsafe(ee);if(this.nsym<=1)for(var ne=0;ne<ee;ne++)te[ne]=K[0];else if(this.nsym<=2){ne=0;for(var re=0;ne<ee;ne++){if(ne%8==0)var ie=z[re++];te[ne]=K[1&ie],ie>>=1}}else if(this.nsym<=4)for(ne=0,re=0;ne<ee;ne++)ne%4==0&&(ie=z[re++]),te[ne]=K[3&ie],ie>>=2;else{if(!(this.nsym<=16))return z;for(ne=0,re=0;ne<ee;ne++)ne%2==0&&(ie=z[re++]),te[ne]=K[15&ie],ie>>=4}return te}packMeta(z){for(var K=new ne("",0,1024),ee=new Array(256),te=0;te<z.length;te++)ee[z[te]]=1;var re=0;for(te=0;te<256;te++)ee[te]&&(ee[te]=++re);for(K.WriteByte(re),te=0;te<256;te++)ee[te]&&(K.WriteByte(te),ee[te]--);return[K,ee,re]}encodePack(z){var K,ee,te;[K,ee,te]=this.packMeta(z);var ne=z.length,re=0;if(te<=1)return K.WriteUint7(0),[K,new Buffer.allocUnsafe(0),0];if(te<=2){for(var ie=new Buffer.allocUnsafe(Math.floor((ne+7)/8)),se=(re=0,0);re<(-8&ne);re+=8,se++)ie[se]=(ee[z[re+0]]<<0)+(ee[z[re+1]]<<1)+(ee[z[re+2]]<<2)+(ee[z[re+3]]<<3)+(ee[z[re+4]]<<4)+(ee[z[re+5]]<<5)+(ee[z[re+6]]<<6)+(ee[z[re+7]]<<7);if(re<ne){ie[se]=0;for(var oe=0;re<ne;)ie[se]|=ee[z[re++]]<<oe,oe++;se++}return K.WriteUint7(se),[K,ie,ie.length]}if(te<=4){for(ie=new Buffer.allocUnsafe(Math.floor((ne+3)/4)),re=0,se=0;re<(-4&ne);re+=4,se++)ie[se]=(ee[z[re+0]]<<0)+(ee[z[re+1]]<<2)+(ee[z[re+2]]<<4)+(ee[z[re+3]]<<6);if(re<ne){for(ie[se]=0,oe=0;re<ne;)ie[se]|=ee[z[re++]]<<oe,oe+=2;se++}return K.WriteUint7(se),[K,ie,ie.length]}if(te<=16){for(ie=new Buffer.allocUnsafe(Math.floor((ne+1)/2)),re=0,se=0;re<(-2&ne);re+=2,se++)ie[se]=(ee[z[re+0]]<<0)+(ee[z[re+1]]<<4);return re<ne&&(ie[se++]=ee[z[re++]]),K.WriteUint7(se),[K,ie,ie.length]}return K.WriteUint7(z.length),[K,z,z.length]}encodeStripe(z,K,ee){0==ee&&(ee=4);for(var te=new Array(ee),re=new Array(ee),ie=0;ie<ee;ie++)re[ie]=Math.floor(K.length/ee)+(K.length%ee>ie),te[ie]=new Array(re[ie]);for(var se=0,oe=0;oe<K.length;oe+=ee,se++)for(var ae=0;ae<ee;ae++)se<te[ae].length&&(te[ae][se]=K[oe+ae]);var le=new Array(ee),ce=0;for(ie=0;ie<ee;ie++){var he=this.encode(te[ie],0),ue=this.encode(te[ie],1);le[ie]=ue.length<he.length?ue:he,ce+=le[ie].length}var de=new ne("",0,ce+5*ee+1);for(de.WriteByte(ee),ie=0;ie<ee;ie++)de.WriteUint7(le[ie].length);for(ie=0;ie<ee;ie++)de.WriteData(le[ie],le[ie].length);return de.buf.slice(0,de.buf.pos)}decodeStripe(z,K){for(var ee=z.ReadByte(),te=new Array(ee),ne=new Array(ee),re=0;re<ee;re++)te[re]=z.ReadUint7();var ie=new Array(ee);for(re=0;re<ee;re++)ne[re]=Math.floor(K/ee)+(K%ee>re),ie[re]=this.decodeStream(z,ne[re]);var se=new Buffer.allocUnsafe(K);for(re=0;re<ee;re++)for(var oe=0;oe<ne[re];oe++)se[oe*ee+re]=ie[re][oe];return se}decodeCat(z,K){for(var ee=new Buffer.allocUnsafe(K),te=0;te<K;te++)ee[te]=z.ReadByte();return ee}}},7381:z=>{z.exports=class{constructor(z){this.low=0,this.range=4294967295,this.code=0,this.FFnum=0,this.carry=0,this.cache=0}RangeStartDecode(z){for(var K=0;K<5;K++)this.code=(this.code<<8)+z.ReadByte();this.code&=4294967295,this.code>>>=0}RangeGetFrequency(z){return this.range=Math.floor(this.range/z),Math.floor(this.code/this.range)}RangeDecode(z,K,ee,te){for(this.code-=K*this.range,this.range*=ee;this.range<1<<24;)this.range*=256,this.code=256*this.code+z.ReadByte()}RangeShiftLow(z){if(this.low<4278190080|this.carry){for(z.WriteByte(this.cache+this.carry);this.FFnum;)z.WriteByte(this.carry-1),this.FFnum--;this.cache=this.low>>>24,this.carry=0}else this.FFnum++;this.low<<=8,this.low>>>=0}RangeEncode(z,K,ee,te){var ne=this.low;for(this.range=Math.floor(this.range/te),this.low+=K*this.range,this.low>>>=0,this.range*=ee,this.low<ne&&(0!=this.carry&&console.log("ERROR: Multiple carry"),this.carry=1);this.range<1<<24;)this.range*=256,this.RangeShiftLow(z)}RangeFinishEncode(z){for(var K=0;K<5;K++)this.RangeShiftLow(z)}}},576:z=>{z.exports=class{constructor(z=256){this.total_freq=z,this.max_sym=z-1,this.S=new Array,this.F=new Array;for(var K=0;K<=this.max_sym;K++)this.S[K]=K,this.F[K]=1}ModelDecode(z,K){for(var ee=K.RangeGetFrequency(this.total_freq),te=0,ne=0;te+this.F[ne]<=ee;)te+=this.F[ne++];K.RangeDecode(z,te,this.F[ne],this.total_freq),this.F[ne]+=16,this.total_freq+=16,this.total_freq>65519&&this.ModelRenormalise();var re=this.S[ne];if(ne>0&&this.F[ne]>this.F[ne-1]){var ie=this.F[ne];this.F[ne]=this.F[ne-1],this.F[ne-1]=ie,ie=this.S[ne],this.S[ne]=this.S[ne-1],this.S[ne-1]=ie}return re}ModelRenormalise(){this.total_freq=0;for(var z=0;z<=this.max_sym;z++)this.F[z]-=Math.floor(this.F[z]/2),this.total_freq+=this.F[z]}ModelEncode(z,K,ee){for(var te=0,ne=0;this.S[ne]!=ee;ne++)te+=this.F[ne];if(K.RangeEncode(z,te,this.F[ne],this.total_freq),this.F[ne]+=16,this.total_freq+=16,this.total_freq>65519&&this.ModelRenormalise(),ee=this.S[ne],ne>0&&this.F[ne]>this.F[ne-1]){var re=this.F[ne];this.F[ne]=this.F[ne-1],this.F[ne-1]=re,re=this.S[ne],this.S[ne]=this.S[ne-1],this.S[ne-1]=re}}}},5260:(z,K,ee)=>{const te=ee(9260),ne=ee(576),re=ee(7381);function s(z,K,ee){for(var te=0,ne=0,re=-1,ie=new Array(1024);ne<ee;){var se=z.ReadByte();if(ie[te++]=se,ne+=se,se==re){var oe=z.ReadByte();for(ne+=se*oe;oe--;)ie[te++]=se}re=se}var ae=0;for(te=0,ne=0;ne<ee;){var le=0;do{var ce=ie[te++];le+=ce}while(255==ce);for(;le--;)K[ne++]=ae;ae++}}function a(z,K,ee){var te=z.context;return K.qctx=(K.qctx<<z.qshift)+z.qtab[ee],te+=(K.qctx&(1<<z.qbits)-1)<<z.qloc,z.do_pos&&(te+=z.ptab[Math.min(K.p,1023)]<<z.ploc),z.do_delta&&(te+=z.dtab[Math.min(K.delta,255)]<<z.dloc,K.delta+=K.prevq!=ee?1:0,K.prevq=ee),z.do_sel&&(te+=K.s<<z.sloc),K.p--,65535&te}function f(z){var K={};K.context=z.ReadUint16(),K.pflags=z.ReadByte(),K.do_dedup=2&K.pflags,K.fixed_len=4&K.pflags,K.do_sel=8&K.pflags,K.do_qmap=16&K.pflags,K.do_pos=32&K.pflags,K.do_delta=64&K.pflags,K.do_qtab=128&K.pflags,K.max_sym=z.ReadByte();var ee=z.ReadByte();if(K.qbits=ee>>4,K.qshift=15&ee,ee=z.ReadByte(),K.qloc=ee>>4,K.sloc=15&ee,ee=z.ReadByte(),K.ploc=ee>>4,K.dloc=15&ee,K.qmap=new Array(256),16&K.pflags)for(var te=0;te<K.max_sym;te++)K.qmap[te]=z.ReadByte();else for(te=0;te<256;te++)K.qmap[te]=te;if(K.qtab=new Array(1024),K.qbits>0&&128&K.pflags)s(z,K.qtab,256);else for(te=0;te<256;te++)K.qtab[te]=te;return K.ptab=new Array(1024),32&K.pflags&&s(z,K.ptab,1024),K.dtab=new Array(256),64&K.pflags&&s(z,K.dtab,256),K}function h(z,K,ee,te,ne,re){ee.max_sel>0?ne.s=te.sel.ModelDecode(z,K):ne.s=0,ne.x=ee.stab[ne.s];var ie=ee.params[ne.x];if(ie.fixed_len>=0){var se=te.len[0].ModelDecode(z,K);se|=te.len[1].ModelDecode(z,K)<<8,se|=te.len[2].ModelDecode(z,K)<<16,se|=te.len[3].ModelDecode(z,K)<<24,ie.fixed_len>0&&(ie.fixed_len=-se)}else se=-ie.fixed_len;ne.len=se,ee.do_rev&&(re[ne.rec]=te.rev.ModelDecode(z,K)),ne.is_dup=0,2&ie.pflags&&te.dup.ModelDecode(z,K)&&(ne.is_dup=1),ne.p=se,ne.delta=0,ne.qctx=0,ne.prevq=0,ne.rec++}function l(z,K,ee){for(var te=0,ne=0,re=new Array(2*ee),ie=0;te<ee;){for(var se=te;te<ee&&K[te]==ne;)te++;var oe=te-se;do{var ae=Math.min(255,oe);re[ie++]=ae,oe-=ae}while(255==ae);ne++}var le=-1,ce=new Array(2*ee),he=0;for(te=0;te<ie;){var ue=re[te++];if(ce[he++]=ue,ue==le){for(se=te;te<ie&&re[te]==le&&te-se<255;)te++;ce[he++]=te-se}else le=ue}z.WriteData(ce,he)}z.exports={decode:function(z,K){return function(z,K){var ee=z.ReadUint7(),te=function(z){var K={max_sym:0};if(5==z.ReadByte()){var ee=z.ReadByte(),te=1&ee?z.ReadByte():1,ne=ee.nparam>1?ee.nparam-1:0,re=new Array(256);if(2&ee)ne=z.ReadByte(),s(z,re,256);else{for(var ie=0;ie<te;ie++)re[ie]=ie;for(;ie<256;ie++)re[ie]=te-1}K.do_rev=4&ee,K.stab=re,K.max_sel=ne,K.params=new Array(K.nparam);for(var se=0;se<te;se++)K.params[se]=f(z),K.max_sym<K.params[se].max_sym&&(K.max_sym=K.params[se].max_sym);return K}console.error("Invalid FQZComp version number")}(z);if(te){var ie=te.params,se=new Array(K.length),oe=function(z){var K={};K.qual=new Array(65536);for(var ee=0;ee<65536;ee++)K.qual[ee]=new ne(z.max_sym+1);for(K.len=new Array(4),ee=0;ee<4;ee++)K.len[ee]=new ne(256);return K.rev=new ne(2),K.dup=new ne(2),z.max_sel>0&&(K.sel=new ne(z.max_sel+1)),K}(te),ae=new re(z);ae.RangeStartDecode(z);for(var le=new Buffer.allocUnsafe(ee),ce={qctx:0,prevq:0,delta:0,p:0,s:0,x:0,len:0,is_dup:0,rec:0},he=0;he<ee;){if(0==ce.p){if(h(z,ae,te,oe,ce,se),ce.is_dup>0&&oe.dup.ModelDecode(z,ae)){for(var ue=0;ue<len;ue++)le[he+ue]=le[he+ue-ce.len];he+=ce.len,ce.p=0;continue}K.push(ce.len);var de=(ie=te.params[ce.x]).context}var fe=oe.qual[de].ModelDecode(z,ae);le[he++]=ie.qmap[fe],de=a(ie,ce,fe)}return te.do_rev&&function(z,K,ee,te){for(var ne=0,re=0;re<K;){if(ee[ne])for(var ie=0,se=te[ne]-1;ie<se;){var oe=z[re+ie];z[re+ie]=z[re+se],z[re+se]=oe,ie++,se--}re+=te[ne++]}}(le,ee,se,K),le}}(new te(z),K)},encode:function(z,K,ee){for(var ie=new Array(2),se=new Array(2),oe=new Array(2),ae=new Array(2),le=new Array(256),ce=0;ce<2;ce++)ie[ce]=new Array(256),se[ce]=new Array(256),oe[ce]=new Array(1024),ae[ce]=new Array(256);(ue=new te("",0,1.1*z.length+100)).WriteUint7(z.length);var he=function(z,K,ee,te){for(var ne=ee[0],re=0;re<ee.length&&ee[re]==ne;re++);var ie=re==ee.length?1:0,se=0,oe=0;for(re=0;re<256;re++)te[0][re]=0;var ae=0,le=0;for(re=0;re<z.length;re++)0==le&&(le=K[ae<K.length-1?ae++:ae]),te[0][z[re]]++,le--;for(re=0;re<256;re++)te[0][re]&&(oe<re&&(oe=re),se++);var ce=5,he=0;return se<=16&&(he=1,ce=se<=2?1:se<=4?2:se<=8?3:4),[{qbits:8+(ce>4),qshift:ce,qloc:7,pbits:7,pshift:K[0]>128?1:0,ploc:0,dbits:ce>4?0:1,dshift:3,dloc:15,sbits:0,sloc:15,do_stab:0,context:0,max_sym:oe,nsym:se,do_qmap:he,do_dedup:0,fixed_len:1==K.length?1:0,do_sel:0,do_rev:0,do_pos:1,do_delta:ce<=4?1:0,do_qtab:0,qbits:8+(ce>4)-(0==ie),sbits:1,sloc:15-(ce<=4),do_stab:1,do_sel:1}]}(z,K,ee,ie),ue=function(z,K,ee,te,ne,re,ie){for(var se=[0,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],oe=0;oe<K.length;oe++)ie[oe]=oe;for(;oe<256;oe++)ie[oe]=K.length-1;z.WriteByte(5);var ae=(K.length>1?1:0)|(K[0].do_stab?2:0);if(z.WriteByte(ae),1&ae&&z.WriteByte(K.length),2&ae){var le=1<<K[0].sbits;le>0&&le--,z.WriteByte(le),l(z,ie,256)}for(var ce=0;ce<K.length;ce++){if(z.WriteUint16(K[ce].context),z.WriteByte((K[ce].do_qtab?128:0)|(K[ce].do_delta?64:0)|(K[ce].do_pos?32:0)|(K[ce].do_qmap?16:0)|(K[ce].do_sel?8:0)|(K[ce].fixed_len?4:0)|(K[ce].do_dedup?2:0)),K[ce].do_qmap?z.WriteByte(K[ce].nsym):z.WriteByte(K[ce].max_sym),z.WriteByte(K[ce].qbits<<4|K[ce].qshift),z.WriteByte(K[ce].qloc<<4|K[ce].sloc),z.WriteByte(K[ce].ploc<<4|K[ce].dloc),K[ce].do_qmap){K[ce].max_sym=K[ce].nsym;var he=0;for(oe=0;oe<256;oe++)ee[ce][oe]&&(z.WriteByte(oe),ee[ce][oe]=he++);for(;he<K[ce].nsym;he++)z.WriteByte(0)}else for(oe=0;oe<256;oe++)ee[ce][oe]=oe;if(K[ce].qbits>0){for(oe=0;oe<256;oe++)te[ce][oe]=oe;K[ce].do_qtab&&l(z,te[ce],256)}if(K[ce].pbits>0){for(oe=0;oe<1024;oe++)ne[ce][oe]=Math.min((1<<K[ce].pbits)-1,oe>>K[ce].pshift);l(z,ne[ce],1024)}if(K[ce].dbits>0){for(oe=0;oe<256;oe++)se[oe]>(1<<K[ce].dbits)-1&&(se[oe]=(1<<K[ce].dbits)-1);for(oe=0;oe<256;oe++)re[ce][oe]=se[Math.min(se.length-1,oe>>K[ce].dshift)];l(z,re[ce],256)}}return z}(ue,he,ie,se,oe,ae,le);return function(z,K,ee,te,ie,se,oe,ae,le,ce){var he=1<<ie[0].sbits;he>0&&he--;for(var ue=K.length,de=0,fe=0;fe<ie.length;fe++)de<ie[fe].max_sym&&(de=ie[fe].max_sym);for(var pe=new Array(65536),ge=0;ge<65536;ge++)pe[ge]=new ne(de+1);var me=new Array(4);for(ge=0;ge<4;ge++)me[ge]=new ne(256);new ne(2),new ne(2);for(var be=new ne(he+1),ve=new re(K),we=(fe=0,ge=0,0);ge<ue;){if(0==fe){var ye=te[we];ie[0].sbits>0&&be.ModelEncode(z,ve,ye);var _e=ce[ye],ke=ee[Math.min(ee.length-1,we++)];ie[_e].fixed_len?ie[_e].fixed_len>0&&(me[0].ModelEncode(z,ve,255&ke),me[1].ModelEncode(z,ve,ke>>8&255),me[2].ModelEncode(z,ve,ke>>16&255),me[3].ModelEncode(z,ve,ke>>24&255),ie[_e].fixed_len=-1):(me[0].ModelEncode(z,ve,255&ke),me[1].ModelEncode(z,ve,ke>>8&255),me[2].ModelEncode(z,ve,ke>>16&255),me[3].ModelEncode(z,ve,ke>>24&255)),ie[_e].do_dedup&&process.exit(1),fe=ke;var xe=0,Ce=ie[_e].context,Se=0,Ae=0}var Te=K[ge++],Ee=se[_e][Te];pe[Ce].ModelEncode(z,ve,Ee),Se=(Se<<ie[_e].qshift)+oe[_e][Ee],Ce=ie[_e].context,Ce+=(Se&(1<<ie[_e].qbits)-1)<<ie[_e].qloc,ie[_e].pbits>0&&(Ce+=ae[_e][Math.min(fe,1023)]<<ie[_e].ploc),ie[_e].dbits>0&&(Ce+=le[_e][Math.min(xe,255)]<<ie[_e].dloc,xe+=Ae!=Ee?1:0,Ae=Ee),ie[_e].do_sel&&(Ce+=ye<<ie[_e].sloc),Ce&=65535,fe--}return ve.RangeFinishEncode(z),z.buf.slice(0,z.pos)}(ue,z,K,ee,he,ie,se,oe,ae,le)}}},3498:(z,K,ee)=>{var te=ee(4459),ne=ee(594),re=ee(445),ie=ee(5260),se=ee(2881);z.exports={r4x8_uncompress:function(z,K){te.decode(z).copy(K,0,0)},r4x16_uncompress:function(z,K){ne.decode(z).copy(K,0,0)},arith_uncompress:function(z,K){re.decode(z).copy(K,0,0)},fqzcomp_uncompress:function(z,K){var ee=new Array;ie.decode(z,ee).copy(K,0,0)},tok3_uncompress:function(z,K){var ee=se.decode(z,0,"\0");Buffer.from(ee,"binary").copy(K,0,0)}}},9260:z=>{z.exports=class{constructor(z,K=0,ee=0){0!=ee?(this.buf=Buffer.allocUnsafe(ee),this.length=ee):(this.buf=z,this.length=z.length),this.pos=K}EOF(){return this.pos>=this.length}ReadData(z){var K=this.buf.slice(this.pos,this.pos+z);return this.pos+=z,K}ReadByte(){const z=this.buf[this.pos];return this.pos++,z}ReadChar(){const z=this.buf[this.pos];return this.pos++,String.fromCharCode(z)}ReadUint16(){return this.ReadByte()|this.ReadByte()<<8}ReadUint32(){const z=this.buf.readInt32LE(this.pos);return this.pos+=4,z}ReadString(){var z="";do{var K=this.buf[this.pos++];K&&(z+=String.fromCharCode(K))}while(K);return z}ReadUint7(){var z=0;do{var K=this.ReadByte();z=z<<7|127&K}while(128&K);return z}ReadITF8(){var z=this.buf[this.pos];return this.pos++,z>=240?(z=(15&z)<<28,z+=(this.buf[this.pos+0]<<20)+(this.buf[this.pos+1]<<12)+(this.buf[this.pos+2]<<4)+(this.buf[this.pos+3]>>4),this.pos+=4):z>=224?(z=(15&z)<<24,z+=(this.buf[this.pos+0]<<16)+(this.buf[this.pos+1]<<8)+(this.buf[this.pos+2]<<0),this.pos+=3):z>=192?(z=(31&z)<<16,z+=(this.buf[this.pos+0]<<8)+(this.buf[this.pos+1]<<0),this.pos+=2):z>=128&&(z=(63&z)<<8,z+=this.buf[this.pos],this.pos++),z}WriteByte(z){this.buf[this.pos++]=z}WriteChar(z){this.buf[this.pos++]=z.charCodeAt(0)}WriteString(z){for(var K=0;K<z.length;K++)this.buf[this.pos++]=z.charCodeAt(K);this.buf[this.pos++]=0}WriteData(z,K){for(var ee=0;ee<K;ee++)this.buf[this.pos++]=z[ee]}WriteStream(z){this.WriteData(z.buf,z.pos)}WriteUint16(z){this.WriteByte(255&z),this.WriteByte(z>>8&255)}WriteUint32(z){this.buf.writeInt32LE(z,this.pos),this.pos+=4}WriteUint7(z){var K=0,ee=z;do{K+=7,ee>>=7}while(ee>0);do{K-=7,this.WriteByte((z>>K&127)+((K>0)<<7))}while(K>0)}WriteITF8(z){z<0&&(z=1+z),z<=127?this.buf[this.pos++]=z:z<=16383?(this.buf[this.pos++]=128|Math.floor(z/256),this.buf[this.pos++]=255&z):z<131071?(this.buf[this.pos++]=192|Math.floor(z/65536),this.buf[this.pos++]=255&Math.floor(z/256),this.buf[this.pos++]=255&z):z<268435455?(this.buf[this.pos++]=224|Math.floor(z/16777216),this.buf[this.pos++]=255&Math.floor(z/65536),this.buf[this.pos++]=255&Math.floor(z/256),this.buf[this.pos++]=255&z):(this.buf[this.pos++]=240|Math.floor(z/268435456),this.buf[this.pos++]=255&Math.floor(z/1048576),this.buf[this.pos++]=255&Math.floor(z/4096),this.buf[this.pos++]=255&Math.floor(z/4),this.buf[this.pos++]=15&z)}WriteByteNeg(z){this.buf[--this.pos]=z}}},4459:(z,K,ee)=>{const te=ee(9260);function i(z){return 4095&z}function o(z,K){for(var ee=0;K>=z[ee+1];)ee++;return ee}function s(z){for(var K=new Array(4096),ee=0,te=0;te<4096;te++){for(;te>=z[ee+1];)ee++;K[te]=ee}return K}function a(z,K,ee){return ee*(z>>12)+(4095&z)-K}function f(z,K){for(;K<1<<23;)K=(K<<8)+z.ReadByte();return K}function h(z,K){K.WriteByteNeg(z>>24&255),K.WriteByteNeg(z>>16&255),K.WriteByteNeg(z>>8&255),K.WriteByteNeg(z>>0&255)}function l(z,K,ee,te,ne){return z=function(z,K,ee,te){for(var ne=(1<<23>>te<<8)*ee;z>=ne;)K.WriteByteNeg(255&z),z>>=8;return z}(z,K,te,ne),(Math.floor(z/te)<<ne)+z%te+ee}function u(z,K,ee){for(var te=0;te<256;te++)K[te]=0;var ne=z.ReadByte(),re=ne,ie=0;do{var se=z.ReadITF8();K[ne]=se,ie>0?(ie--,ne++):(ne=z.ReadByte())==re+1&&(ie=z.ReadByte()),re=ne}while(0!=ne);for(ee[0]=0,te=0;te<=255;te++)ee[te+1]=ee[te]+K[te]}function c(z){for(var K=0,ee=0;ee<256;ee++)K+=z[ee];const te=4096;var ne=te/K;do{var re=0,ie=0,se=0;for(K=0,ee=0;ee<256;ee++)0!=z[ee]&&(re<z[ee]&&(re=z[ee],ie=ee),z[ee]=Math.floor(z[ee]*ne),0==z[ee]&&(z[ee]=1),K+=z[ee]);K<te?z[ie]+=te-K:K-te<z[ie]/2&&z[ie]>2?z[ie]-=K-te:K!=te&&(ne*=.99,se=1)}while(se)}function d(z,K){for(var ee=0,te=0;te<256;te++)if(K[te]){if(ee>0)ee--;else if(z.WriteByte(te),te>0&&K[te-1]>0){for(ee=te+1;ee<256&&K[ee];ee++);ee-=te+1,z.WriteByte(ee)}z.WriteITF8(K[te])}z.WriteByte(0)}z.exports={decode:function(z){var K=new te(z),ee=K.ReadByte(),ne=(K.ReadUint32(),K.ReadUint32());return 0==ee?function(z,K){var ee=new Array(256),te=new Array(256);u(z,ee,te);for(var ne=s(te),re=new Array(4),ie=0;ie<4;ie++)re[ie]=z.ReadUint32();var se=new Buffer.allocUnsafe(K);for(ie=0;ie<K;ie++){var oe=ie%4,ae=ne[i(re[oe])];se[ie]=ae,re[oe]=a(re[oe],te[ae],ee[ae]),re[oe]=f(z,re[oe])}return se}(K,ne):function(z,K){var ee=new Array(256),te=new Array(256);!function(z,K,ee){for(var te=0;te<256;te++){K[te]=new Array(256),ee[te]=new Array(256);for(var ne=0;ne<256;ne++)K[te][ne]=0}var re=z.ReadByte(),ie=re,se=0;do{u(z,K[re],ee[re]),se>0?(se--,re++):(re=z.ReadByte())==ie+1&&(se=z.ReadByte()),ie=re}while(0!=re)}(z,ee,te);for(var ne=new Array(256),re=0;re<256;re++)ne[re]=s(te[re]);for(var ie=new Array(4),se=new Array(4),oe=0;oe<4;oe++)ie[oe]=z.ReadUint32(),se[oe]=0;var ae=new Buffer.allocUnsafe(K),le=Math.floor(K/4);for(re=0;re<le;re++)for(oe=0;oe<4;oe++){var ce=i(ie[oe]),he=ne[se[oe]][ce];ae[re+oe*le]=he,ie[oe]=a(ie[oe],te[se[oe]][he],ee[se[oe]][he]),ie[oe]=f(z,ie[oe]),se[oe]=he}for(re*=4;re<K;)ce=i(ie[3]),he=o(te[se[3]],ce),ae[re++]=he,ie[3]=a(ie[3],te[se[3]][he],ee[se[3]][he]),ie[3]=f(z,ie[3]),se[3]=he;return ae}(K,ne)},encode:function(z,K){return 0==K?function(z){const K=z.length;var ee=new te("",0,780);ee.WriteByte(0),ee.WriteUint32(0),ee.WriteUint32(0);var ne=new Array(256);(function(z,K){for(var ee=0;ee<256;ee++)K[ee]=0;for(ee=0;ee<z.length;ee++)K[z[ee]]++})(z,ne),c(ne),d(ee,ne);var re=new Array(256);re[0]=0;for(var ie=1;ie<256;ie++)re[ie]=re[ie-1]+ne[ie-1];var se=new Array(4);for(ie=0;ie<4;ie++)se[ie]=1<<23;var oe=Math.floor(1.05*K+100),ae=new te("",oe,oe);for(ie=K-1;ie>=0;ie--)se[ie%4]=l(se[ie%4],ae,re[z[ie]],ne[z[ie]],12);for(ie=3;ie>=0;ie--)h(se[ie],ae);var le=ee.pos;return ee.buf.writeInt32LE(le-9+(ae.length-ae.pos),1),ee.buf.writeInt32LE(K,5),Buffer.concat([ee.buf.slice(0,ee.pos),ae.buf.slice(ae.pos,ae.length)],ee.pos+ae.length-ae.pos)}(z):function(z){const K=z.length;var ee=new te("",0,198156);ee.WriteByte(1),ee.WriteUint32(0),ee.WriteUint32(0);for(var ne=new Array(256),re=new Array(256),ie=new Array(256),se=0;se<256;se++)re[se]=new Array(256),ie[se]=new Array(256);for(function(z,K,ee){for(var te=0;te<256;te++){ee[te]=0;for(var ne=0;ne<256;ne++)K[te][ne]=0}var re=0;for(te=0;te<z.length;te++)ee[z[te]]++,K[re][z[te]]++,re=z[te];K[0][z[1*(z.length>>2)]]++,K[0][z[2*(z.length>>2)]]++,K[0][z[3*(z.length>>2)]]++,ee[0]+=3}(z,re,ne),function(z,K){for(var ee=0;ee<256;ee++)K[ee]&&c(z[ee])}(re,ne),function(z,K,ee){for(var te=0,ne=0;ne<256;ne++)if(ee[ne]){if(te>0)te--;else if(z.WriteByte(ne),ne>0&&ee[ne-1]>0){for(te=ne+1;te<256&&ee[te];te++);te-=ne+1,z.WriteByte(te)}d(z,K[ne])}z.WriteByte(0)}(ee,re,ne),se=0;se<256;se++)if(ne[se]){ie[se][0]=0;for(var oe=1;oe<256;oe++)ie[se][oe]=ie[se][oe-1]+re[se][oe-1]}var ae=new Array(4),le=new Array(4);for(oe=0;oe<4;oe++)ae[oe]=1<<23,le[oe]=0;var ce=new te("",K,K),he=Math.floor(K/4),ue=new Array(4),de=new Array(4);for(oe=0;oe<4;oe++)ue[oe]=(oe+1)*he-2,de[oe]=z[ue[oe]+1];for(de[3]=z[K-1],se=K-2;se>4*he-2;se--)ae[3]=l(ae[3],ce,ie[z[se]][de[3]],re[z[se]][de[3]],12),de[3]=z[se];for(;ue[0]>=0;)for(oe=3;oe>=0;oe--){var fe=z[ue[oe]];ae[oe]=l(ae[oe],ce,ie[fe][de[oe]],re[fe][de[oe]],12),de[oe]=fe,ue[oe]--}for(oe=3;oe>=0;oe--)ae[oe]=l(ae[oe],ce,ie[0][de[oe]],re[0][de[oe]],12);for(se=3;se>=0;se--)h(ae[se],ce);var pe=ee.pos;return ee.buf.writeInt32LE(pe-9+(ce.length-ce.pos),1),ee.buf.writeInt32LE(K,5),Buffer.concat([ee.buf.slice(0,ee.pos),ce.buf.slice(ce.pos,ce.length)],ee.pos+ce.length-ce.pos)}(z)}}},594:(z,K,ee)=>{const te=ee(9260);function i(z,K){return z&(1<<K)-1}function o(z,K){for(var ee=0;K>=z[ee+1];)ee++;return ee}function s(z,K){for(var ee=1<<K,te=new Array(ee),ne=0,re=0;re<ee;re++){for(;re>=z[ne+1];)ne++;te[re]=ne}return te}function a(z,K,ee,te){return ee*(z>>te)+(z&(1<<te)-1)-K}function f(z,K){return K<32768&&(K=(K<<16)+z.ReadUint16()),K}function h(z,K){K.WriteByteNeg(z>>24&255),K.WriteByteNeg(z>>16&255),K.WriteByteNeg(z>>8&255),K.WriteByteNeg(z>>0&255)}function l(z,K,ee,te,ne){return z=function(z,K,ee,te){for(var ne=(1<<31-te)*ee;z>=ne;)K.WriteByteNeg(z>>8&255),K.WriteByteNeg(255&z),z>>=16;return z}(z,K,te,ne),(Math.floor(z/te)<<ne)+z%te+ee}function u(z,K,ee){0==ee&&(ee=4);for(var ne=new Array(ee),re=new Array(ee),ie=0;ie<ee;ie++)re[ie]=Math.floor(K.length/ee)+(K.length%ee>ie),ne[ie]=new Array(re[ie]);for(var se=0,oe=0;oe<K.length;oe+=ee,se++)for(var ae=0;ae<ee;ae++)se<ne[ae].length&&(ne[ae][se]=K[oe+ae]);var le=new Array(ee),ce=0;for(ie=0;ie<ee;ie++){var he=d(ne[ie],0),ue=d(ne[ie],1);le[ie]=ue.length<he.length?ue:he,ce+=le[ie].length}var de=new te("",0,ce+5*ee+1);for(de.WriteByte(ee),ie=0;ie<ee;ie++)de.WriteUint7(le[ie].length);for(ie=0;ie<ee;ie++)de.WriteData(le[ie],le[ie].length);return de.buf.slice(0,de.buf.pos)}function c(z,K){var ee=z.ReadByte(),ne=1&ee,re=8&ee,ie=32&ee,se=64&ee,oe=128&ee;if(16&ee||(K=z.ReadUint7()),re)return function(z,K){for(var ee=z.ReadByte(),te=new Array(ee),ne=new Array(ee),re=0;re<ee;re++)te[re]=z.ReadUint7();var ie=new Array(ee);for(re=0;re<ee;re++)ne[re]=Math.floor(K/ee)+(K%ee>re),ie[re]=c(z,ne[re]);var se=new Buffer.allocUnsafe(K);for(re=0;re<ee;re++)for(var oe=0;oe<ne[re];oe++)se[oe*ee+re]=ie[re][oe];return se}(z,K);if(oe)var ae=K,[le,ce,K]=function(z){for(var K=z.ReadByte(),ee=new Array(K),te=0;te<K;te++)ee[te]=z.ReadByte();return[ee,K,z.ReadUint7()]}(z);if(se)var he=K,[ue,de,K]=function(z){var K=z.ReadUint7(),ee=z.ReadUint7();if(1&K)var ne=z.ReadData((K-1)/2);else{var re=z.ReadUint7();ne=z.ReadData(re),ne=g(new te(ne),K/2)}ne=new te(ne);var ie=new Array(256),se=ne.ReadByte();0==se&&(se=256);for(var oe=0;oe<se;oe++)ie[ne.ReadByte()]=1;return[ie,ne,ee]}(z);if(ie)var fe=z.ReadData(K);else fe=0==ne?g(z,K):function(z,K){var ee=(se=z.ReadByte())>>4,ne=z;if(1&se){var re=z.ReadUint7(),ie=z.ReadUint7(),se=new te(z.ReadData(ie));ne=new te(g(se,re))}var oe=new Array(256),ae=new Array(256);!function(z,K,ee,te){for(var ne=0;ne<256;ne++){K[ne]=new Array(256),ee[ne]=new Array(256);for(var re=0;re<256;re++)K[ne][re]=0}var ie=p(z);for(ne=0;ne<256;ne++)if(ie[ne]){var se=0;for(re=0;re<256;re++)ie[re]&&(se>0?se--:(K[ne][re]=z.ReadUint7(),0==K[ne][re]&&(se=z.ReadByte())));for(y(K[ne],te),ee[ne][0]=0,re=0;re<256;re++)ee[ne][re+1]=ee[ne][re]+K[ne][re]}}(ne,oe,ae,ee);for(var le=new Array(256),ce=0;ce<256;ce++)le[ce]=s(ae[ce],ee);for(var he=new Array(4),ue=new Array(4),de=0;de<4;de++)he[de]=z.ReadUint32(),ue[de]=0;var fe=new Buffer.allocUnsafe(K),pe=Math.floor(K/4);for(ce=0;ce<pe;ce++)for(de=0;de<4;de++){var ge=i(he[de],ee),me=le[ue[de]][ge];fe[ce+de*pe]=me,he[de]=a(he[de],ae[ue[de]][me],oe[ue[de]][me],ee),he[de]=f(z,he[de]),ue[de]=me}for(ce*=4;ce<K;)ge=i(he[3],ee),me=o(ae[ue[3]],ge),fe[ce++]=me,he[3]=a(he[3],ae[ue[3]][me],oe[ue[3]][me],ee),he[3]=f(z,he[3]),ue[3]=me;return fe}(z,K);return se&&(fe=function(z,K,ee,ne){new te(z);for(var re=new Buffer.allocUnsafe(ne),ie=0,se=0;ie<ne;se++){var oe=z[se];if(K[oe])for(var ae=ee.ReadUint7(),le=0;le<=ae;le++)re[ie++]=oe;else re[ie++]=oe}return re}(fe,ue,de,he)),oe&&(fe=function(z,K,ee,te){var ne=new Buffer.allocUnsafe(te),re=0;if(ee<=1)for(var ie=0;ie<te;ie++)ne[ie]=K[0];else if(ee<=2)for(ie=0;ie<te;ie++){if(ie%8==0)var se=z[re++];ne[ie]=K[1&se],se>>=1}else if(ee<=4)for(ie=0;ie<te;ie++)ie%4==0&&(se=z[re++]),ne[ie]=K[3&se],se>>=2;else if(ee<=16)for(ie=0;ie<te;ie++)ie%2==0&&(se=z[re++]),ne[ie]=K[15&se],se>>=4;return ne}(fe,le,ce,ae)),fe}function d(z,K){var ee=new te("",0,10);ee.WriteByte(K);var ne=1&K,re=8&K,ie=32&K,se=64&K,oe=128&K,ae=K>>8;if(16&K||ee.WriteUint7(z.length),re)return Buffer.concat([ee.buf.slice(0,ee.pos),u(0,z,ae)]);var le=new Buffer.alloc(0);oe&&([le,z]=function(z){for(var K=new Array(256),ee=0;ee<256;ee++)K[ee]=0;for(ee=0;ee<z.length;ee++)K[z[ee]]++;var ne=new Array(256),re=0;for(ee=0;ee<256;ee++)K[ee]>0&&(ne[ee]=re++);if(!(re>16)){if(re<=1)var ie=new Buffer.allocUnsafe(0);else if(re<=2){ie=new Buffer.allocUnsafe(Math.ceil(z.length/8));var se=-1;for(ee=0;ee<z.length;ee++)ee%8==0&&(ie[++se]=0),ie[se]+=ne[z[ee]]<<ee%8}else if(re<=4)for(ie=new Buffer.allocUnsafe(Math.ceil(z.length/4)),se=-1,ee=0;ee<z.length;ee++)ee%4==0&&(ie[++se]=0),ie[se]+=ne[z[ee]]<<ee%4*2;else for(ie=new Buffer.allocUnsafe(Math.ceil(z.length/2)),se=-1,ee=0;ee<z.length;ee++)ee%2==0&&(ie[++se]=0),ie[se]+=ne[z[ee]]<<ee%2*4;var oe=new te("",0,re+5);for(oe.WriteByte(re),se=0,ee=0;ee<256;ee++)K[ee]>0&&(K[ee]=se++,oe.WriteByte(ee));return oe.WriteUint7(ie.length),[oe.buf.slice(0,oe.pos),ie]}}(z));var ce=new Buffer.alloc(0);if(se&&([ce,z]=function(z){for(var K=new Array(256),ee=0;ee<256;ee++)K[ee]=0;var ne=-1;for(ee=0;ee<z.length;ee++)K[z[ee]]+=z[ee]==ne?1:-1,ne=z[ee];var re=0;for(ee=0;ee<256;ee++)K[ee]>0&&re++;for(re||(re=1,K[0]=1),(ae=new te("",0,re+1+z.length)).WriteByte(re),ee=0;ee<256;ee++)K[ee]>0&&ae.WriteByte(ee);var ie=new Buffer.allocUnsafe(z.length),se=0;for(ee=0;ee<z.length;ee++)if(ie[se++]=z[ee],K[z[ee]]>0){ne=z[ee];for(var oe=0;ee+oe+1<z.length&&z[ee+oe+1]==ne;)oe++;ae.WriteUint7(oe),ee+=oe}var ae,le=v(ae.buf.slice(0,ae.pos)),ce=new te("",0,16);return ce.WriteUint7(2*ae.pos),ce.WriteUint7(se),ce.WriteUint7(le.length),[ae=Buffer.concat([ce.buf.slice(0,ce.pos),le]),ie.slice(0,se)]}(z)),z.length<4&&1==ne&&(ne=0,ee.buf[0]&=-2),ie)var he=z;else he=0==ne?v(z):function(z){const K=z.length;for(var ee=new te("",0,198156),ne=new Array(256),re=new Array(256),ie=new Array(256),se=0;se<256;se++)re[se]=new Array(256),ie[se]=new Array(256);var oe=12;(function(z,K,ee){for(var te=0;te<256;te++){ee[te]=0;for(var ne=0;ne<256;ne++)K[te][ne]=0}var re=0;for(te=0;te<z.length;te++)ee[re]++,K[re][z[te]]++,re=z[te];ee[re]++,K[0][z[1*(z.length>>2)]]++,K[0][z[2*(z.length>>2)]]++,K[0][z[3*(z.length>>2)]]++,ee[0]+=3})(z,re,ne),function(z,K,ee){for(var te=0;te<256;te++)if(K[te]){var ne=Math.ceil(Math.log2(K[te]));ne>12&&(ne=12),m(z[te],ne)}}(re,ne);var ae=new te("",0,198156);!function(z,K,ee){b(z,ee);for(var te=0;te<256;te++)if(ee[te])for(var ne=0,re=0;re<256;re++)if(ee[re])if(ne)ne--;else if(z.WriteUint7(K[te][re]),!K[te][re]){for(var ie=re+1;ie<256;ie++)if(ee[ie]){if(0!=K[te][ie])break;ne++}z.WriteByte(ne)}}(ae,re,ne);var le=v(ae.buf.slice(0,ae.pos));for(le.length<ae.pos?(ee.WriteByte(193),ee.WriteUint7(ae.pos),ee.WriteUint7(le.length),ee.WriteData(le,le.length)):(ee.WriteByte(192),ee.WriteData(ae.buf,ae.pos)),function(z,K,ee){for(var te=0;te<256;te++)K[te]&&y(z[te],12)}(re,ne),se=0;se<256;se++)if(ne[se]){ie[se][0]=0;for(var ce=1;ce<256;ce++)ie[se][ce]=ie[se][ce-1]+re[se][ce-1]}var he=new Array(4),ue=new Array(4);for(ce=0;ce<4;ce++)he[ce]=32768,ue[ce]=0;var de=new te("",1.05*K+100>>0,1.05*K+100>>0),fe=Math.floor(K/4),pe=new Array(4),ge=new Array(4);for(ce=0;ce<4;ce++)pe[ce]=(ce+1)*fe-2,ge[ce]=z[pe[ce]+1];for(ge[3]=z[K-1],se=K-2;se>4*fe-2;se--)he[3]=l(he[3],de,ie[z[se]][ge[3]],re[z[se]][ge[3]],oe),ge[3]=z[se];for(;pe[0]>=0;)for(ce=3;ce>=0;ce--){var me=z[pe[ce]];he[ce]=l(he[ce],de,ie[me][ge[ce]],re[me][ge[ce]],oe),ge[ce]=me,pe[ce]--}for(ce=3;ce>=0;ce--)he[ce]=l(he[ce],de,ie[0][ge[ce]],re[0][ge[ce]],oe);for(se=3;se>=0;se--)h(he[se],de);return Buffer.concat([ee.buf.slice(0,ee.pos),de.buf.slice(de.pos,de.length)],ee.pos+de.length-de.pos)}(z);return Buffer.concat([ee.buf.slice(0,ee.pos),le,ce,he])}function p(z){for(var K=new Array(256),ee=0;ee<256;ee++)K[ee]=0;var te=0,ne=z.ReadByte(),re=ne;do{K[ne]=1,te>0?(te--,ne++):(ne=z.ReadByte())==re+1&&(te=z.ReadByte()),re=ne}while(0!=ne);return K}function g(z,K){var ee=new Array(256),te=new Array(256);!function(z,K,ee){for(var te=0;te<256;te++)K[te]=0;var ne=p(z);for(te=0;te<256;te++)ne[te]>0&&(K[te]=z.ReadUint7());for(y(K,12),ee[0]=0,te=0;te<=255;te++)ee[te+1]=ee[te]+K[te]}(z,ee,te);for(var ne=s(te,12),re=new Array(4),ie=0;ie<4;ie++)re[ie]=z.ReadUint32();var se=new Buffer.allocUnsafe(K);for(ie=0;ie<K;ie++){var oe=ie%4,ae=ne[i(re[oe],12)];se[ie]=ae,re[oe]=a(re[oe],te[ae],ee[ae],12),re[oe]=f(z,re[oe])}return se}function m(z,K){for(var ee=0,te=0;te<256;te++)ee+=z[te];const ne=1<<K;var re=ne/ee;do{var ie=0,se=0,oe=0;for(ee=0,te=0;te<256;te++)0!=z[te]&&(ie<z[te]&&(ie=z[te],se=te),z[te]=Math.floor(z[te]*re),0==z[te]&&(z[te]=1),ee+=z[te]);ee<ne?z[se]+=ne-ee:ee-ne<z[se]/2&&z[se]>2?z[se]-=ee-ne:ee!=ne&&(re=ne/ee,oe=1)}while(oe)}function y(z,K){for(var ee=0,te=0;te<256;te++)ee+=z[te];if(0!=ee&&ee!=1<<K){for(var ne=0;ee<1<<K;)ee*=2,ne++;for(te=0;te<256;te++)z[te]<<=ne}}function b(z,K){for(var ee=0,te=0;te<256;te++)if(K[te])if(ee>0)ee--;else if(z.WriteByte(te),te>0&&K[te-1]>0){for(ee=te+1;ee<256&&K[ee];ee++);ee-=te+1,z.WriteByte(ee)}z.WriteByte(0)}function v(z){const K=z.length;var ee=new te("",0,780),ne=new Array(256);!function(z,K){for(var ee=0;ee<256;ee++)K[ee]=0;for(ee=0;ee<z.length;ee++)K[z[ee]]++}(z,ne);var re=Math.ceil(Math.log2(K));re>12&&(re=12),m(ne,re),function(z,K){b(z,K);for(var ee=0;ee<256;ee++)K[ee]&&z.WriteUint7(K[ee])}(ee,ne),m(ne,12);var ie=new Array(256);ie[0]=0;for(var se=1;se<256;se++)ie[se]=ie[se-1]+ne[se-1];var oe=new Array(4);for(se=0;se<4;se++)oe[se]=32768;var ae=new te("",1.05*K+100>>0,1.05*K+100>>0);for(se=K-1;se>=0;se--)oe[se%4]=l(oe[se%4],ae,ie[z[se]],ne[z[se]],12);for(se=3;se>=0;se--)h(oe[se],ae);return Buffer.concat([ee.buf.slice(0,ee.pos),ae.buf.slice(ae.pos,ae.length)],ee.pos+ae.length-ae.pos)}z.exports={decode:function(z){return c(new te(z),0)},encode:d}},2881:(z,K,ee)=>{const te=ee(9260),ne=ee(594);var re=new(ee(445));function s(z,K){for(var ee=z+"";ee.length<K;)ee="0"+ee;return ee}function a(z,K,ee,te){var ne=z[0][0].ReadByte(),re=te-z[0][ne].ReadUint32();if(5==ne)return K[te]=K[re],ee[te]=ee[re],K[te];var ie=1;K[te]="",ee[te]=new Array(256);do{switch(ne=z[ie][0].ReadByte()){case 2:ee[te][ie]=z[ie][2].ReadChar();break;case 1:ee[te][ie]=z[ie][1].ReadString();break;case 7:ee[te][ie]=z[ie][7].ReadUint32();break;case 3:var se=z[ie][3].ReadUint32(),oe=z[ie][4].ReadByte();ee[te][ie]=s(se,oe);break;case 8:ee[te][ie]=(ee[re][ie]>>0)+z[ie][8].ReadByte();break;case 9:se=(ee[re][ie]>>0)+z[ie][9].ReadByte(),oe=ee[re][ie].length,ee[te][ie]=s(se,oe);break;case 10:ee[te][ie]=ee[re][ie];break;default:ee[te][ie]=""}K[te]+=ee[te][ie++]}while(12!=ne);return K[te]}function f(z,K,ee,te,ne,re){for(var ie=0;ie<te.length;ie++)if(!(ee>0&&5==K[ie][0].type)&&K[ie][ee])switch(z[0].WriteByte(K[ie][ee].type),K[ie][ee].type){case 6:z[6].WriteUint32(K[ie][ee].val);break;case 5:z[5].WriteUint32(K[ie][ee].val);break;case 1:z[1].WriteString(K[ie][ee].val);break;case 2:z[2].WriteChar(K[ie][ee].val);break;case 7:z[7].WriteUint32(K[ie][ee].val);break;case 3:z[3].WriteUint32(K[ie][ee].val),z[4].WriteByte(K[ie][ee].val.length);break;case 8:case 9:z[K[ie][ee].type].WriteByte(K[ie][ee].val)}}function h(z,K,ee,te){for(var ne=0;ne<=12;ne++)if(!(z[ne].pos<=0)){te.WriteByte(ne+(0==ne?128:0)),z[ne]=z[ne].buf.slice(0,z[ne].pos);var re=l(z[ne],ee);te.WriteUint7(re.length),te.WriteData(re,re.length)}}function l(z,K){var ee,te=1<<30,ie=[0,1,64,65,128,129,201];for(var se in ie){var oe=ie[se];if(!(1&oe&&z.length<100||8&oe&&z.length%4!=0)){try{var ae=K?re.encode(z,oe):ne.encode(z,oe)}catch(z){ae=0}ae&&te>ae.length&&(te=ae.length,ee=ae)}}return ee}function u(z,K,ee,te,ne){var re=0,ie=ne-1;z[ne]=new Array(256),K[te]?z[ne][0]={type:5,val:ne-K[te]}:z[ne][0]={type:6,val:0==ne?0:1},K[te]=ne;for(var se=te.match(/([a-zA-Z0-9]{1,9})|([^a-zA-Z0-9]+)/g),oe=0;oe<se.length;oe++){var ae=oe+1,le=1,ce=se[oe];if(se[oe].match(/^0+[0-9]*$/g)?le=3:se[oe].match(/^[0-9]+$/g)?le=7:1==se[oe].length&&(le=2),ie>=0&&z[ie][ae])if(z[ie][ae].str==se[oe])le=10,ce="";else if(7==z[ie][ae].type||8==z[ie][ae].type){var he=ce-z[ie][ae].str;ee[ae]++,he>=0&&he<256&&ee[ae]>ne/2&&(le=8,ce=he)}else 3!=z[ie][ae].type&&9!=z[ie][ae].type||z[ie][ae].str.length!=ce.length||(he=ce-z[ie][ae].str,ee[ae]++,he>=0&&he<256&&ee[ae]>ne/2&&(le=9,ce=he));z[ne][ae]={str:se[oe],val:ce,type:le},re<z[ne][ae].val.length+3&&(re=z[ne][ae].val.length+3)}return z[ne][++ae]={type:12},[ae+1,re]}z.exports={encode:function(z,K){var ee=z.toString();"\n"==ee[ee.length-1]&&(ee=ee.substring(0,ee.length-1));var ne=ee.split("\n"),re=new te("",0,2*ee.length+1e4);re.WriteUint32(ee.length),re.WriteUint32(ne.length),re.WriteByte(K);for(var ie=new Array(ne.length),se={},oe=new Array(256).fill(0),ae=0,le=0,ce=0;ce<ne.length;ce++){var[he,ue]=u(ie,se,oe,ne[ce],ce);ae<he&&(ae=he),le<ue&&(le=ue)}for(var de=0;de<ae;de++){for(var fe=new Array(13),pe=0;pe<=12;pe++)fe[pe]=new te("",0,ne.length*le);f(fe,ie,de,ne),h(fe,0,K,re)}return re.buf.slice(0,re.pos)},decode:function(z,K,ee){(z=new te(z)).ReadUint32();var ie=z.ReadUint32(),se=z.ReadByte(),oe=function(z,K,ee,ie){for(var se=-1,oe=new Array(256);!z.EOF();){var ae=z.ReadByte(),le=128&ae,ce=64&ae,he=63&ae;if(le&&(oe[++se]=new Array(13)),0!=he&&le){var ue=new Array(ie-1).fill(10);oe[se][0]=new te(Buffer.from([he].concat(ue)))}if(ce){var de=z.ReadByte(),fe=z.ReadByte();oe[se][he]=new te(oe[de][fe].buf)}else{var pe=z.ReadUint7(),ge=z.ReadData(pe);oe[se][he]=ee?re.decode(ge):ne.decode(ge),oe[se][he]=new te(oe[se][he])}}return oe}(z,0,se,ie),ae=new Array(ie),le=new Array(ie),ce="";void 0===ee&&(ee="\n");for(var he=0;he<ie;he++)ce+=a(oe,ae,le,he)+ee;return ce}}},1422:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=ee(8904),re=te(ee(9049)),ie=te(ee(450));class a{constructor({fill:z,cache:K}){if("function"!=typeof z)throw new TypeError("must pass a fill function");if("object"!=typeof K)throw new TypeError("must pass a cache object");if("function"!=typeof K.get||"function"!=typeof K.set||"function"!=typeof K.delete)throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=K,this.fillCallback=z}static isAbortException(z){return"AbortError"===z.name||"ERR_ABORTED"===z.code||"AbortError: aborted"===z.message||"Error: aborted"===z.message}evict(z,K){this.cache.get(z)===K&&this.cache.delete(z)}fill(z,K,ee,te){const ne=new re.default,se=new ie.default;se.addCallback(te);const oe={aborter:ne,promise:this.fillCallback(K,ne.signal,(z=>{se.callback(z)})),settled:!1,statusReporter:se,get aborted(){return this.aborter.signal.aborted}};oe.aborter.addSignal(ee),oe.aborter.signal.addEventListener("abort",(()=>{oe.settled||this.evict(z,oe)})),oe.promise.then((()=>{oe.settled=!0}),(()=>{oe.settled=!0,this.evict(z,oe)})).catch((z=>{throw console.error(z),z})),this.cache.set(z,oe)}static checkSinglePromise(z,K){function r(){if(K&&K.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return z.then((z=>(r(),z)),(z=>{throw r(),z}))}has(z){return this.cache.has(z)}get(z,K,ee,te){if(!ee&&K instanceof ne.AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");const re=this.cache.get(z);return re?re.aborted&&!re.settled?(this.evict(z,re),this.get(z,K,ee,te)):re.settled?re.promise:(re.aborter.addSignal(ee),re.statusReporter.addCallback(te),a.checkSinglePromise(re.promise,ee)):(this.fill(z,K,ee,te),a.checkSinglePromise(this.cache.get(z).promise,ee))}delete(z){const K=this.cache.get(z);K&&(K.settled||K.aborter.abort(),this.cache.delete(z))}clear(){const z=this.cache.keys();let K=0;for(let ee=z.next();!ee.done;ee=z.next())this.delete(ee.value),K+=1;return K}}K.default=a},9049:(z,K,ee)=>{Object.defineProperty(K,"__esModule",{value:!0});const te=ee(8904);class i{}K.default=class{constructor(){this.signals=new Set,this.abortController=new te.AbortController}addSignal(z=new i){if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(z),z.aborted?this.handleAborted(z):"function"==typeof z.addEventListener&&z.addEventListener("abort",(()=>{this.handleAborted(z)}))}handleAborted(z){this.signals.delete(z),0===this.signals.size&&this.abortController.abort()}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}}},450:(z,K)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.default=class{constructor(){this.callbacks=new Set}addCallback(z=(()=>{})){this.callbacks.add(z),z(this.currentMessage)}callback(z){this.currentMessage=z,this.callbacks.forEach((K=>{K(z)}))}}},8904:(z,K,ee)=>{Object.defineProperty(K,"__esModule",{value:!0}),K.AbortSignal=K.AbortController=void 0;const te=ee(5988);var i=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==ee.g)return ee.g;throw new Error("unable to locate global object")};let ne=void 0===i().AbortController?te.AbortController:i().AbortController;K.AbortController=ne;let re=void 0===i().AbortController?te.AbortSignal:i().AbortSignal;K.AbortSignal=re},4105:function(z,K,ee){var te=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(K,"__esModule",{value:!0});const ne=te(ee(1422));K.default=ne.default},5988:(z,K)=>{function r(z,K){if(!(z instanceof K))throw new TypeError("Cannot call a class as a function")}function n(z,K){for(var ee=0;ee<K.length;ee++){var te=K[ee];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty(z,te.key,te)}}function i(z,K,ee){return K&&n(z.prototype,K),ee&&n(z,ee),Object.defineProperty(z,"prototype",{writable:!1}),z}function o(z){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(z){return z.__proto__||Object.getPrototypeOf(z)},o(z)}function s(z,K){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(z,K){return z.__proto__=K,z},s(z,K)}function a(z){if(void 0===z)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z}function f(z,K){if(K&&("object"==typeof K||"function"==typeof K))return K;if(void 0!==K)throw new TypeError("Derived constructors may only return object or undefined");return a(z)}function h(z,K){for(;!Object.prototype.hasOwnProperty.call(z,K)&&null!==(z=o(z)););return z}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(z,K,ee){var te=h(z,K);if(te){var ne=Object.getOwnPropertyDescriptor(te,K);return ne.get?ne.get.call(arguments.length<3?z:ee):ne.value}},l.apply(this,arguments)}Object.defineProperty(K,"__esModule",{value:!0});var ee=function(){function e(){r(this,e),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return i(e,[{key:"addEventListener",value:function(z,K,ee){z in this.listeners||(this.listeners[z]=[]),this.listeners[z].push({callback:K,options:ee})}},{key:"removeEventListener",value:function(z,K){if(z in this.listeners)for(var ee=this.listeners[z],te=0,ne=ee.length;te<ne;te++)if(ee[te].callback===K)return void ee.splice(te,1)}},{key:"dispatchEvent",value:function(z){if(z.type in this.listeners){for(var K=this.listeners[z.type].slice(),ee=0,te=K.length;ee<te;ee++){var ne=K[ee];try{ne.callback.call(this,z)}catch(z){Promise.resolve().then((function(){throw z}))}ne.options&&ne.options.once&&this.removeEventListener(z.type,ne.callback)}return!z.defaultPrevented}}}]),e}(),te=function(z){!function(z,K){if("function"!=typeof K&&null!==K)throw new TypeError("Super expression must either be null or a function");z.prototype=Object.create(K&&K.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),Object.defineProperty(z,"prototype",{writable:!1}),K&&s(z,K)}(c,z);var K,te,ne=(K=c,te=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(z){return!1}}(),function(){var z,ee=o(K);if(te){var ne=o(this).constructor;z=Reflect.construct(ee,arguments,ne)}else z=ee.apply(this,arguments);return f(this,z)});function c(){var z;return r(this,c),(z=ne.call(this)).listeners||ee.call(a(z)),Object.defineProperty(a(z),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(a(z),"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(a(z),"reason",{value:void 0,writable:!0,configurable:!0}),z}return i(c,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(z){"abort"===z.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,z)),l(o(c.prototype),"dispatchEvent",this).call(this,z)}}]),c}(ee),ne=function(){function e(){r(this,e),Object.defineProperty(this,"signal",{value:new te,writable:!0,configurable:!0})}return i(e,[{key:"abort",value:function(z){var K;try{K=new Event("abort")}catch(z){"undefined"!=typeof document?document.createEvent?(K=document.createEvent("Event")).initEvent("abort",!1,!1):(K=document.createEventObject()).type="abort":K={type:"abort",bubbles:!1,cancelable:!1}}var ee=z;if(void 0===ee)if("undefined"==typeof document)(ee=new Error("This operation was aborted")).name="AbortError";else try{ee=new DOMException("signal is aborted without reason")}catch(z){(ee=new Error("This operation was aborted")).name="AbortError"}this.signal.reason=ee,this.signal.dispatchEvent(K)}},{key:"toString",value:function(){return"[object AbortController]"}}]),e}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(ne.prototype[Symbol.toStringTag]="AbortController",te.prototype[Symbol.toStringTag]="AbortSignal"),K.AbortController=ne,K.AbortSignal=te,K.abortableFetch=function(z){"function"==typeof z&&(z={fetch:z});var K=z,ee=K.fetch,te=K.Request,ne=void 0===te?ee.Request:te,re=K.AbortController,ie=K.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,se=void 0!==ie&&ie;if(!function(z){return z.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof z.Request&&!z.Request.prototype.hasOwnProperty("signal")||!z.AbortController}({fetch:ee,Request:ne,AbortController:re,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:se}))return{fetch:ee,Request:oe};var oe=ne;(oe&&!oe.prototype.hasOwnProperty("signal")||se)&&((oe=function(z,K){var ee;K&&K.signal&&(ee=K.signal,delete K.signal);var te=new ne(z,K);return ee&&Object.defineProperty(te,"signal",{writable:!1,enumerable:!1,configurable:!0,value:ee}),te}).prototype=ne.prototype);var ae=ee;return{fetch:function(z,K){var ee=oe&&oe.prototype.isPrototypeOf(z)?z.signal:K?K.signal:void 0;if(ee){var te;try{te=new DOMException("Aborted","AbortError")}catch(z){(te=new Error("Aborted")).name="AbortError"}if(ee.aborted)return Promise.reject(te);var ne=new Promise((function(z,K){ee.addEventListener("abort",(function(){return K(te)}),{once:!0})}));return K&&K.signal&&delete K.signal,Promise.race([ne,ae(z,K)])}return ae(z,K)},Request:oe}}},9742:(z,K)=>{K.byteLength=function(z){var K=f(z),ee=K[0],te=K[1];return 3*(ee+te)/4-te},K.toByteArray=function(z){var K,ee,re=f(z),ie=re[0],se=re[1],oe=new ne(function(z,K,ee){return 3*(K+ee)/4-ee}(0,ie,se)),ae=0,le=se>0?ie-4:ie;for(ee=0;ee<le;ee+=4)K=te[z.charCodeAt(ee)]<<18|te[z.charCodeAt(ee+1)]<<12|te[z.charCodeAt(ee+2)]<<6|te[z.charCodeAt(ee+3)],oe[ae++]=K>>16&255,oe[ae++]=K>>8&255,oe[ae++]=255&K;return 2===se&&(K=te[z.charCodeAt(ee)]<<2|te[z.charCodeAt(ee+1)]>>4,oe[ae++]=255&K),1===se&&(K=te[z.charCodeAt(ee)]<<10|te[z.charCodeAt(ee+1)]<<4|te[z.charCodeAt(ee+2)]>>2,oe[ae++]=K>>8&255,oe[ae++]=255&K),oe},K.fromByteArray=function(z){for(var K,te=z.length,ne=te%3,re=[],ie=16383,se=0,oe=te-ne;se<oe;se+=ie)re.push(h(z,se,se+ie>oe?oe:se+ie));return 1===ne?(K=z[te-1],re.push(ee[K>>2]+ee[K<<4&63]+"==")):2===ne&&(K=(z[te-2]<<8)+z[te-1],re.push(ee[K>>10]+ee[K>>4&63]+ee[K<<2&63]+"=")),re.join("")};for(var ee=[],te=[],ne="undefined"!=typeof Uint8Array?Uint8Array:Array,re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ie=0,se=re.length;ie<se;++ie)ee[ie]=re[ie],te[re.charCodeAt(ie)]=ie;function f(z){var K=z.length;if(K%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var ee=z.indexOf("=");return-1===ee&&(ee=K),[ee,ee===K?0:4-ee%4]}function h(z,K,te){for(var ne,re,ie=[],se=K;se<te;se+=3)ne=(z[se]<<16&16711680)+(z[se+1]<<8&65280)+(255&z[se+2]),ie.push(ee[(re=ne)>>18&63]+ee[re>>12&63]+ee[re>>6&63]+ee[63&re]);return ie.join("")}te["-".charCodeAt(0)]=62,te["_".charCodeAt(0)]=63},2779:(z,K,ee)=>{var te=ee(8764).Buffer,ne=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];function o(z){if(te.isBuffer(z))return z;var K="function"==typeof te.alloc&&"function"==typeof te.from;if("number"==typeof z)return K?te.alloc(z):new te(z);if("string"==typeof z)return K?te.from(z):new te(z);throw new Error("input must be buffer, number, or string, received "+typeof z)}function s(z){var K=o(4);return K.writeInt32BE(z,0),K}function a(z,K){z=o(z),te.isBuffer(K)&&(K=K.readUInt32BE(0));for(var ee=-1^~~K,re=0;re<z.length;re++)ee=ne[255&(ee^z[re])]^ee>>>8;return-1^ee}function f(){return s(a.apply(null,arguments))}"undefined"!=typeof Int32Array&&(ne=new Int32Array(ne)),f.signed=function(){return a.apply(null,arguments)},f.unsigned=function(){return a.apply(null,arguments)>>>0},z.exports=f},8764:(z,K,ee)=>{const te=ee(9742),ne=ee(645),re="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;K.Buffer=f,K.SlowBuffer=function(z){return+z!=z&&(z=0),f.alloc(+z)},K.INSPECT_MAX_BYTES=50;const ie=2147483647;function a(z){if(z>ie)throw new RangeError('The value "'+z+'" is invalid for option "size"');const K=new Uint8Array(z);return Object.setPrototypeOf(K,f.prototype),K}function f(z,K,ee){if("number"==typeof z){if("string"==typeof K)throw new TypeError('The "string" argument must be of type string. Received type number');return u(z)}return h(z,K,ee)}function h(z,K,ee){if("string"==typeof z)return function(z,K){if("string"==typeof K&&""!==K||(K="utf8"),!f.isEncoding(K))throw new TypeError("Unknown encoding: "+K);const ee=0|g(z,K);let te=a(ee);const ne=te.write(z,K);return ne!==ee&&(te=te.slice(0,ne)),te}(z,K);if(ArrayBuffer.isView(z))return function(z){if(Q(z,Uint8Array)){const K=new Uint8Array(z);return d(K.buffer,K.byteOffset,K.byteLength)}return c(z)}(z);if(null==z)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof z);if(Q(z,ArrayBuffer)||z&&Q(z.buffer,ArrayBuffer))return d(z,K,ee);if("undefined"!=typeof SharedArrayBuffer&&(Q(z,SharedArrayBuffer)||z&&Q(z.buffer,SharedArrayBuffer)))return d(z,K,ee);if("number"==typeof z)throw new TypeError('The "value" argument must not be of type number. Received type number');const te=z.valueOf&&z.valueOf();if(null!=te&&te!==z)return f.from(te,K,ee);const ne=function(z){if(f.isBuffer(z)){const K=0|p(z.length),ee=a(K);return 0===ee.length||z.copy(ee,0,0,K),ee}return void 0!==z.length?"number"!=typeof z.length||Y(z.length)?a(0):c(z):"Buffer"===z.type&&Array.isArray(z.data)?c(z.data):void 0}(z);if(ne)return ne;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof z[Symbol.toPrimitive])return f.from(z[Symbol.toPrimitive]("string"),K,ee);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof z)}function l(z){if("number"!=typeof z)throw new TypeError('"size" argument must be of type number');if(z<0)throw new RangeError('The value "'+z+'" is invalid for option "size"')}function u(z){return l(z),a(z<0?0:0|p(z))}function c(z){const K=z.length<0?0:0|p(z.length),ee=a(K);for(let te=0;te<K;te+=1)ee[te]=255&z[te];return ee}function d(z,K,ee){if(K<0||z.byteLength<K)throw new RangeError('"offset" is outside of buffer bounds');if(z.byteLength<K+(ee||0))throw new RangeError('"length" is outside of buffer bounds');let te;return te=void 0===K&&void 0===ee?new Uint8Array(z):void 0===ee?new Uint8Array(z,K):new Uint8Array(z,K,ee),Object.setPrototypeOf(te,f.prototype),te}function p(z){if(z>=ie)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ie.toString(16)+" bytes");return 0|z}function g(z,K){if(f.isBuffer(z))return z.length;if(ArrayBuffer.isView(z)||Q(z,ArrayBuffer))return z.byteLength;if("string"!=typeof z)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof z);const ee=z.length,te=arguments.length>2&&!0===arguments[2];if(!te&&0===ee)return 0;let ne=!1;for(;;)switch(K){case"ascii":case"latin1":case"binary":return ee;case"utf8":case"utf-8":return V(z).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*ee;case"hex":return ee>>>1;case"base64":return Z(z).length;default:if(ne)return te?-1:V(z).length;K=(""+K).toLowerCase(),ne=!0}}function m(z,K,ee){let te=!1;if((void 0===K||K<0)&&(K=0),K>this.length)return"";if((void 0===ee||ee>this.length)&&(ee=this.length),ee<=0)return"";if((ee>>>=0)<=(K>>>=0))return"";for(z||(z="utf8");;)switch(z){case"hex":return I(this,K,ee);case"utf8":case"utf-8":return C(this,K,ee);case"ascii":return k(this,K,ee);case"latin1":case"binary":return x(this,K,ee);case"base64":return A(this,K,ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,K,ee);default:if(te)throw new TypeError("Unknown encoding: "+z);z=(z+"").toLowerCase(),te=!0}}function y(z,K,ee){const te=z[K];z[K]=z[ee],z[ee]=te}function b(z,K,ee,te,ne){if(0===z.length)return-1;if("string"==typeof ee?(te=ee,ee=0):ee>2147483647?ee=2147483647:ee<-2147483648&&(ee=-2147483648),Y(ee=+ee)&&(ee=ne?0:z.length-1),ee<0&&(ee=z.length+ee),ee>=z.length){if(ne)return-1;ee=z.length-1}else if(ee<0){if(!ne)return-1;ee=0}if("string"==typeof K&&(K=f.from(K,te)),f.isBuffer(K))return 0===K.length?-1:v(z,K,ee,te,ne);if("number"==typeof K)return K&=255,"function"==typeof Uint8Array.prototype.indexOf?ne?Uint8Array.prototype.indexOf.call(z,K,ee):Uint8Array.prototype.lastIndexOf.call(z,K,ee):v(z,[K],ee,te,ne);throw new TypeError("val must be string, number or Buffer")}function v(z,K,ee,te,ne){let re,ie=1,se=z.length,oe=K.length;if(void 0!==te&&("ucs2"===(te=String(te).toLowerCase())||"ucs-2"===te||"utf16le"===te||"utf-16le"===te)){if(z.length<2||K.length<2)return-1;ie=2,se/=2,oe/=2,ee/=2}function h(z,K){return 1===ie?z[K]:z.readUInt16BE(K*ie)}if(ne){let te=-1;for(re=ee;re<se;re++)if(h(z,re)===h(K,-1===te?0:re-te)){if(-1===te&&(te=re),re-te+1===oe)return te*ie}else-1!==te&&(re-=re-te),te=-1}else for(ee+oe>se&&(ee=se-oe),re=ee;re>=0;re--){let ee=!0;for(let te=0;te<oe;te++)if(h(z,re+te)!==h(K,te)){ee=!1;break}if(ee)return re}return-1}function w(z,K,ee,te){ee=Number(ee)||0;const ne=z.length-ee;te?(te=Number(te))>ne&&(te=ne):te=ne;const re=K.length;let ie;for(te>re/2&&(te=re/2),ie=0;ie<te;++ie){const te=parseInt(K.substr(2*ie,2),16);if(Y(te))return ie;z[ee+ie]=te}return ie}function _(z,K,ee,te){return G(V(K,z.length-ee),z,ee,te)}function B(z,K,ee,te){return G(function(z){const K=[];for(let ee=0;ee<z.length;++ee)K.push(255&z.charCodeAt(ee));return K}(K),z,ee,te)}function E(z,K,ee,te){return G(Z(K),z,ee,te)}function S(z,K,ee,te){return G(function(z,K){let ee,te,ne;const re=[];for(let ie=0;ie<z.length&&!((K-=2)<0);++ie)ee=z.charCodeAt(ie),te=ee>>8,ne=ee%256,re.push(ne),re.push(te);return re}(K,z.length-ee),z,ee,te)}function A(z,K,ee){return 0===K&&ee===z.length?te.fromByteArray(z):te.fromByteArray(z.slice(K,ee))}function C(z,K,ee){ee=Math.min(z.length,ee);const te=[];let ne=K;for(;ne<ee;){const K=z[ne];let re=null,ie=K>239?4:K>223?3:K>191?2:1;if(ne+ie<=ee){let ee,te,se,oe;switch(ie){case 1:K<128&&(re=K);break;case 2:ee=z[ne+1],128==(192&ee)&&(oe=(31&K)<<6|63&ee,oe>127&&(re=oe));break;case 3:ee=z[ne+1],te=z[ne+2],128==(192&ee)&&128==(192&te)&&(oe=(15&K)<<12|(63&ee)<<6|63&te,oe>2047&&(oe<55296||oe>57343)&&(re=oe));break;case 4:ee=z[ne+1],te=z[ne+2],se=z[ne+3],128==(192&ee)&&128==(192&te)&&128==(192&se)&&(oe=(15&K)<<18|(63&ee)<<12|(63&te)<<6|63&se,oe>65535&&oe<1114112&&(re=oe))}}null===re?(re=65533,ie=1):re>65535&&(re-=65536,te.push(re>>>10&1023|55296),re=56320|1023&re),te.push(re),ne+=ie}return function(z){const K=z.length;if(K<=se)return String.fromCharCode.apply(String,z);let ee="",te=0;for(;te<K;)ee+=String.fromCharCode.apply(String,z.slice(te,te+=se));return ee}(te)}K.kMaxLength=ie,f.TYPED_ARRAY_SUPPORT=function(){try{const z=new Uint8Array(1),K={foo:function(){return 42}};return Object.setPrototypeOf(K,Uint8Array.prototype),Object.setPrototypeOf(z,K),42===z.foo()}catch(z){return!1}}(),f.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}}),f.poolSize=8192,f.from=function(z,K,ee){return h(z,K,ee)},Object.setPrototypeOf(f.prototype,Uint8Array.prototype),Object.setPrototypeOf(f,Uint8Array),f.alloc=function(z,K,ee){return function(z,K,ee){return l(z),z<=0?a(z):void 0!==K?"string"==typeof ee?a(z).fill(K,ee):a(z).fill(K):a(z)}(z,K,ee)},f.allocUnsafe=function(z){return u(z)},f.allocUnsafeSlow=function(z){return u(z)},f.isBuffer=function(z){return null!=z&&!0===z._isBuffer&&z!==f.prototype},f.compare=function(z,K){if(Q(z,Uint8Array)&&(z=f.from(z,z.offset,z.byteLength)),Q(K,Uint8Array)&&(K=f.from(K,K.offset,K.byteLength)),!f.isBuffer(z)||!f.isBuffer(K))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(z===K)return 0;let ee=z.length,te=K.length;for(let ne=0,re=Math.min(ee,te);ne<re;++ne)if(z[ne]!==K[ne]){ee=z[ne],te=K[ne];break}return ee<te?-1:te<ee?1:0},f.isEncoding=function(z){switch(String(z).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(z,K){if(!Array.isArray(z))throw new TypeError('"list" argument must be an Array of Buffers');if(0===z.length)return f.alloc(0);let ee;if(void 0===K)for(K=0,ee=0;ee<z.length;++ee)K+=z[ee].length;const te=f.allocUnsafe(K);let ne=0;for(ee=0;ee<z.length;++ee){let K=z[ee];if(Q(K,Uint8Array))ne+K.length>te.length?(f.isBuffer(K)||(K=f.from(K)),K.copy(te,ne)):Uint8Array.prototype.set.call(te,K,ne);else{if(!f.isBuffer(K))throw new TypeError('"list" argument must be an Array of Buffers');K.copy(te,ne)}ne+=K.length}return te},f.byteLength=g,f.prototype._isBuffer=!0,f.prototype.swap16=function(){const z=this.length;if(z%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let K=0;K<z;K+=2)y(this,K,K+1);return this},f.prototype.swap32=function(){const z=this.length;if(z%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let K=0;K<z;K+=4)y(this,K,K+3),y(this,K+1,K+2);return this},f.prototype.swap64=function(){const z=this.length;if(z%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let K=0;K<z;K+=8)y(this,K,K+7),y(this,K+1,K+6),y(this,K+2,K+5),y(this,K+3,K+4);return this},f.prototype.toString=function(){const z=this.length;return 0===z?"":0===arguments.length?C(this,0,z):m.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(z){if(!f.isBuffer(z))throw new TypeError("Argument must be a Buffer");return this===z||0===f.compare(this,z)},f.prototype.inspect=function(){let z="";const ee=K.INSPECT_MAX_BYTES;return z=this.toString("hex",0,ee).replace(/(.{2})/g,"$1 ").trim(),this.length>ee&&(z+=" ... "),"<Buffer "+z+">"},re&&(f.prototype[re]=f.prototype.inspect),f.prototype.compare=function(z,K,ee,te,ne){if(Q(z,Uint8Array)&&(z=f.from(z,z.offset,z.byteLength)),!f.isBuffer(z))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof z);if(void 0===K&&(K=0),void 0===ee&&(ee=z?z.length:0),void 0===te&&(te=0),void 0===ne&&(ne=this.length),K<0||ee>z.length||te<0||ne>this.length)throw new RangeError("out of range index");if(te>=ne&&K>=ee)return 0;if(te>=ne)return-1;if(K>=ee)return 1;if(this===z)return 0;let re=(ne>>>=0)-(te>>>=0),ie=(ee>>>=0)-(K>>>=0);const se=Math.min(re,ie),oe=this.slice(te,ne),ae=z.slice(K,ee);for(let z=0;z<se;++z)if(oe[z]!==ae[z]){re=oe[z],ie=ae[z];break}return re<ie?-1:ie<re?1:0},f.prototype.includes=function(z,K,ee){return-1!==this.indexOf(z,K,ee)},f.prototype.indexOf=function(z,K,ee){return b(this,z,K,ee,!0)},f.prototype.lastIndexOf=function(z,K,ee){return b(this,z,K,ee,!1)},f.prototype.write=function(z,K,ee,te){if(void 0===K)te="utf8",ee=this.length,K=0;else if(void 0===ee&&"string"==typeof K)te=K,ee=this.length,K=0;else{if(!isFinite(K))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");K>>>=0,isFinite(ee)?(ee>>>=0,void 0===te&&(te="utf8")):(te=ee,ee=void 0)}const ne=this.length-K;if((void 0===ee||ee>ne)&&(ee=ne),z.length>0&&(ee<0||K<0)||K>this.length)throw new RangeError("Attempt to write outside buffer bounds");te||(te="utf8");let re=!1;for(;;)switch(te){case"hex":return w(this,z,K,ee);case"utf8":case"utf-8":return _(this,z,K,ee);case"ascii":case"latin1":case"binary":return B(this,z,K,ee);case"base64":return E(this,z,K,ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,z,K,ee);default:if(re)throw new TypeError("Unknown encoding: "+te);te=(""+te).toLowerCase(),re=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const se=4096;function k(z,K,ee){let te="";ee=Math.min(z.length,ee);for(let ne=K;ne<ee;++ne)te+=String.fromCharCode(127&z[ne]);return te}function x(z,K,ee){let te="";ee=Math.min(z.length,ee);for(let ne=K;ne<ee;++ne)te+=String.fromCharCode(z[ne]);return te}function I(z,K,ee){const te=z.length;(!K||K<0)&&(K=0),(!ee||ee<0||ee>te)&&(ee=te);let ne="";for(let te=K;te<ee;++te)ne+=le[z[te]];return ne}function M(z,K,ee){const te=z.slice(K,ee);let ne="";for(let z=0;z<te.length-1;z+=2)ne+=String.fromCharCode(te[z]+256*te[z+1]);return ne}function F(z,K,ee){if(z%1!=0||z<0)throw new RangeError("offset is not uint");if(z+K>ee)throw new RangeError("Trying to access beyond buffer length")}function O(z,K,ee,te,ne,re){if(!f.isBuffer(z))throw new TypeError('"buffer" argument must be a Buffer instance');if(K>ne||K<re)throw new RangeError('"value" argument is out of bounds');if(ee+te>z.length)throw new RangeError("Index out of range")}function T(z,K,ee,te,ne){j(K,te,ne,z,ee,7);let re=Number(K&BigInt(4294967295));z[ee++]=re,re>>=8,z[ee++]=re,re>>=8,z[ee++]=re,re>>=8,z[ee++]=re;let ie=Number(K>>BigInt(32)&BigInt(4294967295));return z[ee++]=ie,ie>>=8,z[ee++]=ie,ie>>=8,z[ee++]=ie,ie>>=8,z[ee++]=ie,ee}function U(z,K,ee,te,ne){j(K,te,ne,z,ee,7);let re=Number(K&BigInt(4294967295));z[ee+7]=re,re>>=8,z[ee+6]=re,re>>=8,z[ee+5]=re,re>>=8,z[ee+4]=re;let ie=Number(K>>BigInt(32)&BigInt(4294967295));return z[ee+3]=ie,ie>>=8,z[ee+2]=ie,ie>>=8,z[ee+1]=ie,ie>>=8,z[ee]=ie,ee+8}function P(z,K,ee,te,ne,re){if(ee+te>z.length)throw new RangeError("Index out of range");if(ee<0)throw new RangeError("Index out of range")}function N(z,K,ee,te,re){return K=+K,ee>>>=0,re||P(z,0,ee,4),ne.write(z,K,ee,te,23,4),ee+4}function L(z,K,ee,te,re){return K=+K,ee>>>=0,re||P(z,0,ee,8),ne.write(z,K,ee,te,52,8),ee+8}f.prototype.slice=function(z,K){const ee=this.length;(z=~~z)<0?(z+=ee)<0&&(z=0):z>ee&&(z=ee),(K=void 0===K?ee:~~K)<0?(K+=ee)<0&&(K=0):K>ee&&(K=ee),K<z&&(K=z);const te=this.subarray(z,K);return Object.setPrototypeOf(te,f.prototype),te},f.prototype.readUintLE=f.prototype.readUIntLE=function(z,K,ee){z>>>=0,K>>>=0,ee||F(z,K,this.length);let te=this[z],ne=1,re=0;for(;++re<K&&(ne*=256);)te+=this[z+re]*ne;return te},f.prototype.readUintBE=f.prototype.readUIntBE=function(z,K,ee){z>>>=0,K>>>=0,ee||F(z,K,this.length);let te=this[z+--K],ne=1;for(;K>0&&(ne*=256);)te+=this[z+--K]*ne;return te},f.prototype.readUint8=f.prototype.readUInt8=function(z,K){return z>>>=0,K||F(z,1,this.length),this[z]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(z,K){return z>>>=0,K||F(z,2,this.length),this[z]|this[z+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(z,K){return z>>>=0,K||F(z,2,this.length),this[z]<<8|this[z+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(z,K){return z>>>=0,K||F(z,4,this.length),(this[z]|this[z+1]<<8|this[z+2]<<16)+16777216*this[z+3]},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(z,K){return z>>>=0,K||F(z,4,this.length),16777216*this[z]+(this[z+1]<<16|this[z+2]<<8|this[z+3])},f.prototype.readBigUInt64LE=X((function(z){H(z>>>=0,"offset");const K=this[z],ee=this[z+7];void 0!==K&&void 0!==ee||W(z,this.length-8);const te=K+256*this[++z]+65536*this[++z]+this[++z]*2**24,ne=this[++z]+256*this[++z]+65536*this[++z]+ee*2**24;return BigInt(te)+(BigInt(ne)<<BigInt(32))})),f.prototype.readBigUInt64BE=X((function(z){H(z>>>=0,"offset");const K=this[z],ee=this[z+7];void 0!==K&&void 0!==ee||W(z,this.length-8);const te=K*2**24+65536*this[++z]+256*this[++z]+this[++z],ne=this[++z]*2**24+65536*this[++z]+256*this[++z]+ee;return(BigInt(te)<<BigInt(32))+BigInt(ne)})),f.prototype.readIntLE=function(z,K,ee){z>>>=0,K>>>=0,ee||F(z,K,this.length);let te=this[z],ne=1,re=0;for(;++re<K&&(ne*=256);)te+=this[z+re]*ne;return ne*=128,te>=ne&&(te-=Math.pow(2,8*K)),te},f.prototype.readIntBE=function(z,K,ee){z>>>=0,K>>>=0,ee||F(z,K,this.length);let te=K,ne=1,re=this[z+--te];for(;te>0&&(ne*=256);)re+=this[z+--te]*ne;return ne*=128,re>=ne&&(re-=Math.pow(2,8*K)),re},f.prototype.readInt8=function(z,K){return z>>>=0,K||F(z,1,this.length),128&this[z]?-1*(255-this[z]+1):this[z]},f.prototype.readInt16LE=function(z,K){z>>>=0,K||F(z,2,this.length);const ee=this[z]|this[z+1]<<8;return 32768&ee?4294901760|ee:ee},f.prototype.readInt16BE=function(z,K){z>>>=0,K||F(z,2,this.length);const ee=this[z+1]|this[z]<<8;return 32768&ee?4294901760|ee:ee},f.prototype.readInt32LE=function(z,K){return z>>>=0,K||F(z,4,this.length),this[z]|this[z+1]<<8|this[z+2]<<16|this[z+3]<<24},f.prototype.readInt32BE=function(z,K){return z>>>=0,K||F(z,4,this.length),this[z]<<24|this[z+1]<<16|this[z+2]<<8|this[z+3]},f.prototype.readBigInt64LE=X((function(z){H(z>>>=0,"offset");const K=this[z],ee=this[z+7];void 0!==K&&void 0!==ee||W(z,this.length-8);const te=this[z+4]+256*this[z+5]+65536*this[z+6]+(ee<<24);return(BigInt(te)<<BigInt(32))+BigInt(K+256*this[++z]+65536*this[++z]+this[++z]*2**24)})),f.prototype.readBigInt64BE=X((function(z){H(z>>>=0,"offset");const K=this[z],ee=this[z+7];void 0!==K&&void 0!==ee||W(z,this.length-8);const te=(K<<24)+65536*this[++z]+256*this[++z]+this[++z];return(BigInt(te)<<BigInt(32))+BigInt(this[++z]*2**24+65536*this[++z]+256*this[++z]+ee)})),f.prototype.readFloatLE=function(z,K){return z>>>=0,K||F(z,4,this.length),ne.read(this,z,!0,23,4)},f.prototype.readFloatBE=function(z,K){return z>>>=0,K||F(z,4,this.length),ne.read(this,z,!1,23,4)},f.prototype.readDoubleLE=function(z,K){return z>>>=0,K||F(z,8,this.length),ne.read(this,z,!0,52,8)},f.prototype.readDoubleBE=function(z,K){return z>>>=0,K||F(z,8,this.length),ne.read(this,z,!1,52,8)},f.prototype.writeUintLE=f.prototype.writeUIntLE=function(z,K,ee,te){z=+z,K>>>=0,ee>>>=0,te||O(this,z,K,ee,Math.pow(2,8*ee)-1,0);let ne=1,re=0;for(this[K]=255&z;++re<ee&&(ne*=256);)this[K+re]=z/ne&255;return K+ee},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(z,K,ee,te){z=+z,K>>>=0,ee>>>=0,te||O(this,z,K,ee,Math.pow(2,8*ee)-1,0);let ne=ee-1,re=1;for(this[K+ne]=255&z;--ne>=0&&(re*=256);)this[K+ne]=z/re&255;return K+ee},f.prototype.writeUint8=f.prototype.writeUInt8=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,1,255,0),this[K]=255&z,K+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,2,65535,0),this[K]=255&z,this[K+1]=z>>>8,K+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,2,65535,0),this[K]=z>>>8,this[K+1]=255&z,K+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,4,4294967295,0),this[K+3]=z>>>24,this[K+2]=z>>>16,this[K+1]=z>>>8,this[K]=255&z,K+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,4,4294967295,0),this[K]=z>>>24,this[K+1]=z>>>16,this[K+2]=z>>>8,this[K+3]=255&z,K+4},f.prototype.writeBigUInt64LE=X((function(z,K=0){return T(this,z,K,BigInt(0),BigInt("0xffffffffffffffff"))})),f.prototype.writeBigUInt64BE=X((function(z,K=0){return U(this,z,K,BigInt(0),BigInt("0xffffffffffffffff"))})),f.prototype.writeIntLE=function(z,K,ee,te){if(z=+z,K>>>=0,!te){const te=Math.pow(2,8*ee-1);O(this,z,K,ee,te-1,-te)}let ne=0,re=1,ie=0;for(this[K]=255&z;++ne<ee&&(re*=256);)z<0&&0===ie&&0!==this[K+ne-1]&&(ie=1),this[K+ne]=(z/re>>0)-ie&255;return K+ee},f.prototype.writeIntBE=function(z,K,ee,te){if(z=+z,K>>>=0,!te){const te=Math.pow(2,8*ee-1);O(this,z,K,ee,te-1,-te)}let ne=ee-1,re=1,ie=0;for(this[K+ne]=255&z;--ne>=0&&(re*=256);)z<0&&0===ie&&0!==this[K+ne+1]&&(ie=1),this[K+ne]=(z/re>>0)-ie&255;return K+ee},f.prototype.writeInt8=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,1,127,-128),z<0&&(z=255+z+1),this[K]=255&z,K+1},f.prototype.writeInt16LE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,2,32767,-32768),this[K]=255&z,this[K+1]=z>>>8,K+2},f.prototype.writeInt16BE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,2,32767,-32768),this[K]=z>>>8,this[K+1]=255&z,K+2},f.prototype.writeInt32LE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,4,2147483647,-2147483648),this[K]=255&z,this[K+1]=z>>>8,this[K+2]=z>>>16,this[K+3]=z>>>24,K+4},f.prototype.writeInt32BE=function(z,K,ee){return z=+z,K>>>=0,ee||O(this,z,K,4,2147483647,-2147483648),z<0&&(z=4294967295+z+1),this[K]=z>>>24,this[K+1]=z>>>16,this[K+2]=z>>>8,this[K+3]=255&z,K+4},f.prototype.writeBigInt64LE=X((function(z,K=0){return T(this,z,K,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),f.prototype.writeBigInt64BE=X((function(z,K=0){return U(this,z,K,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),f.prototype.writeFloatLE=function(z,K,ee){return N(this,z,K,!0,ee)},f.prototype.writeFloatBE=function(z,K,ee){return N(this,z,K,!1,ee)},f.prototype.writeDoubleLE=function(z,K,ee){return L(this,z,K,!0,ee)},f.prototype.writeDoubleBE=function(z,K,ee){return L(this,z,K,!1,ee)},f.prototype.copy=function(z,K,ee,te){if(!f.isBuffer(z))throw new TypeError("argument should be a Buffer");if(ee||(ee=0),te||0===te||(te=this.length),K>=z.length&&(K=z.length),K||(K=0),te>0&&te<ee&&(te=ee),te===ee)return 0;if(0===z.length||0===this.length)return 0;if(K<0)throw new RangeError("targetStart out of bounds");if(ee<0||ee>=this.length)throw new RangeError("Index out of range");if(te<0)throw new RangeError("sourceEnd out of bounds");te>this.length&&(te=this.length),z.length-K<te-ee&&(te=z.length-K+ee);const ne=te-ee;return this===z&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(K,ee,te):Uint8Array.prototype.set.call(z,this.subarray(ee,te),K),ne},f.prototype.fill=function(z,K,ee,te){if("string"==typeof z){if("string"==typeof K?(te=K,K=0,ee=this.length):"string"==typeof ee&&(te=ee,ee=this.length),void 0!==te&&"string"!=typeof te)throw new TypeError("encoding must be a string");if("string"==typeof te&&!f.isEncoding(te))throw new TypeError("Unknown encoding: "+te);if(1===z.length){const K=z.charCodeAt(0);("utf8"===te&&K<128||"latin1"===te)&&(z=K)}}else"number"==typeof z?z&=255:"boolean"==typeof z&&(z=Number(z));if(K<0||this.length<K||this.length<ee)throw new RangeError("Out of range index");if(ee<=K)return this;let ne;if(K>>>=0,ee=void 0===ee?this.length:ee>>>0,z||(z=0),"number"==typeof z)for(ne=K;ne<ee;++ne)this[ne]=z;else{const re=f.isBuffer(z)?z:f.from(z,te),ie=re.length;if(0===ie)throw new TypeError('The value "'+z+'" is invalid for argument "value"');for(ne=0;ne<ee-K;++ne)this[ne+K]=re[ne%ie]}return this};const oe={};function D(z,K,ee){oe[z]=class extends ee{constructor(){super(),Object.defineProperty(this,"message",{value:K.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${z}]`,this.stack,delete this.name}get code(){return z}set code(z){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:z,writable:!0})}toString(){return`${this.name} [${z}]: ${this.message}`}}}function q(z){let K="",ee=z.length;const te="-"===z[0]?1:0;for(;ee>=te+4;ee-=3)K=`_${z.slice(ee-3,ee)}${K}`;return`${z.slice(0,ee)}${K}`}function j(z,K,ee,te,ne,re){if(z>ee||z<K){const te="bigint"==typeof K?"n":"";let ne;throw ne=re>3?0===K||K===BigInt(0)?`>= 0${te} and < 2${te} ** ${8*(re+1)}${te}`:`>= -(2${te} ** ${8*(re+1)-1}${te}) and < 2 ** ${8*(re+1)-1}${te}`:`>= ${K}${te} and <= ${ee}${te}`,new oe.ERR_OUT_OF_RANGE("value",ne,z)}!function(z,K,ee){H(K,"offset"),void 0!==z[K]&&void 0!==z[K+ee]||W(K,z.length-(ee+1))}(te,ne,re)}function H(z,K){if("number"!=typeof z)throw new oe.ERR_INVALID_ARG_TYPE(K,"number",z)}function W(z,K,ee){if(Math.floor(z)!==z)throw H(z,ee),new oe.ERR_OUT_OF_RANGE(ee||"offset","an integer",z);if(K<0)throw new oe.ERR_BUFFER_OUT_OF_BOUNDS;throw new oe.ERR_OUT_OF_RANGE(ee||"offset",`>= ${ee?1:0} and <= ${K}`,z)}D("ERR_BUFFER_OUT_OF_BOUNDS",(function(z){return z?`${z} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),D("ERR_INVALID_ARG_TYPE",(function(z,K){return`The "${z}" argument must be of type number. Received type ${typeof K}`}),TypeError),D("ERR_OUT_OF_RANGE",(function(z,K,ee){let te=`The value of "${z}" is out of range.`,ne=ee;return Number.isInteger(ee)&&Math.abs(ee)>2**32?ne=q(String(ee)):"bigint"==typeof ee&&(ne=String(ee),(ee>BigInt(2)**BigInt(32)||ee<-(BigInt(2)**BigInt(32)))&&(ne=q(ne)),ne+="n"),te+=` It must be ${K}. Received ${ne}`,te}),RangeError);const ae=/[^+/0-9A-Za-z-_]/g;function V(z,K){let ee;K=K||1/0;const te=z.length;let ne=null;const re=[];for(let ie=0;ie<te;++ie){if(ee=z.charCodeAt(ie),ee>55295&&ee<57344){if(!ne){if(ee>56319){(K-=3)>-1&&re.push(239,191,189);continue}if(ie+1===te){(K-=3)>-1&&re.push(239,191,189);continue}ne=ee;continue}if(ee<56320){(K-=3)>-1&&re.push(239,191,189),ne=ee;continue}ee=65536+(ne-55296<<10|ee-56320)}else ne&&(K-=3)>-1&&re.push(239,191,189);if(ne=null,ee<128){if((K-=1)<0)break;re.push(ee)}else if(ee<2048){if((K-=2)<0)break;re.push(ee>>6|192,63&ee|128)}else if(ee<65536){if((K-=3)<0)break;re.push(ee>>12|224,ee>>6&63|128,63&ee|128)}else{if(!(ee<1114112))throw new Error("Invalid code point");if((K-=4)<0)break;re.push(ee>>18|240,ee>>12&63|128,ee>>6&63|128,63&ee|128)}}return re}function Z(z){return te.toByteArray(function(z){if((z=(z=z.split("=")[0]).trim().replace(ae,"")).length<2)return"";for(;z.length%4!=0;)z+="=";return z}(z))}function G(z,K,ee,te){let ne;for(ne=0;ne<te&&!(ne+ee>=K.length||ne>=z.length);++ne)K[ne+ee]=z[ne];return ne}function Q(z,K){return z instanceof K||null!=z&&null!=z.constructor&&null!=z.constructor.name&&z.constructor.name===K.name}function Y(z){return z!=z}const le=function(){const z="0123456789abcdef",K=new Array(256);for(let ee=0;ee<16;++ee){const te=16*ee;for(let ne=0;ne<16;++ne)K[te+ne]=z[ee]+z[ne]}return K}();function X(z){return"undefined"==typeof BigInt?J:z}function J(){throw new Error("BigInt not supported")}},4693:z=>{var K={array:function(z){var K=0,ee=0,te=[0,1,3,7,15,31,63,127,255];return function(ne){for(var re=0;ne>0;){var ie=8-K;ne>=ie?(re<<=ie,re|=te[ie]&z[ee++],K=0,ne-=ie):(re<<=ne,re|=(z[ee]&te[ne]<<8-ne-K)>>8-ne-K,K+=ne,ne=0)}return re}},simple:function(z){var ee,te,ne=K.header(z),re=[],ie=0;do{-1!=(te=K.decompress(z,ne))&&(re.push(te),ie+=te.byteLength)}while(-1!=te);ee=new Uint8Array(ie),ie=0;for(var se=0;se<re.length;++se)te=re[se],ee.set(te,ie),ie+=te.byteLength;return ee},header:function(z){if(4348520!=z(24))throw"No magic number found";var K=z(8)-48;if(K<1||K>9)throw"Not a BZIP archive";return K},decompress:function(z,K,ee){for(var te=9e5,ne="",re=0;re<6;re++)ne+=z(8).toString(16);if("177245385090"==ne)return-1;if("314159265359"!=ne)throw"eek not valid bzip data";if(z(32),z(1))throw"unsupported obsolete version";var ie=z(24);if(ie>te)throw"Initial position larger than buffer size";var se=z(16),oe=new Uint8Array(256),ae=0;for(re=0;re<16;re++)if(se&1<<15-re){var le=z(16);for(fe=0;fe<16;fe++)le&1<<15-fe&&(oe[ae++]=16*re+fe)}var ce=z(3);if(ce<2||ce>6)throw"another error";var he=z(15);if(0==he)throw"meh";var ue=[];for(re=0;re<ce;re++)ue[re]=re;var de=new Uint8Array(32768);for(re=0;re<he;re++){for(var fe=0;z(1);fe++)if(fe>=ce)throw"whoops another error";var pe=ue[fe];ue.splice(fe,1),ue.splice(0,0,pe),de[re]=pe}var ge=ae+2,me=[];for(fe=0;fe<ce;fe++){var be,ve,we,ye=new Uint8Array(258),_e=new Uint8Array(21);for(se=z(5),re=0;re<ge;re++){for(;;){if(se<1||se>20)throw"I gave up a while ago on writing error messages";if(!z(1))break;z(1)?se--:se++}ye[re]=se}for(be=ve=ye[0],re=1;re<ge;re++)ye[re]>ve?ve=ye[re]:ye[re]<be&&(be=ye[re]);(we=me[fe]={}).permute=new Uint32Array(258),we.limit=new Uint32Array(21),we.base=new Uint32Array(21),we.minLen=be,we.maxLen=ve;var ke=we.base.subarray(1),xe=we.limit.subarray(1),Ce=0;for(re=be;re<=ve;re++)for(se=0;se<ge;se++)ye[se]==re&&(we.permute[Ce++]=se);for(re=be;re<=ve;re++)_e[re]=xe[re]=0;for(re=0;re<ge;re++)_e[ye[re]]++;for(Ce=se=0,re=be;re<ve;re++)Ce+=_e[re],xe[re]=Ce-1,Ce<<=1,ke[re+1]=Ce-(se+=_e[re]);xe[ve]=Ce+_e[ve]-1,ke[be]=0}var Se,Ae,Te,Ee=new Uint32Array(256);for(re=0;re<256;re++)ue[re]=re;Se=Ae=ge=Te=0;for(var Me=new Uint32Array(te);;){if(!ge--){if(ge=49,Te>=he)throw"meow i'm a kitty, that's an error";ke=(we=me[de[Te++]]).base.subarray(1),xe=we.limit.subarray(1)}for(fe=z(re=we.minLen);;){if(re>we.maxLen)throw"rawr i'm a dinosaur";if(fe<=xe[re])break;re++,fe=fe<<1|z(1)}if((fe-=ke[re])<0||fe>=258)throw"moo i'm a cow";var Re=we.permute[fe];if(0!=Re&&1!=Re){if(Se){if(Se=0,Ae+se>=te)throw"Boom.";for(Ee[pe=oe[ue[0]]]+=se;se--;)Me[Ae++]=pe}if(Re>ae)break;if(Ae>=te)throw"I can't think of anything. Error";pe=ue[re=Re-1],ue.splice(re,1),ue.splice(0,0,pe),Ee[pe=oe[pe]]++,Me[Ae++]=pe}else Se||(Se=1,se=0),se+=0==Re?Se:2*Se,Se<<=1}if(ie<0||ie>=Ae)throw"I'm a monkey and I'm throwing something at someone, namely you";for(fe=0,re=0;re<256;re++)le=fe+Ee[re],Ee[re]=fe,fe=le;for(re=0;re<Ae;re++)Me[Ee[pe=255&Me[re]]]|=re<<8,Ee[pe]++;var Ie=0,Fe=0,Le=0;Ae&&(Fe=255&(Ie=Me[ie]),Ie>>=8,Le=-1);var Be,Ne,De,Pe=new Uint8Array(te),Oe=0;for(ee||(ee=1/0);Ae;){for(Ae--,Ne=Fe,Fe=255&(Ie=Me[Ie]),Ie>>=8,3==Le++?(Be=Fe,De=Ne,Fe=-1):(Be=1,De=Fe);Be--;)if(Pe[Oe++]=De,!--ee)return Pe;Fe!=Ne&&(Le=0)}return Pe.subarray(0,Oe)}};z.exports=K},487:z=>{var K={utf8:{stringToBytes:function(z){return K.bin.stringToBytes(unescape(encodeURIComponent(z)))},bytesToString:function(z){return decodeURIComponent(escape(K.bin.bytesToString(z)))}},bin:{stringToBytes:function(z){for(var K=[],ee=0;ee<z.length;ee++)K.push(255&z.charCodeAt(ee));return K},bytesToString:function(z){for(var K=[],ee=0;ee<z.length;ee++)K.push(String.fromCharCode(z[ee]));return K.join("")}}};z.exports=K},1012:z=>{var K,ee;K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ee={rotl:function(z,K){return z<<K|z>>>32-K},rotr:function(z,K){return z<<32-K|z>>>K},endian:function(z){if(z.constructor==Number)return 16711935&ee.rotl(z,8)|4278255360&ee.rotl(z,24);for(var K=0;K<z.length;K++)z[K]=ee.endian(z[K]);return z},randomBytes:function(z){for(var K=[];z>0;z--)K.push(Math.floor(256*Math.random()));return K},bytesToWords:function(z){for(var K=[],ee=0,te=0;ee<z.length;ee++,te+=8)K[te>>>5]|=z[ee]<<24-te%32;return K},wordsToBytes:function(z){for(var K=[],ee=0;ee<32*z.length;ee+=8)K.push(z[ee>>>5]>>>24-ee%32&255);return K},bytesToHex:function(z){for(var K=[],ee=0;ee<z.length;ee++)K.push((z[ee]>>>4).toString(16)),K.push((15&z[ee]).toString(16));return K.join("")},hexToBytes:function(z){for(var K=[],ee=0;ee<z.length;ee+=2)K.push(parseInt(z.substr(ee,2),16));return K},bytesToBase64:function(z){for(var ee=[],te=0;te<z.length;te+=3)for(var ne=z[te]<<16|z[te+1]<<8|z[te+2],re=0;re<4;re++)8*te+6*re<=8*z.length?ee.push(K.charAt(ne>>>6*(3-re)&63)):ee.push("=");return ee.join("")},base64ToBytes:function(z){z=z.replace(/[^A-Z0-9+\/]/gi,"");for(var ee=[],te=0,ne=0;te<z.length;ne=++te%4)0!=ne&&ee.push((K.indexOf(z.charAt(te-1))&Math.pow(2,-2*ne+8)-1)<<2*ne|K.indexOf(z.charAt(te))>>>6-2*ne);return ee}},z.exports=ee},2949:(z,K,ee)=>{ee.r(K),ee.d(K,{BlobFile:()=>h,LocalFile:()=>ne(),RemoteFile:()=>a,fromUrl:()=>l,open:()=>u});var te=ee(7067),ne=ee.n(te),re=ee(8764);const ie="undefined"!=typeof window?window:"undefined"!=typeof self?self:{fetch:void 0};class a{constructor(z,K={}){this.baseOverrides={},this.url=z;const ee=K.fetch||ie.fetch&&ie.fetch.bind(ie);if(!ee)throw new TypeError("no fetch function supplied, and none found in global environment");K.overrides&&(this.baseOverrides=K.overrides),this.fetchImplementation=ee}async getBufferFromResponse(z){if("function"==typeof z.buffer)return z.buffer();if("function"==typeof z.arrayBuffer){const K=await z.arrayBuffer();return re.Buffer.from(K)}throw new TypeError("invalid HTTP response object, has no buffer method, and no arrayBuffer method")}async fetch(z,K){let ee;try{ee=await this.fetchImplementation(z,K)}catch(te){if(!`${te}`.includes("Failed to fetch"))throw te;console.warn(`generic-filehandle: refetching ${z} to attempt to work around chrome CORS header caching bug`),ee=await this.fetchImplementation(z,{...K,cache:"reload"})}return ee}async read(z,K=0,ee,te=0,ne={}){const{headers:re={},signal:ie,overrides:se={}}=ne;ee<1/0?re.range=`bytes=${te}-${te+ee}`:ee===1/0&&0!==te&&(re.range=`bytes=${te}-`);const oe={...this.baseOverrides,...se,headers:{...re,...se.headers,...this.baseOverrides.headers},method:"GET",redirect:"follow",mode:"cors",signal:ie},ae=await this.fetch(this.url,oe);if(!ae.ok)throw new Error(`HTTP ${ae.status} ${ae.statusText} ${this.url}`);if(200===ae.status&&0===te||206===ae.status){const te=await this.getBufferFromResponse(ae),ne=te.copy(z,K,0,Math.min(ee,te.length)),re=ae.headers.get("content-range"),ie=/\/(\d+)$/.exec(re||"");return ie&&ie[1]&&(this._stat={size:parseInt(ie[1],10)}),{bytesRead:ne,buffer:z}}if(200===ae.status)throw new Error("${this.url} fetch returned status 200, expected 206");throw new Error(`HTTP ${ae.status} fetching ${this.url}`)}async readFile(z={}){let K,ee;"string"==typeof z?(K=z,ee={}):(K=z.encoding,ee=z,delete ee.encoding);const{headers:te={},signal:ne,overrides:re={}}=ee,ie={headers:te,method:"GET",redirect:"follow",mode:"cors",signal:ne,...this.baseOverrides,...re},se=await this.fetch(this.url,ie);if(!se)throw new Error("generic-filehandle failed to fetch");if(200!==se.status)throw Object.assign(new Error(`HTTP ${se.status} fetching ${this.url}`),{status:se.status});if("utf8"===K)return se.text();if(K)throw new Error(`unsupported encoding: ${K}`);return this.getBufferFromResponse(se)}async stat(){if(!this._stat){const z=re.Buffer.allocUnsafe(10);if(await this.read(z,0,10,0),!this._stat)throw new Error(`unable to determine size of file at ${this.url}`)}return this._stat}async close(){}}function f(z){const K=new FileReader;return new Promise(((ee,te)=>{K.onerror=()=>{K.abort(),te(new Error("problem reading blob"))},K.onabort=()=>{te(new Error("blob reading was aborted"))},K.onload=()=>{K.result&&"string"!=typeof K.result?ee(K.result):te(new Error("unknown error reading blob"))},K.readAsArrayBuffer(z)}))}class h{constructor(z){this.blob=z,this.size=z.size}async read(z,K=0,ee,te=0){if(!ee)return{bytesRead:0,buffer:z};const ne=te,ie=ne+ee,se=await f(this.blob.slice(ne,ie)),oe=re.Buffer.from(se);return{bytesRead:oe.copy(z,K),buffer:oe}}async readFile(z){let K;if(K="string"==typeof z?z:z&&z.encoding,"utf8"===K)return function(z){const K=new FileReader;return new Promise(((ee,te)=>{K.onerror=()=>{K.abort(),te(new Error("problem reading blob"))},K.onabort=()=>{te(new Error("blob reading was aborted"))},K.onload=()=>{K.result&&"string"==typeof K.result?ee(K.result):te(new Error("unknown error reading blob"))},K.readAsText(z)}))}(this.blob);if(K)throw new Error(`unsupported encoding: ${K}`);const ee=await f(this.blob);return re.Buffer.from(ee)}async stat(){return{size:this.size}}async close(){}}function l(z,K={}){return new a(z,K)}function u(z,K,ee,te={}){if(void 0!==ee)return ee;if(void 0!==z)return l(z,te);if(void 0!==K)return new(ne())(K,te);throw new Error("no url, path, or filehandle provided, cannot open")}},645:(z,K)=>{K.read=function(z,K,ee,te,ne){var re,ie,se=8*ne-te-1,oe=(1<<se)-1,ae=oe>>1,le=-7,ce=ee?ne-1:0,he=ee?-1:1,ue=z[K+ce];for(ce+=he,re=ue&(1<<-le)-1,ue>>=-le,le+=se;le>0;re=256*re+z[K+ce],ce+=he,le-=8);for(ie=re&(1<<-le)-1,re>>=-le,le+=te;le>0;ie=256*ie+z[K+ce],ce+=he,le-=8);if(0===re)re=1-ae;else{if(re===oe)return ie?NaN:1/0*(ue?-1:1);ie+=Math.pow(2,te),re-=ae}return(ue?-1:1)*ie*Math.pow(2,re-te)},K.write=function(z,K,ee,te,ne,re){var ie,se,oe,ae=8*re-ne-1,le=(1<<ae)-1,ce=le>>1,he=23===ne?Math.pow(2,-24)-Math.pow(2,-77):0,ue=te?0:re-1,de=te?1:-1,fe=K<0||0===K&&1/K<0?1:0;for(K=Math.abs(K),isNaN(K)||K===1/0?(se=isNaN(K)?1:0,ie=le):(ie=Math.floor(Math.log(K)/Math.LN2),K*(oe=Math.pow(2,-ie))<1&&(ie--,oe*=2),(K+=ie+ce>=1?he/oe:he*Math.pow(2,1-ce))*oe>=2&&(ie++,oe/=2),ie+ce>=le?(se=0,ie=le):ie+ce>=1?(se=(K*oe-1)*Math.pow(2,ne),ie+=ce):(se=K*Math.pow(2,ce-1)*Math.pow(2,ne),ie=0));ne>=8;z[ee+ue]=255&se,ue+=de,se/=256,ne-=8);for(ie=ie<<ne|se,ae+=ne;ae>0;z[ee+ue]=255&ie,ue+=de,ie/=256,ae-=8);z[ee+ue-de]|=128*fe}},8738:z=>{function t(z){return!!z.constructor&&"function"==typeof z.constructor.isBuffer&&z.constructor.isBuffer(z)}z.exports=function(z){return null!=z&&(t(z)||function(z){return"function"==typeof z.readFloatLE&&"function"==typeof z.slice&&t(z.slice(0,0))}(z)||!!z._isBuffer)}},3720:z=>{z.exports=r;var K=null;try{K=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(z){}function r(z,K,ee){this.low=0|z,this.high=0|K,this.unsigned=!!ee}function n(z){return!0===(z&&z.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var ee={},te={};function s(z,K){var ne,re,ie;return K?(ie=0<=(z>>>=0)&&z<256)&&(re=te[z])?re:(ne=f(z,(0|z)<0?-1:0,!0),ie&&(te[z]=ne),ne):(ie=-128<=(z|=0)&&z<128)&&(re=ee[z])?re:(ne=f(z,z<0?-1:0,!1),ie&&(ee[z]=ne),ne)}function a(z,K){if(isNaN(z))return K?le:ae;if(K){if(z<0)return le;if(z>=ie)return fe}else{if(z<=-se)return pe;if(z+1>=se)return de}return z<0?a(-z,K).neg():f(z%re|0,z/re|0,K)}function f(z,K,ee){return new r(z,K,ee)}r.fromInt=s,r.fromNumber=a,r.fromBits=f;var ne=Math.pow;function l(z,K,ee){if(0===z.length)throw Error("empty string");if("NaN"===z||"Infinity"===z||"+Infinity"===z||"-Infinity"===z)return ae;if("number"==typeof K?(ee=K,K=!1):K=!!K,(ee=ee||10)<2||36<ee)throw RangeError("radix");var te;if((te=z.indexOf("-"))>0)throw Error("interior hyphen");if(0===te)return l(z.substring(1),K,ee).neg();for(var re=a(ne(ee,8)),ie=ae,se=0;se<z.length;se+=8){var oe=Math.min(8,z.length-se),le=parseInt(z.substring(se,se+oe),ee);if(oe<8){var ce=a(ne(ee,oe));ie=ie.mul(ce).add(a(le))}else ie=(ie=ie.mul(re)).add(a(le))}return ie.unsigned=K,ie}function u(z,K){return"number"==typeof z?a(z,K):"string"==typeof z?l(z,K):f(z.low,z.high,"boolean"==typeof K?K:z.unsigned)}r.fromString=l,r.fromValue=u;var re=4294967296,ie=re*re,se=ie/2,oe=s(1<<24),ae=s(0);r.ZERO=ae;var le=s(0,!0);r.UZERO=le;var ce=s(1);r.ONE=ce;var he=s(1,!0);r.UONE=he;var ue=s(-1);r.NEG_ONE=ue;var de=f(-1,2147483647,!1);r.MAX_VALUE=de;var fe=f(-1,-1,!0);r.MAX_UNSIGNED_VALUE=fe;var pe=f(0,-2147483648,!1);r.MIN_VALUE=pe;var ge=r.prototype;ge.toInt=function(){return this.unsigned?this.low>>>0:this.low},ge.toNumber=function(){return this.unsigned?(this.high>>>0)*re+(this.low>>>0):this.high*re+(this.low>>>0)},ge.toString=function(z){if((z=z||10)<2||36<z)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(pe)){var K=a(z),ee=this.div(K),te=ee.mul(K).sub(this);return ee.toString(z)+te.toInt().toString(z)}return"-"+this.neg().toString(z)}for(var re=a(ne(z,6),this.unsigned),ie=this,se="";;){var oe=ie.div(re),ae=(ie.sub(oe.mul(re)).toInt()>>>0).toString(z);if((ie=oe).isZero())return ae+se;for(;ae.length<6;)ae="0"+ae;se=""+ae+se}},ge.getHighBits=function(){return this.high},ge.getHighBitsUnsigned=function(){return this.high>>>0},ge.getLowBits=function(){return this.low},ge.getLowBitsUnsigned=function(){return this.low>>>0},ge.getNumBitsAbs=function(){if(this.isNegative())return this.eq(pe)?64:this.neg().getNumBitsAbs();for(var z=0!=this.high?this.high:this.low,K=31;K>0&&0==(z&1<<K);K--);return 0!=this.high?K+33:K+1},ge.isZero=function(){return 0===this.high&&0===this.low},ge.eqz=ge.isZero,ge.isNegative=function(){return!this.unsigned&&this.high<0},ge.isPositive=function(){return this.unsigned||this.high>=0},ge.isOdd=function(){return 1==(1&this.low)},ge.isEven=function(){return 0==(1&this.low)},ge.equals=function(z){return n(z)||(z=u(z)),(this.unsigned===z.unsigned||this.high>>>31!=1||z.high>>>31!=1)&&this.high===z.high&&this.low===z.low},ge.eq=ge.equals,ge.notEquals=function(z){return!this.eq(z)},ge.neq=ge.notEquals,ge.ne=ge.notEquals,ge.lessThan=function(z){return this.comp(z)<0},ge.lt=ge.lessThan,ge.lessThanOrEqual=function(z){return this.comp(z)<=0},ge.lte=ge.lessThanOrEqual,ge.le=ge.lessThanOrEqual,ge.greaterThan=function(z){return this.comp(z)>0},ge.gt=ge.greaterThan,ge.greaterThanOrEqual=function(z){return this.comp(z)>=0},ge.gte=ge.greaterThanOrEqual,ge.ge=ge.greaterThanOrEqual,ge.compare=function(z){if(n(z)||(z=u(z)),this.eq(z))return 0;var K=this.isNegative(),ee=z.isNegative();return K&&!ee?-1:!K&&ee?1:this.unsigned?z.high>>>0>this.high>>>0||z.high===this.high&&z.low>>>0>this.low>>>0?-1:1:this.sub(z).isNegative()?-1:1},ge.comp=ge.compare,ge.negate=function(){return!this.unsigned&&this.eq(pe)?pe:this.not().add(ce)},ge.neg=ge.negate,ge.add=function(z){n(z)||(z=u(z));var K=this.high>>>16,ee=65535&this.high,te=this.low>>>16,ne=65535&this.low,re=z.high>>>16,ie=65535&z.high,se=z.low>>>16,oe=0,ae=0,le=0,ce=0;return le+=(ce+=ne+(65535&z.low))>>>16,ae+=(le+=te+se)>>>16,oe+=(ae+=ee+ie)>>>16,oe+=K+re,f((le&=65535)<<16|(ce&=65535),(oe&=65535)<<16|(ae&=65535),this.unsigned)},ge.subtract=function(z){return n(z)||(z=u(z)),this.add(z.neg())},ge.sub=ge.subtract,ge.multiply=function(z){if(this.isZero())return ae;if(n(z)||(z=u(z)),K)return f(K.mul(this.low,this.high,z.low,z.high),K.get_high(),this.unsigned);if(z.isZero())return ae;if(this.eq(pe))return z.isOdd()?pe:ae;if(z.eq(pe))return this.isOdd()?pe:ae;if(this.isNegative())return z.isNegative()?this.neg().mul(z.neg()):this.neg().mul(z).neg();if(z.isNegative())return this.mul(z.neg()).neg();if(this.lt(oe)&&z.lt(oe))return a(this.toNumber()*z.toNumber(),this.unsigned);var ee=this.high>>>16,te=65535&this.high,ne=this.low>>>16,re=65535&this.low,ie=z.high>>>16,se=65535&z.high,le=z.low>>>16,ce=65535&z.low,he=0,ue=0,de=0,fe=0;return de+=(fe+=re*ce)>>>16,ue+=(de+=ne*ce)>>>16,de&=65535,ue+=(de+=re*le)>>>16,he+=(ue+=te*ce)>>>16,ue&=65535,he+=(ue+=ne*le)>>>16,ue&=65535,he+=(ue+=re*se)>>>16,he+=ee*ce+te*le+ne*se+re*ie,f((de&=65535)<<16|(fe&=65535),(he&=65535)<<16|(ue&=65535),this.unsigned)},ge.mul=ge.multiply,ge.divide=function(z){if(n(z)||(z=u(z)),z.isZero())throw Error("division by zero");var ee,te,re;if(K)return this.unsigned||-2147483648!==this.high||-1!==z.low||-1!==z.high?f((this.unsigned?K.div_u:K.div_s)(this.low,this.high,z.low,z.high),K.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?le:ae;if(this.unsigned){if(z.unsigned||(z=z.toUnsigned()),z.gt(this))return le;if(z.gt(this.shru(1)))return he;re=le}else{if(this.eq(pe))return z.eq(ce)||z.eq(ue)?pe:z.eq(pe)?ce:(ee=this.shr(1).div(z).shl(1)).eq(ae)?z.isNegative()?ce:ue:(te=this.sub(z.mul(ee)),re=ee.add(te.div(z)));if(z.eq(pe))return this.unsigned?le:ae;if(this.isNegative())return z.isNegative()?this.neg().div(z.neg()):this.neg().div(z).neg();if(z.isNegative())return this.div(z.neg()).neg();re=ae}for(te=this;te.gte(z);){ee=Math.max(1,Math.floor(te.toNumber()/z.toNumber()));for(var ie=Math.ceil(Math.log(ee)/Math.LN2),se=ie<=48?1:ne(2,ie-48),oe=a(ee),de=oe.mul(z);de.isNegative()||de.gt(te);)de=(oe=a(ee-=se,this.unsigned)).mul(z);oe.isZero()&&(oe=ce),re=re.add(oe),te=te.sub(de)}return re},ge.div=ge.divide,ge.modulo=function(z){return n(z)||(z=u(z)),K?f((this.unsigned?K.rem_u:K.rem_s)(this.low,this.high,z.low,z.high),K.get_high(),this.unsigned):this.sub(this.div(z).mul(z))},ge.mod=ge.modulo,ge.rem=ge.modulo,ge.not=function(){return f(~this.low,~this.high,this.unsigned)},ge.and=function(z){return n(z)||(z=u(z)),f(this.low&z.low,this.high&z.high,this.unsigned)},ge.or=function(z){return n(z)||(z=u(z)),f(this.low|z.low,this.high|z.high,this.unsigned)},ge.xor=function(z){return n(z)||(z=u(z)),f(this.low^z.low,this.high^z.high,this.unsigned)},ge.shiftLeft=function(z){return n(z)&&(z=z.toInt()),0==(z&=63)?this:z<32?f(this.low<<z,this.high<<z|this.low>>>32-z,this.unsigned):f(0,this.low<<z-32,this.unsigned)},ge.shl=ge.shiftLeft,ge.shiftRight=function(z){return n(z)&&(z=z.toInt()),0==(z&=63)?this:z<32?f(this.low>>>z|this.high<<32-z,this.high>>z,this.unsigned):f(this.high>>z-32,this.high>=0?0:-1,this.unsigned)},ge.shr=ge.shiftRight,ge.shiftRightUnsigned=function(z){if(n(z)&&(z=z.toInt()),0==(z&=63))return this;var K=this.high;return z<32?f(this.low>>>z|K<<32-z,K>>>z,this.unsigned):f(32===z?K:K>>>z-32,0,this.unsigned)},ge.shru=ge.shiftRightUnsigned,ge.shr_u=ge.shiftRightUnsigned,ge.toSigned=function(){return this.unsigned?f(this.low,this.high,!1):this},ge.toUnsigned=function(){return this.unsigned?this:f(this.low,this.high,!0)},ge.toBytes=function(z){return z?this.toBytesLE():this.toBytesBE()},ge.toBytesLE=function(){var z=this.high,K=this.low;return[255&K,K>>>8&255,K>>>16&255,K>>>24,255&z,z>>>8&255,z>>>16&255,z>>>24]},ge.toBytesBE=function(){var z=this.high,K=this.low;return[z>>>24,z>>>16&255,z>>>8&255,255&z,K>>>24,K>>>16&255,K>>>8&255,255&K]},r.fromBytes=function(z,K,ee){return ee?r.fromBytesLE(z,K):r.fromBytesBE(z,K)},r.fromBytesLE=function(z,K){return new r(z[0]|z[1]<<8|z[2]<<16|z[3]<<24,z[4]|z[5]<<8|z[6]<<16|z[7]<<24,K)},r.fromBytesBE=function(z,K){return new r(z[4]<<24|z[5]<<16|z[6]<<8|z[7],z[0]<<24|z[1]<<16|z[2]<<8|z[3],K)}},2568:(z,K,ee)=>{var te,ne,re,ie,se;te=ee(1012),ne=ee(487).utf8,re=ee(8738),ie=ee(487).bin,(se=function(z,K){z.constructor==String?z=K&&"binary"===K.encoding?ie.stringToBytes(z):ne.stringToBytes(z):re(z)?z=Array.prototype.slice.call(z,0):Array.isArray(z)||z.constructor===Uint8Array||(z=z.toString());for(var ee=te.bytesToWords(z),oe=8*z.length,ae=1732584193,le=-271733879,ce=-1732584194,he=271733878,ue=0;ue<ee.length;ue++)ee[ue]=16711935&(ee[ue]<<8|ee[ue]>>>24)|4278255360&(ee[ue]<<24|ee[ue]>>>8);ee[oe>>>5]|=128<<oe%32,ee[14+(oe+64>>>9<<4)]=oe;var de=se._ff,fe=se._gg,pe=se._hh,ge=se._ii;for(ue=0;ue<ee.length;ue+=16){var me=ae,be=le,ve=ce,we=he;ae=de(ae,le,ce,he,ee[ue+0],7,-680876936),he=de(he,ae,le,ce,ee[ue+1],12,-389564586),ce=de(ce,he,ae,le,ee[ue+2],17,606105819),le=de(le,ce,he,ae,ee[ue+3],22,-1044525330),ae=de(ae,le,ce,he,ee[ue+4],7,-176418897),he=de(he,ae,le,ce,ee[ue+5],12,1200080426),ce=de(ce,he,ae,le,ee[ue+6],17,-1473231341),le=de(le,ce,he,ae,ee[ue+7],22,-45705983),ae=de(ae,le,ce,he,ee[ue+8],7,1770035416),he=de(he,ae,le,ce,ee[ue+9],12,-1958414417),ce=de(ce,he,ae,le,ee[ue+10],17,-42063),le=de(le,ce,he,ae,ee[ue+11],22,-1990404162),ae=de(ae,le,ce,he,ee[ue+12],7,1804603682),he=de(he,ae,le,ce,ee[ue+13],12,-40341101),ce=de(ce,he,ae,le,ee[ue+14],17,-1502002290),ae=fe(ae,le=de(le,ce,he,ae,ee[ue+15],22,1236535329),ce,he,ee[ue+1],5,-165796510),he=fe(he,ae,le,ce,ee[ue+6],9,-1069501632),ce=fe(ce,he,ae,le,ee[ue+11],14,643717713),le=fe(le,ce,he,ae,ee[ue+0],20,-373897302),ae=fe(ae,le,ce,he,ee[ue+5],5,-701558691),he=fe(he,ae,le,ce,ee[ue+10],9,38016083),ce=fe(ce,he,ae,le,ee[ue+15],14,-660478335),le=fe(le,ce,he,ae,ee[ue+4],20,-405537848),ae=fe(ae,le,ce,he,ee[ue+9],5,568446438),he=fe(he,ae,le,ce,ee[ue+14],9,-1019803690),ce=fe(ce,he,ae,le,ee[ue+3],14,-187363961),le=fe(le,ce,he,ae,ee[ue+8],20,1163531501),ae=fe(ae,le,ce,he,ee[ue+13],5,-1444681467),he=fe(he,ae,le,ce,ee[ue+2],9,-51403784),ce=fe(ce,he,ae,le,ee[ue+7],14,1735328473),ae=pe(ae,le=fe(le,ce,he,ae,ee[ue+12],20,-1926607734),ce,he,ee[ue+5],4,-378558),he=pe(he,ae,le,ce,ee[ue+8],11,-2022574463),ce=pe(ce,he,ae,le,ee[ue+11],16,1839030562),le=pe(le,ce,he,ae,ee[ue+14],23,-35309556),ae=pe(ae,le,ce,he,ee[ue+1],4,-1530992060),he=pe(he,ae,le,ce,ee[ue+4],11,1272893353),ce=pe(ce,he,ae,le,ee[ue+7],16,-155497632),le=pe(le,ce,he,ae,ee[ue+10],23,-1094730640),ae=pe(ae,le,ce,he,ee[ue+13],4,681279174),he=pe(he,ae,le,ce,ee[ue+0],11,-358537222),ce=pe(ce,he,ae,le,ee[ue+3],16,-722521979),le=pe(le,ce,he,ae,ee[ue+6],23,76029189),ae=pe(ae,le,ce,he,ee[ue+9],4,-640364487),he=pe(he,ae,le,ce,ee[ue+12],11,-421815835),ce=pe(ce,he,ae,le,ee[ue+15],16,530742520),ae=ge(ae,le=pe(le,ce,he,ae,ee[ue+2],23,-995338651),ce,he,ee[ue+0],6,-198630844),he=ge(he,ae,le,ce,ee[ue+7],10,1126891415),ce=ge(ce,he,ae,le,ee[ue+14],15,-1416354905),le=ge(le,ce,he,ae,ee[ue+5],21,-57434055),ae=ge(ae,le,ce,he,ee[ue+12],6,1700485571),he=ge(he,ae,le,ce,ee[ue+3],10,-1894986606),ce=ge(ce,he,ae,le,ee[ue+10],15,-1051523),le=ge(le,ce,he,ae,ee[ue+1],21,-2054922799),ae=ge(ae,le,ce,he,ee[ue+8],6,1873313359),he=ge(he,ae,le,ce,ee[ue+15],10,-30611744),ce=ge(ce,he,ae,le,ee[ue+6],15,-1560198380),le=ge(le,ce,he,ae,ee[ue+13],21,1309151649),ae=ge(ae,le,ce,he,ee[ue+4],6,-145523070),he=ge(he,ae,le,ce,ee[ue+11],10,-1120210379),ce=ge(ce,he,ae,le,ee[ue+2],15,718787259),le=ge(le,ce,he,ae,ee[ue+9],21,-343485551),ae=ae+me>>>0,le=le+be>>>0,ce=ce+ve>>>0,he=he+we>>>0}return te.endian([ae,le,ce,he])})._ff=function(z,K,ee,te,ne,re,ie){var se=z+(K&ee|~K&te)+(ne>>>0)+ie;return(se<<re|se>>>32-re)+K},se._gg=function(z,K,ee,te,ne,re,ie){var se=z+(K&te|ee&~te)+(ne>>>0)+ie;return(se<<re|se>>>32-re)+K},se._hh=function(z,K,ee,te,ne,re,ie){var se=z+(K^ee^te)+(ne>>>0)+ie;return(se<<re|se>>>32-re)+K},se._ii=function(z,K,ee,te,ne,re,ie){var se=z+(ee^(K|~te))+(ne>>>0)+ie;return(se<<re|se>>>32-re)+K},se._blocksize=16,se._digestsize=16,z.exports=function(z,K){if(null==z)throw new Error("Illegal argument "+z);var ee=te.wordsToBytes(se(z,K));return K&&K.asBytes?ee:K&&K.asString?ie.bytesToString(ee):te.bytesToHex(ee)}},9591:(z,K,ee)=>{var te={};(0,ee(4236).assign)(te,ee(4555),ee(8843),ee(1619)),z.exports=te},4555:(z,K,ee)=>{var te=ee(405),ne=ee(4236),re=ee(9373),ie=ee(8898),se=ee(2292),oe=Object.prototype.toString;function h(z){if(!(this instanceof h))return new h(z);this.options=ne.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},z||{});var K=this.options;K.raw&&K.windowBits>0?K.windowBits=-K.windowBits:K.gzip&&K.windowBits>0&&K.windowBits<16&&(K.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new se,this.strm.avail_out=0;var ee=te.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(0!==ee)throw new Error(ie[ee]);if(K.header&&te.deflateSetHeader(this.strm,K.header),K.dictionary){var ae;if(ae="string"==typeof K.dictionary?re.string2buf(K.dictionary):"[object ArrayBuffer]"===oe.call(K.dictionary)?new Uint8Array(K.dictionary):K.dictionary,0!==(ee=te.deflateSetDictionary(this.strm,ae)))throw new Error(ie[ee]);this._dict_set=!0}}function l(z,K){var ee=new h(K);if(ee.push(z,!0),ee.err)throw ee.msg||ie[ee.err];return ee.result}h.prototype.push=function(z,K){var ee,ie,se=this.strm,ae=this.options.chunkSize;if(this.ended)return!1;ie=K===~~K?K:!0===K?4:0,"string"==typeof z?se.input=re.string2buf(z):"[object ArrayBuffer]"===oe.call(z)?se.input=new Uint8Array(z):se.input=z,se.next_in=0,se.avail_in=se.input.length;do{if(0===se.avail_out&&(se.output=new ne.Buf8(ae),se.next_out=0,se.avail_out=ae),1!==(ee=te.deflate(se,ie))&&0!==ee)return this.onEnd(ee),this.ended=!0,!1;0!==se.avail_out&&(0!==se.avail_in||4!==ie&&2!==ie)||("string"===this.options.to?this.onData(re.buf2binstring(ne.shrinkBuf(se.output,se.next_out))):this.onData(ne.shrinkBuf(se.output,se.next_out)))}while((se.avail_in>0||0===se.avail_out)&&1!==ee);return 4===ie?(ee=te.deflateEnd(this.strm),this.onEnd(ee),this.ended=!0,0===ee):2!==ie||(this.onEnd(0),se.avail_out=0,!0)},h.prototype.onData=function(z){this.chunks.push(z)},h.prototype.onEnd=function(z){0===z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ne.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg},K.Deflate=h,K.deflate=l,K.deflateRaw=function(z,K){return(K=K||{}).raw=!0,l(z,K)},K.gzip=function(z,K){return(K=K||{}).gzip=!0,l(z,K)}},8843:(z,K,ee)=>{var te=ee(7948),ne=ee(4236),re=ee(9373),ie=ee(1619),se=ee(8898),oe=ee(2292),ae=ee(2401),le=Object.prototype.toString;function u(z){if(!(this instanceof u))return new u(z);this.options=ne.assign({chunkSize:16384,windowBits:0,to:""},z||{});var K=this.options;K.raw&&K.windowBits>=0&&K.windowBits<16&&(K.windowBits=-K.windowBits,0===K.windowBits&&(K.windowBits=-15)),!(K.windowBits>=0&&K.windowBits<16)||z&&z.windowBits||(K.windowBits+=32),K.windowBits>15&&K.windowBits<48&&0==(15&K.windowBits)&&(K.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oe,this.strm.avail_out=0;var ee=te.inflateInit2(this.strm,K.windowBits);if(ee!==ie.Z_OK)throw new Error(se[ee]);if(this.header=new ae,te.inflateGetHeader(this.strm,this.header),K.dictionary&&("string"==typeof K.dictionary?K.dictionary=re.string2buf(K.dictionary):"[object ArrayBuffer]"===le.call(K.dictionary)&&(K.dictionary=new Uint8Array(K.dictionary)),K.raw&&(ee=te.inflateSetDictionary(this.strm,K.dictionary))!==ie.Z_OK))throw new Error(se[ee])}function c(z,K){var ee=new u(K);if(ee.push(z,!0),ee.err)throw ee.msg||se[ee.err];return ee.result}u.prototype.push=function(z,K){var ee,se,oe,ae,ce,he=this.strm,ue=this.options.chunkSize,de=this.options.dictionary,fe=!1;if(this.ended)return!1;se=K===~~K?K:!0===K?ie.Z_FINISH:ie.Z_NO_FLUSH,"string"==typeof z?he.input=re.binstring2buf(z):"[object ArrayBuffer]"===le.call(z)?he.input=new Uint8Array(z):he.input=z,he.next_in=0,he.avail_in=he.input.length;do{if(0===he.avail_out&&(he.output=new ne.Buf8(ue),he.next_out=0,he.avail_out=ue),(ee=te.inflate(he,ie.Z_NO_FLUSH))===ie.Z_NEED_DICT&&de&&(ee=te.inflateSetDictionary(this.strm,de)),ee===ie.Z_BUF_ERROR&&!0===fe&&(ee=ie.Z_OK,fe=!1),ee!==ie.Z_STREAM_END&&ee!==ie.Z_OK)return this.onEnd(ee),this.ended=!0,!1;he.next_out&&(0!==he.avail_out&&ee!==ie.Z_STREAM_END&&(0!==he.avail_in||se!==ie.Z_FINISH&&se!==ie.Z_SYNC_FLUSH)||("string"===this.options.to?(oe=re.utf8border(he.output,he.next_out),ae=he.next_out-oe,ce=re.buf2string(he.output,oe),he.next_out=ae,he.avail_out=ue-ae,ae&&ne.arraySet(he.output,he.output,oe,ae,0),this.onData(ce)):this.onData(ne.shrinkBuf(he.output,he.next_out)))),0===he.avail_in&&0===he.avail_out&&(fe=!0)}while((he.avail_in>0||0===he.avail_out)&&ee!==ie.Z_STREAM_END);return ee===ie.Z_STREAM_END&&(se=ie.Z_FINISH),se===ie.Z_FINISH?(ee=te.inflateEnd(this.strm),this.onEnd(ee),this.ended=!0,ee===ie.Z_OK):se!==ie.Z_SYNC_FLUSH||(this.onEnd(ie.Z_OK),he.avail_out=0,!0)},u.prototype.onData=function(z){this.chunks.push(z)},u.prototype.onEnd=function(z){z===ie.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ne.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg},K.Inflate=u,K.inflate=c,K.inflateRaw=function(z,K){return(K=K||{}).raw=!0,c(z,K)},K.ungzip=c},4236:(z,K)=>{var ee="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(z,K){return Object.prototype.hasOwnProperty.call(z,K)}K.assign=function(z){for(var K=Array.prototype.slice.call(arguments,1);K.length;){var ee=K.shift();if(ee){if("object"!=typeof ee)throw new TypeError(ee+"must be non-object");for(var te in ee)n(ee,te)&&(z[te]=ee[te])}}return z},K.shrinkBuf=function(z,K){return z.length===K?z:z.subarray?z.subarray(0,K):(z.length=K,z)};var te={arraySet:function(z,K,ee,te,ne){if(K.subarray&&z.subarray)z.set(K.subarray(ee,ee+te),ne);else for(var re=0;re<te;re++)z[ne+re]=K[ee+re]},flattenChunks:function(z){var K,ee,te,ne,re,ie;for(te=0,K=0,ee=z.length;K<ee;K++)te+=z[K].length;for(ie=new Uint8Array(te),ne=0,K=0,ee=z.length;K<ee;K++)re=z[K],ie.set(re,ne),ne+=re.length;return ie}},ne={arraySet:function(z,K,ee,te,ne){for(var re=0;re<te;re++)z[ne+re]=K[ee+re]},flattenChunks:function(z){return[].concat.apply([],z)}};K.setTyped=function(z){z?(K.Buf8=Uint8Array,K.Buf16=Uint16Array,K.Buf32=Int32Array,K.assign(K,te)):(K.Buf8=Array,K.Buf16=Array,K.Buf32=Array,K.assign(K,ne))},K.setTyped(ee)},9373:(z,K,ee)=>{var te=ee(4236),ne=!0,re=!0;try{String.fromCharCode.apply(null,[0])}catch(z){ne=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(z){re=!1}for(var ie=new te.Buf8(256),se=0;se<256;se++)ie[se]=se>=252?6:se>=248?5:se>=240?4:se>=224?3:se>=192?2:1;function f(z,K){if(K<65534&&(z.subarray&&re||!z.subarray&&ne))return String.fromCharCode.apply(null,te.shrinkBuf(z,K));for(var ee="",ie=0;ie<K;ie++)ee+=String.fromCharCode(z[ie]);return ee}ie[254]=ie[254]=1,K.string2buf=function(z){var K,ee,ne,re,ie,se=z.length,oe=0;for(re=0;re<se;re++)55296==(64512&(ee=z.charCodeAt(re)))&&re+1<se&&56320==(64512&(ne=z.charCodeAt(re+1)))&&(ee=65536+(ee-55296<<10)+(ne-56320),re++),oe+=ee<128?1:ee<2048?2:ee<65536?3:4;for(K=new te.Buf8(oe),ie=0,re=0;ie<oe;re++)55296==(64512&(ee=z.charCodeAt(re)))&&re+1<se&&56320==(64512&(ne=z.charCodeAt(re+1)))&&(ee=65536+(ee-55296<<10)+(ne-56320),re++),ee<128?K[ie++]=ee:ee<2048?(K[ie++]=192|ee>>>6,K[ie++]=128|63&ee):ee<65536?(K[ie++]=224|ee>>>12,K[ie++]=128|ee>>>6&63,K[ie++]=128|63&ee):(K[ie++]=240|ee>>>18,K[ie++]=128|ee>>>12&63,K[ie++]=128|ee>>>6&63,K[ie++]=128|63&ee);return K},K.buf2binstring=function(z){return f(z,z.length)},K.binstring2buf=function(z){for(var K=new te.Buf8(z.length),ee=0,ne=K.length;ee<ne;ee++)K[ee]=z.charCodeAt(ee);return K},K.buf2string=function(z,K){var ee,te,ne,re,se=K||z.length,oe=new Array(2*se);for(te=0,ee=0;ee<se;)if((ne=z[ee++])<128)oe[te++]=ne;else if((re=ie[ne])>4)oe[te++]=65533,ee+=re-1;else{for(ne&=2===re?31:3===re?15:7;re>1&&ee<se;)ne=ne<<6|63&z[ee++],re--;re>1?oe[te++]=65533:ne<65536?oe[te++]=ne:(ne-=65536,oe[te++]=55296|ne>>10&1023,oe[te++]=56320|1023&ne)}return f(oe,te)},K.utf8border=function(z,K){var ee;for((K=K||z.length)>z.length&&(K=z.length),ee=K-1;ee>=0&&128==(192&z[ee]);)ee--;return ee<0||0===ee?K:ee+ie[z[ee]]>K?ee:K}},6069:z=>{z.exports=function(z,K,ee,te){for(var ne=65535&z|0,re=z>>>16&65535|0,ie=0;0!==ee;){ee-=ie=ee>2e3?2e3:ee;do{re=re+(ne=ne+K[te++]|0)|0}while(--ie);ne%=65521,re%=65521}return ne|re<<16|0}},1619:z=>{z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},2869:z=>{var K=function(){for(var z,K=[],ee=0;ee<256;ee++){z=ee;for(var te=0;te<8;te++)z=1&z?3988292384^z>>>1:z>>>1;K[ee]=z}return K}();z.exports=function(z,ee,te,ne){var re=K,ie=ne+te;z^=-1;for(var se=ne;se<ie;se++)z=z>>>8^re[255&(z^ee[se])];return-1^z}},405:(z,K,ee)=>{var te,ne=ee(4236),re=ee(342),ie=ee(6069),se=ee(2869),oe=ee(8898),ae=-2,le=258,ce=262,he=103,ue=113,de=666;function g(z,K){return z.msg=oe[K],K}function m(z){return(z<<1)-(z>4?9:0)}function y(z){for(var K=z.length;--K>=0;)z[K]=0}function b(z){var K=z.state,ee=K.pending;ee>z.avail_out&&(ee=z.avail_out),0!==ee&&(ne.arraySet(z.output,K.pending_buf,K.pending_out,ee,z.next_out),z.next_out+=ee,K.pending_out+=ee,z.total_out+=ee,z.avail_out-=ee,K.pending-=ee,0===K.pending&&(K.pending_out=0))}function v(z,K){re._tr_flush_block(z,z.block_start>=0?z.block_start:-1,z.strstart-z.block_start,K),z.block_start=z.strstart,b(z.strm)}function w(z,K){z.pending_buf[z.pending++]=K}function _(z,K){z.pending_buf[z.pending++]=K>>>8&255,z.pending_buf[z.pending++]=255&K}function B(z,K,ee,te){var re=z.avail_in;return re>te&&(re=te),0===re?0:(z.avail_in-=re,ne.arraySet(K,z.input,z.next_in,re,ee),1===z.state.wrap?z.adler=ie(z.adler,K,re,ee):2===z.state.wrap&&(z.adler=se(z.adler,K,re,ee)),z.next_in+=re,z.total_in+=re,re)}function E(z,K){var ee,te,ne=z.max_chain_length,re=z.strstart,ie=z.prev_length,se=z.nice_match,oe=z.strstart>z.w_size-ce?z.strstart-(z.w_size-ce):0,ae=z.window,he=z.w_mask,ue=z.prev,de=z.strstart+le,fe=ae[re+ie-1],pe=ae[re+ie];z.prev_length>=z.good_match&&(ne>>=2),se>z.lookahead&&(se=z.lookahead);do{if(ae[(ee=K)+ie]===pe&&ae[ee+ie-1]===fe&&ae[ee]===ae[re]&&ae[++ee]===ae[re+1]){re+=2,ee++;do{}while(ae[++re]===ae[++ee]&&ae[++re]===ae[++ee]&&ae[++re]===ae[++ee]&&ae[++re]===ae[++ee]&&ae[++re]===ae[++ee]&&ae[++re]===ae[++ee]&&ae[++re]===ae[++ee]&&ae[++re]===ae[++ee]&&re<de);if(te=le-(de-re),re=de-le,te>ie){if(z.match_start=K,ie=te,te>=se)break;fe=ae[re+ie-1],pe=ae[re+ie]}}}while((K=ue[K&he])>oe&&0!=--ne);return ie<=z.lookahead?ie:z.lookahead}function S(z){var K,ee,te,re,ie,se=z.w_size;do{if(re=z.window_size-z.lookahead-z.strstart,z.strstart>=se+(se-ce)){ne.arraySet(z.window,z.window,se,se,0),z.match_start-=se,z.strstart-=se,z.block_start-=se,K=ee=z.hash_size;do{te=z.head[--K],z.head[K]=te>=se?te-se:0}while(--ee);K=ee=se;do{te=z.prev[--K],z.prev[K]=te>=se?te-se:0}while(--ee);re+=se}if(0===z.strm.avail_in)break;if(ee=B(z.strm,z.window,z.strstart+z.lookahead,re),z.lookahead+=ee,z.lookahead+z.insert>=3)for(ie=z.strstart-z.insert,z.ins_h=z.window[ie],z.ins_h=(z.ins_h<<z.hash_shift^z.window[ie+1])&z.hash_mask;z.insert&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[ie+3-1])&z.hash_mask,z.prev[ie&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=ie,ie++,z.insert--,!(z.lookahead+z.insert<3)););}while(z.lookahead<ce&&0!==z.strm.avail_in)}function A(z,K){for(var ee,te;;){if(z.lookahead<ce){if(S(z),z.lookahead<ce&&0===K)return 1;if(0===z.lookahead)break}if(ee=0,z.lookahead>=3&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+3-1])&z.hash_mask,ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),0!==ee&&z.strstart-ee<=z.w_size-ce&&(z.match_length=E(z,ee)),z.match_length>=3)if(te=re._tr_tally(z,z.strstart-z.match_start,z.match_length-3),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=3){z.match_length--;do{z.strstart++,z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+3-1])&z.hash_mask,ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart}while(0!=--z.match_length);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+1])&z.hash_mask;else te=re._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(te&&(v(z,!1),0===z.strm.avail_out))return 1}return z.insert=z.strstart<2?z.strstart:2,4===K?(v(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(v(z,!1),0===z.strm.avail_out)?1:2}function C(z,K){for(var ee,te,ne;;){if(z.lookahead<ce){if(S(z),z.lookahead<ce&&0===K)return 1;if(0===z.lookahead)break}if(ee=0,z.lookahead>=3&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+3-1])&z.hash_mask,ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=2,0!==ee&&z.prev_length<z.max_lazy_match&&z.strstart-ee<=z.w_size-ce&&(z.match_length=E(z,ee),z.match_length<=5&&(1===z.strategy||3===z.match_length&&z.strstart-z.match_start>4096)&&(z.match_length=2)),z.prev_length>=3&&z.match_length<=z.prev_length){ne=z.strstart+z.lookahead-3,te=re._tr_tally(z,z.strstart-1-z.prev_match,z.prev_length-3),z.lookahead-=z.prev_length-1,z.prev_length-=2;do{++z.strstart<=ne&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+3-1])&z.hash_mask,ee=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart)}while(0!=--z.prev_length);if(z.match_available=0,z.match_length=2,z.strstart++,te&&(v(z,!1),0===z.strm.avail_out))return 1}else if(z.match_available){if((te=re._tr_tally(z,0,z.window[z.strstart-1]))&&v(z,!1),z.strstart++,z.lookahead--,0===z.strm.avail_out)return 1}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(te=re._tr_tally(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<2?z.strstart:2,4===K?(v(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(v(z,!1),0===z.strm.avail_out)?1:2}function R(z,K,ee,te,ne){this.good_length=z,this.max_lazy=K,this.nice_length=ee,this.max_chain=te,this.func=ne}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ne.Buf16(1146),this.dyn_dtree=new ne.Buf16(122),this.bl_tree=new ne.Buf16(78),y(this.dyn_ltree),y(this.dyn_dtree),y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ne.Buf16(16),this.heap=new ne.Buf16(573),y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ne.Buf16(573),y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function x(z){var K;return z&&z.state?(z.total_in=z.total_out=0,z.data_type=2,(K=z.state).pending=0,K.pending_out=0,K.wrap<0&&(K.wrap=-K.wrap),K.status=K.wrap?42:ue,z.adler=2===K.wrap?0:1,K.last_flush=0,re._tr_init(K),0):g(z,ae)}function I(z){var K,ee=x(z);return 0===ee&&((K=z.state).window_size=2*K.w_size,y(K.head),K.max_lazy_match=te[K.level].max_lazy,K.good_match=te[K.level].good_length,K.nice_match=te[K.level].nice_length,K.max_chain_length=te[K.level].max_chain,K.strstart=0,K.block_start=0,K.lookahead=0,K.insert=0,K.match_length=K.prev_length=2,K.match_available=0,K.ins_h=0),ee}function M(z,K,ee,te,re,ie){if(!z)return ae;var se=1;if(-1===K&&(K=6),te<0?(se=0,te=-te):te>15&&(se=2,te-=16),re<1||re>9||8!==ee||te<8||te>15||K<0||K>9||ie<0||ie>4)return g(z,ae);8===te&&(te=9);var oe=new k;return z.state=oe,oe.strm=z,oe.wrap=se,oe.gzhead=null,oe.w_bits=te,oe.w_size=1<<oe.w_bits,oe.w_mask=oe.w_size-1,oe.hash_bits=re+7,oe.hash_size=1<<oe.hash_bits,oe.hash_mask=oe.hash_size-1,oe.hash_shift=~~((oe.hash_bits+3-1)/3),oe.window=new ne.Buf8(2*oe.w_size),oe.head=new ne.Buf16(oe.hash_size),oe.prev=new ne.Buf16(oe.w_size),oe.lit_bufsize=1<<re+6,oe.pending_buf_size=4*oe.lit_bufsize,oe.pending_buf=new ne.Buf8(oe.pending_buf_size),oe.d_buf=1*oe.lit_bufsize,oe.l_buf=3*oe.lit_bufsize,oe.level=K,oe.strategy=ie,oe.method=ee,I(z)}te=[new R(0,0,0,0,(function(z,K){var ee=65535;for(ee>z.pending_buf_size-5&&(ee=z.pending_buf_size-5);;){if(z.lookahead<=1){if(S(z),0===z.lookahead&&0===K)return 1;if(0===z.lookahead)break}z.strstart+=z.lookahead,z.lookahead=0;var te=z.block_start+ee;if((0===z.strstart||z.strstart>=te)&&(z.lookahead=z.strstart-te,z.strstart=te,v(z,!1),0===z.strm.avail_out))return 1;if(z.strstart-z.block_start>=z.w_size-ce&&(v(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,4===K?(v(z,!0),0===z.strm.avail_out?3:4):(z.strstart>z.block_start&&(v(z,!1),z.strm.avail_out),1)})),new R(4,4,8,4,A),new R(4,5,16,8,A),new R(4,6,32,32,A),new R(4,4,16,16,C),new R(8,16,32,32,C),new R(8,16,128,128,C),new R(8,32,128,256,C),new R(32,128,258,1024,C),new R(32,258,258,4096,C)],K.deflateInit=function(z,K){return M(z,K,8,15,8,0)},K.deflateInit2=M,K.deflateReset=I,K.deflateResetKeep=x,K.deflateSetHeader=function(z,K){return z&&z.state?2!==z.state.wrap?ae:(z.state.gzhead=K,0):ae},K.deflate=function(z,K){var ee,ne,ie,oe;if(!z||!z.state||K>5||K<0)return z?g(z,ae):ae;if(ne=z.state,!z.output||!z.input&&0!==z.avail_in||ne.status===de&&4!==K)return g(z,0===z.avail_out?-5:ae);if(ne.strm=z,ee=ne.last_flush,ne.last_flush=K,42===ne.status)if(2===ne.wrap)z.adler=0,w(ne,31),w(ne,139),w(ne,8),ne.gzhead?(w(ne,(ne.gzhead.text?1:0)+(ne.gzhead.hcrc?2:0)+(ne.gzhead.extra?4:0)+(ne.gzhead.name?8:0)+(ne.gzhead.comment?16:0)),w(ne,255&ne.gzhead.time),w(ne,ne.gzhead.time>>8&255),w(ne,ne.gzhead.time>>16&255),w(ne,ne.gzhead.time>>24&255),w(ne,9===ne.level?2:ne.strategy>=2||ne.level<2?4:0),w(ne,255&ne.gzhead.os),ne.gzhead.extra&&ne.gzhead.extra.length&&(w(ne,255&ne.gzhead.extra.length),w(ne,ne.gzhead.extra.length>>8&255)),ne.gzhead.hcrc&&(z.adler=se(z.adler,ne.pending_buf,ne.pending,0)),ne.gzindex=0,ne.status=69):(w(ne,0),w(ne,0),w(ne,0),w(ne,0),w(ne,0),w(ne,9===ne.level?2:ne.strategy>=2||ne.level<2?4:0),w(ne,3),ne.status=ue);else{var ce=8+(ne.w_bits-8<<4)<<8;ce|=(ne.strategy>=2||ne.level<2?0:ne.level<6?1:6===ne.level?2:3)<<6,0!==ne.strstart&&(ce|=32),ce+=31-ce%31,ne.status=ue,_(ne,ce),0!==ne.strstart&&(_(ne,z.adler>>>16),_(ne,65535&z.adler)),z.adler=1}if(69===ne.status)if(ne.gzhead.extra){for(ie=ne.pending;ne.gzindex<(65535&ne.gzhead.extra.length)&&(ne.pending!==ne.pending_buf_size||(ne.gzhead.hcrc&&ne.pending>ie&&(z.adler=se(z.adler,ne.pending_buf,ne.pending-ie,ie)),b(z),ie=ne.pending,ne.pending!==ne.pending_buf_size));)w(ne,255&ne.gzhead.extra[ne.gzindex]),ne.gzindex++;ne.gzhead.hcrc&&ne.pending>ie&&(z.adler=se(z.adler,ne.pending_buf,ne.pending-ie,ie)),ne.gzindex===ne.gzhead.extra.length&&(ne.gzindex=0,ne.status=73)}else ne.status=73;if(73===ne.status)if(ne.gzhead.name){ie=ne.pending;do{if(ne.pending===ne.pending_buf_size&&(ne.gzhead.hcrc&&ne.pending>ie&&(z.adler=se(z.adler,ne.pending_buf,ne.pending-ie,ie)),b(z),ie=ne.pending,ne.pending===ne.pending_buf_size)){oe=1;break}oe=ne.gzindex<ne.gzhead.name.length?255&ne.gzhead.name.charCodeAt(ne.gzindex++):0,w(ne,oe)}while(0!==oe);ne.gzhead.hcrc&&ne.pending>ie&&(z.adler=se(z.adler,ne.pending_buf,ne.pending-ie,ie)),0===oe&&(ne.gzindex=0,ne.status=91)}else ne.status=91;if(91===ne.status)if(ne.gzhead.comment){ie=ne.pending;do{if(ne.pending===ne.pending_buf_size&&(ne.gzhead.hcrc&&ne.pending>ie&&(z.adler=se(z.adler,ne.pending_buf,ne.pending-ie,ie)),b(z),ie=ne.pending,ne.pending===ne.pending_buf_size)){oe=1;break}oe=ne.gzindex<ne.gzhead.comment.length?255&ne.gzhead.comment.charCodeAt(ne.gzindex++):0,w(ne,oe)}while(0!==oe);ne.gzhead.hcrc&&ne.pending>ie&&(z.adler=se(z.adler,ne.pending_buf,ne.pending-ie,ie)),0===oe&&(ne.status=he)}else ne.status=he;if(ne.status===he&&(ne.gzhead.hcrc?(ne.pending+2>ne.pending_buf_size&&b(z),ne.pending+2<=ne.pending_buf_size&&(w(ne,255&z.adler),w(ne,z.adler>>8&255),z.adler=0,ne.status=ue)):ne.status=ue),0!==ne.pending){if(b(z),0===z.avail_out)return ne.last_flush=-1,0}else if(0===z.avail_in&&m(K)<=m(ee)&&4!==K)return g(z,-5);if(ne.status===de&&0!==z.avail_in)return g(z,-5);if(0!==z.avail_in||0!==ne.lookahead||0!==K&&ne.status!==de){var fe=2===ne.strategy?function(z,K){for(var ee;;){if(0===z.lookahead&&(S(z),0===z.lookahead)){if(0===K)return 1;break}if(z.match_length=0,ee=re._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,ee&&(v(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,4===K?(v(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(v(z,!1),0===z.strm.avail_out)?1:2}(ne,K):3===ne.strategy?function(z,K){for(var ee,te,ne,ie,se=z.window;;){if(z.lookahead<=le){if(S(z),z.lookahead<=le&&0===K)return 1;if(0===z.lookahead)break}if(z.match_length=0,z.lookahead>=3&&z.strstart>0&&(te=se[ne=z.strstart-1])===se[++ne]&&te===se[++ne]&&te===se[++ne]){ie=z.strstart+le;do{}while(te===se[++ne]&&te===se[++ne]&&te===se[++ne]&&te===se[++ne]&&te===se[++ne]&&te===se[++ne]&&te===se[++ne]&&te===se[++ne]&&ne<ie);z.match_length=le-(ie-ne),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=3?(ee=re._tr_tally(z,1,z.match_length-3),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(ee=re._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),ee&&(v(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,4===K?(v(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(v(z,!1),0===z.strm.avail_out)?1:2}(ne,K):te[ne.level].func(ne,K);if(3!==fe&&4!==fe||(ne.status=de),1===fe||3===fe)return 0===z.avail_out&&(ne.last_flush=-1),0;if(2===fe&&(1===K?re._tr_align(ne):5!==K&&(re._tr_stored_block(ne,0,0,!1),3===K&&(y(ne.head),0===ne.lookahead&&(ne.strstart=0,ne.block_start=0,ne.insert=0))),b(z),0===z.avail_out))return ne.last_flush=-1,0}return 4!==K?0:ne.wrap<=0?1:(2===ne.wrap?(w(ne,255&z.adler),w(ne,z.adler>>8&255),w(ne,z.adler>>16&255),w(ne,z.adler>>24&255),w(ne,255&z.total_in),w(ne,z.total_in>>8&255),w(ne,z.total_in>>16&255),w(ne,z.total_in>>24&255)):(_(ne,z.adler>>>16),_(ne,65535&z.adler)),b(z),ne.wrap>0&&(ne.wrap=-ne.wrap),0!==ne.pending?0:1)},K.deflateEnd=function(z){var K;return z&&z.state?42!==(K=z.state.status)&&69!==K&&73!==K&&91!==K&&K!==he&&K!==ue&&K!==de?g(z,ae):(z.state=null,K===ue?g(z,-3):0):ae},K.deflateSetDictionary=function(z,K){var ee,te,re,se,oe,le,ce,he,ue=K.length;if(!z||!z.state)return ae;if(2===(se=(ee=z.state).wrap)||1===se&&42!==ee.status||ee.lookahead)return ae;for(1===se&&(z.adler=ie(z.adler,K,ue,0)),ee.wrap=0,ue>=ee.w_size&&(0===se&&(y(ee.head),ee.strstart=0,ee.block_start=0,ee.insert=0),he=new ne.Buf8(ee.w_size),ne.arraySet(he,K,ue-ee.w_size,ee.w_size,0),K=he,ue=ee.w_size),oe=z.avail_in,le=z.next_in,ce=z.input,z.avail_in=ue,z.next_in=0,z.input=K,S(ee);ee.lookahead>=3;){te=ee.strstart,re=ee.lookahead-2;do{ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[te+3-1])&ee.hash_mask,ee.prev[te&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=te,te++}while(--re);ee.strstart=te,ee.lookahead=2,S(ee)}return ee.strstart+=ee.lookahead,ee.block_start=ee.strstart,ee.insert=ee.lookahead,ee.lookahead=0,ee.match_length=ee.prev_length=2,ee.match_available=0,z.next_in=le,z.input=ce,z.avail_in=oe,ee.wrap=se,0},K.deflateInfo="pako deflate (from Nodeca project)"},2401:z=>{z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},4264:z=>{z.exports=function(z,K){var ee,te,ne,re,ie,se,oe,ae,le,ce,he,ue,de,fe,pe,ge,me,be,ve,we,ye,_e,ke,xe,Ce;ee=z.state,te=z.next_in,xe=z.input,ne=te+(z.avail_in-5),re=z.next_out,Ce=z.output,ie=re-(K-z.avail_out),se=re+(z.avail_out-257),oe=ee.dmax,ae=ee.wsize,le=ee.whave,ce=ee.wnext,he=ee.window,ue=ee.hold,de=ee.bits,fe=ee.lencode,pe=ee.distcode,ge=(1<<ee.lenbits)-1,me=(1<<ee.distbits)-1;e:do{de<15&&(ue+=xe[te++]<<de,de+=8,ue+=xe[te++]<<de,de+=8),be=fe[ue&ge];t:for(;;){if(ue>>>=ve=be>>>24,de-=ve,0==(ve=be>>>16&255))Ce[re++]=65535&be;else{if(!(16&ve)){if(0==(64&ve)){be=fe[(65535&be)+(ue&(1<<ve)-1)];continue t}if(32&ve){ee.mode=12;break e}z.msg="invalid literal/length code",ee.mode=30;break e}we=65535&be,(ve&=15)&&(de<ve&&(ue+=xe[te++]<<de,de+=8),we+=ue&(1<<ve)-1,ue>>>=ve,de-=ve),de<15&&(ue+=xe[te++]<<de,de+=8,ue+=xe[te++]<<de,de+=8),be=pe[ue&me];n:for(;;){if(ue>>>=ve=be>>>24,de-=ve,!(16&(ve=be>>>16&255))){if(0==(64&ve)){be=pe[(65535&be)+(ue&(1<<ve)-1)];continue n}z.msg="invalid distance code",ee.mode=30;break e}if(ye=65535&be,de<(ve&=15)&&(ue+=xe[te++]<<de,(de+=8)<ve&&(ue+=xe[te++]<<de,de+=8)),(ye+=ue&(1<<ve)-1)>oe){z.msg="invalid distance too far back",ee.mode=30;break e}if(ue>>>=ve,de-=ve,ye>(ve=re-ie)){if((ve=ye-ve)>le&&ee.sane){z.msg="invalid distance too far back",ee.mode=30;break e}if(_e=0,ke=he,0===ce){if(_e+=ae-ve,ve<we){we-=ve;do{Ce[re++]=he[_e++]}while(--ve);_e=re-ye,ke=Ce}}else if(ce<ve){if(_e+=ae+ce-ve,(ve-=ce)<we){we-=ve;do{Ce[re++]=he[_e++]}while(--ve);if(_e=0,ce<we){we-=ve=ce;do{Ce[re++]=he[_e++]}while(--ve);_e=re-ye,ke=Ce}}}else if(_e+=ce-ve,ve<we){we-=ve;do{Ce[re++]=he[_e++]}while(--ve);_e=re-ye,ke=Ce}for(;we>2;)Ce[re++]=ke[_e++],Ce[re++]=ke[_e++],Ce[re++]=ke[_e++],we-=3;we&&(Ce[re++]=ke[_e++],we>1&&(Ce[re++]=ke[_e++]))}else{_e=re-ye;do{Ce[re++]=Ce[_e++],Ce[re++]=Ce[_e++],Ce[re++]=Ce[_e++],we-=3}while(we>2);we&&(Ce[re++]=Ce[_e++],we>1&&(Ce[re++]=Ce[_e++]))}break}}break}}while(te<ne&&re<se);te-=we=de>>3,ue&=(1<<(de-=we<<3))-1,z.next_in=te,z.next_out=re,z.avail_in=te<ne?ne-te+5:5-(te-ne),z.avail_out=re<se?se-re+257:257-(re-se),ee.hold=ue,ee.bits=de}},7948:(z,K,ee)=>{var te=ee(4236),ne=ee(6069),re=ee(2869),ie=ee(4264),se=ee(9241),oe=-2,ae=12,le=30;function u(z){return(z>>>24&255)+(z>>>8&65280)+((65280&z)<<8)+((255&z)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new te.Buf16(320),this.work=new te.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(z){var K;return z&&z.state?(K=z.state,z.total_in=z.total_out=K.total=0,z.msg="",K.wrap&&(z.adler=1&K.wrap),K.mode=1,K.last=0,K.havedict=0,K.dmax=32768,K.head=null,K.hold=0,K.bits=0,K.lencode=K.lendyn=new te.Buf32(852),K.distcode=K.distdyn=new te.Buf32(592),K.sane=1,K.back=-1,0):oe}function p(z){var K;return z&&z.state?((K=z.state).wsize=0,K.whave=0,K.wnext=0,d(z)):oe}function g(z,K){var ee,te;return z&&z.state?(te=z.state,K<0?(ee=0,K=-K):(ee=1+(K>>4),K<48&&(K&=15)),K&&(K<8||K>15)?oe:(null!==te.window&&te.wbits!==K&&(te.window=null),te.wrap=ee,te.wbits=K,p(z))):oe}function m(z,K){var ee,te;return z?(te=new c,z.state=te,te.window=null,0!==(ee=g(z,K))&&(z.state=null),ee):oe}var ce,he,ue=!0;function w(z){if(ue){var K;for(ce=new te.Buf32(512),he=new te.Buf32(32),K=0;K<144;)z.lens[K++]=8;for(;K<256;)z.lens[K++]=9;for(;K<280;)z.lens[K++]=7;for(;K<288;)z.lens[K++]=8;for(se(1,z.lens,0,288,ce,0,z.work,{bits:9}),K=0;K<32;)z.lens[K++]=5;se(2,z.lens,0,32,he,0,z.work,{bits:5}),ue=!1}z.lencode=ce,z.lenbits=9,z.distcode=he,z.distbits=5}function _(z,K,ee,ne){var re,ie=z.state;return null===ie.window&&(ie.wsize=1<<ie.wbits,ie.wnext=0,ie.whave=0,ie.window=new te.Buf8(ie.wsize)),ne>=ie.wsize?(te.arraySet(ie.window,K,ee-ie.wsize,ie.wsize,0),ie.wnext=0,ie.whave=ie.wsize):((re=ie.wsize-ie.wnext)>ne&&(re=ne),te.arraySet(ie.window,K,ee-ne,re,ie.wnext),(ne-=re)?(te.arraySet(ie.window,K,ee-ne,ne,0),ie.wnext=ne,ie.whave=ie.wsize):(ie.wnext+=re,ie.wnext===ie.wsize&&(ie.wnext=0),ie.whave<ie.wsize&&(ie.whave+=re))),0}K.inflateReset=p,K.inflateReset2=g,K.inflateResetKeep=d,K.inflateInit=function(z){return m(z,15)},K.inflateInit2=m,K.inflate=function(z,K){var ee,ce,he,ue,de,fe,pe,ge,me,be,ve,we,ye,_e,ke,xe,Ce,Se,Ae,Te,Ee,Me,Re,Ie,Fe=0,Le=new te.Buf8(4),Be=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!z||!z.state||!z.output||!z.input&&0!==z.avail_in)return oe;(ee=z.state).mode===ae&&(ee.mode=13),de=z.next_out,he=z.output,pe=z.avail_out,ue=z.next_in,ce=z.input,fe=z.avail_in,ge=ee.hold,me=ee.bits,be=fe,ve=pe,Me=0;e:for(;;)switch(ee.mode){case 1:if(0===ee.wrap){ee.mode=13;break}for(;me<16;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(2&ee.wrap&&35615===ge){ee.check=0,Le[0]=255&ge,Le[1]=ge>>>8&255,ee.check=re(ee.check,Le,2,0),ge=0,me=0,ee.mode=2;break}if(ee.flags=0,ee.head&&(ee.head.done=!1),!(1&ee.wrap)||(((255&ge)<<8)+(ge>>8))%31){z.msg="incorrect header check",ee.mode=le;break}if(8!=(15&ge)){z.msg="unknown compression method",ee.mode=le;break}if(me-=4,Ee=8+(15&(ge>>>=4)),0===ee.wbits)ee.wbits=Ee;else if(Ee>ee.wbits){z.msg="invalid window size",ee.mode=le;break}ee.dmax=1<<Ee,z.adler=ee.check=1,ee.mode=512&ge?10:ae,ge=0,me=0;break;case 2:for(;me<16;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(ee.flags=ge,8!=(255&ee.flags)){z.msg="unknown compression method",ee.mode=le;break}if(57344&ee.flags){z.msg="unknown header flags set",ee.mode=le;break}ee.head&&(ee.head.text=ge>>8&1),512&ee.flags&&(Le[0]=255&ge,Le[1]=ge>>>8&255,ee.check=re(ee.check,Le,2,0)),ge=0,me=0,ee.mode=3;case 3:for(;me<32;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ee.head&&(ee.head.time=ge),512&ee.flags&&(Le[0]=255&ge,Le[1]=ge>>>8&255,Le[2]=ge>>>16&255,Le[3]=ge>>>24&255,ee.check=re(ee.check,Le,4,0)),ge=0,me=0,ee.mode=4;case 4:for(;me<16;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ee.head&&(ee.head.xflags=255&ge,ee.head.os=ge>>8),512&ee.flags&&(Le[0]=255&ge,Le[1]=ge>>>8&255,ee.check=re(ee.check,Le,2,0)),ge=0,me=0,ee.mode=5;case 5:if(1024&ee.flags){for(;me<16;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ee.length=ge,ee.head&&(ee.head.extra_len=ge),512&ee.flags&&(Le[0]=255&ge,Le[1]=ge>>>8&255,ee.check=re(ee.check,Le,2,0)),ge=0,me=0}else ee.head&&(ee.head.extra=null);ee.mode=6;case 6:if(1024&ee.flags&&((we=ee.length)>fe&&(we=fe),we&&(ee.head&&(Ee=ee.head.extra_len-ee.length,ee.head.extra||(ee.head.extra=new Array(ee.head.extra_len)),te.arraySet(ee.head.extra,ce,ue,we,Ee)),512&ee.flags&&(ee.check=re(ee.check,ce,we,ue)),fe-=we,ue+=we,ee.length-=we),ee.length))break e;ee.length=0,ee.mode=7;case 7:if(2048&ee.flags){if(0===fe)break e;we=0;do{Ee=ce[ue+we++],ee.head&&Ee&&ee.length<65536&&(ee.head.name+=String.fromCharCode(Ee))}while(Ee&&we<fe);if(512&ee.flags&&(ee.check=re(ee.check,ce,we,ue)),fe-=we,ue+=we,Ee)break e}else ee.head&&(ee.head.name=null);ee.length=0,ee.mode=8;case 8:if(4096&ee.flags){if(0===fe)break e;we=0;do{Ee=ce[ue+we++],ee.head&&Ee&&ee.length<65536&&(ee.head.comment+=String.fromCharCode(Ee))}while(Ee&&we<fe);if(512&ee.flags&&(ee.check=re(ee.check,ce,we,ue)),fe-=we,ue+=we,Ee)break e}else ee.head&&(ee.head.comment=null);ee.mode=9;case 9:if(512&ee.flags){for(;me<16;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(ge!==(65535&ee.check)){z.msg="header crc mismatch",ee.mode=le;break}ge=0,me=0}ee.head&&(ee.head.hcrc=ee.flags>>9&1,ee.head.done=!0),z.adler=ee.check=0,ee.mode=ae;break;case 10:for(;me<32;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}z.adler=ee.check=u(ge),ge=0,me=0,ee.mode=11;case 11:if(0===ee.havedict)return z.next_out=de,z.avail_out=pe,z.next_in=ue,z.avail_in=fe,ee.hold=ge,ee.bits=me,2;z.adler=ee.check=1,ee.mode=ae;case ae:if(5===K||6===K)break e;case 13:if(ee.last){ge>>>=7&me,me-=7&me,ee.mode=27;break}for(;me<3;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}switch(ee.last=1&ge,me-=1,3&(ge>>>=1)){case 0:ee.mode=14;break;case 1:if(w(ee),ee.mode=20,6===K){ge>>>=2,me-=2;break e}break;case 2:ee.mode=17;break;case 3:z.msg="invalid block type",ee.mode=le}ge>>>=2,me-=2;break;case 14:for(ge>>>=7&me,me-=7&me;me<32;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if((65535&ge)!=(ge>>>16^65535)){z.msg="invalid stored block lengths",ee.mode=le;break}if(ee.length=65535&ge,ge=0,me=0,ee.mode=15,6===K)break e;case 15:ee.mode=16;case 16:if(we=ee.length){if(we>fe&&(we=fe),we>pe&&(we=pe),0===we)break e;te.arraySet(he,ce,ue,we,de),fe-=we,ue+=we,pe-=we,de+=we,ee.length-=we;break}ee.mode=ae;break;case 17:for(;me<14;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(ee.nlen=257+(31&ge),ge>>>=5,me-=5,ee.ndist=1+(31&ge),ge>>>=5,me-=5,ee.ncode=4+(15&ge),ge>>>=4,me-=4,ee.nlen>286||ee.ndist>30){z.msg="too many length or distance symbols",ee.mode=le;break}ee.have=0,ee.mode=18;case 18:for(;ee.have<ee.ncode;){for(;me<3;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ee.lens[Be[ee.have++]]=7&ge,ge>>>=3,me-=3}for(;ee.have<19;)ee.lens[Be[ee.have++]]=0;if(ee.lencode=ee.lendyn,ee.lenbits=7,Re={bits:ee.lenbits},Me=se(0,ee.lens,0,19,ee.lencode,0,ee.work,Re),ee.lenbits=Re.bits,Me){z.msg="invalid code lengths set",ee.mode=le;break}ee.have=0,ee.mode=19;case 19:for(;ee.have<ee.nlen+ee.ndist;){for(;xe=(Fe=ee.lencode[ge&(1<<ee.lenbits)-1])>>>16&255,Ce=65535&Fe,!((ke=Fe>>>24)<=me);){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(Ce<16)ge>>>=ke,me-=ke,ee.lens[ee.have++]=Ce;else{if(16===Ce){for(Ie=ke+2;me<Ie;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(ge>>>=ke,me-=ke,0===ee.have){z.msg="invalid bit length repeat",ee.mode=le;break}Ee=ee.lens[ee.have-1],we=3+(3&ge),ge>>>=2,me-=2}else if(17===Ce){for(Ie=ke+3;me<Ie;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}me-=ke,Ee=0,we=3+(7&(ge>>>=ke)),ge>>>=3,me-=3}else{for(Ie=ke+7;me<Ie;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}me-=ke,Ee=0,we=11+(127&(ge>>>=ke)),ge>>>=7,me-=7}if(ee.have+we>ee.nlen+ee.ndist){z.msg="invalid bit length repeat",ee.mode=le;break}for(;we--;)ee.lens[ee.have++]=Ee}}if(ee.mode===le)break;if(0===ee.lens[256]){z.msg="invalid code -- missing end-of-block",ee.mode=le;break}if(ee.lenbits=9,Re={bits:ee.lenbits},Me=se(1,ee.lens,0,ee.nlen,ee.lencode,0,ee.work,Re),ee.lenbits=Re.bits,Me){z.msg="invalid literal/lengths set",ee.mode=le;break}if(ee.distbits=6,ee.distcode=ee.distdyn,Re={bits:ee.distbits},Me=se(2,ee.lens,ee.nlen,ee.ndist,ee.distcode,0,ee.work,Re),ee.distbits=Re.bits,Me){z.msg="invalid distances set",ee.mode=le;break}if(ee.mode=20,6===K)break e;case 20:ee.mode=21;case 21:if(fe>=6&&pe>=258){z.next_out=de,z.avail_out=pe,z.next_in=ue,z.avail_in=fe,ee.hold=ge,ee.bits=me,ie(z,ve),de=z.next_out,he=z.output,pe=z.avail_out,ue=z.next_in,ce=z.input,fe=z.avail_in,ge=ee.hold,me=ee.bits,ee.mode===ae&&(ee.back=-1);break}for(ee.back=0;xe=(Fe=ee.lencode[ge&(1<<ee.lenbits)-1])>>>16&255,Ce=65535&Fe,!((ke=Fe>>>24)<=me);){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(xe&&0==(240&xe)){for(Se=ke,Ae=xe,Te=Ce;xe=(Fe=ee.lencode[Te+((ge&(1<<Se+Ae)-1)>>Se)])>>>16&255,Ce=65535&Fe,!(Se+(ke=Fe>>>24)<=me);){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ge>>>=Se,me-=Se,ee.back+=Se}if(ge>>>=ke,me-=ke,ee.back+=ke,ee.length=Ce,0===xe){ee.mode=26;break}if(32&xe){ee.back=-1,ee.mode=ae;break}if(64&xe){z.msg="invalid literal/length code",ee.mode=le;break}ee.extra=15&xe,ee.mode=22;case 22:if(ee.extra){for(Ie=ee.extra;me<Ie;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ee.length+=ge&(1<<ee.extra)-1,ge>>>=ee.extra,me-=ee.extra,ee.back+=ee.extra}ee.was=ee.length,ee.mode=23;case 23:for(;xe=(Fe=ee.distcode[ge&(1<<ee.distbits)-1])>>>16&255,Ce=65535&Fe,!((ke=Fe>>>24)<=me);){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(0==(240&xe)){for(Se=ke,Ae=xe,Te=Ce;xe=(Fe=ee.distcode[Te+((ge&(1<<Se+Ae)-1)>>Se)])>>>16&255,Ce=65535&Fe,!(Se+(ke=Fe>>>24)<=me);){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ge>>>=Se,me-=Se,ee.back+=Se}if(ge>>>=ke,me-=ke,ee.back+=ke,64&xe){z.msg="invalid distance code",ee.mode=le;break}ee.offset=Ce,ee.extra=15&xe,ee.mode=24;case 24:if(ee.extra){for(Ie=ee.extra;me<Ie;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}ee.offset+=ge&(1<<ee.extra)-1,ge>>>=ee.extra,me-=ee.extra,ee.back+=ee.extra}if(ee.offset>ee.dmax){z.msg="invalid distance too far back",ee.mode=le;break}ee.mode=25;case 25:if(0===pe)break e;if(we=ve-pe,ee.offset>we){if((we=ee.offset-we)>ee.whave&&ee.sane){z.msg="invalid distance too far back",ee.mode=le;break}we>ee.wnext?(we-=ee.wnext,ye=ee.wsize-we):ye=ee.wnext-we,we>ee.length&&(we=ee.length),_e=ee.window}else _e=he,ye=de-ee.offset,we=ee.length;we>pe&&(we=pe),pe-=we,ee.length-=we;do{he[de++]=_e[ye++]}while(--we);0===ee.length&&(ee.mode=21);break;case 26:if(0===pe)break e;he[de++]=ee.length,pe--,ee.mode=21;break;case 27:if(ee.wrap){for(;me<32;){if(0===fe)break e;fe--,ge|=ce[ue++]<<me,me+=8}if(ve-=pe,z.total_out+=ve,ee.total+=ve,ve&&(z.adler=ee.check=ee.flags?re(ee.check,he,ve,de-ve):ne(ee.check,he,ve,de-ve)),ve=pe,(ee.flags?ge:u(ge))!==ee.check){z.msg="incorrect data check",ee.mode=le;break}ge=0,me=0}ee.mode=28;case 28:if(ee.wrap&&ee.flags){for(;me<32;){if(0===fe)break e;fe--,ge+=ce[ue++]<<me,me+=8}if(ge!==(4294967295&ee.total)){z.msg="incorrect length check",ee.mode=le;break}ge=0,me=0}ee.mode=29;case 29:Me=1;break e;case le:Me=-3;break e;case 31:return-4;default:return oe}return z.next_out=de,z.avail_out=pe,z.next_in=ue,z.avail_in=fe,ee.hold=ge,ee.bits=me,(ee.wsize||ve!==z.avail_out&&ee.mode<le&&(ee.mode<27||4!==K))&&_(z,z.output,z.next_out,ve-z.avail_out)?(ee.mode=31,-4):(be-=z.avail_in,ve-=z.avail_out,z.total_in+=be,z.total_out+=ve,ee.total+=ve,ee.wrap&&ve&&(z.adler=ee.check=ee.flags?re(ee.check,he,ve,z.next_out-ve):ne(ee.check,he,ve,z.next_out-ve)),z.data_type=ee.bits+(ee.last?64:0)+(ee.mode===ae?128:0)+(20===ee.mode||15===ee.mode?256:0),(0===be&&0===ve||4===K)&&0===Me&&(Me=-5),Me)},K.inflateEnd=function(z){if(!z||!z.state)return oe;var K=z.state;return K.window&&(K.window=null),z.state=null,0},K.inflateGetHeader=function(z,K){var ee;return z&&z.state?0==(2&(ee=z.state).wrap)?oe:(ee.head=K,K.done=!1,0):oe},K.inflateSetDictionary=function(z,K){var ee,te=K.length;return z&&z.state?0!==(ee=z.state).wrap&&11!==ee.mode?oe:11===ee.mode&&ne(1,K,te,0)!==ee.check?-3:_(z,K,te,te)?(ee.mode=31,-4):(ee.havedict=1,0):oe},K.inflateInfo="pako inflate (from Nodeca project)"},9241:(z,K,ee)=>{var te=ee(4236),ne=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],re=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],ie=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],se=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];z.exports=function(z,K,ee,oe,ae,le,ce,he){var ue,de,fe,pe,ge,me,be,ve,we,ye=he.bits,_e=0,ke=0,xe=0,Ce=0,Se=0,Ae=0,Te=0,Ee=0,Me=0,Re=0,Ie=null,Fe=0,Le=new te.Buf16(16),Be=new te.Buf16(16),Ne=null,De=0;for(_e=0;_e<=15;_e++)Le[_e]=0;for(ke=0;ke<oe;ke++)Le[K[ee+ke]]++;for(Se=ye,Ce=15;Ce>=1&&0===Le[Ce];Ce--);if(Se>Ce&&(Se=Ce),0===Ce)return ae[le++]=20971520,ae[le++]=20971520,he.bits=1,0;for(xe=1;xe<Ce&&0===Le[xe];xe++);for(Se<xe&&(Se=xe),Ee=1,_e=1;_e<=15;_e++)if(Ee<<=1,(Ee-=Le[_e])<0)return-1;if(Ee>0&&(0===z||1!==Ce))return-1;for(Be[1]=0,_e=1;_e<15;_e++)Be[_e+1]=Be[_e]+Le[_e];for(ke=0;ke<oe;ke++)0!==K[ee+ke]&&(ce[Be[K[ee+ke]]++]=ke);if(0===z?(Ie=Ne=ce,me=19):1===z?(Ie=ne,Fe-=257,Ne=re,De-=257,me=256):(Ie=ie,Ne=se,me=-1),Re=0,ke=0,_e=xe,ge=le,Ae=Se,Te=0,fe=-1,pe=(Me=1<<Se)-1,1===z&&Me>852||2===z&&Me>592)return 1;for(;;){be=_e-Te,ce[ke]<me?(ve=0,we=ce[ke]):ce[ke]>me?(ve=Ne[De+ce[ke]],we=Ie[Fe+ce[ke]]):(ve=96,we=0),ue=1<<_e-Te,xe=de=1<<Ae;do{ae[ge+(Re>>Te)+(de-=ue)]=be<<24|ve<<16|we|0}while(0!==de);for(ue=1<<_e-1;Re&ue;)ue>>=1;if(0!==ue?(Re&=ue-1,Re+=ue):Re=0,ke++,0==--Le[_e]){if(_e===Ce)break;_e=K[ee+ce[ke]]}if(_e>Se&&(Re&pe)!==fe){for(0===Te&&(Te=Se),ge+=xe,Ee=1<<(Ae=_e-Te);Ae+Te<Ce&&!((Ee-=Le[Ae+Te])<=0);)Ae++,Ee<<=1;if(Me+=1<<Ae,1===z&&Me>852||2===z&&Me>592)return 1;ae[fe=Re&pe]=Se<<24|Ae<<16|ge-le|0}}return 0!==Re&&(ae[ge+Re]=_e-Te<<24|64<<16|0),he.bits=Se,0}},8898:z=>{z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},342:(z,K,ee)=>{var te=ee(4236);function i(z){for(var K=z.length;--K>=0;)z[K]=0}var ne=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],re=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ie=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],oe=new Array(576);i(oe);var ae=new Array(60);i(ae);var le=new Array(512);i(le);var ce=new Array(256);i(ce);var he=new Array(29);i(he);var ue,de,fe,pe=new Array(30);function b(z,K,ee,te,ne){this.static_tree=z,this.extra_bits=K,this.extra_base=ee,this.elems=te,this.max_length=ne,this.has_stree=z&&z.length}function v(z,K){this.dyn_tree=z,this.max_code=0,this.stat_desc=K}function w(z){return z<256?le[z]:le[256+(z>>>7)]}function _(z,K){z.pending_buf[z.pending++]=255&K,z.pending_buf[z.pending++]=K>>>8&255}function B(z,K,ee){z.bi_valid>16-ee?(z.bi_buf|=K<<z.bi_valid&65535,_(z,z.bi_buf),z.bi_buf=K>>16-z.bi_valid,z.bi_valid+=ee-16):(z.bi_buf|=K<<z.bi_valid&65535,z.bi_valid+=ee)}function E(z,K,ee){B(z,ee[2*K],ee[2*K+1])}function S(z,K){var ee=0;do{ee|=1&z,z>>>=1,ee<<=1}while(--K>0);return ee>>>1}function A(z,K,ee){var te,ne,re=new Array(16),ie=0;for(te=1;te<=15;te++)re[te]=ie=ie+ee[te-1]<<1;for(ne=0;ne<=K;ne++){var se=z[2*ne+1];0!==se&&(z[2*ne]=S(re[se]++,se))}}function C(z){var K;for(K=0;K<286;K++)z.dyn_ltree[2*K]=0;for(K=0;K<30;K++)z.dyn_dtree[2*K]=0;for(K=0;K<19;K++)z.bl_tree[2*K]=0;z.dyn_ltree[512]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0}function R(z){z.bi_valid>8?_(z,z.bi_buf):z.bi_valid>0&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0}function k(z,K,ee,te){var ne=2*K,re=2*ee;return z[ne]<z[re]||z[ne]===z[re]&&te[K]<=te[ee]}function x(z,K,ee){for(var te=z.heap[ee],ne=ee<<1;ne<=z.heap_len&&(ne<z.heap_len&&k(K,z.heap[ne+1],z.heap[ne],z.depth)&&ne++,!k(K,te,z.heap[ne],z.depth));)z.heap[ee]=z.heap[ne],ee=ne,ne<<=1;z.heap[ee]=te}function I(z,K,ee){var te,ie,se,oe,ae=0;if(0!==z.last_lit)do{te=z.pending_buf[z.d_buf+2*ae]<<8|z.pending_buf[z.d_buf+2*ae+1],ie=z.pending_buf[z.l_buf+ae],ae++,0===te?E(z,ie,K):(E(z,(se=ce[ie])+256+1,K),0!==(oe=ne[se])&&B(z,ie-=he[se],oe),E(z,se=w(--te),ee),0!==(oe=re[se])&&B(z,te-=pe[se],oe))}while(ae<z.last_lit);E(z,256,K)}function M(z,K){var ee,te,ne,re=K.dyn_tree,ie=K.stat_desc.static_tree,se=K.stat_desc.has_stree,oe=K.stat_desc.elems,ae=-1;for(z.heap_len=0,z.heap_max=573,ee=0;ee<oe;ee++)0!==re[2*ee]?(z.heap[++z.heap_len]=ae=ee,z.depth[ee]=0):re[2*ee+1]=0;for(;z.heap_len<2;)re[2*(ne=z.heap[++z.heap_len]=ae<2?++ae:0)]=1,z.depth[ne]=0,z.opt_len--,se&&(z.static_len-=ie[2*ne+1]);for(K.max_code=ae,ee=z.heap_len>>1;ee>=1;ee--)x(z,re,ee);ne=oe;do{ee=z.heap[1],z.heap[1]=z.heap[z.heap_len--],x(z,re,1),te=z.heap[1],z.heap[--z.heap_max]=ee,z.heap[--z.heap_max]=te,re[2*ne]=re[2*ee]+re[2*te],z.depth[ne]=(z.depth[ee]>=z.depth[te]?z.depth[ee]:z.depth[te])+1,re[2*ee+1]=re[2*te+1]=ne,z.heap[1]=ne++,x(z,re,1)}while(z.heap_len>=2);z.heap[--z.heap_max]=z.heap[1],function(z,K){var ee,te,ne,re,ie,se,oe=K.dyn_tree,ae=K.max_code,le=K.stat_desc.static_tree,ce=K.stat_desc.has_stree,he=K.stat_desc.extra_bits,ue=K.stat_desc.extra_base,de=K.stat_desc.max_length,fe=0;for(re=0;re<=15;re++)z.bl_count[re]=0;for(oe[2*z.heap[z.heap_max]+1]=0,ee=z.heap_max+1;ee<573;ee++)(re=oe[2*oe[2*(te=z.heap[ee])+1]+1]+1)>de&&(re=de,fe++),oe[2*te+1]=re,te>ae||(z.bl_count[re]++,ie=0,te>=ue&&(ie=he[te-ue]),se=oe[2*te],z.opt_len+=se*(re+ie),ce&&(z.static_len+=se*(le[2*te+1]+ie)));if(0!==fe){do{for(re=de-1;0===z.bl_count[re];)re--;z.bl_count[re]--,z.bl_count[re+1]+=2,z.bl_count[de]--,fe-=2}while(fe>0);for(re=de;0!==re;re--)for(te=z.bl_count[re];0!==te;)(ne=z.heap[--ee])>ae||(oe[2*ne+1]!==re&&(z.opt_len+=(re-oe[2*ne+1])*oe[2*ne],oe[2*ne+1]=re),te--)}}(z,K),A(re,ae,z.bl_count)}function F(z,K,ee){var te,ne,re=-1,ie=K[1],se=0,oe=7,ae=4;for(0===ie&&(oe=138,ae=3),K[2*(ee+1)+1]=65535,te=0;te<=ee;te++)ne=ie,ie=K[2*(te+1)+1],++se<oe&&ne===ie||(se<ae?z.bl_tree[2*ne]+=se:0!==ne?(ne!==re&&z.bl_tree[2*ne]++,z.bl_tree[32]++):se<=10?z.bl_tree[34]++:z.bl_tree[36]++,se=0,re=ne,0===ie?(oe=138,ae=3):ne===ie?(oe=6,ae=3):(oe=7,ae=4))}function O(z,K,ee){var te,ne,re=-1,ie=K[1],se=0,oe=7,ae=4;for(0===ie&&(oe=138,ae=3),te=0;te<=ee;te++)if(ne=ie,ie=K[2*(te+1)+1],!(++se<oe&&ne===ie)){if(se<ae)do{E(z,ne,z.bl_tree)}while(0!=--se);else 0!==ne?(ne!==re&&(E(z,ne,z.bl_tree),se--),E(z,16,z.bl_tree),B(z,se-3,2)):se<=10?(E(z,17,z.bl_tree),B(z,se-3,3)):(E(z,18,z.bl_tree),B(z,se-11,7));se=0,re=ne,0===ie?(oe=138,ae=3):ne===ie?(oe=6,ae=3):(oe=7,ae=4)}}i(pe);var ge=!1;function U(z,K,ee,ne){B(z,0+(ne?1:0),3),function(z,K,ee,ne){R(z),_(z,ee),_(z,~ee),te.arraySet(z.pending_buf,z.window,K,ee,z.pending),z.pending+=ee}(z,K,ee)}K._tr_init=function(z){ge||(function(){var z,K,ee,te,se,ge=new Array(16);for(ee=0,te=0;te<28;te++)for(he[te]=ee,z=0;z<1<<ne[te];z++)ce[ee++]=te;for(ce[ee-1]=te,se=0,te=0;te<16;te++)for(pe[te]=se,z=0;z<1<<re[te];z++)le[se++]=te;for(se>>=7;te<30;te++)for(pe[te]=se<<7,z=0;z<1<<re[te]-7;z++)le[256+se++]=te;for(K=0;K<=15;K++)ge[K]=0;for(z=0;z<=143;)oe[2*z+1]=8,z++,ge[8]++;for(;z<=255;)oe[2*z+1]=9,z++,ge[9]++;for(;z<=279;)oe[2*z+1]=7,z++,ge[7]++;for(;z<=287;)oe[2*z+1]=8,z++,ge[8]++;for(A(oe,287,ge),z=0;z<30;z++)ae[2*z+1]=5,ae[2*z]=S(z,5);ue=new b(oe,ne,257,286,15),de=new b(ae,re,0,30,15),fe=new b(new Array(0),ie,0,19,7)}(),ge=!0),z.l_desc=new v(z.dyn_ltree,ue),z.d_desc=new v(z.dyn_dtree,de),z.bl_desc=new v(z.bl_tree,fe),z.bi_buf=0,z.bi_valid=0,C(z)},K._tr_stored_block=U,K._tr_flush_block=function(z,K,ee,te){var ne,re,ie=0;z.level>0?(2===z.strm.data_type&&(z.strm.data_type=function(z){var K,ee=4093624447;for(K=0;K<=31;K++,ee>>>=1)if(1&ee&&0!==z.dyn_ltree[2*K])return 0;if(0!==z.dyn_ltree[18]||0!==z.dyn_ltree[20]||0!==z.dyn_ltree[26])return 1;for(K=32;K<256;K++)if(0!==z.dyn_ltree[2*K])return 1;return 0}(z)),M(z,z.l_desc),M(z,z.d_desc),ie=function(z){var K;for(F(z,z.dyn_ltree,z.l_desc.max_code),F(z,z.dyn_dtree,z.d_desc.max_code),M(z,z.bl_desc),K=18;K>=3&&0===z.bl_tree[2*se[K]+1];K--);return z.opt_len+=3*(K+1)+5+5+4,K}(z),ne=z.opt_len+3+7>>>3,(re=z.static_len+3+7>>>3)<=ne&&(ne=re)):ne=re=ee+5,ee+4<=ne&&-1!==K?U(z,K,ee,te):4===z.strategy||re===ne?(B(z,2+(te?1:0),3),I(z,oe,ae)):(B(z,4+(te?1:0),3),function(z,K,ee,te){var ne;for(B(z,K-257,5),B(z,ee-1,5),B(z,te-4,4),ne=0;ne<te;ne++)B(z,z.bl_tree[2*se[ne]+1],3);O(z,z.dyn_ltree,K-1),O(z,z.dyn_dtree,ee-1)}(z,z.l_desc.max_code+1,z.d_desc.max_code+1,ie+1),I(z,z.dyn_ltree,z.dyn_dtree)),C(z),te&&R(z)},K._tr_tally=function(z,K,ee){return z.pending_buf[z.d_buf+2*z.last_lit]=K>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&K,z.pending_buf[z.l_buf+z.last_lit]=255&ee,z.last_lit++,0===K?z.dyn_ltree[2*ee]++:(z.matches++,K--,z.dyn_ltree[2*(ce[ee]+256+1)]++,z.dyn_dtree[2*w(K)]++),z.last_lit===z.lit_bufsize-1},K._tr_align=function(z){B(z,2,3),E(z,256,oe),function(z){16===z.bi_valid?(_(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):z.bi_valid>=8&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)}(z)}},2292:z=>{z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},2587:z=>{function t(z,K){return Object.prototype.hasOwnProperty.call(z,K)}z.exports=function(z,K,ee,te){K=K||"&",ee=ee||"=";var ne={};if("string"!=typeof z||0===z.length)return ne;var re=/\+/g;z=z.split(K);var ie=1e3;te&&"number"==typeof te.maxKeys&&(ie=te.maxKeys);var se=z.length;ie>0&&se>ie&&(se=ie);for(var oe=0;oe<se;++oe){var ae,le,ce,he,ue=z[oe].replace(re,"%20"),de=ue.indexOf(ee);de>=0?(ae=ue.substr(0,de),le=ue.substr(de+1)):(ae=ue,le=""),ce=decodeURIComponent(ae),he=decodeURIComponent(le),t(ne,ce)?Array.isArray(ne[ce])?ne[ce].push(he):ne[ce]=[ne[ce],he]:ne[ce]=he}return ne}},2361:z=>{var t=function(z){switch(typeof z){case"string":return z;case"boolean":return z?"true":"false";case"number":return isFinite(z)?z:"";default:return""}};z.exports=function(z,K,ee,te){return K=K||"&",ee=ee||"=",null===z&&(z=void 0),"object"==typeof z?Object.keys(z).map((function(te){var ne=encodeURIComponent(t(te))+ee;return Array.isArray(z[te])?z[te].map((function(z){return ne+encodeURIComponent(t(z))})).join(K):ne+encodeURIComponent(t(z[te]))})).join(K):te?encodeURIComponent(t(te))+ee+encodeURIComponent(t(z)):""}},7673:(z,K,ee)=>{K.decode=K.parse=ee(2587),K.encode=K.stringify=ee(2361)},1269:z=>{class t{constructor(z={}){if(!(z.maxSize&&z.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=z.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(z,K){this.cache.set(z,K),this._size++,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}get(z){if(this.cache.has(z))return this.cache.get(z);if(this.oldCache.has(z)){const K=this.oldCache.get(z);return this.oldCache.delete(z),this._set(z,K),K}}set(z,K){return this.cache.has(z)?this.cache.set(z,K):this._set(z,K),this}has(z){return this.cache.has(z)||this.oldCache.has(z)}peek(z){return this.cache.has(z)?this.cache.get(z):this.oldCache.has(z)?this.oldCache.get(z):void 0}delete(z){const K=this.cache.delete(z);return K&&this._size--,this.oldCache.delete(z)||K}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const[z]of this)yield z}*values(){for(const[,z]of this)yield z}*[Symbol.iterator](){for(const z of this.cache)yield z;for(const z of this.oldCache){const[K]=z;this.cache.has(K)||(yield z)}}get size(){let z=0;for(const K of this.oldCache.keys())this.cache.has(K)||z++;return this._size+z}}z.exports=t},2511:function(z,K,ee){var te;z=ee.nmd(z),function(ne){K&&K.nodeType,z&&z.nodeType;var re="object"==typeof ee.g&&ee.g;re.global!==re&&re.window!==re&&re.self;var ie,se=2147483647,oe=36,ae=/^xn--/,le=/[^\x20-\x7E]/,ce=/[\x2E\u3002\uFF0E\uFF61]/g,he={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ue=Math.floor,de=String.fromCharCode;function g(z){throw RangeError(he[z])}function m(z,K){for(var ee=z.length,te=[];ee--;)te[ee]=K(z[ee]);return te}function y(z,K){var ee=z.split("@"),te="";return ee.length>1&&(te=ee[0]+"@",z=ee[1]),te+m((z=z.replace(ce,".")).split("."),K).join(".")}function b(z){for(var K,ee,te=[],ne=0,re=z.length;ne<re;)(K=z.charCodeAt(ne++))>=55296&&K<=56319&&ne<re?56320==(64512&(ee=z.charCodeAt(ne++)))?te.push(((1023&K)<<10)+(1023&ee)+65536):(te.push(K),ne--):te.push(K);return te}function v(z){return m(z,(function(z){var K="";return z>65535&&(K+=de((z-=65536)>>>10&1023|55296),z=56320|1023&z),K+de(z)})).join("")}function w(z,K){return z+22+75*(z<26)-((0!=K)<<5)}function _(z,K,ee){var te=0;for(z=ee?ue(z/700):z>>1,z+=ue(z/K);z>455;te+=oe)z=ue(z/35);return ue(te+36*z/(z+38))}function B(z){var K,ee,te,ne,re,ie,ae,le,ce,he,de,fe=[],pe=z.length,ge=0,me=128,be=72;for((ee=z.lastIndexOf("-"))<0&&(ee=0),te=0;te<ee;++te)z.charCodeAt(te)>=128&&g("not-basic"),fe.push(z.charCodeAt(te));for(ne=ee>0?ee+1:0;ne<pe;){for(re=ge,ie=1,ae=oe;ne>=pe&&g("invalid-input"),((le=(de=z.charCodeAt(ne++))-48<10?de-22:de-65<26?de-65:de-97<26?de-97:oe)>=oe||le>ue((se-ge)/ie))&&g("overflow"),ge+=le*ie,!(le<(ce=ae<=be?1:ae>=be+26?26:ae-be));ae+=oe)ie>ue(se/(he=oe-ce))&&g("overflow"),ie*=he;be=_(ge-re,K=fe.length+1,0==re),ue(ge/K)>se-me&&g("overflow"),me+=ue(ge/K),ge%=K,fe.splice(ge++,0,me)}return v(fe)}function E(z){var K,ee,te,ne,re,ie,ae,le,ce,he,fe,pe,ge,me,be,ve=[];for(pe=(z=b(z)).length,K=128,ee=0,re=72,ie=0;ie<pe;++ie)(fe=z[ie])<128&&ve.push(de(fe));for(te=ne=ve.length,ne&&ve.push("-");te<pe;){for(ae=se,ie=0;ie<pe;++ie)(fe=z[ie])>=K&&fe<ae&&(ae=fe);for(ae-K>ue((se-ee)/(ge=te+1))&&g("overflow"),ee+=(ae-K)*ge,K=ae,ie=0;ie<pe;++ie)if((fe=z[ie])<K&&++ee>se&&g("overflow"),fe==K){for(le=ee,ce=oe;!(le<(he=ce<=re?1:ce>=re+26?26:ce-re));ce+=oe)be=le-he,me=oe-he,ve.push(de(w(he+be%me,0))),le=ue(be/me);ve.push(de(w(le,0))),re=_(ee,ge,te==ne),ee=0,++te}++ee,++K}return ve.join("")}ie={version:"1.3.2",ucs2:{decode:b,encode:v},decode:B,encode:E,toASCII:function(z){return y(z,(function(z){return le.test(z)?"xn--"+E(z):z}))},toUnicode:function(z){return y(z,(function(z){return ae.test(z)?B(z.slice(4).toLowerCase()):z}))}},void 0===(te=function(){return ie}.call(K,ee,K,z))||(z.exports=te)}()},8575:(z,K,ee)=>{var te=ee(2511),ne=ee(2502);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}K.parse=v,K.resolve=function(z,K){return v(z,!1,!0).resolve(K)},K.resolveObject=function(z,K){return z?v(z,!1,!0).resolveObject(K):K},K.format=function(z){return ne.isString(z)&&(z=v(z)),z instanceof o?z.format():o.prototype.format.call(z)},K.Url=o;var re=/^([a-z0-9.+-]+:)/i,ie=/:[0-9]*$/,se=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,oe=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),ae=["'"].concat(oe),le=["%","/","?",";","#"].concat(ae),ce=["/","?","#"],he=/^[+a-z0-9A-Z_-]{0,63}$/,ue=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,de={javascript:!0,"javascript:":!0},fe={javascript:!0,"javascript:":!0},pe={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},ge=ee(7673);function v(z,K,ee){if(z&&ne.isObject(z)&&z instanceof o)return z;var te=new o;return te.parse(z,K,ee),te}o.prototype.parse=function(z,K,ee){if(!ne.isString(z))throw new TypeError("Parameter 'url' must be a string, not "+typeof z);var ie=z.indexOf("?"),oe=-1!==ie&&ie<z.indexOf("#")?"?":"#",me=z.split(oe);me[0]=me[0].replace(/\\/g,"/");var be=z=me.join(oe);if(be=be.trim(),!ee&&1===z.split("#").length){var ve=se.exec(be);if(ve)return this.path=be,this.href=be,this.pathname=ve[1],ve[2]?(this.search=ve[2],this.query=K?ge.parse(this.search.substr(1)):this.search.substr(1)):K&&(this.search="",this.query={}),this}var we=re.exec(be);if(we){var ye=(we=we[0]).toLowerCase();this.protocol=ye,be=be.substr(we.length)}if(ee||we||be.match(/^\/\/[^@\/]+@[^@\/]+/)){var _e="//"===be.substr(0,2);!_e||we&&fe[we]||(be=be.substr(2),this.slashes=!0)}if(!fe[we]&&(_e||we&&!pe[we])){for(var ke,xe,Ce=-1,Se=0;Se<ce.length;Se++)-1!==(Ae=be.indexOf(ce[Se]))&&(-1===Ce||Ae<Ce)&&(Ce=Ae);for(-1!==(xe=-1===Ce?be.lastIndexOf("@"):be.lastIndexOf("@",Ce))&&(ke=be.slice(0,xe),be=be.slice(xe+1),this.auth=decodeURIComponent(ke)),Ce=-1,Se=0;Se<le.length;Se++){var Ae;-1!==(Ae=be.indexOf(le[Se]))&&(-1===Ce||Ae<Ce)&&(Ce=Ae)}-1===Ce&&(Ce=be.length),this.host=be.slice(0,Ce),be=be.slice(Ce),this.parseHost(),this.hostname=this.hostname||"";var Te="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!Te)for(var Ee=this.hostname.split(/\./),Me=(Se=0,Ee.length);Se<Me;Se++){var Re=Ee[Se];if(Re&&!Re.match(he)){for(var Ie="",Fe=0,Le=Re.length;Fe<Le;Fe++)Re.charCodeAt(Fe)>127?Ie+="x":Ie+=Re[Fe];if(!Ie.match(he)){var Be=Ee.slice(0,Se),Ne=Ee.slice(Se+1),De=Re.match(ue);De&&(Be.push(De[1]),Ne.unshift(De[2])),Ne.length&&(be="/"+Ne.join(".")+be),this.hostname=Be.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),Te||(this.hostname=te.toASCII(this.hostname));var Pe=this.port?":"+this.port:"",Oe=this.hostname||"";this.host=Oe+Pe,this.href+=this.host,Te&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==be[0]&&(be="/"+be))}if(!de[ye])for(Se=0,Me=ae.length;Se<Me;Se++){var ze=ae[Se];if(-1!==be.indexOf(ze)){var He=encodeURIComponent(ze);He===ze&&(He=escape(ze)),be=be.split(ze).join(He)}}var Ue=be.indexOf("#");-1!==Ue&&(this.hash=be.substr(Ue),be=be.slice(0,Ue));var Ve=be.indexOf("?");if(-1!==Ve?(this.search=be.substr(Ve),this.query=be.substr(Ve+1),K&&(this.query=ge.parse(this.query)),be=be.slice(0,Ve)):K&&(this.search="",this.query={}),be&&(this.pathname=be),pe[ye]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){Pe=this.pathname||"";var $e=this.search||"";this.path=Pe+$e}return this.href=this.format(),this},o.prototype.format=function(){var z=this.auth||"";z&&(z=(z=encodeURIComponent(z)).replace(/%3A/i,":"),z+="@");var K=this.protocol||"",ee=this.pathname||"",te=this.hash||"",re=!1,ie="";this.host?re=z+this.host:this.hostname&&(re=z+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(re+=":"+this.port)),this.query&&ne.isObject(this.query)&&Object.keys(this.query).length&&(ie=ge.stringify(this.query));var se=this.search||ie&&"?"+ie||"";return K&&":"!==K.substr(-1)&&(K+=":"),this.slashes||(!K||pe[K])&&!1!==re?(re="//"+(re||""),ee&&"/"!==ee.charAt(0)&&(ee="/"+ee)):re||(re=""),te&&"#"!==te.charAt(0)&&(te="#"+te),se&&"?"!==se.charAt(0)&&(se="?"+se),K+re+(ee=ee.replace(/[?#]/g,(function(z){return encodeURIComponent(z)})))+(se=se.replace("#","%23"))+te},o.prototype.resolve=function(z){return this.resolveObject(v(z,!1,!0)).format()},o.prototype.resolveObject=function(z){if(ne.isString(z)){var K=new o;K.parse(z,!1,!0),z=K}for(var ee=new o,te=Object.keys(this),re=0;re<te.length;re++){var ie=te[re];ee[ie]=this[ie]}if(ee.hash=z.hash,""===z.href)return ee.href=ee.format(),ee;if(z.slashes&&!z.protocol){for(var se=Object.keys(z),oe=0;oe<se.length;oe++){var ae=se[oe];"protocol"!==ae&&(ee[ae]=z[ae])}return pe[ee.protocol]&&ee.hostname&&!ee.pathname&&(ee.path=ee.pathname="/"),ee.href=ee.format(),ee}if(z.protocol&&z.protocol!==ee.protocol){if(!pe[z.protocol]){for(var le=Object.keys(z),ce=0;ce<le.length;ce++){var he=le[ce];ee[he]=z[he]}return ee.href=ee.format(),ee}if(ee.protocol=z.protocol,z.host||fe[z.protocol])ee.pathname=z.pathname;else{for(var ue=(z.pathname||"").split("/");ue.length&&!(z.host=ue.shift()););z.host||(z.host=""),z.hostname||(z.hostname=""),""!==ue[0]&&ue.unshift(""),ue.length<2&&ue.unshift(""),ee.pathname=ue.join("/")}if(ee.search=z.search,ee.query=z.query,ee.host=z.host||"",ee.auth=z.auth,ee.hostname=z.hostname||z.host,ee.port=z.port,ee.pathname||ee.search){var de=ee.pathname||"",ge=ee.search||"";ee.path=de+ge}return ee.slashes=ee.slashes||z.slashes,ee.href=ee.format(),ee}var me=ee.pathname&&"/"===ee.pathname.charAt(0),be=z.host||z.pathname&&"/"===z.pathname.charAt(0),ve=be||me||ee.host&&z.pathname,we=ve,ye=ee.pathname&&ee.pathname.split("/")||[],_e=(ue=z.pathname&&z.pathname.split("/")||[],ee.protocol&&!pe[ee.protocol]);if(_e&&(ee.hostname="",ee.port=null,ee.host&&(""===ye[0]?ye[0]=ee.host:ye.unshift(ee.host)),ee.host="",z.protocol&&(z.hostname=null,z.port=null,z.host&&(""===ue[0]?ue[0]=z.host:ue.unshift(z.host)),z.host=null),ve=ve&&(""===ue[0]||""===ye[0])),be)ee.host=z.host||""===z.host?z.host:ee.host,ee.hostname=z.hostname||""===z.hostname?z.hostname:ee.hostname,ee.search=z.search,ee.query=z.query,ye=ue;else if(ue.length)ye||(ye=[]),ye.pop(),ye=ye.concat(ue),ee.search=z.search,ee.query=z.query;else if(!ne.isNullOrUndefined(z.search))return _e&&(ee.hostname=ee.host=ye.shift(),(Ae=!!(ee.host&&ee.host.indexOf("@")>0)&&ee.host.split("@"))&&(ee.auth=Ae.shift(),ee.host=ee.hostname=Ae.shift())),ee.search=z.search,ee.query=z.query,ne.isNull(ee.pathname)&&ne.isNull(ee.search)||(ee.path=(ee.pathname?ee.pathname:"")+(ee.search?ee.search:"")),ee.href=ee.format(),ee;if(!ye.length)return ee.pathname=null,ee.search?ee.path="/"+ee.search:ee.path=null,ee.href=ee.format(),ee;for(var ke=ye.slice(-1)[0],xe=(ee.host||z.host||ye.length>1)&&("."===ke||".."===ke)||""===ke,Ce=0,Se=ye.length;Se>=0;Se--)"."===(ke=ye[Se])?ye.splice(Se,1):".."===ke?(ye.splice(Se,1),Ce++):Ce&&(ye.splice(Se,1),Ce--);if(!ve&&!we)for(;Ce--;Ce)ye.unshift("..");!ve||""===ye[0]||ye[0]&&"/"===ye[0].charAt(0)||ye.unshift(""),xe&&"/"!==ye.join("/").substr(-1)&&ye.push("");var Ae,Te=""===ye[0]||ye[0]&&"/"===ye[0].charAt(0);return _e&&(ee.hostname=ee.host=Te?"":ye.length?ye.shift():"",(Ae=!!(ee.host&&ee.host.indexOf("@")>0)&&ee.host.split("@"))&&(ee.auth=Ae.shift(),ee.host=ee.hostname=Ae.shift())),(ve=ve||ee.host&&ye.length)&&!Te&&ye.unshift(""),ye.length?ee.pathname=ye.join("/"):(ee.pathname=null,ee.path=null),ne.isNull(ee.pathname)&&ne.isNull(ee.search)||(ee.path=(ee.pathname?ee.pathname:"")+(ee.search?ee.search:"")),ee.auth=z.auth||ee.auth,ee.slashes=ee.slashes||z.slashes,ee.href=ee.format(),ee},o.prototype.parseHost=function(){var z=this.host,K=ie.exec(z);K&&(":"!==(K=K[0])&&(this.port=K.substr(1)),z=z.substr(0,z.length-K.length)),z&&(this.hostname=z)}},2502:z=>{z.exports={isString:function(z){return"string"==typeof z},isObject:function(z){return"object"==typeof z&&null!==z},isNull:function(z){return null===z},isNullOrUndefined:function(z){return null==z}}},7067:()=>{}},K={};function r(ee){var te=K[ee];if(void 0!==te)return te.exports;var ne=K[ee]={id:ee,loaded:!1,exports:{}};return z[ee].call(ne.exports,ne,ne.exports,r),ne.loaded=!0,ne.exports}r.n=z=>{var K=z&&z.__esModule?()=>z.default:()=>z;return r.d(K,{a:K}),K},r.d=(z,K)=>{for(var ee in K)r.o(K,ee)&&!r.o(z,ee)&&Object.defineProperty(z,ee,{enumerable:!0,get:K[ee]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(z){if("object"==typeof window)return window}}(),r.o=(z,K)=>Object.prototype.hasOwnProperty.call(z,K),r.r=z=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(z,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(z,"__esModule",{value:!0})},r.nmd=z=>(z.paths=[],z.children||(z.children=[]),z);var ee=r(5590);return ee};const Kl=fn();const Jl=16;const ec=32;const tc=1;
/**
     * Class for reading a cram file.  Wraps the gMOD Cram package.
     *
     * @param config
     * @constructor
     */class CramReader{constructor(z,K,ee){this.config=z;this.browser=ee;this.genome=K;this.cramFile=new Kl.CramFile({filehandle:new FileHandler(z.url,z),seqFetch:z.seqFetch||seqFetch.bind(this),checkSequenceMD5:void 0===z.checkSequenceMD5||z.checkSequenceMD5});const te=new FileHandler(z.indexURL,z);this.indexedCramFile=new Kl.IndexedCramFile({cram:this.cramFile,index:new Kl.CraiIndex({filehandle:te}),fetchSizeLimit:3e7});Yl.setReaderDefaults(this,z);function seqFetch(z,K,ee){const te=this.genome.sequence;const ne=this.genome;return this.getHeader().then((function(re){const ie=ne.getChromosomeName(re.chrNames[z]);return te.getSequence(ie,K-1,ee)}))}}
/**
         * Parse the sequence dictionary from the SAM header and build chr name tables.  This function
         * is public so it can be unit tested.
         *
         * @returns {PromiseLike<chrName, chrToIndex, chrAliasTable}>}
         */async getHeader(){if(!this.header){const z=this.genome;const K=await this.cramFile.getSamHeader();const ee={};const te=[];const ne={};const re=[];for(let ie of K)if("SQ"===ie.tag){for(let K of ie.data)if("SN"===K.tag){const re=K.value;ee[re]=te.length;te.push(re);if(z){const K=z.getChromosomeName(re);ne[K]=re}break}}else"RG"===ie.tag&&re.push(ie.data);this.header={chrNames:te,chrToIndex:ee,chrAliasTable:ne,readGroups:re}}return this.header}async readAlignments(z,K,ee){this.browser;const te=await this.getHeader();const ne=te.chrAliasTable.hasOwnProperty(z)?te.chrAliasTable[z]:z;const re=te.chrToIndex[ne];const ie=new AlignmentContainer(z,K,ee,this.config);if(void 0===re)return ie;try{const z=await this.indexedCramFile.getRecordsForRange(re,K,ee);for(let ne of z){const z=ne.sequenceId;const se=ne.alignmentStart;const oe=se+ne.lengthOnRef;if(z<0)continue;if(z>re||se>ee)return;if(z<re)continue;if(oe<K)continue;const ae=decodeCramRecord(ne,te.chrNames);this.filter.pass(ae)&&ie.push(ae)}ie.finish();return ie}catch(z){let K=z.message;K&&K.indexOf("MD5")>=0&&(K="Sequence mismatch. Is this the correct genome for the loaded CRAM?");this.browser.alert.present(new Error(K));throw z}function decodeCramRecord(z,K){const ee=new BamAlignment;ee.chr=K[z.sequenceId];ee.start=z.alignmentStart-1;ee.lengthOnRef=z.lengthOnRef;ee.flags=z.flags;ee.strand=!(z.flags&Jl);ee.fragmentLength=z.templateLength||z.templateSize;ee.mq=z.mappingQuality;ee.end=z.alignmentStart+z.lengthOnRef;ee.readGroupId=z.readGroupId;if(z.mate&&void 0!==z.mate.sequenceId){const te=void 0!==z.mate.flags?!(z.mate.flags&tc):!(z.flags&ec);ee.mate={chr:K[z.mate.sequenceId],position:z.mate.alignmentStart,strand:te}}ee.seq=z.getReadBases();ee.qual=z.qualityScores;ee.tagDict=z.tags;ee.readName=z.readName;makeBlocks(z,ee);ee.mate&&ee.start>ee.mate.position&&ee.fragmentLength>0&&(ee.fragmentLength=-ee.fragmentLength);Yl.setPairOrientation(ee);return ee}function makeBlocks(z,K){const ee=[];let te;let ne;let re=0;let ie="";K.scStart=K.start;K.scLengthOnRef=K.lengthOnRef;if(z.readFeatures)for(let se of z.readFeatures){const z=se.code;const oe=se.data;const ae=se.pos-1;const le=se.refPos-1;switch(z){case"S":case"I":case"i":case"N":case"D":if(ae>re){const z=ae-re;ee.push(new AlignmentBlock({start:le-z,seqOffset:re,len:z,type:"M"}));re+=z;ie+=z+"M"}if("S"===z){let te=le;K.scLengthOnRef+=oe.length;if(0===ae){K.scStart-=oe.length;te-=oe.length}const ne=oe.length;ee.push(new AlignmentBlock({start:te,seqOffset:re,len:ne,type:"S"}));re+=ne;ie+=ne+z}else if("I"===z||"i"===z){void 0===te&&(te=[]);const K="i"===z?1:oe.length;te.push(new AlignmentBlock({start:le,len:K,seqOffset:re,type:"I"}));re+=K;ie+=K+z}else if("D"===z||"N"===z){ne||(ne=[]);ne.push({start:le,len:oe,type:z});ie+=oe+z}break;case"H":case"P":ie+=oe+z;break}}const se=z.readLength-re;if(se>0){ee.push(new AlignmentBlock({start:z.alignmentStart+z.lengthOnRef-se-1,seqOffset:re,len:se,type:"M"}));ie+=se+"M"}K.blocks=ee;K.insertions=te;K.gaps=ne;K.cigar=ie}}}class FileHandler{constructor(z,K){this.position=0;this.url=z;this.config=K;this.cache=new BufferCache({fetch:(z,K)=>this._fetch(z,K)})}async _fetch(z,K){const ee={start:z,size:K};this._stat={size:void 0};const te=await Wo.loadArrayBuffer(this.url,buildOptions(this.config,{range:ee}));return Buffer.from(te)}async read(z,K=0,ee=Infinity,te=0){let ne=te;if(null===ne){ne=this.position;this.position+=ee}return this.cache.get(z,K,ee,te)}async readFile(){const z=await Wo.loadArrayBuffer(this.url,buildOptions(this.config));return Buffer.from(z)}async stat(){if(!this._stat){const z=Buffer.allocUnsafe(10);await this.read(z,0,10,0);if(!this._stat)throw new Error(`unable to determine size of file at ${this.url}`)}return this._stat}}class BufferCache{constructor({fetch:z,size:K=1e7,chunkSize:ee=32768}){this.fetch=z;this.chunkSize=ee;this.lruCache=new QuickLRU({maxSize:Math.floor(K/ee)})}async get(z,K,ee,te){if(z.length<K+ee)throw new Error("output buffer not big enough for request");const ne=Math.floor(te/this.chunkSize);const re=Math.floor((te+ee)/this.chunkSize);const ie=new Array(re-ne+1);for(let z=ne;z<=re;z+=1)ie[z-ne]=this._getChunk(z).then((K=>({data:K,chunkNumber:z})));const se=await Promise.all(ie);const oe=te-se[0].chunkNumber*this.chunkSize;se.forEach((({data:ie,chunkNumber:se})=>{const ae=se*this.chunkSize;let le=0;let ce=this.chunkSize;let he=K+(se-ne)*this.chunkSize-oe;if(se===ne){he=K;le=oe}se===re&&(ce=te+ee-ae);ie.copy(z,he,le,ce)}))}_getChunk(z){const K=this.lruCache.get(z);if(K)return K;const ee=this.fetch(z*this.chunkSize,this.chunkSize);this.lruCache.set(z,ee);return ee}}class QuickLRU{constructor(z={}){if(!(z.maxSize&&z.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=z.maxSize;this.cache=new Map;this.oldCache=new Map;this._size=0}_set(z,K){this.cache.set(z,K);this._size++;if(this._size>=this.maxSize){this._size=0;this.oldCache=this.cache;this.cache=new Map}}get(z){if(this.cache.has(z))return this.cache.get(z);if(this.oldCache.has(z)){const K=this.oldCache.get(z);this._set(z,K);return K}}set(z,K){this.cache.has(z)?this.cache.set(z,K):this._set(z,K);return this}has(z){return this.cache.has(z)||this.oldCache.has(z)}peek(z){return this.cache.has(z)?this.cache.get(z):this.oldCache.has(z)?this.oldCache.get(z):void 0}delete(z){const K=this.cache.delete(z);K&&this._size--;return this.oldCache.delete(z)||K}clear(){this.cache.clear();this.oldCache.clear();this._size=0}*keys(){for(const[z]of this)yield z}*values(){for(const[,z]of this)yield z}*[Symbol.iterator](){for(const z of this.cache)yield z;for(const z of this.oldCache){const[K]=z;this.cache.has(K)||(yield z)}}get size(){let z=0;for(const K of this.oldCache.keys())this.cache.has(K)||z++;return this._size+z}}var nc={ALIGNMENT_MATCH:"M",INSERT:"I",DELETE:"D",SKIP:"N",CLIP_SOFT:"S",CLIP_HARD:"H",PAD:"P",SEQUENCE_MATCH:"=",SEQUENCE_MISMATCH:"X"};const Ga4ghAlignmentReader=function(z,K){this.config=z;this.genome=K;this.url=z.url;this.filter=new BamFilter(z.filter);this.readGroupSetIds=z.readGroupSetIds;this.authKey=z.authKey;this.samplingWindowSize=void 0===z.samplingWindowSize?100:z.samplingWindowSize;this.samplingDepth=void 0===z.samplingDepth?1e3:z.samplingDepth;z.viewAsPairs?this.pairsSupported=true:this.pairsSupported=void 0===z.pairsSupported||z.pairsSupported};Ga4ghAlignmentReader.prototype.readAlignments=function(z,K,ee){const te=this.genome;const ne=this;return getChrAliasTable().then((function(te){var re=te.hasOwnProperty(z)?te[z]:z,ie=ne.url+"/reads/search";return ga4ghSearch({url:ie,body:{readGroupSetIds:[ne.readGroupSetIds],referenceName:re,start:K,end:ee,pageSize:"10000"},decode:decodeGa4ghReads,results:new AlignmentContainer(z,K,ee,ne.config)})}));function getChrAliasTable(){return ne.chrAliasTable?Promise.resolve(ne.chrAliasTable):ne.readMetadata().then((function(z){ne.chrAliasTable={};if(te&&z.readGroups&&z.readGroups.length>0){var K=z.readGroups[0].referenceSetId;if(K){var ee=ne.url+"/references/search";return ga4ghSearch({url:ee,body:{referenceSetId:K},decode:function(z){return z.references}}).then((function(z){z.forEach((function(z){var K=z.name,ee=te.getChromosomeName(K);ne.chrAliasTable[ee]=K}));return ne.chrAliasTable}))}populateChrAliasTable(ne.chrAliasTable,ne.config.datasetId);return ne.chrAliasTable}return ne.chrAliasTable}))}function decodeGa4ghReads(z){var K,ee,re,ie,se,oe,ae=z.alignments,le=ae.length,ce=[];for(K=0;K<le;K++){let z=ae[K];ee=new BamAlignment;ee.readName=z.fragmentName;ee.properPlacement=z.properPlacement;ee.duplicateFragment=z.duplicateFragment;ee.numberReads=z.numberReads;ee.fragmentLength=z.fragmentLength;ee.readNumber=z.readNumber;ee.failedVendorQualityChecks=z.failedVendorQualityChecks;ee.secondaryAlignment=z.secondaryAlignment;ee.supplementaryAlignment=z.supplementaryAlignment;ee.seq=z.alignedSequence;ee.qual=z.alignedQuality;ee.matePos=z.nextMatePosition;ee.tagDict=z.info;ee.flags=encodeFlags();re=z.alignment;if(re){ee.mapped=true;ee.chr=z.alignment.position.referenceName;te&&(ee.chr=te.getChromosomeName(ee.chr));ee.start=parseInt(z.alignment.position.position);ee.strand=!z.alignment.position.reverseStrand;ee.mq=z.alignment.mappingQuality;ee.cigar=encodeCigar(z.alignment.cigar);ie=translateCigar(z.alignment.cigar);ee.lengthOnRef=ie.lengthOnRef;oe=makeBlocks(ee,ie.array);ee.blocks=oe.blocks;ee.insertions=oe.insertions}else ee.mapped=false;se=z.nextMatePosition;se&&(ee.mate={chr:se.referenceFrame,position:parseInt(se.position),strand:!se.reverseStrand});ne.filter.pass(ee)&&ce.push(ee)}return ce;function encodeCigar(z){var K="";z.forEach((function(z){var ee=nc[z.operation],te=z.operationLength;K+=te+ee}));return K}function encodeFlags(z){return 0}function translateCigar(z){var K,ee,te,ne,re=0,ie=[];for(ne=0;ne<z.length;ne++){K=z[ne];te=nc[K.operation];ee=parseInt(K.operationLength);"M"!==te&&"EQ"!==te&&"X"!==te&&"D"!==te&&"N"!==te&&"="!==te||(re+=ee);ie.push({len:ee,ltr:te})}return{lengthOnRef:re,array:ie}}
/**
             * Split the alignment record into blocks as specified in the cigarArray.  Each aligned block contains
             * its portion of the read sequence and base quality strings.  A read sequence or base quality string
             * of "*" indicates the value is not recorded.  In all other cases the length of the block sequence (block.seq)
             * and quality string (block.qual) must == the block length.
             *
             * NOTE: Insertions are not yet treated // TODO
             *
             * @param record
             * @param cigarArray
             * @returns array of blocks
             */function makeBlocks(z,K){var ee,te,ne,re=[],ie=0,se=z.start,oe=K.length;for(var ae=0;ae<oe;ae++){var le=K[ae];switch(le.ltr){case"H":break;case"P":break;case"S":ie+=le.len;ne="S";break;case"N":case"D":void 0===ee&&(ee=[]);ee.push({start:se,len:le.len,type:le.ltr});se+=le.len;break;case"I":void 0===te&&(te=[]);te.push(new AlignmentBlock({start:se,len:le.len,seqOffset:ie}));ie+=le.len;break;case"M":case"EQ":case"=":case"X":re.push(new AlignmentBlock({start:se,len:le.len,seqOffset:ie,gapType:ne}));ie+=le.len;se+=le.len;break;default:console.log("Error processing cigar element: "+le.len+le.ltr)}}return{blocks:re,insertions:te,gaps:ee}}}};Ga4ghAlignmentReader.prototype.readMetadata=function(){return ga4ghGet({url:this.url,entity:"readgroupsets",entityId:this.readGroupSetIds})};
/**
     * Hardcoded hack to work around some non-compliant google datasets
     *
     * @param chrAliasTable
     * @param datasetId
     */function populateChrAliasTable(z,K){var ee;if("461916304629"===K||"337315832689"===K){for(ee=1;ee<23;ee++)z["chr"+ee]=ee;z.chrX="X";z.chrY="Y";z.chrM="MT"}}class BamSource{constructor(z,K){const ee=K.genome;this.config=z;this.genome=ee;isDataURL(z.url)&&(this.config.indexed=false);if("ga4gh"===z.sourceType)this.bamReader=new Ga4ghAlignmentReader(z,ee);else if("pysam"===z.sourceType)this.bamReader=new BamWebserviceReader(z,ee);else if("htsget"===z.sourceType)this.bamReader=new HtsgetBamReader(z,ee);else if("shardedBam"===z.sourceType)this.bamReader=new ShardedBamReader(z,ee);else if("cram"===z.format)this.bamReader=new CramReader(z,ee,K);else{if(!this.config.indexURL&&false!==z.indexed)if(isString$2(this.config.url)){const z=inferIndexPath(this.config.url,"bai");if(z){console.error(`Warning: no indexURL specified for ${this.config.url}.  Guessing ${this.baiPath}`);this.config.indexURL=z}else{console.error(`Warning: no indexURL specified for ${this.config.url}.`);this.config.indexed=false}}else{console.error(`Warning: no indexURL specified for ${this.config.name}.`);this.config.indexed=false}false!==this.config.indexed?this.bamReader=new BamReader(z,ee):this.bamReader=new BamReaderNonIndexed(z,ee)}this.viewAsPairs=z.viewAsPairs;this.showSoftClips=z.showSoftClips}setViewAsPairs(z){this.viewAsPairs=z}setShowSoftClips(z){this.showSoftClips=z}async getAlignments(z,K,ee){const te=this.genome;const ne=this.showSoftClips;const re=await this.bamReader.readAlignments(z,K,ee);let ie=re.alignments;this.viewAsPairs||(ie=unpairAlignments([{alignments:ie}]));const se=ie.length>0;re.packedAlignmentRows=packAlignmentRows(ie,re.start,re.end,ne);this.alignmentContainer=re;if(se){const K=await te.sequence.getSequence(z,re.start,re.end);if(K){re.coverageMap.refSeq=K;re.sequence=K;return re}console.error("No sequence for: "+z+":"+re.start+"-"+re.end)}return re}}function paintAxis(z,K,ee){var te,ne,re,ie,se,oe,ae,le,ce={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};if(void 0===this.dataRange||void 0===this.dataRange.max||void 0===this.dataRange.min)return;let he=void 0!==this.flipAxis&&this.flipAxis;Jo.fillRect(z,0,0,K,ee,{fillStyle:"rgb(255, 255, 255)"});ae=.95*K;te=ae-8;ne=ae;le=.01;re=ie=le*ee;se={x:ne,y:re};Jo.strokeLine(z,te,re,ne,ie,ce);Jo.fillText(z,prettyPrint(he?this.dataRange.min:this.dataRange.max),te+4,re+12,ce);re=ie=(1-le)*ee;oe={x:ne,y:re};Jo.strokeLine(z,te,re,ne,ie,ce);Jo.fillText(z,prettyPrint(he?this.dataRange.max:this.dataRange.min),te+4,re-4,ce);Jo.strokeLine(z,se.x,se.y,oe.x,oe.y,ce);function prettyPrint(z){return 0===z?"0":Math.abs(z)>=10?z.toFixed():Math.abs(z)>=1?z.toFixed(1):z.toFixed(2)}}class Locus{constructor({chr:z,start:K,end:ee}){this.chr=z;this.start=K;this.end=ee}contains(z){return z.chr===this.chr&&z.start>=this.start&&z.end<=this.end}overlaps(z){return z.chr===this.chr&&!(z.end<this.start||z.start>this.end)}extend(z){if(z.chr===this.chr){this.start=Math.min(z.start,this.start);this.end=Math.max(z.end,this.end)}}getLocusString(){if("all"===this.chr)return"all";{const z=numberFormatter$1(Math.floor(this.start)+1);const K=numberFormatter$1(Math.round(this.end));return`${this.chr}:${z}-${K}`}}static fromLocusString(z){if("all"===z)return new Locus({chr:"all"});const K=z.split(":");const ee=K[0];const te=K[1].split("-");const ne=Number.parseInt(te[0].replace(/,/g,""))-1;const re=Number.parseInt(te[1].replace(/,/g,""));return new Locus({chr:ee,start:ne,end:re})}}var classCallCheck=function(z,K){if(!(z instanceof K))throw new TypeError("Cannot call a class as a function")};var rc=function(){function defineProperties(z,K){for(var ee=0;ee<K.length;ee++){var te=K[ee];te.enumerable=te.enumerable||false;te.configurable=true;"value"in te&&(te.writable=true);Object.defineProperty(z,te.key,te)}}return function(z,K,ee){K&&defineProperties(z.prototype,K);ee&&defineProperties(z,ee);return z}}();var ic=function(){function sliceIterator(z,K){var ee=[];var te=true;var ne=false;var re=void 0;try{for(var ie,se=z[Symbol.iterator]();!(te=(ie=se.next()).done);te=true){ee.push(ie.value);if(K&&ee.length===K)break}}catch(z){ne=true;re=z}finally{try{!te&&se.return&&se.return()}finally{if(ne)throw re}}return ee}return function(z,K){if(Array.isArray(z))return z;if(Symbol.iterator in Object(z))return sliceIterator(z,K);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(z){return 0===this.indexOf(z)};String.prototype.padStart=String.prototype.padStart||function(z,K){var ee=this;while(ee.length<z)ee=K+ee;return ee};var sc={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function printNum(z){var K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var ee=K>0?z.toFixed(K).replace(/0+$/,"").replace(/\.$/,""):z.toString();return ee||"0"}var oc=function(){function Color(z,K,ee,te){classCallCheck(this,Color);var ne=this;function parseString(z){if(z.startsWith("hsl")){var K=z.match(/([\-\d\.e]+)/g).map(Number),ee=ic(K,4),te=ee[0],re=ee[1],ie=ee[2],se=ee[3];void 0===se&&(se=1);te/=360;re/=100;ie/=100;ne.hsla=[te,re,ie,se]}else if(z.startsWith("rgb")){var oe=z.match(/([\-\d\.e]+)/g).map(Number),ae=ic(oe,4),le=ae[0],ce=ae[1],he=ae[2],ue=ae[3];void 0===ue&&(ue=1);ne.rgba=[le,ce,he,ue]}else z.startsWith("#")?ne.rgba=Color.hexToRgb(z):ne.rgba=Color.nameToRgb(z)||Color.hexToRgb(z)}if(void 0===z);else if(Array.isArray(z))this.rgba=z;else if(void 0===ee){var re=z&&""+z;re&&parseString(re.toLowerCase())}else this.rgba=[z,K,ee,void 0===te?1:te]}rc(Color,[{key:"printRGB",value:function printRGB(z){var K=z?this.rgba:this.rgba.slice(0,3),ee=K.map((function(z,K){return printNum(z,3===K?3:0)}));return z?"rgba("+ee+")":"rgb("+ee+")"}},{key:"printHSL",value:function printHSL(z){var K=[360,100,100,1],ee=["","%","%",""];var te=z?this.hsla:this.hsla.slice(0,3),ne=te.map((function(z,te){return printNum(z*K[te],3===te?3:1)+ee[te]}));return z?"hsla("+ne+")":"hsl("+ne+")"}},{key:"printHex",value:function printHex(z){var K=this.hex;return z?K:K.substring(0,7)}},{key:"rgba",get:function get(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=Color.hslToRgb(this._hsla)},set:function set(z){3===z.length&&(z[3]=1);this._rgba=z;this._hsla=null}},{key:"rgbString",get:function get(){return this.printRGB()}},{key:"rgbaString",get:function get(){return this.printRGB(true)}},{key:"hsla",get:function get(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=Color.rgbToHsl(this._rgba)},set:function set(z){3===z.length&&(z[3]=1);this._hsla=z;this._rgba=null}},{key:"hslString",get:function get(){return this.printHSL()}},{key:"hslaString",get:function get(){return this.printHSL(true)}},{key:"hex",get:function get(){var z=this.rgba,K=z.map((function(z,K){return K<3?z.toString(16):Math.round(255*z).toString(16)}));return"#"+K.map((function(z){return z.padStart(2,"0")})).join("")},set:function set(z){this.rgba=Color.hexToRgb(z)}}],[{key:"hexToRgb",value:function hexToRgb(z){var K=(z.startsWith("#")?z.slice(1):z).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!K.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+z);var ee=K.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map((function(z){return parseInt(z,16)}));ee[3]=ee[3]/255;return ee}},{key:"nameToRgb",value:function nameToRgb(z){var K=z.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),ee=sc[K];return void 0===ee?ee:Color.hexToRgb(ee.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function rgbToHsl(z){var K=ic(z,4),ee=K[0],te=K[1],ne=K[2],re=K[3];ee/=255;te/=255;ne/=255;var ie=Math.max(ee,te,ne),se=Math.min(ee,te,ne);var oe=void 0,ae=void 0,le=(ie+se)/2;if(ie===se)oe=ae=0;else{var ce=ie-se;ae=le>.5?ce/(2-ie-se):ce/(ie+se);switch(ie){case ee:oe=(te-ne)/ce+(te<ne?6:0);break;case te:oe=(ne-ee)/ce+2;break;case ne:oe=(ee-te)/ce+4;break}oe/=6}return[oe,ae,le,re]}},{key:"hslToRgb",value:function hslToRgb(z){var K=ic(z,4),ee=K[0],te=K[1],ne=K[2],re=K[3];var ie=void 0,se=void 0,oe=void 0;if(0===te)ie=se=oe=ne;else{var ae=function hue2rgb(z,K,ee){ee<0&&(ee+=1);ee>1&&(ee-=1);return ee<1/6?z+6*(K-z)*ee:ee<.5?K:ee<2/3?z+(K-z)*(2/3-ee)*6:z};var le=ne<.5?ne*(1+te):ne+te-ne*te,ce=2*ne-le;ie=ae(ce,le,ee+1/3);se=ae(ce,le,ee);oe=ae(ce,le,ee-1/3)}var he=[255*ie,255*se,255*oe].map(Math.round);he[3]=re;return he}}]);return Color}();var ac=function(){function EventBucket(){classCallCheck(this,EventBucket);this._events=[]}rc(EventBucket,[{key:"add",value:function add(z,K,ee){z.addEventListener(K,ee,false);this._events.push({target:z,type:K,handler:ee})}},{key:"remove",value:function remove(z,K,ee){this._events=this._events.filter((function(te){var ne=true;z&&z!==te.target&&(ne=false);K&&K!==te.type&&(ne=false);ee&&ee!==te.handler&&(ne=false);ne&&EventBucket._doRemove(te.target,te.type,te.handler);return!ne}))}},{key:"destroy",value:function destroy(){this._events.forEach((function(z){return EventBucket._doRemove(z.target,z.type,z.handler)}));this._events=[]}}],[{key:"_doRemove",value:function _doRemove(z,K,ee){z.removeEventListener(K,ee,false)}}]);return EventBucket}();function parseHTML(z){var K=document.createElement("div");K.innerHTML=z;return K.firstElementChild}function dragTrack(z,K,ee){var te=false;function clamp(z,K,ee){return Math.max(K,Math.min(z,ee))}function onMove(z,ne,re){re&&(te=true);if(te){z.preventDefault();var ie=K.getBoundingClientRect(),se=ie.width,oe=ie.height,ae=ne.clientX,le=ne.clientY;var ce=clamp(ae-ie.left,0,se),he=clamp(le-ie.top,0,oe);ee(ce/se,he/oe)}}function onMouse(z,K){var ee=void 0===z.buttons?z.which:z.buttons;1===ee?onMove(z,z,K):te=false}function onTouch(z,K){1===z.touches.length?onMove(z,z.touches[0],K):te=false}z.add(K,"mousedown",(function(z){onMouse(z,true)}));z.add(K,"touchstart",(function(z){onTouch(z,true)}));z.add(window,"mousemove",onMouse);z.add(K,"touchmove",onTouch);z.add(window,"mouseup",(function(z){te=false}));z.add(K,"touchend",(function(z){te=false}));z.add(K,"touchcancel",(function(z){te=false}))}var lc="linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,\n                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em";var cc=360;var hc="keydown",uc="mousedown",dc="focusin";function $(z,K){return(K||document).querySelector(z)}function stopEvent(z){z.preventDefault();z.stopPropagation()}function onKey(z,K,ee,te,ne){z.add(K,hc,(function(z){if(ee.indexOf(z.key)>=0){ne&&stopEvent(z);te(z)}}))}var fc=function(){function Picker(z){classCallCheck(this,Picker);this.settings={popup:"right",layout:"default",alpha:true,editor:true,editorFormat:"hex",cancelButton:false,defaultColor:"#0cf"};this._events=new ac;this.onChange=null;this.onDone=null;this.onOpen=null;this.onClose=null;this.setOptions(z)}rc(Picker,[{key:"setOptions",value:function setOptions(z){var K=this;if(z){var ee=this.settings;if(z instanceof HTMLElement)ee.parent=z;else{if(ee.parent&&z.parent&&ee.parent!==z.parent){this._events.remove(ee.parent);this._popupInited=false}transfer(z,ee);z.onChange&&(this.onChange=z.onChange);z.onDone&&(this.onDone=z.onDone);z.onOpen&&(this.onOpen=z.onOpen);z.onClose&&(this.onClose=z.onClose);var te=z.color||z.colour;te&&this._setColor(te)}var ne=ee.parent;if(ne&&ee.popup&&!this._popupInited){var re=function openProxy(z){return K.openHandler(z)};this._events.add(ne,"click",re);onKey(this._events,ne,[" ","Spacebar","Enter"],re);this._popupInited=true}else z.parent&&!ee.popup&&this.show()}function transfer(z,K,ee){for(var te in z)ee&&ee.indexOf(te)>=0||(K[te]=z[te])}}},{key:"openHandler",value:function openHandler(z){if(this.show()){z&&z.preventDefault();this.settings.parent.style.pointerEvents="none";var K=z&&z.type===hc?this._domEdit:this.domElement;setTimeout((function(){return K.focus()}),100);this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function closeHandler(z){var K=z&&z.type;var ee=false;if(z)if(K===uc||K===dc){var te=(this.__containedEvent||0)+100;z.timeStamp>te&&(ee=true)}else{stopEvent(z);ee=true}else ee=true;if(ee&&this.hide()){this.settings.parent.style.pointerEvents="";K!==uc&&this.settings.parent.focus();this.onClose&&this.onClose(this.colour)}}},{key:"movePopup",value:function movePopup(z,K){this.closeHandler();this.setOptions(z);K&&this.openHandler()}},{key:"setColor",value:function setColor(z,K){this._setColor(z,{silent:K})}},{key:"_setColor",value:function _setColor(z,K){"string"===typeof z&&(z=z.trim());if(z){K=K||{};var ee=void 0;try{ee=new oc(z)}catch(z){if(K.failSilently)return;throw z}if(!this.settings.alpha){var te=ee.hsla;te[3]=1;ee.hsla=te}this.colour=this.color=ee;this._setHSLA(null,null,null,null,K)}}},{key:"setColour",value:function setColour(z,K){this.setColor(z,K)}},{key:"show",value:function show(){var z=this.settings.parent;if(!z)return false;if(this.domElement){var K=this._toggleDOM(true);this._setPosition();return K}var ee=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>';var te=parseHTML(ee);this.domElement=te;this._domH=$(".picker_hue",te);this._domSL=$(".picker_sl",te);this._domA=$(".picker_alpha",te);this._domEdit=$(".picker_editor input",te);this._domSample=$(".picker_sample",te);this._domOkay=$(".picker_done button",te);this._domCancel=$(".picker_cancel button",te);te.classList.add("layout_"+this.settings.layout);this.settings.alpha||te.classList.add("no_alpha");this.settings.editor||te.classList.add("no_editor");this.settings.cancelButton||te.classList.add("no_cancel");this._ifPopup((function(){return te.classList.add("popup")}));this._setPosition();this.colour?this._updateUI():this._setColor(this.settings.defaultColor);this._bindEvents();return true}},{key:"hide",value:function hide(){return this._toggleDOM(false)}},{key:"destroy",value:function destroy(){this._events.destroy();this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function _bindEvents(){var z=this;var K=this,ee=this.domElement,te=this._events;function addEvent(z,K,ee){te.add(z,K,ee)}addEvent(ee,"click",(function(z){return z.preventDefault()}));dragTrack(te,this._domH,(function(z,ee){return K._setHSLA(z)}));dragTrack(te,this._domSL,(function(z,ee){return K._setHSLA(null,z,1-ee)}));this.settings.alpha&&dragTrack(te,this._domA,(function(z,ee){return K._setHSLA(null,null,null,1-ee)}));var ne=this._domEdit;addEvent(ne,"input",(function(z){K._setColor(this.value,{fromEditor:true,failSilently:true})}));addEvent(ne,"focus",(function(z){var K=this;K.selectionStart===K.selectionEnd&&K.select()}));this._ifPopup((function(){var K=function popupCloseProxy(K){return z.closeHandler(K)};addEvent(window,uc,K);addEvent(window,dc,K);onKey(te,ee,["Esc","Escape"],K);var ne=function timeKeeper(K){z.__containedEvent=K.timeStamp};addEvent(ee,uc,ne);addEvent(ee,dc,ne);addEvent(z._domCancel,"click",K)}));var re=function onDoneProxy(K){z._ifPopup((function(){return z.closeHandler(K)}));z.onDone&&z.onDone(z.colour)};addEvent(this._domOkay,"click",re);onKey(te,ee,["Enter"],re)}},{key:"_setPosition",value:function _setPosition(){var z=this.settings.parent,K=this.domElement;z!==K.parentNode&&z.appendChild(K);this._ifPopup((function(ee){"static"===getComputedStyle(z).position&&(z.style.position="relative");var te=true===ee?"popup_right":"popup_"+ee;["popup_top","popup_bottom","popup_left","popup_right"].forEach((function(z){z===te?K.classList.add(z):K.classList.remove(z)}));K.classList.add(te)}))}},{key:"_setHSLA",value:function _setHSLA(z,K,ee,te,ne){ne=ne||{};var re=this.colour,ie=re.hsla;[z,K,ee,te].forEach((function(z,K){(z||0===z)&&(ie[K]=z)}));re.hsla=ie;this._updateUI(ne);this.onChange&&!ne.silent&&this.onChange(re)}},{key:"_updateUI",value:function _updateUI(z){if(this.domElement){z=z||{};var K=this.colour,ee=K.hsla,te="hsl("+ee[0]*cc+", 100%, 50%)",ne=K.hslString,re=K.hslaString;var ie=this._domH,se=this._domSL,oe=this._domA,ae=$(".picker_selector",ie),le=$(".picker_selector",se),ce=$(".picker_selector",oe);posX(ie,ae,ee[0]);this._domSL.style.backgroundColor=this._domH.style.color=te;posX(se,le,ee[1]);posY(se,le,1-ee[2]);se.style.color=ne;posY(oe,ce,1-ee[3]);var he=ne,ue=he.replace("hsl","hsla").replace(")",", 0)"),de="linear-gradient("+[he,ue]+")";this._domA.style.background=de+", "+lc;if(!z.fromEditor){var fe=this.settings.editorFormat,pe=this.settings.alpha;var ge=void 0;switch(fe){case"rgb":ge=K.printRGB(pe);break;case"hsl":ge=K.printHSL(pe);break;default:ge=K.printHex(pe)}this._domEdit.value=ge}this._domSample.style.color=re}function posX(z,K,ee){K.style.left=100*ee+"%"}function posY(z,K,ee){K.style.top=100*ee+"%"}}},{key:"_ifPopup",value:function _ifPopup(z,K){this.settings.parent&&this.settings.popup?z&&z(this.settings.popup):K&&K()}},{key:"_toggleDOM",value:function _toggleDOM(z){var K=this.domElement;if(!K)return false;var ee=z?"":"none",te=K.style.display!==ee;te&&(K.style.display=ee);return te}}]);return Picker}();var pc=document.createElement("style");pc.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}';document.documentElement.firstElementChild.appendChild(pc);fc.StyleElement=pc;function getChrColor$1(z){if(gc[z])return gc[z];if(gc["chr"+z]){const K=gc["chr"+z];gc[z]=K;return K}{const K=randomRGB();gc[z]=K;return K}}function randomRGB(z,K){var ee=Math.round(255*Math.random()).toString(10);var te=Math.round(255*Math.random()).toString(10);var ne=Math.round(255*Math.random()).toString(10);return"rgb("+ee+","+te+","+ne+")"}const gc={chrX:"rgb(204, 153, 0)",chrY:"rgb(153, 204, 0",chrUn:"rgb(50, 50, 50)",chr1:"rgb(80, 80, 255)",chrI:"rgb(139, 155, 187)",chr2:"rgb(206, 61, 50)",chrII:"rgb(206, 61, 50)",chr2a:"rgb(216, 71, 60)",chr2b:"rgb(226, 81, 70)",chr3:"rgb(116, 155, 88)",chrIII:"rgb(116, 155, 88)",chr4:"rgb(240, 230, 133)",chrIV:"rgb(240, 230, 133)",chr5:"rgb(70, 105, 131)",chr6:"rgb(186, 99, 56)",chr7:"rgb(93, 177, 221)",chr8:"rgb(128, 34, 104)",chr9:"rgb(107, 215, 107)",chr10:"rgb(213, 149, 167)",chr11:"rgb(146, 72, 34)",chr12:"rgb(131, 123, 141)",chr13:"rgb(199, 81, 39)",chr14:"rgb(213, 143, 92)",chr15:"rgb(122, 101, 165)",chr16:"rgb(228, 175, 105)",chr17:"rgb(59, 27, 83)",chr18:"rgb(205, 222, 183)",chr19:"rgb(97, 42, 121)",chr20:"rgb(174, 31, 99)",chr21:"rgb(231, 199, 111)",chr22:"rgb(90, 101, 94)",chr23:"rgb(204, 153, 0)",chr24:"rgb(153, 204, 0)",chr25:"rgb(51, 204, 0)",chr26:"rgb(0, 204, 51)",chr27:"rgb(0, 204, 153)",chr28:"rgb(0, 153, 204)",chr29:"rgb(10, 71, 255)",chr30:"rgb(71, 117, 255)",chr31:"rgb(255, 194, 10)",chr32:"rgb(255, 209, 71)",chr33:"rgb(153, 0, 51)",chr34:"rgb(153, 26, 0)",chr35:"rgb(153, 102, 0)",chr36:"rgb(128, 153, 0)",chr37:"rgb(51, 153, 0)",chr38:"rgb(0, 153, 26)",chr39:"rgb(0, 153, 102)",chr40:"rgb(0, 128, 153)",chr41:"rgb(0, 51, 153)",chr42:"rgb(26, 0, 153)",chr43:"rgb(102, 0, 153)",chr44:"rgb(153, 0, 128)",chr45:"rgb(214, 0, 71)",chr46:"rgb(255, 20, 99)",chr47:"rgb(0, 214, 143)",chr48:"rgb(20, 255, 177)"};class ChordSetManager{constructor(z){this.tracks=[];this.chordSets=[]}addChordSet(z){this.chordSets=this.chordSets.filter((K=>K.name!==z.name));this.chordSets.push(z);let K=this.tracks.find((K=>z.trackName===K.name));if(K){K.chordSets=K.chordSets.filter((K=>K.name!==z.name));K.chordSets.push(z)}if(!K){K=new IGVTrack(z);this.tracks.push(K)}}clearChords(){this.tracks=[];this.chordSets=[]}getTrack(z){return this.tracks.find((K=>z===K.name))}getChordSet(z){return this.chordSets.find((K=>z===K.name))}}class IGVTrack{constructor(z){this.name=z.trackName;this.color=z.trackColor;this.visible=true;this.chordSets=[z];this.id=guid$1()}get chords(){if(1===this.chordSets.length)return this.chordSets[0].chords;const z=[];for(let K of this.chordSets)for(let ee of K.chords)z.push(ee);return z}}function guid$1(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}const mc=Math.exp(5);class CircularView{static isInstalled(){return void 0!==window.JBrowseReactCircularGenomeView&&void 0!==window.React&&void 0!==window.ReactDOM}
/**
         * Create a new CircularView
         *
         * @param parent
         * @param config - configuration options
         *   {
         *       assembly: {name: string, id: string, chromosomes: [{name: string, bpLength: integer, color: string}]
         *       onChordClick: function called upon chord click with chord feature as argument
         *   }
         */constructor(z,K){K=K||{};this.config=K;if(CircularView.isInstalled()){this.parent=z;this.groupByTrack=true===K.groupByTrack;this.chordManager=new ChordSetManager(K);const ee=document.createElement("div");ee.className="igv-circview-container";z.appendChild(ee);this.createControls(ee);this.resetControlPanel();const te=document.createElement("div");te.className="igv-circview-circular-genome-view";ee.appendChild(te);this.container=te;K.assembly&&this.setAssembly(K.assembly);this.width=K.width||500;this.height=K.height||500;this.setSize(this.width,this.height)}else console.error("JBrowse circular view is not installed")}createControls(z){const K=document.createElement("div");K.className="igv-circview-toolbar";z.appendChild(K);this.toolbar=K;const ee=document.createElement("div");ee.className="igv-circview-track-panel";z.appendChild(ee);this.controlPanel=ee;this.controlPanel.style.display="none";const te=document.createElement("div");te.className="igv-circview-toolbar-button-container";this.toolbar.appendChild(te);this.showControlsButton=document.createElement("div");this.showControlsButton.className="igv-circview-button";te.appendChild(this.showControlsButton);this.showControlsButton.innerText="none"===this.controlPanel.style.display?"Show Controls":"Hide Controls";this.showControlsButton.addEventListener("click",(z=>{const K=this.controlPanel.querySelectorAll("div");if(K.length>0)if("none"===this.controlPanel.style.display){this.controlPanel.style.display="flex";z.target.innerText="Hide Controls"}else{this.controlPanel.style.display="none";z.target.innerText="Show Controls"}}));let ne=document.createElement("div");ne.className="igv-circview-button";te.appendChild(ne);ne.innerText="Clear All";ne.addEventListener("click",(()=>{this.clearChords()}));if(false!==this.config.showCloseButton){ne=document.createElement("div");ne.className="igv-circview-button";te.appendChild(ne);ne.innerText="Close";ne.addEventListener("click",(()=>{this.visible=false}))}}resetControlPanel(){this.controlPanel.innerHTML="";this.controlPanel.appendChild(this.createGroupByCB());const z=this.groupByTrack?this.chordManager.tracks:this.chordManager.chordSets;for(let K of z)this.addToControlPanel(K)}createGroupByCB(){const z=document.createElement("input");z.type="checkbox";z.id="groupByCB";z.style.width="1.4em";z.style.height="1.4em";z.checked=this.groupByTrack;z.onclick=z=>{this.groupByTrack=z.target.checked;this.resetControlPanel();this.render()};const K=document.createElement("label");K.for="groupByCB";K.innerText="Group by track";K.style.color="black";K.style.paddingLeft="10px";const ee=document.createElement("div");ee.style.width="100%";ee.style.paddingTop="5px";ee.style.paddingBottom="5px";ee.style.background="rgb(216, 230, 234)";ee.appendChild(z);ee.appendChild(K);return ee}addToControlPanel(z){const K=document.createElement("div");this.controlPanel.appendChild(K);const ee=document.createElement("div");ee.className="igv-circview-button";K.appendChild(ee);ee.innerText=true===z.visible?"Hide":"Show";ee.addEventListener("click",(K=>{if(true===z.visible){this.hideChordSet(z.name);K.target.innerText="Show"}else{this.showChordSet(z.name);K.target.innerText="Hide"}}));const te=document.createElement("input");const valueToAlpha=z=>Math.exp(z/200)/mc;const alphaToValue=z=>200*Math.log(z*mc);const ne=document.createElement("div");ne.className="igv-circview-button";ne.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;";K.appendChild(ne);ne.style.backgroundColor=setAlpha(z.color,1);const re={parent:ne,popup:"right",editorFormat:"rgb",color:z.color,onChange:({rgbaString:K})=>{ne.style.backgroundColor=setAlpha(K,1);this.setColor(z.name,K);te.value=alphaToValue(getAlpha(z.color))}};const ie=new fc(re);te.setAttribute("title","Adjust transparency of arcs");te.type="range";te.style.width="100px";te.style.marginRight="10px";te.setAttribute("class","range");te.setAttribute("min","0");te.setAttribute("max","1000");te.value=alphaToValue(getAlpha(z.color));te.oninput=()=>{const K=valueToAlpha(te.value);this.setColor(z.name,setAlpha(z.color,K));ie.setColor(z.color)};K.appendChild(te);const se=document.createElement("div");se.style.color="black";K.appendChild(se);se.innerText=se.title=z.name}
/**
         * Reset view with a new set of chromosomes.
         *
         * @param igvGenome {name: string, id: string, chromosomes: [{name: string, bpLength: integer, color: string}
         */setAssembly(z){const K=this.genomeId||guid();if(this.genomeId===K)return;this.chordManager.clearChords();this.genomeId=K;this.chrNames=new Set(z.chromosomes.map((z=>shortChrName$1(z.name))));const ee=[];const te=[];for(let K of z.chromosomes){const z=shortChrName$1(K.name);te.push(K.color||getChrColor$1(z));ee.push({refName:z,uniqueId:z,start:0,end:K.bpLength})}this.assembly={name:z.name,sequence:{trackId:K,type:"ReferenceSequenceTrack",adapter:{type:"FromConfigSequenceAdapter",features:ee}},refNameColors:te};this.render()}
/**
         * Append or replace current set of chords to the global set or a specific track.
         *
         * @param newChords array of chord feature objects.  Example:
         * [
         *   {
         *     "uniqueId": "chr1:129763372-129763376_chr1:129806775-129806790",
         *     "color": "rgba(0, 0, 255, 0.1)",
         *     "refName": "1",
         *     "start": 129763372,
         *     "end": 129763376,
         *     "mate": {
         *       "refName": "2",
         *       "start": 129806775,
         *       "end": 129806790
         *     }
         *   }
         * ]
         * @param options {
         *     name: string,    // Track name
         *     color: string,   // Track color
         *     append: boolean  // Replace or append chords to current set.  Default is append (true)
         * }
         */addChords(z,K={}){const ee=K.name||K.track||"*";const te=ee.split(" ")[0].replaceAll("%20"," ");const ne=ee.replaceAll("%20"," ");const re={name:ne,trackName:te,chords:z,color:K.color||"black",trackColor:K.trackColor||K.color||"black",visible:true,id:K.id||guid()};this.chordManager.addChordSet(re);this.resetControlPanel();this.render()}setSize(z,K){K=K||z;this.width=z;this.height=K;if(this.viewState){const ee=this.viewState.session.view;ee.setWidth(z);ee.setHeight(K);ee.setBpPerPx(ee.minBpPerPx)}}getSize(){return Math.min(this.width,this.height)}clearChords(){this.chordManager.clearChords();this.resetControlPanel();this.render()}clearSelection(){this.viewState.pluginManager.rootModel.session.clearSelection()}show(){this.parent.style.display="block"}hide(){this.parent.style.display="none"}get visible(){return"none"!==this.parent.style.display}set visible(z){this.parent.style.display=z?"block":"none"}hideChordSet(z){let K=this.getChordSet(z);if(K){K.visible=false;this.render()}else console.warn(`No track with name: ${name}`)}showChordSet(z){let K=this.getChordSet(z);if(K){K.visible=true;this.render()}else console.warn(`No track with name: ${z}`)}deleteTrack(z){let K=this.tracks.findIndex((K=>z===K.name));K>=0&&this.tracks.splice(K,1);this.render()}getChordSet(z){return this.groupByTrack?this.chordManager.getTrack(z):this.chordManager.getChordSet(z)}setColor(z,K){const ee=this.getChordSet(z);if(ee){ee.color=K;const z=ee.id;for(let ee of this.viewState.config.tracks)if(z===ee.trackId){ee.displays[0].renderer.strokeColor.set(K);break}}}render(){const{createViewState:z,JBrowseCircularGenomeView:K}=JBrowseReactCircularGenomeView;ReactDOM.unmountComponentAtNode(this.container);const ee=(this.groupByTrack?this.chordManager.tracks:this.chordManager.chordSets).filter((z=>z.visible));const te=[];const ne=[];for(let z of ee){te.push({trackId:z.id,name:z.name,assemblyNames:["forIGV"],type:"VariantTrack",adapter:{type:"FromConfigAdapter",features:z.chords}});ne.push(z.color)}this.viewState=z({assembly:this.assembly,tracks:te});for(let z=0;z<ee.length;z++)this.viewState.config.tracks[z].displays[0].renderer.strokeColor.set(ne[z]);this.element=React.createElement(K,{viewState:this.viewState});this.setSize(this.width,this.height);ReactDOM.render(this.element,this.container);const re=this.config.onChordClick||defaultOnChordClick;for(let z=0;z<ee.length;z++){this.viewState.session.view.showTrack(this.viewState.config.tracks[z].trackId);if(re){this.viewState.pluginManager.jexl.addFunction("onChordClick",re);this.viewState.config.tracks[z].displays[0].onChordClick.set("jexl:onChordClick(feature, track, pluginManager)")}}}}function setAlpha(z,K){const[ee,te,ne,re]=z.split(",");return`${ee},${te},${ne},${K})`}function getAlpha(z){return z.startsWith("rgba(")?Number(z.split(",")[3].replace(")","")):1}function shortChrName$1(z){return z.startsWith("chr")?z.substring(3):z}function defaultOnChordClick(z,K,ee){console.log(z)}function guid(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function embedCSS$1(){const z='.igv-circview-container {\n  width: fit-content;\n  height: fit-content;\n  box-sizing: content-box;\n  color: dimgray;\n  font-family: "Open Sans", sans-serif;\n  font-size: 12px;\n  background-color: white;\n  border-color: dimgray;\n  border-style: solid;\n  border-width: thin;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n}\n\n.igv-circview-toolbar {\n  position: relative;\n  width: 100%;\n  height: 32px;\n  background-color: lightgrey;\n  border-bottom-style: solid;\n  border-bottom-color: dimgray;\n  border-bottom-width: thin;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.igv-circview-toolbar-button-container {\n  height: 100%;\n  width: fit-content;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-circview-toolbar-button-container > div {\n  margin: 4px;\n}\n\n.igv-circview-track-panel {\n  z-index: 1024;\n  position: absolute;\n  top: 33px;\n  left: 0;\n  width: 100%;\n  height: fit-content;\n  border-bottom-style: solid;\n  border-bottom-color: dimgray;\n  border-bottom-width: thin;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n}\n.igv-circview-track-panel > div {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-circview-track-panel > div > div {\n  margin: 4px;\n}\n\n.igv-circview-swatch-button {\n  cursor: pointer;\n  padding: 5px;\n  width: 8px;\n  height: 8px;\n  border: 1px solid #8d8b8b;\n  border-radius: 16px;\n}\n\n.igv-circview-button {\n  cursor: pointer;\n  padding: 5px;\n  color: #444;\n  vertical-align: middle;\n  text-align: center;\n  font-family: "Open Sans", sans-serif;\n  font-size: 12px;\n  border: 1px solid #8d8b8b;\n  border-radius: 4px;\n  background: #efefef;\n  box-shadow: 0 0 5px -1px rgba(0, 0, 0, 0.2);\n}\n\n.igv-circview-button:hover {\n  background: #efefef;\n  box-shadow: 0 0 5px -1px rgba(0, 0, 0, 0.6);\n}\n\n.igv-circview-button:active {\n  color: #007bff;\n  box-shadow: 0 0 5px -1px rgba(0, 0, 0, 0.6);\n}\n\n/*# sourceMappingURL=circular-view.css.map */\n';const K=document.createElement("style");K.setAttribute("type","text/css");K.innerHTML=z;document.head.insertBefore(K,document.head.childNodes[document.head.childNodes.length-1])}if("undefined"!==typeof document){stylesheetExists("circular-view.css")||embedCSS$1();function stylesheetExists(z){for(let K of document.styleSheets){K=K.href?K.href.replace(/^.*[\\\/]/,""):"";if(K===z)return true}return false}}
/**
     * The minimum length for a VCF structural variant.  VCF records < this length are ignored in the circular view
     * @type {number}
     */const bc=1e6;const shortChrName=z=>z.startsWith("chr")?z.substring(3):z;const makePairedAlignmentChords=z=>{const K=[];for(let ee of z)if(ee.paired)ee.firstAlignment&&ee.secondAlignment&&K.push({uniqueId:ee.readName,refName:shortChrName(ee.firstAlignment.chr),start:ee.firstAlignment.start,end:ee.firstAlignment.end,mate:{refName:shortChrName(ee.secondAlignment.chr),start:ee.secondAlignment.start,end:ee.secondAlignment.end}});else{const z=ee.mate;z&&z.chr&&z.position&&K.push({uniqueId:ee.readName,refName:shortChrName(ee.chr),start:ee.start,end:ee.end,mate:{refName:shortChrName(z.chr),start:z.position-1,end:z.position}})}return K};const makeSupplementalAlignmentChords=z=>{const makeChords=z=>{const ee=z.tags().SA;const te=createSupplementaryAlignments(ee);let ne=0;for(let ee of te)ee.start!==z.start&&K.push({uniqueId:`${z.readName}_${ne++}`,refName:shortChrName(z.chr),start:z.start,end:z.end,mate:{refName:shortChrName(ee.chr),start:ee.start,end:ee.start+ee.lenOnRef}})};const K=[];for(let K of z)if(K.paired){makeChords(K.firstAlignment);K.secondAlignment&&makeChords(K.secondAlignment)}else makeChords(K);return K};const makeBedPEChords=z=>z.map((z=>{const K=z._f||z;return{uniqueId:`${K.chr1}:${K.start1}-${K.end1}_${K.chr2}:${K.start2}-${K.end2}`,refName:shortChrName(K.chr1),start:K.start1,end:K.end1,mate:{refName:shortChrName(K.chr2),start:K.start2,end:K.end2}}}));const makeVCFChords=z=>{const K=z.filter((z=>{const K=z._f||z;const ee=K.info&&K.info.CHR2&&K.info.END&&(K.info.CHR2!==K.chr||Math.abs(Number.parseInt(K.info.END)-K.pos)>bc);return ee}));return K.map((z=>{const K=z._f||z;const ee=Number.parseInt(K.info.END);const te=ee-100;const ne=ee+100;return{uniqueId:`${K.chr}:${K.start}-${K.end}_${K.info.CHR2}:${K.info.END}`,refName:shortChrName(K.chr),start:K.start,end:K.end,mate:{refName:shortChrName(K.info.CHR2),start:te,end:ne}}}))};function makeCircViewChromosomes(z){const K=[];const ee=[];for(let te of z.wgChromosomeNames){const ne=z.getChromosome(te);ee.push(getChrColor(ne.name));K.push({name:ne.name,bpLength:ne.bpLength})}return K}function sendChords(z,K,ee,te){const ne=K.color||"rgb(0,0,255)";const re=$o.addAlpha("all"===ee.chr?ne:getChrColor(ee.chr),te);const ie=$o.addAlpha(ne,te);const se=K.name.replaceAll(" ","%20");const oe="all"===ee.chr?se:`${se}  ${ee.chr}:${ee.start}-${ee.end}`;K.browser.circularView.addChords(z,{track:oe,color:re,trackColor:ie});K.browser.circularViewVisible||(K.browser.circularViewVisible=true)}function createCircularView(z,K){const ee=new CircularView(z,{onChordClick:(z,ee,te)=>{const ne=z.data;const re=ne.mate;addFrameForFeature(ne);addFrameForFeature(re);function addFrameForFeature(z){z.chr=K.genome.getChromosomeName(z.refName);let ee=false;for(let te of K.referenceFrameList){const K=Locus.fromLocusString(te.getLocusString());if(K.contains(z)){ee=true;break}if(K.overlaps(z)){te.extend(z);ee=true;break}}if(!ee){const ee=2e3;const te=(z.start+z.end)/2;K.addMultiLocusPanel(z.chr,te-ee,te+ee)}}}});return ee}class PairedEndStats{constructor(z,{minTLENPercentile:K,maxTLENPercentile:ee}){this.totalCount=0;this.frCount=0;this.rfCount=0;this.ffCount=0;this.sumF=0;this.sumF2=0;this.lp=void 0===K?.1:K;this.up=void 0===ee?99.5:ee;this.isizes=[];this.compute(z)}compute(z){for(let ne of z)if(ne.isProperPair()){var K=Math.abs(ne.fragmentLength);this.sumF+=K;this.sumF2+=K*K;this.isizes.push(K);var ee=ne.pairOrientation;if("string"===typeof ee&&4===ee.length){var te=""+ee.charAt(0)+ee.charAt(2);switch(te){case"FF":case"RR":this.ffCount++;break;case"FR":this.frCount++;break;case"RF":this.rfCount++}}this.totalCount++}this.ffCount/this.totalCount>.9?this.orienation="ff":this.frCount/this.totalCount>.9?this.orienation="fr":this.rfCount/this.totalCount>.9&&(this.orienation="rf");this.minTLEN=0===this.lp?0:percentile(this.isizes,this.lp);this.maxTLEN=percentile(this.isizes,this.up)}}function percentile(z,K){if(0!==z.length){var ee=Math.floor(z.length*(K/100));z.sort((function(z,K){return z-K}));return z[ee]}}const vc={getTissueInfo:function(z,K){z=z||"gtex_v8";K=K||"https://gtexportal.org/rest/v1";let ee=K+"/dataset/tissueInfo?datasetId="+z;return Wo.loadJson(ee,{})},trackConfiguration:function(z,K){K=K||"https://gtexportal.org/rest/v1";return{type:"eqtl",sourceType:"gtex-ws",url:K+"/association/singleTissueEqtlByLocation",tissueSiteDetailId:z.tissueSiteDetailId,name:z.tissueSiteDetailId.split("_").join(" "),visibilityWindow:25e4}}};
/**
     * @param feature
     * @param bpStart  genomic location of the left edge of the current canvas
     * @param xScale  scale in base-pairs per pixel
     * @returns {{px: number, px1: number, pw: number, h: number, py: number}}
     */function calculateFeatureCoordinates(z,K,ee){let te=(z.start-K)/ee;let ne=(z.end-K)/ee;let re=ne-te;if(re<3){re=3;te-=1.5}return{px:te,px1:ne,pw:re}}
/**
     *
     * @param feature
     * @param bpStart  genomic location of the left edge of the current canvas
     * @param xScale  scale in base-pairs per pixel
     * @param pixelHeight  pixel height of the current canvas
     * @param ctx  the canvas 2d context
     * @param options  genomic state
     */function renderFeature(z,K,ee,te,ne,re){try{ne.save();ne.fillStyle=this.color;ne.strokeStyle=this.color;const te=this.getColorForFeature(z);ne.fillStyle=te;ne.strokeStyle=te;let ie;let se;if("SQUISHED"===this.displayMode&&void 0!==z.row){ie=this.featureHeight/2;se=this.margin+this.squishedRowHeight*z.row}else if("EXPANDED"===this.displayMode&&void 0!==z.row){ie=this.featureHeight;se=this.margin+this.expandedRowHeight*z.row}else{ie=this.featureHeight;se=this.margin}const oe=re.pixelWidth;const ae=se+ie/2;const le=ie/2;const ce=ae-le/2;const he=z.exons?z.exons.length:0;const ue=calculateFeatureCoordinates(z,K,ee);const de=this.arrowSpacing;const fe="+"===z.strand?1:"-"===z.strand?-1:0;if(0===he){const z=Math.max(0,ue.px);const K=Math.min(oe,ue.px1);const ee=K-z;ne.fillRect(z,se,ee,ie);if(0!==fe){ne.fillStyle="white";ne.strokeStyle="white";for(let ee=z+de/2;ee<K;ee+=de){Jo.strokeLine(ne,ee-2*fe,ae-2,ee,ae);Jo.strokeLine(ne,ee-2*fe,ae+2,ee,ae)}ne.fillStyle=te;ne.strokeStyle=te}}else{Jo.strokeLine(ne,ue.px+1,ae,ue.px1-1,ae);const re=Math.max(0,ue.px)+de/2;const pe=Math.min(oe,ue.px1);for(let z=re;z<pe;z+=de){Jo.strokeLine(ne,z-2*fe,ae-2,z,ae);Jo.strokeLine(ne,z-2*fe,ae+2,z,ae)}for(let re=0;re<he;re++){const he=z.exons[re];let ue=Math.round((he.start-K)/ee);let pe=Math.round((he.end-K)/ee);let ge=Math.max(1,pe-ue);let me;if(!(ue+ge<0)){if(ue>oe)break;if(he.utr)ne.fillRect(ue,ce,ge,le);else{if(he.cdStart){me=Math.round((he.cdStart-K)/ee);ne.fillRect(ue,ce,me-ue,le);ge-=me-ue;ue=me}if(he.cdEnd){me=Math.round((he.cdEnd-K)/ee);ne.fillRect(me,ce,pe-me,le);ge-=pe-me;pe=me}ge=Math.max(ge,1);ne.fillRect(ue,se,ge,ie);if(ge>de+5&&0!==fe){ne.fillStyle="white";ne.strokeStyle="white";for(let z=ue+de/2;z<pe;z+=de){Jo.strokeLine(ne,z-2*fe,ae-2,z,ae);Jo.strokeLine(ne,z-2*fe,ae+2,z,ae)}ne.fillStyle=te;ne.strokeStyle=te}}}}}re.drawLabel&&"SQUISHED"!==this.displayMode&&renderFeatureLabel.call(this,ne,z,ue.px,ue.px1,se,re.referenceFrame,re)}finally{ne.restore()}}
/**
     * @param ctx       the canvas 2d context
     * @param feature
     * @param featureX  feature start in pixel coordinates
     * @param featureX1 feature end in pixel coordinates
     * @param featureY  feature y-coordinate
     * @param windowX   visible window start x-coordinate
     * @param windowX1  visible window end x-coordinate
     * @param referenceFrame  genomic state
     * @param options  options
     */function renderFeatureLabel(z,K,ee,te,ne,re,ie){try{z.save();let se=K.name;void 0===se&&K.gene&&(se=K.gene.name);void 0===se&&(se=K.id||K.ID);if(!se||"."===se)return;let oe=ie.pixelXOffset||0;const ae=Math.max(ee,-oe);const le=Math.min(te,-oe+ie.viewportWidth);let ce=(ae+le)/2;let he;"COLLAPSED"===this.displayMode&&"SLANT"===this.labelDisplayMode&&(he={rotate:{angle:45}});const ue=getFeatureLabelY(ne,he);let de=this.getColorForFeature(K);let fe;let pe=false;if(re.selection&&vc.gtexLoaded){pe=true;fe=re.selection.colorForGene(se)}const ge={textAlign:"SLANT"===this.labelDisplayMode?void 0:"center",fillStyle:fe||de,strokeStyle:fe||de};const me=z.measureText(se);const be=ce-me.width/2;const ve=ce+me.width/2;const we=ie.rowLastLabelX[K.row]||-Number.MAX_SAFE_INTEGER;if(ie.labelAllFeatures||be>we||pe){ie.rowLastLabelX[K.row]=ve;if("y"===ie.axis){z.save();Jo.labelTransformWithContext(z,ce);Jo.fillText(z,se,ce,ue,ge,he);z.restore()}else Jo.fillText(z,se,ce,ue,ge,he)}}finally{z.restore()}}function getFeatureLabelY(z,K){return K?z+20:z+25}const wc=new Set(["nonsense","missense","stop-loss","frameshift","cds-indel"]);const yc=new Set(["coding-synon"]);const _c=new Set(["splice-3","splice-5"]);const kc=new Set(["untranslated-5","untranslated-3"]);
/**
     * Renderer for a UCSC snp track
     *
     * @param snp
     * @param bpStart  genomic location of the left edge of the current canvas
     * @param xScale  scale in base-pairs per pixel
     * @param pixelHeight  pixel height of the current canvas
     * @param ctx  the canvas 2d context
     */function renderSnp(z,K,ee,te,ne){var re,ie,se=calculateFeatureCoordinates(z,K,ee),oe=this.margin,ae=this.snpColors.length;re="squished"===this.displayMode?this.squishedRowHeight:this.expandedRowHeight;switch(this.colorBy){case"function":ie=colorByFunc(z.func);break;case"class":ie=colorByClass(z.class)}ne.fillStyle=this.snpColors[ie];ne.fillRect(se.px,oe,se.pw,re);function colorByFunc(z){var K;var ee=z.split(",");K=ee.map((function(z){return wc.has(z)||_c.has(z)?ae-1:yc.has(z)?ae-2:kc.has(z)?ae-3:0}));return K.reduce((function(z,K){return Math.max(z,K)}))}function colorByClass(z){return"deletion"===z?ae-1:"mnp"===z?ae-2:"microsatellite"===z||"named"===z?ae-3:0}}
/**
     *
     * @param feature
     * @param bpStart  genomic location of the left edge of the current canvas
     * @param xScale  scale in base-pairs per pixel
     * @param pixelHeight  pixel height of the current canvas
     * @param ctx  the canvas 2d context
     */function renderFusionJuncSpan(z,K,ee,te,ne){const re="EXPANDED"===this.displayMode?this.expandedRowHeight:this.squishedRowHeight;let ie=this.margin;"COLLAPSED"!==this.displayMode&&void 0!==z.row&&(ie+=z.row*re);const se=ie+.5*re;const oe=se-.5*re;const ae=se+.5*re;const le=Math.round((z.junction_left-K)/ee);const ce=Math.round((z.junction_right-K)/ee);ne.beginPath();ne.moveTo(le,se);ne.bezierCurveTo(le,oe,ce,oe,ce,se);ne.lineWidth=1+Math.log(z.num_junction_reads)/Math.log(2);ne.strokeStyle="blue";ne.stroke();const he=z.spanning_frag_coords;for(let z=0;z<he.length;z++){const te=he[z];const re=Math.round((te.left-K)/ee);const ie=Math.round((te.right-K)/ee);ne.beginPath();ne.moveTo(re,se);ne.bezierCurveTo(re,ae,ie,ae,ie,se);ne.lineWidth=1;ne.strokeStyle="purple";ne.stroke()}}const xc="rgb(0, 0, 150)";class FeatureTrack extends TrackBase{static defaults={type:"annotation",maxRows:1e3,displayMode:"EXPANDED",margin:10,featureHeight:14,autoHeight:false,useScore:false};constructor(z,K){super(z,K)}init(z){super.init(z);this.labelDisplayMode=z.labelDisplayMode;if(z._featureSource){this.featureSource=z._featureSource;delete z._featureSource}else this.featureSource=z.featureSource?z.featureSource:FeatureSource(z,this.browser.genome);if("FusionJuncSpan"===z.type){this.render=z.render||renderFusionJuncSpan;this.squishedRowHeight=z.squishedRowHeight||50;this.expandedRowHeight=z.expandedRowHeight||50;this.height=z.height||this.margin+2*this.expandedRowHeight}else if("snp"===z.type){this.render=z.render||renderSnp;this.snpColors=["rgb(0,0,0)","rgb(0,0,255)","rgb(0,255,0)","rgb(255,0,0)"];this.colorBy="function";this.expandedRowHeight=z.expandedRowHeight||10;this.squishedRowHeight=z.squishedRowHeight||5;this.height=z.height||30}else{this.render=z.render||renderFeature;this.arrowSpacing=30;monitorTrackDrag(this);this.squishedRowHeight=z.squishedRowHeight||15;this.expandedRowHeight=z.expandedRowHeight||30;this.height=z.height||this.margin+2*this.expandedRowHeight;if(z.colorBy){if(z.colorBy.field){z.colorTable=z.colorBy.pallete||z.colorBy.palette;z.colorBy=z.colorBy.field}this.colorBy=z.colorBy;z.colorTable?this.colorTable=new ColorTable(z.colorTable):this.colorTable=new PaletteColorTable("Set1")}}}async postInit(){if("function"===typeof this.featureSource.getHeader){this.header=await this.featureSource.getHeader();if(this.disposed)return}this.header&&this.setTrackProperties(this.header);void 0===this.visibilityWindow&&"function"===typeof this.featureSource.defaultVisibilityWindow&&(this.visibilityWindow=await this.featureSource.defaultVisibilityWindow());return this}get supportsWholeGenome(){return void 0!==this.config.supportsWholeGenome?this.config.supportsWholeGenome:this.featureSource&&"function"===typeof this.featureSource.supportsWholeGenome?this.featureSource.supportsWholeGenome():!(void 0!==this.visibilityWindow||false!==this.config.indexed&&this.config.indexURL)||void 0}async getFeatures(z,K,ee,te){const ne=this.visibilityWindow;return this.featureSource.getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,visibilityWindow:ne})}
/**
         * The required height in pixels required for the track content.   This is not the visible track height, which
         * can be smaller (with a scrollbar) or larger.
         *
         * @param features
         * @returns {*}
         */
computePixelHeight(z){if("COLLAPSED"===this.displayMode)return this.margin+this.expandedRowHeight;{let K=0;if(z&&"function"===typeof z.forEach)for(let ee of z)ee.row&&ee.row>K&&(K=ee.row);const ee=this.margin+(K+1)*("SQUISHED"===this.displayMode?this.squishedRowHeight:this.expandedRowHeight);return ee}}draw(z){const K=z.features;const ee=z.context;const te=z.bpPerPixel;const ne=z.bpStart;const re=z.pixelWidth;const ie=z.pixelHeight;const se=ne+re*te+1;this.config.isMergedTrack||Jo.fillRect(ee,0,z.pixelTop,re,ie,{fillStyle:"rgb(255, 255, 255)"});if(K){const oe=[];z.rowLastX=[];z.rowLastLabelX=[];for(let ee of K)if(ee.start>ne&&ee.end<se){const K="COLLAPSED"===this.displayMode?0:ee.row||0;void 0===oe[K]?oe[K]=1:oe[K]++;z.rowLastX[K]=-Number.MAX_SAFE_INTEGER;z.rowLastLabelX[K]=-Number.MAX_SAFE_INTEGER}const ae=Math.max(1,Math.max(...oe));const le=re/ae;let ce=[];for(let re of K){if(re.end<ne)continue;if(re.start>se)break;const K="COLLAPSED"===this.displayMode?0:re.row;z.drawLabel=z.labelAllFeatures||le>10;const oe=Math.ceil((re.end-ne)/te);const ae=ce[K];if(!ae||oe>ae){this.render.call(this,re,ne,te,ie,ee,z);const se=Math.floor((re.start-ne)/te);if(ae&&se-ae<=0){ee.globalAlpha=.5;Jo.strokeLine(ee,se,0,se,ie,{strokeStyle:"rgb(255, 255, 255)"});ee.globalAlpha=1}ce[K]=oe}}}else console.log("No feature list")}clickedFeatures(z){const K=z.y-this.margin;const ee=super.clickedFeatures(z);let te;switch(this.displayMode){case"SQUISHED":te=Math.floor(K/this.squishedRowHeight);break;case"EXPANDED":te=Math.floor(K/this.expandedRowHeight);break;default:te=void 0}return ee.filter((function(z){return void 0===te||void 0===z.row||te===z.row}))}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));const ee=z.genomicLocation;const te=[];for(let z of K){const K=z._f||z;const ne="function"===typeof K.popupData?K.popupData(ee):this.extractPopupData(K);if(ne){te.length>0&&te.push("<hr/><hr/>");const re=this.infoURL||this.config.infoURL;for(let K of ne){te.push(K);if(re&&K.name&&"name"===K.name.toLowerCase()&&K.value&&isString$2(K.value)&&!K.value.startsWith("<")){const ee=re.replace("$$",z.name);K.value=`<a target=_blank href=${ee}>${K.value}</a>`}}const ie="gff"===this.config.format||"gff3"===this.config.format||"gtf"===this.config.format;if(K.exons)for(let z=0;z<K.exons.length;z++){const ne=K.exons[z];if(ee>=ne.start&&ee<=ne.end){const ee=ie?ne.number:"-"===K.strand?K.exons.length-z:z+1;if(ee){te.push("<hr/>");te.push({name:"Exon Number",value:ee})}break}}}}return te}menuItemList(){const z=[];if(this.render===renderSnp){z.push("<hr/>");for(let K of["function","class"])z.push({object:pt(createCheckbox("Color by "+K,K===this.colorBy)),click:()=>{this.colorBy=K;this.trackView.repaintViews()}})}z.push("<hr/>");for(let K of["COLLAPSED","SQUISHED","EXPANDED"]){const ee={COLLAPSED:"Collapse",SQUISHED:"Squish",EXPANDED:"Expand"};z.push({object:pt(createCheckbox(ee[K],K===this.displayMode)),click:()=>{this.displayMode=K;this.config.displayMode=K;this.trackView.checkContentHeight();this.trackView.repaintViews()}})}return z}contextMenuItemList(z){const K=this.clickedFeatures(z);if(void 0===K||0===K.length)return;K.length>1&&K.sort(((z,K)=>K.end-K.start-(z.end-z.start)));const ee=K[0];if(ee.end-ee.start<=1e6){const z=[{label:"View feature sequence",click:async()=>{let z=await this.browser.genome.getSequence(ee.chr,ee.start,ee.end);z?"-"===ee.strand&&(z=reverseComplementSequence(z)):z="Unknown sequence";this.browser.alert.present(z)}}];isSecureContext()&&void 0!==navigator.clipboard&&z.push({label:"Copy feature sequence",click:async()=>{let z=await this.browser.genome.getSequence(ee.chr,ee.start,ee.end);z?"-"===ee.strand&&(z=reverseComplementSequence(z)):z="Unknown sequence";try{await navigator.clipboard.writeText(z)}catch(z){console.error(z);this.browser.alert.present(`error copying sequence to clipboard ${z}`)}}});z.push("<hr/>");return z}}description(){if(renderSnp===this.render){let z="<html>"+this.name+"<hr/>";z+="<em>Color By Function:</em><br>";z+='<span style="color:red">Red</span>: Coding-Non-Synonymous, Splice Site<br>';z+='<span style="color:green">Green</span>: Coding-Synonymous<br>';z+='<span style="color:blue">Blue</span>: Untranslated<br>';z+='<span style="color:black">Black</span>: Intron, Locus, Unknown<br><br>';z+="<em>Color By Class:</em><br>";z+='<span style="color:red">Red</span>: Deletion<br>';z+='<span style="color:green">Green</span>: MNP<br>';z+='<span style="color:blue">Blue</span>: Microsatellite, Named<br>';z+='<span style="color:black">Black</span>: Indel, Insertion, SNP';z+="</html>";return z}return super.description()}
/**
         * Return color for feature.
         * @param feature
         * @returns {string}
         */
getColorForFeature(z){let K;if(this.altColor&&"-"===z.strand)K="function"===typeof this.altColor?this.altColor(z):this.altColor;else if(this.color)K="function"===typeof this.color?this.color(z):this.color;else if(this.colorBy){const ee=z.getAttributeValue?z.getAttributeValue(this.colorBy):z[this.colorBy];K=this.colorTable.getColor(ee)}else z.color&&(K=z.color);K||(K=xc);if(z.alpha&&1!==z.alpha)K=$o.addAlpha(K,z.alpha);else if(this.useScore&&z.score&&!Number.isNaN(z.score)){const ee=this.config.min?this.config.min:this.viewLimitMin?this.viewLimitMin:0;const te=this.config.max?this.config.max:this.viewLimitMax?this.viewLimitMax:1e3;const ne=getAlpha(ee,te,z.score);z.alpha=ne;K=$o.addAlpha(K,ne)}function getAlpha(z,K,ee){const te=(K-z)/9;const ne=Math.floor((ee-z)/te);return Math.min(1,.2+.8*ne/9)}return K}dispose(){this.trackView=void 0}}
/**
     * Monitors track drag events, updates label position to ensure that they're always visible.
     * @param track
     */function monitorTrackDrag(z){if(z.browser.on){z.browser.on("trackdragend",onDragEnd);z.browser.on("trackremoved",unSubscribe)}function onDragEnd(){z.trackView&&"SQUISHED"!==z.displayMode&&z.trackView.updateViews()}function unSubscribe(K){if(z.browser.un&&z===K){z.browser.un("trackdragend",onDragEnd);z.browser.un("trackremoved",unSubscribe)}}}class RegionTableBase{constructor(z){this.config=z;this.browser=z.browser;this.columnFormat=z.columnFormat;this.tableRowSelectionList=[];this.tableDOM=gt.div({class:"igv-roi-table"});z.parent.appendChild(this.tableDOM);this.headerDOM=z;this.tableColumnTitles=this.tableDOM;this.tableRowContainer=this.tableDOM;this.footerDOM=z.gotoButtonHandler}set headerDOM({browser:z,parent:K,headerTitle:ee,dismissHandler:te}){const ne=gt.div();this.tableDOM.appendChild(ne);const re=gt.div();ne.appendChild(re);re.innerHTML=ee;const ie=gt.div();ne.appendChild(ie);ie.appendChild(cn.createIcon("times"));this.boundDismissHandler=mouseClickHandler.bind(this);ie.addEventListener("click",this.boundDismissHandler);function mouseClickHandler(z){z.stopPropagation();te()}const{y:se}=z.root.getBoundingClientRect();const{y:oe}=K.getBoundingClientRect();const ae=-(oe-se);makeDraggable(this.tableDOM,ne,{minX:0,minY:ae});this.tableDOM.style.display="none";this._headerDOM=ne}set tableColumnTitles(z){const K=gt.div({class:"igv-roi-table-column-titles"});z.appendChild(K);for(const{label:z,width:ee}of this.columnFormat){const te=gt.div();K.appendChild(te);te.style.width=ee;te.innerText=z}this._tableColumnTitlesDOM=K}get tableColumnTitles(){return this._tableColumnTitlesDOM}set tableRowContainer(z){const K=gt.div({class:"igv-roi-table-row-container"});z.appendChild(K);this._tableRowContainerDOM=K}get tableRowContainer(){return this._tableRowContainerDOM}set footerDOM(z){const K=gt.div();this.tableDOM.appendChild(K);const ee=gt.div({class:"igv-roi-table-button"});K.appendChild(ee);ee.id="igv-roi-table-view-button";ee.textContent="Go To";ee.style.pointerEvents="none";this._footerDOM=K;this.gotoButton=ee;this.boundGotoButtonHandler=z.bind(this);this.gotoButton.addEventListener("click",this.boundGotoButtonHandler)}tableRowDOMHelper(z){z.addEventListener("mousedown",(K=>{K.stopPropagation();z.classList.toggle("igv-roi-table-row-selected");z.classList.contains("igv-roi-table-row-selected")?z.classList.remove("igv-roi-table-row-hover"):z.classList.add("igv-roi-table-row-hover");this.setTableRowSelectionState(z.classList.contains("igv-roi-table-row-selected"))}));z.addEventListener("mouseover",(K=>{z.classList.contains("igv-roi-table-row-selected")?z.classList.remove("igv-roi-table-row-hover"):z.classList.add("igv-roi-table-row-hover")}));z.addEventListener("mouseout",(K=>{z.classList.remove("igv-roi-table-row-hover")}))}clearTable(){const z=this.tableRowContainer.querySelectorAll(".igv-roi-table-row");for(let K of z)K.remove()}setTableRowSelectionState(z){z?this.tableRowSelectionList.push(1):this.tableRowSelectionList.pop();this.gotoButton.style.pointerEvents=this.tableRowSelectionList.length>0?"auto":"none"}present(){this.tableDOM.style.left="0px";const{y:z}=this.browser.root.getBoundingClientRect();const{y:K}=this.config.parent.getBoundingClientRect();this.tableDOM.style.top=z-K+"px";this.tableDOM.style.display="flex"}dismiss(){this.tableDOM.style.display="none"}dispose(){this.tableDOM.innerHTML="";this.tableDOM.remove();for(const z of Object.keys(this))this[z]=void 0;document.removeEventListener("click",this.boundDismissHandler)}}class BlatTable extends RegionTableBase{constructor(z){const K=Object.assign({width:"1024px"},z);super(K);this.descriptionDOM=z}set descriptionDOM(z){if(z.description){let K;K=gt.div({class:"igv-roi-table-description"});this.tableDOM.insertBefore(K,this.tableColumnTitles);K.style.height="auto";K.innerHTML="BLAT result for query sequence:";K=gt.div({class:"igv-roi-table-description"});this.tableDOM.insertBefore(K,this.tableColumnTitles);K.style.height="auto";K.style.maxHeight="128px";K.innerHTML=z.description;K=gt.div({class:"igv-roi-table-goto-explainer"});this.tableDOM.insertBefore(K,this.tableColumnTitles);K.innerHTML="Select one or more rows and click Go To to view the regions"}}tableRowDOM(z){const K=gt.div({class:"igv-roi-table-row"});const ee=z.map((z=>isFinite(z)?numberFormatter$1(z):z));for(let z=0;z<ee.length;z++){const te=gt.div();K.appendChild(te);const ne=this.columnFormat[z];te.style.width=ne.width||"fit-content";te.innerText=ee[z]}this.tableRowDOMHelper(K);return K}renderTable(z){Array.from(this.tableRowContainer.querySelectorAll(".igv-roi-table-row")).forEach((z=>z.remove()));if(z.length>0)for(let K of z){const z=this.tableRowDOM(K);this.tableRowContainer.appendChild(z)}}static getColumnFormatConfiguration(){return[{label:"chr",width:"7%"},{label:"start",width:"12%"},{label:"end",width:"12%"},{label:"strand",width:"5%"},{label:"score",width:"5%"},{label:"match",width:"5%"},{label:"mis-match",width:"7%"},{label:"rep. match",width:"7%"},{label:"N's",width:"3%"},{label:"Q gap count",width:"9%"},{label:"Q gap bases",width:"9%"},{label:"T gap count",width:"9%"},{label:"T gap bases",width:"9%"}]}static gotoButtonHandler(z){z.stopPropagation();const K=this.tableDOM.querySelectorAll(".igv-roi-table-row-selected");const ee=[];for(const z of K){const K=[];z.querySelectorAll("div").forEach((z=>K.push(z.innerText)));const[te,ne,re]=K;ee.push(`${te}:${ne}-${re}`)}for(const z of this.tableDOM.querySelectorAll(".igv-roi-table-row"))z.classList.remove("igv-roi-table-row-selected");this.setTableRowSelectionState(false);this.browser.search(ee.join(" "))}}const Cc="https://igv.org/services/blatUCSC.php";async function blat({url:z,userSeq:K,db:ee}){z=z||Cc;const te=await postData(z,K,ee);te.fields;const ne=te.blat.map(decodePSL);return ne}async function postData(z="",K,ee){const te=new URLSearchParams;te.append("userSeq",K);te.append("db",ee);const ne=await fetch(z,{method:"post",body:te});return ne.json()}const Sc=25e3;class BlatTrack extends FeatureTrack{constructor(z,K){super(z,K);this.name||(this.name="Blat Results");this.sequence=z.sequence;this.table=void 0}openTableView(){if(void 0===this.table){const z=this.config.features.map((z=>[z.chr,z.start+1,z.end,z.strand,z.score,z.matches,z.misMatches,z.repMatches,z.nCount,z.qNumInsert,z.qBaseInsert,z.tNumInsert,z.tBaseInsert]));const K={browser:this.browser,parent:this.browser.parent,headerTitle:this.config.title,description:this.sequence,dismissHandler:()=>{this.table.dismiss();this.table.dispose();this.table=void 0},columnFormat:BlatTable.getColumnFormatConfiguration(),gotoButtonHandler:BlatTable.gotoButtonHandler};this.table=new BlatTable(K);this.table.renderTable(z)}this.table.present()}menuItemList(){const z=super.menuItemList();z.push("<hr/>");z.push({label:"Open table view",click:()=>this.openTableView()});return z}dispose(){super.dispose();this.table&&this.table.popover.parentElement.removeChild(this.table.popover)}}async function createBlatTrack({sequence:z,browser:K,name:ee,title:te}){if(z.length>Sc){K.alert.present(`Sequence size exceeds maximum allowed length (${z.length} > ${Sc})`);return}const ne=K.genome.id;const re=K.config.blatServerURL;try{const ie=await blat({url:re,userSeq:z,db:ne});const se={type:"blat",name:ee||"blat results",title:te||"blat results",sequence:z,altColor:"rgb(176, 176, 236)",color:"rgb(236, 176, 176)",features:ie};const oe=await K.loadTrack(se);oe.openTableView()}catch(z){K.alert.present(`Error performing blat search:  ${z}`)}}const Ac=5;const Tc=5;const Ec="rgb(185, 185, 185)";const Mc="rgb(150, 150, 150)";const Rc="rgb(200, 200, 200)";const Ic=20;class BAMTrack extends TrackBase{static defaults={alleleFreqThreshold:.2,visibilityWindow:3e4,showCoverage:true,showAlignments:true,viewAsPairs:false,pairsSupported:true,showSoftClips:false,showAllBases:false,showInsertions:true,showMismatches:true,height:300,coverageTrackHeight:50};constructor(z,K){super(z,K)}init(z){this.type="alignment";this.featureSource=new BamSource(z,this.browser);this.coverageTrack=new CoverageTrack(z,this);this.alignmentTrack=new AlignmentTrack(z,this);super.init(z);this.alignmentTrack.setTop(this.coverageTrack,this.showCoverage);this.showAlignments||(this._height=this.coverageTrackHeight);z.sort&&(Array.isArray(z.sort)?this.assignSort(z.sort[0]):this.assignSort(z.sort))}set height(z){this._height=z;this.showAlignments&&(this.alignmentTrack.height=this.showCoverage?z-this.coverageTrackHeight:z)}get height(){return this._height}get minTemplateLength(){const z=void 0!==this.config.minTLEN?this.config.minTLEN:this.config.minFragmentLength;return void 0!==z?z:this._pairedEndStats?this._pairedEndStats.minTLEN:0}get maxTemplateLength(){const z=void 0!==this.config.maxTLEN?this.config.maxTLEN:this.config.maxFragmentLength;return void 0!==z?z:this._pairedEndStats?this._pairedEndStats.maxTLEN:1e3}sort(z){z=this.assignSort(z);for(let K of this.trackView.viewports)if(K.containsPosition(z.chr,z.position)){const ee=K.cachedFeatures;if(ee){ee.sortRows(z);K.repaint()}}}
/**
         * Fix syntax problems for sort options.
         * @param options
         */assignSort(z){if(z.locus){const K=parseLocusString$1(z.locus);z.chr=K.chr;z.position=K.start}else z.position--;z.direction="ASC"===z.direction||true===z.direction;z.chr=this.browser.genome.getChromosomeName(z.chr);this.sortObject=z;return this.sortObject}async getFeatures(z,K,ee,te,ne){const re=await this.featureSource.getAlignments(z,K,ee);if(re.paired&&!this._pairedEndStats&&!this.config.maxFragmentLength){const z=new PairedEndStats(re.alignments,this.config);z.totalCount>99&&(this._pairedEndStats=z)}re.alignments=void 0;const ie=this.sortObject;ie&&ie.chr===z&&ie.position>=K&&ie.position<=ee&&re.sortRows(ie);return re}
/**
         * Compute the pixel height required to display all content.  This is not the same as the viewport height
         * (track.height) which might include a scrollbar.
         *
         * @param alignmentContainer
         * @returns {number}
         */computePixelHeight(z){return(this.showCoverage?this.coverageTrackHeight:0)+(this.showAlignments?this.alignmentTrack.computePixelHeight(z):0)}draw(z){Jo.fillRect(z.context,0,z.pixelTop,z.pixelWidth,z.pixelHeight,{fillStyle:"rgb(255, 255, 255)"});if(true===this.showCoverage&&this.coverageTrackHeight>0){this.trackView.axisCanvas.style.display="block";this.coverageTrack.draw(z)}else this.trackView.axisCanvas.style.display="none";if(true===this.showAlignments){this.alignmentTrack.setTop(this.coverageTrack,this.showCoverage);this.alignmentTrack.draw(z)}}paintAxis(z,K,ee){this.coverageTrack.paintAxis(z,K,this.coverageTrackHeight)}contextMenuItemList(z){return this.alignmentTrack.contextMenuItemList(z)}popupData(z){return true===this.showCoverage&&z.y>=this.coverageTrack.top&&z.y<this.coverageTrackHeight?this.coverageTrack.popupData(z):this.alignmentTrack.popupData(z)}
/**
         * Return the features (alignment, coverage, downsampled interval) clicked on.  Needed for "onclick" event.
         * @param clickState
         * @param features
         */clickedFeatures(z){let K;K=true===this.showCoverage&&z.y>=this.coverageTrack.top&&z.y<this.coverageTrackHeight?this.coverageTrack.getClickedObject(z):this.alignmentTrack.getClickedObject(z);return K?[K]:void 0}hoverText(z){if(true===this.showCoverage&&z.y>=this.coverageTrack.top&&z.y<this.coverageTrackHeight){const K=this.coverageTrack.getClickedObject(z);if(K)return K.hoverText()}}menuItemList(){let z=[];z=z.concat(gn.numericDataMenuItems(this.trackView));z.push("<hr/>");const K=pt('<div class="igv-track-menu-category">');K.text("Color by:");z.push({name:void 0,object:K,click:void 0,init:void 0});const ee=[{key:"strand",label:"read strand"}];if(this.alignmentTrack.hasPairs){ee.push({key:"firstOfPairStrand",label:"first-of-pair strand"});ee.push({key:"pairOrientation",label:"pair orientation"});ee.push({key:"tlen",label:"insert size (TLEN)"});ee.push({key:"unexpectedPair",label:"pair orientation & insert size (TLEN)"})}const te="tag"+(this.alignmentTrack.colorByTag?" ("+this.alignmentTrack.colorByTag+")":"");ee.push({key:"tag",label:te});for(let K of ee){const ee=this.alignmentTrack.colorBy===K.key;z.push(this.colorByCB(K,ee))}const adjustTrackHeight=()=>{if(!this.autoHeight){const z=(this.showCoverage?this.coverageTrackHeight:0)+(this.showAlignments?this.alignmentTrack.height:0);this.trackView.setTrackHeight(z)}};z.push("<hr/>");z.push({object:pt(createCheckbox("Show Coverage",this.showCoverage)),click:()=>{this.showCoverage=!this.showCoverage;adjustTrackHeight();this.trackView.checkContentHeight();this.trackView.repaintViews()}});z.push({object:pt(createCheckbox("Show Alignments",this.showAlignments)),click:()=>{this.showAlignments=!this.showAlignments;adjustTrackHeight();this.trackView.checkContentHeight();this.trackView.repaintViews()}});z.push("<hr/>");z.push({object:pt(createCheckbox("Show all bases",this.showAllBases)),click:()=>{this.showAllBases=!this.showAllBases;this.config.showAllBases=this.showAllBases;this.trackView.repaintViews()}});z.push("<hr/>");z.push({object:pt(createCheckbox("Show mismatches",this.showMismatches)),click:()=>{this.showMismatches=!this.showMismatches;this.config.showMismatches=this.showMismatches;this.trackView.repaintViews()}});z.push({object:pt(createCheckbox("Show insertions",this.showInsertions)),click:()=>{this.showInsertions=!this.showInsertions;this.config.showInsertions=this.showInsertions;this.getCachedAlignmentContainers();this.trackView.repaintViews()}});z.push({object:pt(createCheckbox("Show soft clips",this.showSoftClips)),click:()=>{this.showSoftClips=!this.showSoftClips;this.config.showSoftClips=this.showSoftClips;this.featureSource.setShowSoftClips(this.showSoftClips);const z=this.getCachedAlignmentContainers();for(let K of z)K.setShowSoftClips(this.showSoftClips);this.trackView.repaintViews()}});if(this.pairsSupported&&this.alignmentTrack.hasPairs){z.push("<hr/>");z.push({object:pt(createCheckbox("View as pairs",this.viewAsPairs)),click:()=>{this.viewAsPairs=!this.viewAsPairs;this.config.viewAsPairs=this.viewAsPairs;this.featureSource.setViewAsPairs(this.viewAsPairs);const z=this.getCachedAlignmentContainers();for(let K of z)K.setViewAsPairs(this.viewAsPairs);this.trackView.repaintViews()}})}if(this.browser.circularView&&(this.alignmentTrack.hasPairs||this.alignmentTrack.hasSupplemental)){z.push("<hr/>");this.alignmentTrack.hasPairs&&z.push({label:"Add discordant pairs to circular view",click:()=>{for(let z of this.trackView.viewports)this.addPairedChordsForViewport(z)}});this.alignmentTrack.hasSupplemental&&z.push({label:"Add split reads to circular view",click:()=>{for(let z of this.trackView.viewports)this.addSplitChordsForViewport(z)}})}z.push("<hr/>");const ne=pt('<div class="igv-track-menu-category">');ne.text("Display mode:");z.push({name:void 0,object:ne,click:void 0,init:void 0});z.push({object:pt(createCheckbox("expand","EXPANDED"===this.alignmentTrack.displayMode)),click:()=>{this.alignmentTrack.displayMode="EXPANDED";this.config.displayMode="EXPANDED";this.trackView.checkContentHeight();this.trackView.repaintViews()}});z.push({object:pt(createCheckbox("squish","SQUISHED"===this.alignmentTrack.displayMode)),click:()=>{this.alignmentTrack.displayMode="SQUISHED";this.config.displayMode="SQUISHED";this.trackView.checkContentHeight();this.trackView.repaintViews()}});return z}
/**
         * Create a "color by" checkbox menu item, optionally initially checked
         * @param menuItem
         * @param showCheck
         * @returns {{init: undefined, name: undefined, click: clickHandler, object: (jQuery|HTMLElement|jQuery.fn.init)}}
         */colorByCB(z,K){const ee=pt(createCheckbox(z.label,K));const clickHandler=K=>{if("tag"!==z.key)if(z.key===this.alignmentTrack.colorBy){this.alignmentTrack.colorBy="none";this.config.colorBy="none";this.trackView.repaintViews()}else{this.alignmentTrack.colorBy=z.key;this.config.colorBy=z.key;this.trackView.repaintViews()}else this.browser.inputDialog.present({label:"Tag Name",value:this.alignmentTrack.colorByTag?this.alignmentTrack.colorByTag:"",callback:z=>{if(z){this.alignmentTrack.colorBy="tag";this.alignmentTrack.colorByTag=z;this.alignmentTrack.tagColors||(this.alignmentTrack.tagColors=new PaletteColorTable("Set1"))}else{this.alignmentTrack.colorBy="none";this.alignmentTrack.colorByTag=""}this.trackView.repaintViews()}},K)};return{name:void 0,object:ee,click:clickHandler,init:void 0}}
/**
         * Return the current state of the track.  Used to create sessions and bookmarks.
         *
         * @returns {*|{}}
         */getState(){const z=super.getState();this.sortObject&&(z.sort={chr:this.sortObject.chr,position:this.sortObject.position+1,option:this.sortObject.option,direction:this.sortObject.direction?"ASC":"DESC"});return z}getCachedAlignmentContainers(){return this.trackView.viewports.map((z=>z.cachedFeatures))}get dataRange(){return this.coverageTrack.dataRange}set dataRange(z){this.coverageTrack.dataRange=z}get logScale(){return this.coverageTrack.logScale}set logScale(z){this.coverageTrack.logScale=z}get autoscale(){return this.coverageTrack.autoscale}set autoscale(z){this.coverageTrack.autoscale=z}
/**
         * Add chords to the circular view for the given viewport, represented by its reference frame
         * @param refFrame
         */addPairedChordsForViewport(z){const K=this.maxTemplateLength;const ee=[];const te=z.referenceFrame;for(let ne of z.cachedFeatures.allAlignments())ne.end>=te.start&&ne.start<=te.end&&(ne.paired?ne.end-ne.start>K&&ee.push(ne):ne.mate&&ne.mate.chr&&(ne.mate.chr!==ne.chr||Math.max(ne.fragmentLength)>K)&&ee.push(ne));const ne=makePairedAlignmentChords(ee);sendChords(ne,this,te,.02)}addSplitChordsForViewport(z){const K=[];const ee=z.referenceFrame;for(let te of z.cachedFeatures.allAlignments()){const z=te.hasTag("SA");te.end>=ee.start&&te.start<=ee.end&&z&&K.push(te)}const te=makeSupplementalAlignmentChords(K);sendChords(te,this,ee,.02)}}class CoverageTrack{constructor(z,K){this.parent=K;this.featureSource=K.featureSource;this.paintAxis=paintAxis;this.top=0;this.autoscale=z.autoscale||void 0===z.max;this.autoscale||(this.dataRange={min:z.min||0,max:z.max})}get height(){return this.parent.coverageTrackHeight}draw(z){const K=z.pixelTop;K+z.pixelHeight;const ee=this.parent.browser.nucleotideColors;if(K>this.height)return;const te=z.context;const ne=z.features;const re=ne.coverageMap;let ie;re.refSeq&&(ie=re.refSeq.toUpperCase());const se=z.bpPerPixel;const oe=z.bpStart;const ae=z.pixelWidth;const le=oe+ae*se+1;let ce;ce=this.parent.coverageColor?this.parent.coverageColor:this.parent.color&&"function"!==typeof this.parent.color?$o.darkenLighten(this.parent.color,-35):Mc;Jo.setProperties(te,{fillStyle:ce,strokeStyle:ce});const he=Math.max(1,Math.ceil(1/se));for(let z=0,K=re.coverage.length;z<K;z++){const K=re.bpStart+z;if(K<oe)continue;if(K>le)break;const ee=re.coverage[z];if(!ee)continue;const ne=Math.round(ee.total/this.dataRange.max*this.height);const ie=this.height-ne;const ae=Math.floor((K-oe)/se);Jo.fillRect(te,ae,ie,he,ne)}if(ie)for(let z=0,K=re.coverage.length;z<K;z++){const K=re.bpStart+z;if(K<oe)continue;if(K>le)break;const ne=re.coverage[z];if(!ne)continue;const ae=ne.total/this.dataRange.max*this.height;let ce=this.height-ae;const ue=Math.floor((K-oe)/se);const de=ie[z];if(ne.isMismatch(de)){Jo.setProperties(te,{fillStyle:ee[de]});Jo.fillRect(te,ue,ce,he,ae);let z=0;for(let K of["A","C","T","G"]){const re=ne["pos"+K]+ne["neg"+K];const ie=re/this.dataRange.max*this.height;ce=this.height-ie-z;z+=ie;Jo.setProperties(te,{fillStyle:ee[K]});Jo.fillRect(te,ue,ce,he,ie)}}}}getClickedObject(z){let K=z.viewport.cachedFeatures;if(!K||0===K.length)return;const ee=Math.floor(z.genomicLocation);const te=K.coverageMap;const ne=Math.floor(ee-te.bpStart);return te.coverage[ne]}popupData(z){const K=[];const ee=this.getClickedObject(z);if(ee){const te=Math.floor(z.genomicLocation);const ne=z.viewport.referenceFrame;K.push(ne.chr+":"+numberFormatter$1(1+te));K.push({name:"Total Count",value:ee.total});let re=ee.posA+ee.negA;re>0&&(re=re.toString()+" ("+Math.round(re/ee.total*100)+"%, "+ee.posA+"+, "+ee.negA+"- )");K.push({name:"A",value:re});re=ee.posC+ee.negC;re>0&&(re=re.toString()+" ("+Math.round(re/ee.total*100)+"%, "+ee.posC+"+, "+ee.negC+"- )");K.push({name:"C",value:re});re=ee.posG+ee.negG;re>0&&(re=re.toString()+" ("+Math.round(re/ee.total*100)+"%, "+ee.posG+"+, "+ee.negG+"- )");K.push({name:"G",value:re});re=ee.posT+ee.negT;re>0&&(re=re.toString()+" ("+Math.round(re/ee.total*100)+"%, "+ee.posT+"+, "+ee.negT+"- )");K.push({name:"T",value:re});re=ee.posN+ee.negN;re>0&&(re=re.toString()+" ("+Math.round(re/ee.total*100)+"%, "+ee.posN+"+, "+ee.negN+"- )");K.push({name:"N",value:re});K.push("<HR/>");K.push({name:"DEL",value:ee.del.toString()});K.push({name:"INS",value:ee.ins.toString()})}return K}}class AlignmentTrack{constructor(z,K){this.parent=K;this.browser=K.browser;this.featureSource=K.featureSource;this.top=0===z.coverageTrackHeight?0:z.coverageTrackHeight+5;this.displayMode=z.displayMode||"EXPANDED";this.alignmentRowHeight=z.alignmentRowHeight||14;this.squishedRowHeight=z.squishedRowHeight||3;this.negStrandColor=z.negStrandColor||"rgba(150, 150, 230, 0.75)";this.posStrandColor=z.posStrandColor||"rgba(230, 150, 150, 0.75)";this.insertionColor=z.insertionColor||"rgb(138, 94, 161)";this.insertionTextColor=z.insertionTextColor||"white";this.showInsertionText=void 0!==z.showInsertionText&&!!z.showInsertionText;this.deletionColor=z.deletionColor||"black";this.deletionTextColor=z.deletionTextColor||"black";this.showDeletionText=void 0!==z.showDeletionText&&!!z.showDeletionText;this.skippedColor=z.skippedColor||"rgb(150, 170, 170)";this.pairConnectorColor=z.pairConnectorColor;this.smallTLENColor=z.smallTLENColor||z.smallFragmentLengthColor||"rgb(0, 0, 150)";this.largeTLENColor=z.largeTLENColor||z.largeFragmentLengthColor||"rgb(200, 0, 0)";this.pairOrientation=z.pairOrienation||"fr";this.pairColors={};this.pairColors.RL=z.rlColor||"rgb(0, 150, 0)";this.pairColors.RR=z.rrColor||"rgb(20, 50, 200)";this.pairColors.LL=z.llColor||"rgb(0, 150, 150)";this.colorBy=z.colorBy||"unexpectedPair";this.colorByTag=z.colorByTag?z.colorByTag.toUpperCase():void 0;this.bamColorTag=void 0===z.bamColorTag?"YC":z.bamColorTag;this.hideSmallIndels=z.hideSmallIndels;this.indelSizeThreshold=z.indelSizeThreshold||1;this.hasPairs=false;this.hasSupplemental=false}setTop(z,K){this.top=0===z.height||false===K?0:5+z.height}
/**
         * Compute the pixel height required to display all content.
         *
         * @param alignmentContainer
         * @returns {number|*}
         */computePixelHeight(z){if(z.packedAlignmentRows){const K=z.hasDownsampledIntervals()?Tc+Ac:0;const ee="SQUISHED"===this.displayMode?this.squishedRowHeight:this.alignmentRowHeight;return K+ee*z.packedAlignmentRows.length+5}return 0}draw(z){const K=z.features;const ee=z.context;const te=z.bpPerPixel;const ne=z.bpStart;const re=z.pixelWidth;const ie=ne+re*te+1;const se=this.parent.showSoftClips;const oe=this.parent.showAllBases;const ae=this.browser.nucleotideColors;const le=K.packedAlignmentRows;ee.save();let ce=K.sequence;ce&&(ce=ce.toUpperCase());let he=0;let ue=z.pixelTop;this.top&&ee.translate(0,this.top);const de=ue+z.pixelHeight;if(K.hasDownsampledIntervals()){he=Tc+Ac;K.downsampledIntervals.forEach((function(z){var K=(z.start-ne)/te,re=(z.end-ne)/te;if(re-K>5){K+=1;re-=1}Jo.fillRect(ee,K,2,re-K,Tc-2,{fillStyle:"black"})}))}else he=0;this.alignmentsYOffset=he;const fe="SQUISHED"===this.displayMode?this.squishedRowHeight:this.alignmentRowHeight;if(le){const z=le.length;for(let K=0;K<z;K++){const z=le[K];const ee=he+fe*K;const te=fe<=4?fe:fe-2;if(ee>de)break;if(!(ee+te<ue))for(let K of z.alignments){this.hasPairs=this.hasPairs||K.isPaired();this.browser.circularView&&(this.hasSupplemental=this.hasSupplemental||K.hasTag("SA"));if(!(K.start+K.lengthOnRef<ne)){if(K.start>ie)break;if(true!==K.hidden)if(K instanceof PairedAlignment){drawPairConnector.call(this,K,ee,te);drawSingleAlignment.call(this,K.firstAlignment,ee,te);K.secondAlignment&&drawSingleAlignment.call(this,K.secondAlignment,ee,te)}else drawSingleAlignment.call(this,K,ee,te)}}}}ee.restore();function drawPairConnector(z,K,re){var se=this.getConnectorColor(z.firstAlignment),oe=(z.connectingStart-ne)/te,ae=(z.connectingEnd-ne)/te,le=K+re/2;if(!(z.connectingEnd<ne||z.connectingStart>ie)){z.mq<=0&&(se=$o.addAlpha(se,.15));Jo.setProperties(ee,{fillStyle:se,strokeStyle:se});Jo.strokeLine(ee,oe,le,ae,le)}}function drawSingleAlignment(z,le,he){if(z.start+z.lengthOnRef<ne||z.start>ie)return;const ue=se?z.blocks:z.blocks.filter((z=>"S"!==z.type));let de=this.getAlignmentColor(z);const pe=de;z.mq<=0&&(de=$o.addAlpha(de,.15));Jo.setProperties(ee,{fillStyle:de,strokeStyle:pe});const ge=[];for(let z=0;z<ue.length;z++){const K=ue[z];if(!(z!==ue.length-1&&ue[z+1].start<ne)){ge.push(...drawBlock.call(this,K,z));if(K.start+K.len>ie)break}}if(z.gaps){const K=le+he/2;for(let re of z.gaps){const z=(re.start-ne)/te;const ie=(re.start+re.len-ne)/te;const se=ie-z;const oe=re.len.toString();const ae=6*oe.length;const ce=z+se/2;const he="D"===re.type?this.deletionColor:this.skippedColor;Jo.strokeLine(ee,z,K,ie,K,{strokeStyle:he,lineWidth:2});if(this.showDeletionText&&re.len>1&&se>=ae+8){const z=ce-ae/2;Jo.fillRect(ee,z-1,le-1,ae+2,12,{fillStyle:"white"});Jo.fillText(ee,oe,z,le+10,{font:"normal 10px monospace",fillStyle:this.deletionTextColor})}}}if(z.insertions&&this.parent.showInsertions){let K=-1;for(let re of z.insertions){if(this.hideSmallIndels&&re.len<=this.indelSizeThreshold)continue;if(re.start<ne)continue;if(re.start>ie)break;const z=re.start-ne;const se=re.len.toString();const oe=2+6*se.length;const ae=this.showInsertionText&&1!==re.len?Math.round(re.len/te):2;const ce=Math.max(Math.min(oe,ae),2);const ue=z/te-ce/2;if(ue-K>2){const z={fillStyle:this.insertionColor};Jo.fillRect(ee,ue-2,le,ce+4,2,z);Jo.fillRect(ee,ue,le+2,ce,he-4,z);Jo.fillRect(ee,ue-2,le+he-2,ce+4,2,z);this.showInsertionText&&re.len>1&&ae>oe&&Jo.fillText(ee,se,ue+1,le+10,{font:"normal 10px monospace",fillStyle:this.insertionTextColor});K=ue}}}ge.forEach((({bbox:z,baseColor:K,readChar:ne})=>{renderBlockOrReadChar(ee,te,z,K,ne)}));function drawBlock(ie,se){const ge=[];const me=ie.start-K.start;const be=(ie.start-ne)/te;const ve=(ie.start+ie.len-ne)/te;const we=Math.max(1,ve-be);const ye=100/te;const _e=Math.min(fe/2,ye/6);const ke="S"===ie.type;const xe=z.mq<=0||this.highlightedAlignmentReadNamed===z.readName||ke;let Ce=pe;this.highlightedAlignmentReadNamed===z.readName?Ce="red":ke&&(Ce="rgb(50,50,50)");const Se=true===z.strand&&se===ue.length-1;const Ae=false===z.strand&&0===se;const Te=Se|Ae;if(Te){let z;let K;if(Se){z=[be,ve,ve+_e,ve,be,be];K=[le,le,le+he/2,le+he,le+he,le]}else if(Ae){z=[ve,be,be-_e,be,ve,ve];K=[le,le,le+he/2,le+he,le+he,le]}Jo.fillPolygon(ee,z,K,{fillStyle:de});xe&&Jo.strokePolygon(ee,z,K,{strokeStyle:Ce})}else{Jo.fillRect(ee,be,le,we,he,{fillStyle:de});if(xe){ee.save();ee.strokeStyle=Ce;ee.strokeRect(be,le,we,he);ee.restore()}}if(ke||oe||this.parent.showMismatches&&ce&&z.seq&&"*"!==z.seq){const K=z.seq?z.seq.toUpperCase():void 0;const ee=z.qual;const se=ie.seqOffset;const ue=Math.max(1,1/te);for(let z=0,de=ie.len;z<de;z++){const de=(ie.start+z-ne)/te;if(de+ue<0)continue;if(de>re)break;let fe=K?K.charAt(se+z):"";const pe=me+z>=0?ce.charAt(me+z):"";"="===fe&&(fe=pe);if("X"===fe||pe!==fe||ke||oe){let K;if(!ke&&void 0!==ee&&ee.length>se+z){const te=ee[se+z];K=shadedBaseColor(te,ae[fe])}else K=ae[fe];K&&ge.push({bbox:{x:de,y:le,width:ue,height:he},baseColor:K,readChar:fe})}}}return ge}function renderBlockOrReadChar(z,K,ee,te,ne){var re,ie;re=.1;if(K<=re&&ee.height>=8){const K=Math.min(10,ee.height);z.font=K+"px sans-serif";ie=ee.x+ee.width/2;Jo.strokeText(z,ne,ie-z.measureText(ne).width/2,K-1+ee.y,{strokeStyle:te})}else Jo.fillRect(z,ee.x,ee.y,ee.width,ee.height,{fillStyle:te})}}}popupData(z){const K=this.getClickedObject(z);return K?K.popupData(z.genomicLocation):void 0}contextMenuItemList(z){const K=z.viewport;const ee=[];const sortByOption=ee=>{const te=this.parent.sortObject;const ne=!te||te.position!==Math.floor(z.genomicLocation)||!te.direction;const re={chr:K.referenceFrame.chr,position:Math.floor(z.genomicLocation),option:ee,direction:ne};this.parent.sortObject=re;K.cachedFeatures.sortRows(re);K.repaint()};ee.push("<b>Sort by...</b>");ee.push({label:"&nbsp; base",click:()=>sortByOption("BASE")});ee.push({label:"&nbsp; read strand",click:()=>sortByOption("STRAND")});ee.push({label:"&nbsp; insert size",click:()=>sortByOption("INSERT_SIZE")});ee.push({label:"&nbsp; gap size",click:()=>sortByOption("GAP_SIZE")});ee.push({label:"&nbsp; chromosome of mate",click:()=>sortByOption("MATE_CHR")});ee.push({label:"&nbsp; mapping quality",click:()=>sortByOption("MQ")});ee.push({label:"&nbsp; read name",click:()=>sortByOption("READ_NAME")});ee.push({label:"&nbsp; aligned read length",click:()=>sortByOption("ALIGNED_READ_LENGTH")});ee.push({label:"&nbsp; tag",click:()=>{const ee=this.parent.sortObject;const te=!ee||ee.position!==Math.floor(z.genomicLocation)||!ee.direction;const ne={label:"Tag Name",value:this.sortByTag?this.sortByTag:"",callback:ee=>{if(ee){const ne={chr:K.referenceFrame.chr,position:Math.floor(z.genomicLocation),option:"TAG",tag:ee,direction:te};this.sortByTag=ee;this.parent.sortObject=ne;K.cachedFeatures.sortRows(ne);K.repaint()}}};this.browser.inputDialog.present(ne,z.event)}});ee.push("<hr/>");const te=this.getClickedObject(z);if(te){const K=this.parent.showSoftClips;const ne="function"===typeof te.alignmentContaining?te.alignmentContaining(z.genomicLocation,K):te;if(ne){ne.isPaired()&&ne.isMateMapped()&&ee.push({label:"View mate in split screen",click:()=>{if(ne.mate){const K=z.viewport.referenceFrame;if(this.browser.genome.getChromosome(ne.mate.chr)){this.highlightedAlignmentReadNamed=ne.readName;const z=K.end-K.start;const ee=ne.mate.position-z/2;const te=ne.mate.position+z/2;this.browser.addMultiLocusPanel(ne.mate.chr,ee,te,K)}else this.browser.alert.present(`Reference does not contain chromosome: ${ne.mate.chr}`)}},init:void 0});ee.push({label:"View read sequence",click:()=>{const z=ne.seq;z&&"*"!==z?this.browser.alert.present(z):this.browser.alert.present("Read sequence: *")}});isSecureContext()&&ee.push({label:"Copy read sequence",click:async()=>{const z=ne.seq;try{await navigator.clipboard.writeText(z)}catch(z){console.error(z);this.browser.alert.present(`error copying sequence to clipboard ${z}`)}}});const K=ne.seq;if(K&&"*"!=K){K.length<Sc&&ee.push({label:"BLAT read sequence",click:()=>{const z=ne.isNegativeStrand()?reverseComplementSequence(K):K;const ee=`${ne.readName} - blat`;const te=`${this.parent.name} - ${ee}`;createBlatTrack({sequence:z,browser:this.browser,name:ee,title:te})}});const z=ne.softClippedBlocks();z.left&&z.left.len>Ic&&z.left.len<Sc&&ee.push({label:"BLAT left soft-clipped sequence",click:()=>{const ee=K.substr(z.left.seqOffset,z.left.len);const te=ne.isNegativeStrand()?reverseComplementSequence(ee):ee;const re=`${ne.readName} - blat left clip`;const ie=`${this.parent.name} - ${re}`;createBlatTrack({sequence:te,browser:this.browser,name:re,title:ie})}});z.right&&z.right.len>Ic&&z.right.len<Sc&&ee.push({label:"BLAT right soft-clipped sequence",click:()=>{const ee=K.substr(z.right.seqOffset,z.right.len);const te=ne.isNegativeStrand()?reverseComplementSequence(ee):ee;const re=`${ne.readName} - blat right clip`;const ie=`${this.parent.name} - ${re}`;createBlatTrack({sequence:te,browser:this.browser,name:re,title:ie})}})}ee.push("<hr/>")}}if(this.browser.circularView&&(this.hasPairs||this.hasSupplemental)){this.hasPairs&&ee.push({label:"Add discordant pairs to circular view",click:()=>{this.parent.addPairedChordsForViewport(K)}});this.hasSupplemental&&ee.push({label:"Add split reads to circular view",click:()=>{this.parent.addSplitChordsForViewport(K)}});ee.push("<hr/>")}return ee}getClickedObject(z){const K=z.viewport;const ee=z.y;const te=z.genomicLocation;const ne=this.parent.showSoftClips;let re=K.cachedFeatures;if(!re||0===re.length)return;let ie=re.packedAlignmentRows;let se=re.downsampledIntervals;const oe="SQUISHED"===this.displayMode?this.squishedRowHeight:this.alignmentRowHeight;let ae=Math.floor((ee-this.top-this.alignmentsYOffset)/oe);if(ae<0){for(let z=0;z<se.length;z++)if(se[z].start<=te&&se[z].end>=te)return se[z]}else if(ae<ie.length){const z=ie[ae];const K=z.alignments.filter((z=>z.containsLocation(te,ne)));if(K.length>0)return K[0]}}
/**
         * Return the color for connectors in paired alignment view.   If explicitly set return that, otherwise return
         * the alignment color, unless the color option can result in split colors (separte color for each mate).
         *
         * @param alignment
         * @returns {string}
         */
getConnectorColor(z){if(this.pairConnectorColor)return this.pairConnectorColor;switch(this.colorBy){case"strand":case"firstOfPairStrand":case"pairOrientation":case"tag":return this.parent.color?"function"===typeof this.parent.color?this.parent.color(z):this.parent.color:Rc;default:return this.getAlignmentColor(z)}}getAlignmentColor(z){let K=Ec;K=this.parent.color?"function"===typeof this.parent.color?this.parent.color(z):this.parent.color:Ec;const ee=this.colorBy;switch(ee){case"strand":K=z.strand?this.posStrandColor:this.negStrandColor;break;case"firstOfPairStrand":z instanceof PairedAlignment?K=z.firstOfPairStrand()?this.posStrandColor:this.negStrandColor:z.isPaired()&&(z.isFirstOfPair()?K=z.strand?this.posStrandColor:this.negStrandColor:z.isSecondOfPair()?K=z.strand?this.negStrandColor:this.posStrandColor:console.error("ERROR. Paired alignments are either first or second."));break;case"unexpectedPair":case"pairOrientation":if(this.pairOrientation&&z.pairOrientation){const ee=Fc[this.pairOrientation];if(ee){const te=this.pairColors[ee[z.pairOrientation]];if(te){K=te;break}}}if("pairOrientation"===ee)break;case"tlen":case"fragmentLength":z.mate&&z.isMateMapped()&&(z.mate.chr!==z.chr?K=getChrColor(z.mate.chr):this.parent.minTemplateLength&&Math.abs(z.fragmentLength)<this.parent.minTemplateLength?K=this.smallTLENColor:this.parent.maxTemplateLength&&Math.abs(z.fragmentLength)>this.parent.maxTemplateLength&&(K=this.largeTLENColor));break;case"tag":const te=z.tags()[this.colorByTag];if(void 0!==te)if(this.bamColorTag===this.colorByTag)K="rgb("+te+")";else{this.tagColors||(this.tagColors=new PaletteColorTable("Set1"));K=this.tagColors.getColor(te)}break}return K}}function shadedBaseColor(z,K){const ee=5;const te=20;let ne;ne=z<ee?.1:Math.max(.1,Math.min(1,.1+.9*(z-ee)/(te-ee)));ne=Math.round(10*ne)/10;ne<1&&(K=$o.addAlpha(K,ne));return K}const Fc={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}};function getChrColor(z){if(Lc[z])return Lc[z];if(Lc["chr"+z]){const K=Lc["chr"+z];Lc[z]=K;return K}{const K=$o.randomRGB(0,255);Lc[z]=K;return K}}const Lc={chrX:"rgb(204, 153, 0)",chrY:"rgb(153, 204, 0)",chrUn:"rgb(50, 50, 50)",chr1:"rgb(80, 80, 255)",chrI:"rgb(139, 155, 187)",chr2:"rgb(206, 61, 50)",chrII:"rgb(206, 61, 50)",chr2a:"rgb(216, 71, 60)",chr2b:"rgb(226, 81, 70)",chr3:"rgb(116, 155, 88)",chrIII:"rgb(116, 155, 88)",chr4:"rgb(240, 230, 133)",chrIV:"rgb(240, 230, 133)",chr5:"rgb(70, 105, 131)",chr6:"rgb(186, 99, 56)",chr7:"rgb(93, 177, 221)",chr8:"rgb(128, 34, 104)",chr9:"rgb(107, 215, 107)",chr10:"rgb(213, 149, 167)",chr11:"rgb(146, 72, 34)",chr12:"rgb(131, 123, 141)",chr13:"rgb(199, 81, 39)",chr14:"rgb(213, 143, 92)",chr15:"rgb(122, 101, 165)",chr16:"rgb(228, 175, 105)",chr17:"rgb(59, 27, 83)",chr18:"rgb(205, 222, 183)",chr19:"rgb(97, 42, 121)",chr20:"rgb(174, 31, 99)",chr21:"rgb(231, 199, 111)",chr22:"rgb(90, 101, 94)",chr23:"rgb(204, 153, 0)",chr24:"rgb(153, 204, 0)",chr25:"rgb(51, 204, 0)",chr26:"rgb(0, 204, 51)",chr27:"rgb(0, 204, 153)",chr28:"rgb(0, 153, 204)",chr29:"rgb(10, 71, 255)",chr30:"rgb(71, 117, 255)",chr31:"rgb(255, 194, 10)",chr32:"rgb(255, 209, 71)",chr33:"rgb(153, 0, 51)",chr34:"rgb(153, 26, 0)",chr35:"rgb(153, 102, 0)",chr36:"rgb(128, 153, 0)",chr37:"rgb(51, 153, 0)",chr38:"rgb(0, 153, 26)",chr39:"rgb(0, 153, 102)",chr40:"rgb(0, 128, 153)",chr41:"rgb(0, 51, 153)",chr42:"rgb(26, 0, 153)",chr43:"rgb(102, 0, 153)",chr44:"rgb(153, 0, 128)",chr45:"rgb(214, 0, 71)",chr46:"rgb(255, 20, 99)",chr47:"rgb(0, 214, 143)",chr48:"rgb(20, 255, 177)"};let Bc;let Nc;const Dc=1e4;class RulerViewport extends TrackViewport{constructor(z,K,ee,te){super(z,K,ee,te)}get contentDiv(){return this.$viewport.get(0)}initializationHelper(){this.$multiLocusCloseButton=pt("<div>",{class:"igv-multi-locus-close-button"});this.$viewport.append(this.$multiLocusCloseButton);this.$multiLocusCloseButton.get(0).appendChild(cn.createIcon("times-circle"));this.$multiLocusCloseButton.click((()=>{this.browser.removeMultiLocusPanel(this.referenceFrame)}));this.$rulerLabel=pt("<div>",{class:"igv-multi-locus-ruler-label"});this.$viewport.append(this.$rulerLabel);let z;z=document.createElement("div");this.$rulerLabel.append(pt(z));this.$rulerLabel.get(0).addEventListener("click",(async z=>{z.stopPropagation();await this.browser.gotoMultilocusPanel(this.referenceFrame)}));this.$tooltip=pt("<div>",{class:"igv-ruler-tooltip"});this.$tooltip.height(this.$viewport.height());this.$viewport.append(this.$tooltip);this.$tooltipContent=pt("<div>");this.$tooltip.append(this.$tooltipContent);this.rulerSweeper=new RulerSweeper(this,this.$viewport.get(0).parentElement,this.browser,this.referenceFrame);this.attachMouseHandlers(Ma.isWholeGenomeView(this.referenceFrame.chr));this.$tooltip.hide();this.dismissLocusLabel()}presentLocusLabel(z){this.$multiLocusCloseButton.show();this.$rulerLabel.show();this.$rulerLabel.get(0).style.backgroundColor=getChrColor(this.referenceFrame.chr);const K=this.$rulerLabel.get(0).querySelector("div");const{width:ee}=this.$rulerLabel.get(0).getBoundingClientRect();K.innerHTML=`${this.referenceFrame.getMultiLocusLabel(z)}`;const{width:te}=K.getBoundingClientRect();te/ee>.5&&(K.innerHTML=`${this.referenceFrame.getMultiLocusLabelBPLengthOnly(z)}`)}dismissLocusLabel(){this.$rulerLabel.hide();this.$multiLocusCloseButton.hide()}attachMouseHandlers(z){this.namespace=`.ruler_track_viewport_${this.browser.referenceFrameList.indexOf(this.referenceFrame)}`;this.$viewport.off(this.namespace);if(true===z){const z=this.browser.referenceFrameList.indexOf(this.referenceFrame);const K=`click${this.namespace}`;this.$viewport.on(K,(K=>{const{x:ee}=gt.translateMouseCoordinates(K,this.$viewport.get(0));const te=Math.round(this.referenceFrame.start+this.referenceFrame.toBP(ee));let ne;const{chr:re}=this.browser.genome.getChromosomeCoordinate(te);if(1===this.browser.referenceFrameList.length)ne=re;else{let K=this.browser.referenceFrameList.map((({locusSearchString:z})=>z));K[z]=re;ne=K.join(" ")}this.browser.search(ne)}));this.$viewport.get(0).style.cursor="pointer"}else this.$viewport.get(0).style.cursor="default"}mouseMove(z){if(true===this.browser.cursorGuideVisible){if(void 0===Nc){Nc=this;this.$tooltip.show()}else if(Nc.guid!==this.guid){Nc.$tooltip&&Nc.$tooltip.hide();this.$tooltip.show();Nc=this}else this.$tooltip.show();const K=this.browser.isMultiLocusWholeGenomeView()||Ma.isWholeGenomeView(this.referenceFrame.chr);if(K){this.$tooltip.hide();return}const{x:ee}=gt.translateMouseCoordinates(z,this.$viewport.get(0));const{start:te,bpPerPixel:ne}=this.referenceFrame;const re=Math.round(.5+te+Math.max(0,ee)*ne);this.$tooltipContent.text(numberFormatter$1(re));const{width:ie}=this.$tooltipContent.get(0).getBoundingClientRect();const{width:se}=this.$viewport.get(0).getBoundingClientRect();this.$tooltip.css({left:`${Vo.clamp(ee,0,se-ie)}px`});clearTimeout(Bc);Bc=setTimeout((()=>{this.$tooltip&&this.$tooltip.hide()}),Dc)}}startSpinner(){}stopSpinner(){}dispose(){this.rulerSweeper.dispose();super.dispose()}}class IdeogramViewport extends TrackViewport{constructor(z,K,ee,te){super(z,K,ee,te)}initializationHelper(){this.canvas=document.createElement("canvas");this.canvas.className="igv-ideogram-canvas";this.$viewport.append(pt(this.canvas));this.ideogram_ctx=this.canvas.getContext("2d");this.addMouseHandlers()}addMouseHandlers(){this.addViewportClickHandler(this.$viewport.get(0))}addViewportClickHandler(z){this.boundClickHandler=clickHandler.bind(this);z.addEventListener("click",this.boundClickHandler);function clickHandler(z){const{xNormalized:K,width:ee}=gt.translateMouseCoordinates(z,this.ideogram_ctx.canvas);const{bpLength:te}=this.browser.genome.getChromosome(this.referenceFrame.chr);const ne=this.referenceFrame.bpPerPixel*ee;const re=ne/te;let ie=K;ie-re/2<0&&(ie=re/2);ie+re/2>1&&(ie=1-re/2);const se=Math.round((ie-re/2)*te);const oe=Math.round((ie+re/2)*te);this.referenceFrame.start=se;this.referenceFrame.end=oe;this.referenceFrame.bpPerPixel=(oe-se)/ee;this.browser.updateViews(this.referenceFrame,this.browser.trackViews,true)}}setWidth(z){this.$viewport.width(z)}drawSVGWithContext(z,K,ee,te,ne,re,ie){z.saveWithTranslationAndClipRect(te,ne,re,K,ee,ie);this.trackView.track.draw({context:z,referenceFrame:this.referenceFrame,pixelWidth:K,pixelHeight:ee});z.restore()}repaint(){this.draw({referenceFrame:this.referenceFrame})}draw({referenceFrame:z}){Jo.configureHighDPICanvas(this.ideogram_ctx,this.$viewport.width(),this.$viewport.height());this.trackView.track.draw({context:this.ideogram_ctx,referenceFrame:z,pixelWidth:this.$viewport.width(),pixelHeight:this.$viewport.height()})}startSpinner(){}stopSpinner(){}}function createViewport(z,K,ee,te){if("ruler"===z.track.type)return new RulerViewport(z,K,ee,te);if("ideogram"===z.track.id)return new IdeogramViewport(z,K,ee,te);{const ne=new TrackViewport(z,K,ee,te);return ne}}const Pc=10;const Oc={textAlign:"start",textBaseline:"bottom",strokeStyle:"black",fillStyle:"black"};class SampleNameViewport{constructor(z,K,ee,te){this.guid=gt.guid();this.trackView=z;this.browser=z.browser;this.viewport=gt.div({class:"igv-viewport"});K.appendChild(this.viewport);z.track.height&&(this.viewport.style.height=`${z.track.height}px`);this.canvas=document.createElement("canvas");this.viewport.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d");this.trackScrollDelta=0;this.contentTop=0;this.setWidth(te);false===this.browser.showSampleNames&&this.hide();this.addMouseHandlers()}checkCanvas(){const z=window.devicePixelRatio;const K=this.viewport.clientHeight;const ee=this.browser.sampleNameViewportWidth;if(this.canvas.width!==ee*z||this.canvas.height!==K*z){const te=this.canvas;te.width=ee*z;te.height=K*z;te.style.width=`${ee}px`;te.style.height=`${K}px`;this.ctx=this.canvas.getContext("2d");this.ctx.scale(z,z)}}setTop(z){if("function"===typeof this.trackView.track.getSamples){this.contentTop=z;const K=this.trackView.track.getSamples();this.repaint(K)}}setWidth(z){this.viewport.innerWidth=z;this.checkCanvas()}show(){this.viewport.style.display="block"}hide(){this.viewport.style.display="none"}async repaint(z){this.checkCanvas();this.draw({context:this.ctx,samples:z})}draw({context:z,samples:K}){if(!K||0===K.names.length)return;configureFont(z,Oc,K.height);const ee=4;z.clearRect(0,0,z.canvas.width,z.canvas.height);z.fillStyle=appleCrayonRGB("lead");const te=this.viewport.getBoundingClientRect().height;let ne=(K.yOffset||0)+this.contentTop;for(let re of K.names){if(ne>te)break;if(ne+K.height>0){const te=re;const ie=getYFont(z,te,ne,K.height);z.fillText(te,ee,ie)}ne+=K.height}}renderSVGContext(z,{deltaX:K,deltaY:ee}){if("function"===typeof this.trackView.track.getSamples){const te=this.trackView.track.getSamples();const ne=0;const{width:re,height:ie}=this.viewport.getBoundingClientRect();const se=(this.trackView.track.name||this.trackView.track.id).replace(/\W/g,"");const oe=`${se}_sample_names_guid_${gt.guid()}`;z.saveWithTranslationAndClipRect(oe,K,ee+ne,re,ie,-ne);this.draw({context:z,samples:te});z.restore()}}addMouseHandlers(){this.addViewportContextMenuHandler(this.viewport)}removeMouseHandlers(){this.removeViewportContextMenuHandler(this.viewport)}addViewportContextMenuHandler(z){this.boundContextMenuHandler=contextMenuHandler.bind(this);z.addEventListener("contextmenu",this.boundContextMenuHandler);function contextMenuHandler(z){z.preventDefault();z.stopPropagation();const K={label:"Name Panel Width",value:this.browser.sampleNameViewportWidth,callback:z=>{this.browser.sampleNameViewportWidth=parseInt(z);for(let{sampleNameViewport:z}of this.browser.trackViews)z.setWidth(this.browser.sampleNameViewportWidth);this.browser.layoutChange()}};this.browser.inputDialog.present(K,z)}}removeViewportContextMenuHandler(z){z.removeEventListener("contextmenu",this.boundContextMenuHandler)}dispose(){this.removeMouseHandlers();this.viewport.remove()}}function getYFont(z,K,ee,te){return ee+te-getSampleNameYShim(z,K,te)}function getSampleNameYShim(z,K,ee){const{actualBoundingBoxAscent:te,actualBoundingBoxDescent:ne}=z.measureText(K);return(ee-(te+ne))/2}function configureFont(z,{textAlign:K,textBaseline:ee,strokeStyle:te,fillStyle:ne},re){const ie=Math.min(re,Pc);z.font=`${ie}px sans-serif`;z.textAlign=K;z.textBaseline=ee;z.fillStyle=ne}const MenuPopup=function(z){this.popover=gt.div({class:"igv-menu-popup"});z.appendChild(this.popover);const K=gt.div({class:"igv-menu-popup-header"});this.popover.appendChild(K);hn.attachDialogCloseHandlerWithParent(K,(()=>this.hide()));this.popoverContent=gt.div();this.popover.appendChild(this.popoverContent);makeDraggable(this.popover,K);K.addEventListener("click",(z=>{z.stopPropagation();z.preventDefault()}));this.hide()};MenuPopup.prototype.hide=function(){this.popover.style.display="none"};MenuPopup.prototype.presentMenuList=function(z){hideAllMenuPopups();if(z.length>0){this.popoverContent.innerHTML="";z=gn.trackMenuItemListHelper(z,this);for(let K of z){K.init&&K.init();let ee=K.object;0===z.indexOf(K)&&ee.removeClass("igv-track-menu-border-top");ee.hasClass("igv-track-menu-border-top")||ee.hasClass("igv-menu-popup-check-container")||ee.is("div")&&ee.addClass("igv-menu-popup-shim");this.popoverContent.appendChild(ee.get(0))}this.popover.style.display="flex";const{width:K}=this.popover.getBoundingClientRect();this.popover.style.left=-K+"px";this.popover.style.top="0px"}};MenuPopup.prototype.presentTrackContextMenu=function(z,K){this.popoverContent.innerHTML="";const ee=createMenuElements(K,this.popover);for(let{el:z}of ee)this.popoverContent.appendChild(z);present(z,this.popover)};MenuPopup.prototype.dispose=function(){this.popoverContent.innerHTML="";this.popover.innerHTML="";Object.keys(this).forEach((function(z){this[z]=void 0}))};function createMenuElements(z,K){return z.map((z=>{let ee;if("string"===typeof z&&"<hr/>"===z)ee=document.createElement("hr");else if("string"===typeof z){ee=gt.div({class:"context-menu"});ee.innerHTML=z}else if("Node"===typeof z)ee=z;else{"function"===typeof z.init&&z.init();if("checkbox"===z.type)ee=createCheckbox("Show all bases",z.value);else if("color"===z.type){const te=new GenericColorPicker({parent:K.parentElement,width:364});te.configure(void 0,{color:K=>z.click(K)});ee=gt.div({class:"context-menu"});"string"===typeof z.label&&(ee.innerHTML=z.label);const clickHandler=z=>{te.show();gt.hide(K);z.preventDefault();z.stopPropagation()};ee.addEventListener("click",clickHandler);ee.addEventListener("touchend",clickHandler);ee.addEventListener("mouseup",(function(z){z.preventDefault();z.stopPropagation()}))}else{ee=gt.div({class:"context-menu"});"string"===typeof z.label&&(ee.innerHTML=z.label)}if(z.click&&"color"!==z.type){ee.addEventListener("click",handleClick);ee.addEventListener("touchend",handleClick);ee.addEventListener("mouseup",(function(z){z.preventDefault();z.stopPropagation()}));function handleClick(ee){z.click();gt.hide(K);ee.preventDefault();ee.stopPropagation()}}}return{el:ee,init:z.init}}))}function present(z,K){K.style.display="flex";const{x:ee,y:te}=gt.translateMouseCoordinates(z,K.parentNode);const{width:ne}=K.getBoundingClientRect();const re=ee+ne;const{width:ie}=K.parentNode.getBoundingClientRect();K.style.left=`${re>ie?ee-(re-ie):ee}px`;K.style.top=`${te}px`}const hideAllMenuPopups=()=>{const z=document.querySelectorAll(".igv-menu-popup");for(let K=0;K<z.length;K++)z[K].style.display="none"};const zc=50;const Hc=new Set(["ruler","ideogram"]);const Uc=new Set(["ruler","sequence","ideogram"]);class TrackView{constructor(z,K,ee){this.browser=z;this.track=ee;ee.trackView=this;this.addDOMToColumnContainer(z,K,z.referenceFrameList)}startSpinner(){this.viewports&&this.viewports.length>0&&this.viewports[0].startSpinner()}stopSpinner(){this.viewports&&this.viewports.length>0&&this.viewports[0].stopSpinner()}addDOMToColumnContainer(z,K,ee){this.axis=this.createAxis(z,this.track);this.viewports=[];const te=z.calculateViewportWidth(ee.length);const ne=K.querySelectorAll(".igv-column");for(let z=0;z<ne.length;z++){const K=createViewport(this,ne[z],ee[z],te);this.viewports.push(K)}this.sampleNameViewport=new SampleNameViewport(this,z.columnContainer.querySelector(".igv-sample-name-column"),void 0,z.sampleNameViewportWidth);this.createTrackScrollbar(z);this.createTrackDragHandle(z);this.createTrackGearPopup(z)}createAxis(z,K){const ee=gt.div();z.columnContainer.querySelector(".igv-axis-column").appendChild(ee);ee.style.height=`${K.height}px`;if("function"===typeof K.paintAxis){K.dataRange&&ee.addEventListener("click",(()=>{z.dataRangeDialog.configure(this);z.dataRangeDialog.present(pt(z.columnContainer))}));const{width:te,height:ne}=ee.getBoundingClientRect();this.axisCanvas=document.createElement("canvas");this.axisCanvas.style.width=`${te}px`;this.axisCanvas.style.height=`${ne}px`;ee.appendChild(this.axisCanvas)}return ee}resizeAxisCanvas(z,K){this.axis.style.width=`${z}px`;this.axis.style.height=`${K}px`;if("function"===typeof this.track.paintAxis){this.axisCanvas.style.width=`${z}px`;this.axisCanvas.style.height=`${K}px`}}removeDOMFromColumnContainer(){this.boundAxisClickHander&&this.removeAxisEventListener(this.axis);this.axis.remove();for(let z of this.viewports)z.$viewport.remove();this.sampleNameViewport.dispose();this.removeTrackScrollMouseHandlers();this.outerScroll.remove();this.removeTrackDragMouseHandlers();this.dragHandle.remove();this.removeTrackGearMouseHandlers();this.gearContainer.remove()}renderSVGContext(z,{deltaX:K,deltaY:ee}){renderSVGAxis(z,this.track,this.axisCanvas,K,ee);const{width:te}=this.axis.getBoundingClientRect();const{y:ne}=this.viewports[0].$viewport.get(0).getBoundingClientRect();let re={deltaX:te+K,deltaY:ne+ee};for(let K of this.viewports){K.renderSVGContext(z,re);const{width:ee}=K.$viewport.get(0).getBoundingClientRect();re.deltaX+=ee}true===this.browser.showSampleNames&&this.sampleNameViewport.renderSVGContext(z,re)}dataRange(){return this.track.dataRange?this.track.dataRange:void 0}setDataRange(z,K){void 0!==z&&(this.track.dataRange.min=z);void 0!==K&&(this.track.dataRange.max=K);this.track.autoscale=false;this.repaintViews()}presentColorPicker(z){if(false===Uc.has(this.track.type)){const K=[];const ee=this.track.color||this.track.defaultColor;isString$2(ee)&&K.push(ee);this.track.altColor&&isString$2(this.track.altColor)&&K.push(this.track.altColor);const te=K.map((z=>z.startsWith("#")?z:z.startsWith("rgb(")?$o.rgbToHex(z):$o.colorNameToHex(z)));const ne={color:z=>{this.track.color=z;this.repaintViews()},altColor:z=>{this.track.altColor=z;this.repaintViews()}};this.browser.genericColorPicker.configure(te,ne);this.browser.genericColorPicker.setActiveColorHandler(z);this.browser.genericColorPicker.show()}}setTrackHeight(z,K){if(!K){this.track.minHeight&&(z=Math.max(this.track.minHeight,z));this.track.maxHeight&&(z=Math.min(this.track.maxHeight,z))}this.track.height=z;this.resizeAxisCanvas(this.axis.clientWidth,this.track.height);"function"===typeof this.track.paintAxis&&this.paintAxis();for(let{$viewport:K}of this.viewports)K.height(z);this.sampleNameViewport.viewport.style.height=`${z}px`;if("function"!==typeof this.track.computePixelHeight)for(let K of this.viewports)K.setContentHeight(z);this.repaintViews();false===Hc.has(this.track.type)&&this.updateScrollbar();this.dragHandle.style.height=`${z}px`;this.gearContainer.style.height=`${z}px`}updateScrollbar(){const z=this.viewports[0].$viewport.height();this.outerScroll.style.height=`${z}px`;const K=this.maxViewportContentHeight();const ee=Math.round(z/K*z);if(K>z){this.innerScroll.style.display="block";this.innerScroll.style.height=`${ee}px`}else this.innerScroll.style.display="none"}moveScroller(z){const K=pt(this.innerScroll).position().top+z;const ee=Math.min(Math.max(0,K),this.outerScroll.clientHeight-this.innerScroll.clientHeight);pt(this.innerScroll).css("top",`${ee}px`);const te=this.maxViewportContentHeight();const ne=-Math.round(ee*(te/this.viewports[0].$viewport.height()));for(let z of this.viewports)z.setTop(ne);this.sampleNameViewport.trackScrollDelta=z;this.sampleNameViewport.setTop(ne)}isLoading(){for(let z of this.viewports)if(z.isLoading())return true}repaintViews(){for(let z of this.viewports)z.isVisible()&&z.repaint();"function"===typeof this.track.paintAxis&&this.paintAxis();this.repaintSamples()}repaintSamples(){if("function"===typeof this.track.getSamples){const z=this.track.getSamples();this.sampleNameViewport.repaint(z)}}setTrackLabelName(z){this.viewports.forEach((K=>K.setTrackLabel(z)))}
/**
         * Called in response to a window resize event, change in # of multilocus panels, or other event that changes
         * the width of the track view.
         *
         * @param viewportWidth  The width of each viewport in this track view.
         */resize(z){for(let K of this.viewports)K.setWidth(z)}
/**
         * Update viewports to reflect current genomic state, possibly loading additional data.
         *
         * @param force - if true, force a repaint even if no new data is loaded
         * @returns {Promise<void>}
         */async updateViews(){if(!(this.browser&&this.browser.referenceFrameList))return;const z=this.viewports.filter((z=>z.isVisible()));z.forEach((z=>z.shift()));if(this.browser.dragObject)return;const K=z.filter((z=>z.needsRepaint())).filter((z=>z.checkZoomIn()));const ee=K.filter((z=>z.needsReload()));for(let z of ee)await z.loadFeatures();if(this.disposed)return;if(this.track&&"function"===typeof this.track.variantRowCount&&ee.length>0){let z=0;for(let K of this.viewports)K.featureCache&&K.featureCache.features&&(z=Math.max(z,K.featureCache.features.reduce(((z,K)=>Math.max(z,K.row||0)),0)));const K=this.track.nVariantRows;if(K!==z+1){this.track.variantRowCount(z+1);for(let z of this.viewports)z.checkContentHeight()}}if(this.track.autoscale){let K=[];for(let ee of z){const z=ee.referenceFrame;const te=z.start;const ne=te+z.toBP(ee.getWidth());if(ee.featureCache&&ee.featureCache.features)if("function"===typeof ee.featureCache.features.getMax){const z=ee.featureCache.features.getMax(te,ne);K.push({value:z})}else{const z=Xo.findOverlapping(ee.featureCache.features,te,ne);for(let ee of z)K.push(ee)}}"function"===typeof this.track.doAutoscale?this.track.dataRange=this.track.doAutoscale(K):this.track.dataRange=doAutoscale(K)}const te=this.track.autoscale||this.track.autoscaleGroup||"ruler"===this.track.type;for(let ee of z)K.includes(ee)?ee.repaint():te&&ee.refresh();this.adjustTrackHeight();this.repaintSamples();this.updateRulerViewportLabels()}clearCachedFeatures(){for(let z of this.viewports)z.clearCache()}updateRulerViewportLabels(){const z=this.browser.calculateViewportWidth(this.viewports.length);for(let K of this.viewports)"ruler"===this.track.type&&(this.viewports.length>1?K.presentLocusLabel(z):K.dismissLocusLabel())}async getInViewFeatures(){if(!(this.browser&&this.browser.referenceFrameList))return[];let z=[];const K=this.viewports.filter((z=>z.isVisible()));for(let ee of K){const K=ee.referenceFrame;const{chr:te,start:ne,bpPerPixel:re}=ee.referenceFrame;const ie=ne+K.toBP(ee.getWidth());const se=!ee.featureCache||!ee.featureCache.containsRange(te,ne,ie,re);se&&await ee.loadFeatures();if(ee.featureCache&&ee.featureCache.features)if("function"===typeof ee.featureCache.features.getMax){const K=ee.featureCache.features.getMax(ne,ie);z.push({value:K})}else{const K="function"===typeof ee.featureCache.queryFeatures?ee.featureCache.queryFeatures(te,ne,ie):Xo.findOverlapping(ee.featureCache.features,ne,ie);z=z.concat(K)}}return z}checkContentHeight(){for(let z of this.viewports)z.checkContentHeight();this.adjustTrackHeight()}adjustTrackHeight(){var z=this.maxViewportContentHeight();this.track.autoHeight?this.setTrackHeight(z,false):this.track.paintAxis&&this.paintAxis();if(false===Hc.has(this.track.type)){const K=this.viewports[0].getContentTop();const ee=this.viewports[0].$viewport.height();const te=Math.min(0,ee-z);if(K<te)for(let z of this.viewports)z.setTop(te);this.updateScrollbar()}}createTrackScrollbar(z){const K=gt.div();z.columnContainer.querySelector(".igv-scrollbar-column").appendChild(K);K.style.height=`${this.track.height}px`;this.outerScroll=K;if(false===Hc.has(this.track.type)){const ee=gt.div();K.appendChild(ee);this.innerScroll=ee;this.addTrackScrollMouseHandlers(z)}}createTrackDragHandle(z){const K="ideogram"===this.track.type||"ruler"===this.track.type?"igv-track-drag-shim":"igv-track-drag-handle";this.dragHandle=gt.div({class:K});z.columnContainer.querySelector(".igv-track-drag-column").appendChild(this.dragHandle);this.dragHandle.style.height=`${this.track.height}px`;this.addTrackDragMouseHandlers(z)}createTrackGearPopup(z){this.gearContainer=gt.div();z.columnContainer.querySelector(".igv-gear-menu-column").appendChild(this.gearContainer);this.gearContainer.style.height=`${this.track.height}px`;if(true===this.track.ignoreTrackMenu);else{this.gear=gt.div();this.gearContainer.appendChild(this.gear);this.gear.appendChild(cn.createIcon("cog"));this.trackGearPopup=new MenuPopup(this.gear);this.addTrackGearMouseHandlers()}}addAxisEventListener(z){this.boundAxisClickHander=axisClickHandler.bind(this);z.addEventListener("click",this.boundAxisClickHander);function axisClickHandler(z){this.browser.dataRangeDialog.configure(this);this.browser.dataRangeDialog.present(pt(this.browser.columnContainer))}}removeAxisEventListener(z){z.removeEventListener("click",this.boundAxisClickHander)}addTrackScrollMouseHandlers(z){this.boundTrackScrollMouseDownHandler=trackScrollMouseDownHandler.bind(this);this.innerScroll.addEventListener("mousedown",this.boundTrackScrollMouseDownHandler);function trackScrollMouseDownHandler(K){K.stopPropagation();const{y:ee}=gt.pageCoordinates(K);pt(this.innerScroll).data("yDown",ee.toString());this.boundColumnContainerMouseMoveHandler=columnContainerMouseMoveHandler.bind(this);z.columnContainer.addEventListener("mousemove",this.boundColumnContainerMouseMoveHandler);function columnContainerMouseMoveHandler(z){z.stopPropagation();const{y:K}=gt.pageCoordinates(z);this.moveScroller(K-parseInt(pt(this.innerScroll).data("yDown")));pt(this.innerScroll).data("yDown",K.toString())}}this.boundColumnContainerMouseUpHandler=columnContainerMouseUpHandler.bind(this);z.columnContainer.addEventListener("mouseup",this.boundColumnContainerMouseUpHandler);function columnContainerMouseUpHandler(K){z.columnContainer.removeEventListener("mousemove",this.boundColumnContainerMouseMoveHandler)}}removeTrackScrollMouseHandlers(){if(false===Hc.has(this.track.type)){this.innerScroll.removeEventListener("mousedown",this.boundTrackScrollMouseDownHandler);this.browser.columnContainer.removeEventListener("mouseup",this.boundColumnContainerMouseUpHandler);this.browser.columnContainer.removeEventListener("mousemove",this.boundColumnContainerMouseMoveHandler)}}addTrackDragMouseHandlers(z){if("ideogram"===this.track.id||"ruler"===this.track.id);else{let K;this.boundTrackDragMouseDownHandler=trackDragMouseDownHandler.bind(this);this.dragHandle.addEventListener("mousedown",this.boundTrackDragMouseDownHandler);function trackDragMouseDownHandler(ee){ee.preventDefault();K=ee.target;K.classList.add("igv-track-drag-handle-hover");z.startTrackDrag(this)}this.boundDocumentTrackDragMouseUpHandler=documentTrackDragMouseUpHandler.bind(this);document.addEventListener("mouseup",this.boundDocumentTrackDragMouseUpHandler);function documentTrackDragMouseUpHandler(ee){z.endTrackDrag();K&&ee.target!==K&&K.classList.remove("igv-track-drag-handle-hover");K=void 0}this.boundTrackDragMouseEnterHandler=trackDragMouseEnterHandler.bind(this);this.dragHandle.addEventListener("mouseenter",this.boundTrackDragMouseEnterHandler);function trackDragMouseEnterHandler(ee){ee.preventDefault();void 0===K&&ee.target.classList.add("igv-track-drag-handle-hover");z.updateTrackDrag(this)}this.dragHandle.addEventListener("mouseout",(z=>{z.preventDefault();void 0===K&&z.target.classList.remove("igv-track-drag-handle-hover")}));this.boundTrackDragMouseOutHandler=trackDragMouseOutHandler.bind(this);this.dragHandle.addEventListener("mouseout",this.boundTrackDragMouseOutHandler);function trackDragMouseOutHandler(z){z.preventDefault();void 0===K&&z.target.classList.remove("igv-track-drag-handle-hover")}}}removeTrackDragMouseHandlers(){if("ideogram"===this.track.id||"ruler"===this.track.id);else{this.dragHandle.removeEventListener("mousedown",this.boundTrackDragMouseDownHandler);document.removeEventListener("mouseup",this.boundDocumentTrackDragMouseUpHandler);this.dragHandle.removeEventListener("mouseup",this.boundTrackDragMouseEnterHandler);this.dragHandle.removeEventListener("mouseout",this.boundTrackDragMouseOutHandler)}}addTrackGearMouseHandlers(){if(true===this.track.ignoreTrackMenu);else{this.boundTrackGearClickHandler=trackGearClickHandler.bind(this);this.gear.addEventListener("click",this.boundTrackGearClickHandler);function trackGearClickHandler(z){z.preventDefault();z.stopPropagation();this.trackGearPopup.presentMenuList(gn.trackMenuItemList(this))}}}removeTrackGearMouseHandlers(){true===this.track.ignoreTrackMenu||this.gear.removeEventListener("click",this.boundTrackGearClickHandler)}dispose(){this.removeAxisEventListener(this.axis);this.axis.remove();for(let z of this.viewports)z.dispose();this.sampleNameViewport.dispose();this.removeTrackScrollMouseHandlers();this.outerScroll.remove();this.removeTrackDragMouseHandlers();this.dragHandle.remove();this.removeTrackGearMouseHandlers();this.gearContainer.remove();"function"===typeof this.track.dispose&&this.track.dispose();for(let z of Object.keys(this))this[z]=void 0;this.alert&&this.alert.container.remove();this.disposed=true}paintAxis(){if("function"===typeof this.track.paintAxis){const{width:z,height:K}=this.axisCanvas.getBoundingClientRect();const ee=window.devicePixelRatio||1;this.axisCanvas.height=ee*K;this.axisCanvas.width=ee*z;const te=this.axisCanvas.getContext("2d");te.scale(ee,ee);this.track.paintAxis(te,z,K)}}maxViewportContentHeight(){return Math.max(this.viewports.map((z=>z.getContentHeight())))}}function renderSVGAxis(z,K,ee,te,ne){if("function"===typeof K.paintAxis){const{y:re,width:ie,height:se}=ee.getBoundingClientRect();const oe=(K.name||K.id).replace(/\W/g,"");const ae=`${oe}_axis_guid_${gt.guid()}`;z.saveWithTranslationAndClipRect(ae,te,re+ne,ie,se,0);K.paintAxis(z,ie,se);z.restore()}}const Vc="rgb(150, 150, 150)";class WigTrack extends TrackBase{static defaults={height:50,flipAxis:false,logScale:false,windowFunction:"mean",graphType:"bar",autoscale:true,normalize:void 0,scaleFactor:void 0};constructor(z,K){super(z,K)}init(z){super.init(z);this.type="wig";this.featureType="numeric";this.paintAxis=paintAxis;const K=z.format?z.format.toLowerCase():z.format;if(z.featureSource){this.featureSource=z.featureSource;delete z.featureSource}else this.featureSource="bigwig"===K?new BWSource(z,this.browser.genome):"tdf"===K?new TDFSource(z,this.browser.genome):FeatureSource(z,this.browser.genome);void 0===z.max||true===z.autoscale?this.autoscale=true:this.dataRange={min:z.min||0,max:z.max}}async postInit(){const z=await this.getHeader();this.disposed||z&&this.setTrackProperties(z)}async getFeatures(z,K,ee,te){const ne=await this.featureSource.getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,visibilityWindow:this.visibilityWindow,windowFunction:this.windowFunction});if(this.normalize&&this.featureSource.normalizationFactor){const z=this.featureSource.normalizationFactor;for(let K of ne)K.value*=z}if(this.scaleFactor){const z=this.scaleFactor;for(let K of ne)K.value*=z}return ne}menuItemList(){let z=[];if(void 0!==this.flipAxis){z.push("<hr>");z.push({label:"Flip y-axis",click:()=>{this.flipAxis=!this.flipAxis;this.trackView.repaintViews()}})}z=z.concat(gn.numericDataMenuItems(this.trackView));return z}async getHeader(){"function"===typeof this.featureSource.getHeader&&(this.header=await this.featureSource.getHeader());return this.header}getScaleFactor(z,K,ee,te){const ne=te?ee/(Math.log10(K+1)-(z<=0?0:Math.log10(z+1))):ee/(K-z);return ne}computeYPixelValue(z,K){return(this.flipAxis?z-this.dataRange.min:this.dataRange.max-z)*K}computeYPixelValueInLogScale(z,K){let ee=this.dataRange.max;let te=this.dataRange.min;if(ee<=0)return 0;te<=-1&&(te=0);te=te<=0?0:Math.log10(te+1);ee=Math.log10(ee+1);z=Math.log10(z+1);return(this.flipAxis?z-te:ee-z)*K}draw(z){const K=z.features;const ee=z.context;const te=z.bpPerPixel;const ne=z.bpStart;const re=z.pixelWidth;z.pixelHeight;const ie=ne+re*te+1;const se=this.color||Vc;let oe;"string"===typeof se&&se.startsWith("rgb(")&&(oe=$o.addAlpha(se,.1));const ae=this.getScaleFactor(this.dataRange.min,this.dataRange.max,z.pixelHeight,this.logScale);const yScale=z=>this.logScale?this.computeYPixelValueInLogScale(z,ae):this.computeYPixelValue(z,ae);if(K&&K.length>0){void 0===this.dataRange.min&&(this.dataRange.min=0);if(this.dataRange.max>this.dataRange.min){let re=-1;let se;const ae=yScale(0);for(let z of K){if(z.end<ne)continue;if(z.start>ie)break;const K=Math.floor((z.start-ne)/te);if(isNaN(K))continue;let oe=yScale(z.value);const le=Math.ceil((z.end-ne)/te);const ce=Math.max(1,le-K);const he=this.getColorForFeature(z);if("points"===this.graphType){const z=this.config.pointSize||3;const te=K+ce/2;Jo.fillCircle(ee,te,oe,z/2,{fillStyle:he,strokeStyle:he})}else if("line"===this.graphType){void 0!=se&&Jo.strokeLine(ee,re,se,K,oe,{fillStyle:he,strokeStyle:he});Jo.strokeLine(ee,K,oe,K+ce,oe,{fillStyle:he,strokeStyle:he})}else{const z=oe-ae;Jo.fillRect(ee,K,ae,ce,z,{fillStyle:he})}re=K+ce;se=oe}if(this.dataRange.min<0){const K=this.dataRange.max/(this.dataRange.max-this.dataRange.min)*z.pixelHeight;Jo.strokeLine(ee,0,K,z.pixelWidth,K,{strokeStyle:oe})}}}if(this.config.hasOwnProperty("guideLines"))for(let K of this.config.guideLines)if(K.hasOwnProperty("color")&&K.hasOwnProperty("y")&&K.hasOwnProperty("dotted")){let ee=yScale(K.y);let te={strokeStyle:K.color,strokeWidth:2};K.dotted?Jo.dashedLine(z.context,0,ee,z.pixelWidth,ee,5,te):Jo.strokeLine(z.context,0,ee,z.pixelWidth,ee,te)}}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));if(K&&K.length>0){const ee=z.genomicLocation;const te=[];K.sort((function(z,K){const te=Math.abs((z.start+z.end)/2-ee);const ne=Math.abs((K.start+K.end)/2-ee);return te-ne}));const ne=K.length>10?K.slice(0,10):K;ne.sort((function(z,K){return z.start-K.start}));for(let z of ne)if(z){te.length>0&&te.push("<hr/>");let K=z.end-z.start===1?numberFormatter$1(z.start+1):numberFormatter$1(z.start+1)+"-"+numberFormatter$1(z.end);te.push({name:"Position:",value:K});te.push({name:"Value:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",value:numberFormatter$1(z.value)})}ne.length<K.length&&te.push("<hr/>...");return te}return[]}get supportsWholeGenome(){return!this.config.indexURL&&false!==this.config.supportsWholeGenome}
/**
         * Return color for feature.
         * @param feature
         * @returns {string}
         */getColorForFeature(z){let K=z.value<0&&this.altColor?this.altColor:this.color||Vc;return"function"===typeof K?K(z.value):K}dispose(){this.trackView=void 0}}
/**
     *
     * @param cs - object containing
     * 1) array of threshold values defining bin boundaries in ascending order
     * 2) array of colors for bins  (length == thresholds.length + 1)
     * @constructor
     */function BinnedColorScale(z){this.thresholds=z.thresholds;this.colors=z.colors}BinnedColorScale.prototype.getColor=function(z){for(let K of this.thresholds)if(z<K)return this.colors[this.thresholds.indexOf(K)];return this.colors[this.colors.length-1]};
/**
     *
     * @param scale - object with the following properties
     *           low
     *           lowR
     *           lowG
     *           lowB
     *           high
     *           highR
     *           highG
     *           highB
     *
     * @constructor
     */function GradientColorScale(z){this.scale=z;this.lowColor="rgb("+z.lowR+","+z.lowG+","+z.lowB+")";this.highColor="rgb("+z.highR+","+z.highG+","+z.highB+")";this.diff=z.high-z.low}GradientColorScale.prototype.getColor=function(z){var K,ee,te,ne,re=this.scale;if(z<=re.low)return this.lowColor;if(z>=re.high)return this.highColor;ne=(z-re.low)/this.diff;K=Math.floor(re.lowR+ne*(re.highR-re.lowR));ee=Math.floor(re.lowG+ne*(re.highG-re.lowG));te=Math.floor(re.lowB+ne*(re.highB-re.lowB));return"rgb("+K+","+ee+","+te+")"};class ConstantColorScale{constructor(z){this.color=z}getColor(){return this.color}}class SegTrack extends TrackBase{constructor(z,K){super(z,K)}init(z){super.init(z);this.type=z.type||"seg";"maf"===this.type&&(this.type="mut");this.isLog=z.isLog;this.displayMode=z.displayMode||"EXPANDED";this.height=z.height||300;this.maxHeight=z.maxHeight||500;this.squishedRowHeight=z.sampleSquishHeight||z.squishedRowHeight||2;this.expandedRowHeight=z.sampleExpandHeight||z.expandedRowHeight||13;this.sampleHeight=this.squishedRowHeight;if(z.color)this.color=z.color;else{this.posColorScale=z.posColorScale||new GradientColorScale({low:.1,lowR:255,lowG:255,lowB:255,high:1.5,highR:255,highG:0,highB:0});this.negColorScale=z.negColorScale||new GradientColorScale({low:-1.5,lowR:0,lowG:0,lowB:255,high:-.1,highR:255,highG:255,highB:255});"mut"===this.type&&(this.colorTable=new ColorTable(z.colorTable||$c))}this.sampleKeys=[];this.sampleNames=new Map;if(z.samples){for(let K of z.samples){this.sampleKeys.push(K);this.sampleNames.set(K,K)}this.explicitSamples=true}const K=Object.assign({},this.config);K.maxWGCount=K.maxWGCount||Number.MAX_SAFE_INTEGER;this.featureSource=FeatureSource(K,this.browser.genome);this.initialSort=z.sort}async postInit(){if("function"===typeof this.featureSource.getHeader){this.header=await this.featureSource.getHeader();if(this.disposed)return}this.header&&this.setTrackProperties(this.header)}menuItemList(){const z=[];const K={SQUISHED:"Squish",EXPANDED:"Expand",FILL:"Fill"};z.push("<hr/>");z.push("DisplayMode:");const ee="seg"===this.type?["SQUISHED","EXPANDED","FILL"]:["SQUISHED","EXPANDED"];for(let te of ee){const ee=createCheckbox(K[te],te===this.displayMode);z.push({object:pt(ee),click:()=>{this.displayMode=te;this.config.displayMode=te;this.trackView.checkContentHeight();this.trackView.repaintViews();this.trackView.moveScroller(this.trackView.sampleNameViewport.trackScrollDelta)}})}return z}hasSamples(){return true}getSamples(){return{names:this.sampleKeys.map((z=>this.sampleNames.get(z))),height:this.sampleHeight,yOffset:0}}async getFeatures(z,K,ee){const te=await this.featureSource.getFeatures({chr:z,start:K,end:ee});if(this.initialSort){const z=this.initialSort;this.sortSamples(z.chr,z.start,z.end,z.direction,te);this.initialSort=void 0}return te}draw({context:z,renderSVG:K,pixelTop:ee,pixelWidth:te,pixelHeight:ne,features:re,bpPerPixel:ie,bpStart:se}){Jo.fillRect(z,0,ee,te,ne,{fillStyle:"rgb(255, 255, 255)"});if(re&&re.length>0){this.checkForLog(re);this.updateSampleKeys(re);const K={};this.sampleKeys.forEach((function(z,ee){K[z]=ee}));let oe;switch(this.displayMode){case"FILL":this.sampleHeight=ne/this.sampleKeys.length;oe=0;break;case"SQUISHED":this.sampleHeight=this.squishedRowHeight;oe=0;break;default:this.sampleHeight=this.expandedRowHeight;oe=1}const ae=this.sampleHeight;for(let z of re)z.pixelRect=void 0;const le=ee+ne;const ce=se+te*ie+1;const he=ie;this.sampleYStart=void 0;for(let te of re){if(te.end<se)continue;if(te.start>ce)break;const ne=te.sampleKey||te.sample;te.row=K[ne];const re=te.row*ae+oe;void 0===this.sampleYStart&&(this.sampleYStart=re);const ie=re+ae;if(ie<ee||re>le)continue;const ue=Math.max(te.start,se);let de=Math.round((ue-se)/he);const fe=Math.min(te.end,ce);const pe=Math.round((fe-se)/he);let ge=Math.max(1,pe-de);let me;this.color?me="function"===typeof this.color?this.color(te):this.color:this.colorTable&&(me=this.colorTable.getColor(te.value.toLowerCase()));let be;if("mut"===this.type){be=ae-2*oe;if(ge<3){ge=3;de-=1}}else{let z=te.value;this.isLog||(z=Vo.log2(z/2));me=z<-.1?this.negColorScale.getColor(z):z>.1?this.posColorScale.getColor(z):"white";let K=ae;if(ae<.25){const ee=.1+2*Math.abs(z);K=Math.min(1,ee*ae)}be=K-2*oe}te.pixelRect={x:de,y:re,w:ge,h:be};z.fillStyle=me;z.fillRect(de,re,ge,be)}}}checkForLog(z){if(void 0===this.isLog){this.isLog=false;for(let K of z)if(K.value<0){this.isLog=true;return}}}
/**
         * Optional method to compute pixel height to accomodate the list of features.  The implementation below
         * has side effects (modifiying the samples hash).  This is unfortunate, but harmless.
         *
         * Note displayMode "FILL" is handled by the viewport
         *
         * @param features
         * @returns {number}
         */computePixelHeight(z){if(!z)return 0;const K="SQUISHED"===this.displayMode?this.squishedRowHeight:this.expandedRowHeight;this.updateSampleKeys(z);return this.sampleKeys.length*K}async sortSamples(z,K,ee,te,ne){ne||(ne=await this.featureSource.getFeatures({chr:z,start:K,end:ee}));if(!ne)return;this.updateSampleKeys(ne);const re={};const ie="ASC"===te?1:-1;const sortSeg=()=>{const z=ee-K+1;for(let te of ne){if(te.end<K)continue;if(te.start>ee)break;const ne=Math.max(K,te.start);const ie=Math.min(ee,te.end);const se=(ie-ne)/z;const oe=te.sampleKey||te.sample;const ae=re[oe]||0;re[oe]=ae+se*te.value}this.sampleKeys.sort((function(z,K){let ee=re[z];let te=re[K];ee||(ee=ie*Number.MAX_VALUE);te||(te=ie*Number.MAX_VALUE);return ee===te?0:ee>te?ie:-1*ie}))};const sortMut=()=>{for(let z of ne){if(z.end<K)continue;if(z.start>ee)break;const te=z.sampleKey||z.sample;(!re.hasOwnProperty(te)||z.value.localeCompare(re[te])>0)&&(re[te]=z.value)}this.sampleKeys.sort((function(z,K){let ee=re[z]||"";let te=re[K]||"";return ie*ee.localeCompare(te)}))};"mut"===this.type?sortMut():sortSeg();this.trackView.repaintViews()}clickedFeatures(z){const K=super.clickedFeatures(z);const ee=z.y;return K.filter((function(z){const K=z.pixelRect;return K&&ee>=K.y&&ee<=K.y+K.h}))}hoverText(z){const K=this.clickedFeatures(z);if(K&&K.length>0)return`${K[0].sample}: ${K[0].value}`}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));const ee=[];for(let z of K){if(ee.length>0){ee.push("<hr/>");ee.push("<hr/>")}const K=z._f||z;const te="function"===typeof K.popupData?K.popupData(this.type,this.browser.genome.id):this.extractPopupData(K);Array.prototype.push.apply(ee,te)}return ee}contextMenuItemList(z){const K=z.viewport.referenceFrame;const ee=z.genomicLocation;const te=this.config.sort?"ASC"===this.config.sort.direction?"DESC":"ASC":"DESC";const ne=K.toBP(2.5);const sortHandler=K=>{const ee=z.viewport;const te=ee.cachedFeatures;this.sortSamples(K.chr,K.start,K.end,K.direction,te)};const re="seg"===this.type?"Sort by value":"Sort by type";return[{label:re,click:K=>{const re={direction:te,chr:z.viewport.referenceFrame.chr,start:ee-ne,end:ee+ne};sortHandler(re);this.config.sort=re}}]}get supportsWholeGenome(){return(false===this.config.indexed||!this.config.indexURL)&&false!==this.config.supportsWholeGenome}updateSampleKeys(z){if(!this.explicitSamples)for(let K of z){const z=K.sampleKey||K.sample;if(!this.sampleNames.has(z)){this.sampleNames.set(z,K.sample);this.sampleKeys.push(z)}}}}const $c={indel:"rgb(0,200,0)","targeted region":"rgb(236,155,43)",truncating:"rgb(\t150,0,0)","non-coding transcript":"rgb(0,0,150)",synonymous:"rgb(109,165,95)",silent:"rgb(109,135,80)",missense_mutation:"rgb(72,130,187)",missense:"rgb(72,130,187)","splice site":"rgb(143,83,155)",splice_region:"rgb(143,83,155)",nonsense:"rgb(216, 57,81)",nonsense_mutation:"rgb(216, 57,81)",frame_shift_del:"rgb(226,135,65)",frame_shift_ins:"rgb(226,135,65)",in_frame_del:"rgb(247,235,94)",in_frame_ins:"rgb(247,235,94)","*other*":"rgb(159,91,50)"};class MergedTrack extends TrackBase{constructor(z,K){super(z,K);this.type="merged";this.featureType="numeric";this.paintAxis=paintAxis;this.graphType=z.graphType}init(z){if(!z.tracks)throw Error("Error: no tracks defined for merged track"+z);super.init(z)}async postInit(){this.tracks=[];const z=[];for(let K of this.config.tracks){K.isMergedTrack=true;const ee=await this.browser.createTrack(K);if(ee){ee.autoscale=false;this.tracks.push(ee)}else console.warn("Could not create track "+K);"function"===typeof ee.postInit&&z.push(ee.postInit())}this.flipAxis=!!this.config.flipAxis&&this.config.flipAxis;this.logScale=!!this.config.logScale&&this.config.logScale;this.autoscale=this.config.autoscale||void 0===this.config.max;this.autoscale||(this.dataRange={min:this.config.min||0,max:this.config.max});for(let z of this.tracks){z.autoscale=false;z.dataRange=this.dataRange}this.height=this.config.height||50;return Promise.all(z)}get height(){return this._height}set height(z){this._height=z;if(this.tracks)for(let K of this.tracks){K.height=z;K.config.height=z}}menuItemList(){let z=[];void 0!==this.flipAxis&&z.push({label:"Flip y-axis",click:()=>{this.flipAxis=!this.flipAxis;this.trackView.repaintViews()}});z=z.concat(gn.numericDataMenuItems(this.trackView));return z}async getFeatures(z,K,ee,te){const ne=this.tracks.map((ne=>ne.getFeatures(z,K,ee,te)));const re=await Promise.all(ne);return new MergedFeatureCollection(re)}draw(z){const K=z.features;for(let ee=0,te=this.tracks.length;ee<te;ee++){const te=Object.assign({},z);te.features=K.featureArrays[ee];this.tracks[ee].dataRange=this.dataRange;this.tracks[ee].flipAxis=this.flipAxis;this.tracks[ee].logScale=this.logScale;this.graphType&&(this.tracks[ee].graphType=this.graphType);this.tracks[ee].draw(te)}}popupData(z){if(z.viewport&&z.viewport.cachedFeatures){const K=z.viewport.cachedFeatures.featureArrays;if(K&&K.length===this.tracks.length){const ee=[];for(let te=0;te<this.tracks.length;te++){te>0&&ee.push("<hr/>");ee.push(`<div style=background-color:rgb(245,245,245);border-bottom-style:dashed;border-bottom-width:1px;padding-bottom:5px;padding-top:10px;font-weight:bold;font-size:larger >${this.tracks[te].name}</div>`);const ne=this.tracks[te].popupData(z,K[te]);ee.push(...ne)}return ee}}}clickedFeatures(z){const K=z.viewport.cachedFeatures;if(!K)return[];const ee=z.genomicLocation;const te=[];for(let ne of K.featureArrays){const K=z.referenceFrame.bpPerPixel>.2?3*z.referenceFrame.bpPerPixel:.2;const re=ee-K;const ie=ee+K;const se=Xo.findOverlapping(ne,re,ie);for(let z of se)te.push(z)}return te}get supportsWholeGenome(){return this.tracks.every((z=>z.supportsWholeGenome))}}class MergedFeatureCollection{constructor(z){this.featureArrays=z}getMax(z,K){let ee=-Number.MAX_VALUE;for(let te of this.featureArrays)for(let ne of te)if("undefined"!==typeof ne.value&&!Number.isNaN(ne.value)){if(ne.end<z)continue;if(ne.start>K)break;ee=Math.max(ee,ne.value)}return ee}}function getArcType(z){if(!z.arcType)return"nested";switch(z.arcType){case"chiapet":return"inView";case"chiapetoutbound":return"partialInView";default:return z.arcType}}const qc="rgb(180,25,137)";class InteractionTrack extends TrackBase{static defaults={height:250,theta:Math.PI/4,arcOrientation:true,showBlocks:true,blockHeight:3,thickness:1,alpha:.02,logScale:true};constructor(z,K){super(z,K)}init(z){super.init(z);this.sinTheta=Math.sin(this.theta);this.cosTheta=Math.cos(this.theta);this.arcType=getArcType(z);this.alpha=z.alpha||.02;this.painter={flipAxis:!this.arcOrientation,dataRange:this.dataRange,paintAxis:paintAxis};if(z.valueColumn){this.valueColumn=z.valueColumn;this.hasValue=true}else if(z.useScore){this.hasValue=true;this.valueColumn="score"}if(z.max){this.dataRange={min:z.min||0,max:z.max};this.autoscale=false}else this.autoscale=true;if(z.featureSource){this.featureSource=z.featureSource;delete z._featureSource}else{this.featureSource=FeatureSource(z,this.browser.genome);this.featureSource.getWGFeatures=getWGFeatures}}async postInit(){if("function"===typeof this.featureSource.getHeader){this.header=await this.featureSource.getHeader();if(this.disposed)return}this.header&&this.setTrackProperties(this.header);if(void 0===this.visibilityWindow&&"function"===typeof this.featureSource.defaultVisibilityWindow){this.visibilityWindow=await this.featureSource.defaultVisibilityWindow();this.featureSource.visibilityWindow=this.visibilityWindow}return this}get supportsWholeGenome(){return true}async getFeatures(z,K,ee){const te=this.visibilityWindow;const ne=await this.featureSource.getFeatures({chr:z,start:K,end:ee,visibilityWindow:te});void 0===this.hasValue&&ne&&ne.length>0&&(this.hasValue=void 0!==ne[0].score);return ne}draw(z){"proportional"===this.arcType||"inView"===this.arcType||"partialInView"===this.arcType?this.drawProportional(z):this.drawNested(z)}drawNested(z){const K=z.context;const ee=z.pixelWidth;const te=z.pixelHeight;const ne=z.viewportWidth;const re=z.bpPerPixel;const ie=z.bpStart;const se=re;Jo.fillRect(K,0,z.pixelTop,ee,te,{fillStyle:"rgb(255, 255, 255)"});const oe=z.features;if(oe){autoscaleNested.call(this);const te=this.arcOrientation?z.pixelHeight:0;const re=this.arcOrientation;K.font="8px sans-serif";K.textAlign="center";for(let z of oe){z.drawState=void 0;let oe;if("function"===typeof this.color)oe=this.color(z);else{oe=this.color||z.color||qc;oe&&this.config.useScore&&(oe=getAlphaColor(oe,scoreShade(z.score)))}K.lineWidth=z.thickness||this.thickness||1;if(z.chr1===z.chr2||"all"===z.chr){const{m1:ae,m2:le}=getMidpoints(z,this.browser.genome);let ce=Math.round((ae-ie)/se);let he=Math.round((le-ie)/se);if(he<0||ce>ee)continue;let ue=he-ce;if(ue<3){ue=3;ce--}const de=ue/2;const fe=de/this.sinTheta;const pe=this.cosTheta*fe;const ge=ce+de;let me,be,ve;if(re){me=this.height+pe;be=Math.PI+Math.PI/2-this.theta;ve=Math.PI+Math.PI/2+this.theta}else{me=-pe;be=Math.PI/2-this.theta;ve=Math.PI/2+this.theta}if(this.showBlocks&&"all"!==z.chr){const ee=(z.start1-ie)/se;const ne=(z.end1-ie)/se;const re=(z.start2-ie)/se;const oe=(z.end2-ie)/se;const ae=this.arcOrientation?-this.blockHeight:this.blockHeight;K.fillRect(ee,te,ne-ee,ae);K.fillRect(re,te,oe-re,ae)}oe&&!this.config.useScore&&ue>ne&&(oe=getAlphaColor(oe,this.alpha));K.strokeStyle=oe;K.fillStyle=oe;K.beginPath();K.arc(ge,me,fe,be,ve,false);K.stroke();z.drawState={xc:ge,yc:me,r:fe}}else{let te=Math.round((z.start-ie)/se);let ne=Math.round((z.end-ie)/se);if(ne<0||te>ee)continue;let ae=ne-te;if(ae<3){ae=3;te--}const le=z.chr===z.chr1?z.chr2:z.chr1;K.strokeStyle=oe;K.fillStyle=getAlphaColor(getChrColor(le),.5);if(re){K.fillRect(te,this.height/2,ae,this.height/2);K.fillText(le,te+ae/2,this.height/2-5);z.drawState={x:te,y:this.height/2,w:ae,h:this.height/2}}else{K.fillRect(te,0,ae,this.height/2);K.fillText(le,te+ae/2,this.height/2+13);z.drawState={x:te,y:0,w:ae,h:this.height/2}}}}}function autoscaleNested(){let z=0;for(let K of oe){let te=(K.start-ie)/se;let ne=(K.end-ie)/se;te>=0&&ne<=ee&&(z=Math.max(z,ne-te))}let K=Math.min(ne,z)/2;if(z>0){let z=(te-10)/K;this.theta=estimateTheta(z);this.sinTheta=Math.sin(this.theta);this.cosTheta=Math.cos(this.theta)}}}getScaleFactor(z,K,ee,te){const ne=te?ee/(Math.log10(K+1)-(z<=0?0:Math.log10(z+1))):ee/(K-z);return ne}drawProportional(z){const K=z.context;const ee=z.pixelWidth;const te=z.pixelHeight;const ne=z.bpPerPixel;const re=z.bpStart;const ie=ne;const se=z.referenceFrame.start;const oe=z.referenceFrame.end;Jo.fillRect(K,0,z.pixelTop,ee,te,{fillStyle:"rgb(255, 255, 255)"});const ae=z.features;if(ae&&ae.length>0){const te=0;const ne=this.getScaleFactor(te,this.dataRange.max,z.pixelHeight-1,this.logScale);const le=this.arcOrientation?z.pixelHeight:0;for(let z of ae){z.drawState=void 0;const te=this.valueColumn?z[this.valueColumn]:z.score;if(void 0===te||Number.isNaN(te))continue;const ae=Math.round((this.logScale?Math.log10(te+1):te)*ne);if(z.chr1===z.chr2||"all"===z.chr){const{m1:ee,m2:ne}=getMidpoints(z,this.browser.genome);let ce=Math.round((ee-re)/ie);let he=Math.round((ne-re)/ie);let ue=he-ce;if(ue<3){ue=3;ce--}if(te<this.dataRange.min||te>this.dataRange.max)continue;if("proportional"!==this.arcType){const z="partialInView"===this.arcType;const K=ee>=se&&ne<=oe;let te=false;let re=false;if(!K&&z){te=se<=ee&&ee<=oe;te||(re=se<=ne&&ne<=oe)}if(!(K||te||re))continue}const de=ue/2;const fe=ce+ue/2;z.drawState={xc:fe,yc:le,radiusX:de,radiusY:ae};const pe=!!this.arcOrientation;const ge=z.color||this.color;K.strokeStyle=ge;K.lineWidth=z.thickness||this.thickness||1;if(true===K.isSVG)K.strokeEllipse(fe,le,de,ae,0,0,Math.PI,pe);else{K.beginPath();K.ellipse(fe,le,de,ae,0,0,Math.PI,pe);K.stroke()}if(this.alpha){K.fillStyle=getAlphaColor(ge,this.alpha);true===K.isSVG?K.fillEllipse(fe,le,de,ae,0,0,Math.PI,pe):K.fill()}if(this.showBlocks&&"all"!==z.chr){K.fillStyle=ge;const ee=(z.start1-re)/ie;const te=(z.end1-re)/ie;const ne=(z.start2-re)/ie;const se=(z.end2-re)/ie;const oe=this.arcOrientation?-this.blockHeight:this.blockHeight;K.fillRect(ee,le,te-ee,oe);K.fillRect(ne,le,se-ne,oe)}}else{let ne=Math.round((z.start-re)/ie);let se=Math.round((z.end-re)/ie);if(se<0||ne>ee||te<this.dataRange.min||te>this.dataRange.max)continue;const oe=Math.min(ae,this.height-13);let le=se-ne;if(le<3){le=3;ne--}const ce=z.chr===z.chr1?z.chr2:z.chr1;K.font="8px sans-serif";K.textAlign="center";K.fillStyle=getAlphaColor(getChrColor(ce),.5);if(this.arcOrientation){const ee=this.height-oe;K.fillRect(ne,ee,le,oe);K.fillText(ce,ne+le/2,ee-5);z.drawState={x:ne,y:ee,w:le,h:oe}}else{K.fillRect(ne,0,le,oe);K.fillText(ce,ne+le/2,oe+13);z.drawState={x:ne,y:0,w:le,h:oe}}}}}}clearAxis(z,K,ee){Jo.fillRect(z,0,0,K,ee,{fillStyle:"rgb(255, 255, 255)"})}paintAxis(z,K,ee){const te={min:0,max:this.dataRange.max};if("proportional"===this.arcType){this.painter.flipAxis=!this.arcOrientation;this.painter.dataRange=te;this.painter.paintAxis(z,K,ee)}else if("inView"===this.arcType||"partialInView"===this.arcType){this.painter.flipAxis=!this.arcOrientation;this.painter.dataRange=te;this.painter.paintAxis(z,K,ee)}else this.clearAxis(z,K,ee)}menuItemList(){let z=[];if(this.hasValue){z.push("<hr/>");const K={nested:"Nested",proportional:"Proportional - All",inView:"Proportional - Both Ends in View",partialInView:"Proportional - One End in View"};z.push("<b>Arc Type</b>");for(let ee of["nested","proportional","inView","partialInView"])z.push({object:pt(createCheckbox(K[ee],ee===this.arcType)),click:()=>{this.arcType=ee;this.trackView.repaintViews()}})}z.push("<hr/>");z.push({name:"Toggle arc direction",click:()=>{this.arcOrientation=!this.arcOrientation;this.trackView.repaintViews()}});z.push({name:this.showBlocks?"Hide Blocks":"Show Blocks",click:()=>{this.showBlocks=!this.showBlocks;this.trackView.repaintViews()}});"proportional"!==this.arcType&&"inView"!==this.arcType&&"partialInView"!==this.arcType||(z=z.concat(gn.numericDataMenuItems(this.trackView)));if(this.browser.circularView){z.push("<hr/>");z.push({label:"Add interactions to circular view",click:()=>{for(let z of this.trackView.viewports)this.addChordsForViewport(z.referenceFrame)}})}return z}contextMenuItemList(z){if(this.browser.circularView){const K=z.viewport;const ee=[];ee.push({label:"Add interactions to circular view",click:()=>{const z=K.referenceFrame;this.addChordsForViewport(z)}});ee.push("<hr/>");return ee}}
/**
         * Add chords to the circular view for the given viewport, represented by its reference frame
         * @param refFrame
         */addChordsForViewport(z){const K="all"===z.chr?this.featureSource.getAllFeatures():this.featureSource.featureCache.queryFeatures(z.chr,z.start,z.end);const ee=K.filter((z=>z.drawState));if(0===ee.length)return;const te=makeBedPEChords(ee);sendChords(te,this,z,.5)}doAutoscale(z){let K=0;if(z)for(let ee of z){const z=this.valueColumn?ee[this.valueColumn]:ee.score;Number.isNaN(z)||(K=Math.max(K,z))}return{min:0,max:K}}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));const ee=[];for(let z of K){const K=z._||z;ee.push({name:"Region 1",value:positionString(K.chr1,K.start1,K.end1,K.strand1)});ee.push({name:"Region 2",value:positionString(K.chr2,K.start2,K.end2,K.strand2)});K.name&&ee.push({name:"Name",value:K.name});void 0!==K.value&&ee.push({name:"Value",value:K.value});void 0!==K.score&&ee.push({name:"Score",value:K.score});if(K.extras&&this.header&&this.header.columnNames){const z=this.header.columnNames;const te=this.header.hiccups?6:10;for(let ne=te;ne<z.length;ne++)this.header.colorColumn!==ne&&("info"===z[ne]?extractInfoColumn(ee,K.extras[ne-te]):ee.push({name:z[ne],value:K.extras[ne-te]}))}break}return ee}clickedFeatures(z){const K=z.viewport.cachedFeatures;const ee=[];if(K){const te="proportional"===this.arcType||"inView"===this.arcType||"partialInView"===this.arcType;for(let ne of K)if(ne.drawState)if(ne.chr1===ne.chr2||"all"===ne.chr)if(te){const{xc:K,yc:te,radiusX:re,radiusY:ie}=ne.drawState;const se=z.canvasX-K;const oe=z.canvasY-te;const ae=se/re*(se/re)+oe/ie*(oe/ie);ae<=1&&ee.push({score:1/ae,feature:ne})}else{const{xc:K,yc:te,r:re}=ne.drawState;const ie=z.canvasX-K;const se=z.canvasY-te;const oe=Math.abs(Math.sqrt(ie*ie+se*se)-re);oe<5&&ee.push({score:oe,feature:ne})}else{const{x:K,y:te,w:re,h:ie}=ne.drawState;const se=5;if(z.canvasX>=K-se&&z.canvasX<=K+re+se&&z.canvasY>=te&&z.canvasY<=te+ie){const te=-Math.abs(z.canvasX-(K+re/2));ee.push({score:te,feature:ne});break}}}ee.length>1&&ee.sort(((z,K)=>z.score-K.score));return ee.map((z=>z.feature))}}function getMidpoints(z,K){let ee=(z.start1+z.end1)/2;let te=(z.start2+z.end2)/2;if("all"===z.chr){ee=K.getGenomeCoordinate(z.chr1,ee);te=K.getGenomeCoordinate(z.chr2,te)}if(ee>te){const z=ee;ee=te;te=z}return{m1:ee,m2:te}}function positionString(z,K,ee,te){return te&&"."!==te?`${z}:${numberFormatter$1(K+1)}-${numberFormatter$1(ee)} (${te})`:`${z}:${numberFormatter$1(K+1)}-${numberFormatter$1(ee)}`}function estimateTheta(z){let K=[.01570925532366355,.15838444032453644,.3249196962329063,.5095254494944288,.7265425280053609,.9999999999999999];let ee=[.031415926535897934,.3141592653589793,.6283185307179586,.9424777960769379,1.2566370614359172,1.5707963267948966];let te;for(te=0;te<K.length;te++)if(K[te]>z)break;let ne=0===te?0:K[te-1];let re=te<K.length?K[te]:1;let ie=(z-ne)/(re-ne);let se=0===te?0:ee[te-1];let oe=te<ee.length?ee[te]:Math.PI/2;return Math.min(Math.PI/2,se+ie*(oe-se))}const jc=new Map;function getAlphaColor(z,K){const ee=`${z}_${K}`;let te=jc.get(ee);if(!te){te=$o.addAlpha(z,K);jc.set(ee,te)}return te}
/**
     * Called in the context of FeatureSource  (i.e. this == the feature source (a TextFeatureSource) for the track
     *
     * @param allFeatures
     * @returns {[]}
     */function getWGFeatures(z){const makeWGFeature=z=>{const ee=Object.assign({},z);ee.chr="all";ee.start=K.getGenomeCoordinate(z.chr1,z.start1);ee.end=K.getGenomeCoordinate(z.chr2,z.end2);return ee};const K=this.genome;let ee;let te=0;for(let ne of K.wgChromosomeNames){let K=z[ne];if(K)for(let z of K)if(!z.dup){te++;z.score&&(!ee||z.score>ee.score)&&(ee=z)}}const ne=this.maxWGCount;const re=ee&&ee.score>0&&te>ne?5:1;const ie=Math.floor(ne/re);const se=ee&&ee.score>0?Math.log(ee.score)/re:Number.MAX_SAFE_INTEGER;let oe=[];let ae=[];for(let z=0;z<re;z++){ae.push([0]);oe.push([])}for(let ee of K.wgChromosomeNames){let K=z[ee];if(K)for(let z of K)if(!z.dup){const K=z.score?Math.max(0,Math.min(re-1,Math.floor(Math.log(z.score)/se))):0;if(oe[K].length<ie)oe[K].push(makeWGFeature(z));else{const ee=ie/(ae[K]+1);if(Math.random()<ee){const ee=Math.floor(Math.random()*(ie-1));oe[K][ee]=makeWGFeature(z)}}ae[K]++}}let le;if(1===re)le=oe[0];else{le=[];for(let z of oe)for(let K of z)le.push(K);ee&&le.push(makeWGFeature(ee));le.sort((function(z,K){return z.start-K.start}));console.log(le.length)}return le}
/**
     * Extract a gff style info column for popup text.  This convention used by 10X for bedpe files
     *     ALLELIC_FRAC=0.0375670840787;BLACK1=.;BLACK2=.;...
     * @param data
     * @param str
     */function extractInfoColumn(z,K){const ee=K.split(";");for(let K of ee){const ee=K.split("=");2===ee.length&&z.push({name:ee[0],value:ee[1]})}}const Wc=isString$2;const Gc="rgb(0,0,150)";const Zc=1e6;const Qc=10;const Xc=new Map([["REF","referenceBases"],["ALT","alternateBases"],["QUAL","quality"],["FILTER","filter"]]);class VariantTrack extends TrackBase{static defaults={displayMode:"EXPANDED",sortDirection:"ASC",showGenotypes:true,squishedVariantHeight:2,squishedCallHeight:1,expandedCallHeight:10,expandedVGap:2,squishedVGap:1,expandedGroupGap:10,squishedGroupGap:5,featureHeight:14,noGenotypeColor:"rgb(200,180,180)",noCallColor:"rgb(225, 225, 225)",nonRefColor:"rgb(200, 200, 215)",mixedColor:"rgb(200, 220, 200)",homrefColor:"rgb(200, 200, 200)",homvarColor:"rgb(17,248,254)",hetvarColor:"rgb(34,12,253)",colorBy:void 0,visibilityWindow:void 0,labelDisplayMode:void 0,type:"variant"};constructor(z,K){super(z,K)}init(z){super.init(z);this.expandedVariantHeight=z.expandedVariantHeight||z.variantHeight||10;this.featureSource=FeatureSource(z,this.browser.genome);this._initColorBy=z.colorBy;if(z.colorTable){this.colorTables=new Map;this.colorTables.set(z.colorBy,new ColorTable(z.colorTable))}this._color=z.color;this._strokecolor=z.strokecolor;this._context_hook=z.context_hook;this.variantRowCount(1)}async postInit(){this.header=await this.getHeader();if(!this.disposed){if(void 0===this.visibilityWindow&&false!==this.config.indexed){const z=isFile(this.config.url)?this.config.url.name:this.config.url;Wc(z)&&z.toLowerCase().includes("gnomad")?this.visibilityWindow=1e3:"function"===typeof this.featureSource.defaultVisibilityWindow?this.visibilityWindow=await this.featureSource.defaultVisibilityWindow():this.visibilityWindow=Zc}return this}}get supportsWholeGenome(){return false===this.config.indexed||true===this.config.supportsWholeGenome}get color(){return this._color||Gc}set color(z){this._color=z;this.colorBy=void 0}async getHeader(){if(!this.header){if("function"===typeof this.featureSource.getHeader){const z=await this.featureSource.getHeader();z&&(this.callSets=z.callSets||[]);this.header=z}this.sampleNames=this.callSets?this.callSets.map((z=>z.name)):[]}return this.header}getCallsetsLength(){return this.callSets?this.callSets.length:0}async getFeatures(z,K,ee,te){void 0===this.header&&(this.header=await this.getHeader());return this.featureSource.getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,visibilityWindow:this.visibilityWindow})}hasSamples(){return this.getCallsetsLength()>0}getSamples(){return{yOffset:this.sampleYOffset,names:this.sampleNames,height:this.sampleHeight}}
/**
         * The required height in pixels required for the track content.   This is not the visible track height, which
         * can be smaller (with a scrollbar) or larger.
         *
         * @param features
         * @returns {*}
         */computePixelHeight(z){if(!z||0==z.length)return Qc;const K="COLLAPSED"===this.displayMode?1:this.nVariantRows;const ee="SQUISHED"===this.displayMode?this.squishedVGap:this.expandedVGap;const te="SQUISHED"===this.displayMode?this.squishedVariantHeight:this.expandedVariantHeight;const ne="SQUISHED"===this.displayMode?this.squishedCallHeight:this.expandedCallHeight;const re=false===this.showGenotypes?0:this.getCallsetsLength()*K;const ie=Qc+K*(te+ee);return ie+ee+(re+1)*(ne+ee)}variantRowCount(z){this.nVariantRows=z}draw({context:z,pixelWidth:K,pixelHeight:ee,bpPerPixel:te,bpStart:ne,pixelTop:re,features:ie}){Jo.fillRect(z,0,re,K,ee,{fillStyle:"rgb(255, 255, 255)"});const se="SQUISHED"===this.displayMode?this.squishedVGap:this.expandedVGap;const oe="COLLAPSED"===this.displayMode?1:this.nVariantRows;const ae="SQUISHED"===this.displayMode?this.squishedVariantHeight:this.expandedVariantHeight;this.variantBandHeight=Qc+oe*(ae+se);let le=this.callSets;!le&&this._f&&(le=this._f.callSets);const ce=this.getCallsetsLength();le&&ce>0&&false!==this.showGenotypes&&Jo.strokeLine(z,0,this.variantBandHeight,K,this.variantBandHeight,{strokeStyle:"rgb(224,224,224) "});if(ie){const ee="SQUISHED"===this.displayMode?this.squishedCallHeight:this.expandedCallHeight;const re="SQUISHED"===this.displayMode?this.squishedVGap:this.expandedVGap;const se=ne+K*te+1;for(let K of ie){if(K.end<ne)continue;if(K.start>se)break;const ie="SQUISHED"===this.displayMode?this.squishedVariantHeight:this.expandedVariantHeight;const oe=Qc+("COLLAPSED"===this.displayMode?0:K.row*(ie+re));const ae=ie;let he=Math.round((K.start-ne)/te);let ue=Math.round((K.end-ne)/te);let de=Math.max(1,ue-he);if(de<3){de=3;he-=1}else if(de>5){he+=1;de-=2}z.fillStyle=this.getColorForFeature(K);z.fillRect(he,oe,de,ae);let fe=this.getVariantStrokecolor(K);if(fe){z.strokeStyle=fe;z.strokeRect(he,oe,de,ae)}this.callContextHook(K,z,he,oe,de,ae);K.pixelRect={x:he,y:oe,w:de,h:ae};if(ce>0&&false!==this.showGenotypes){const te="COLLAPSED"===this.displayMode?1:this.nVariantRows;this.sampleYOffset=this.variantBandHeight+re;this.sampleHeight=te*(ee+re);let ne=0;if(le&&K.calls)for(let te of le){const ie=K.calls[te.id];if(ie){const se="COLLAPSED"===this.displayMode?0:K.row;const oe=this.sampleYOffset+ne*this.sampleHeight+se*(ee+re);let ae=true;let le=true;let ce=false;if(ie.genotype)for(let z of ie.genotype){if("."===z){ce=true;break}0!==z&&(le=false);0===z&&(ae=false)}ie.genotype?z.fillStyle=ce?this.noCallColor:le?this.homrefColor:ae?this.homvarColor:this.hetvarColor:z.fillStyle=this.noGenotypeColor;z.fillRect(he,oe,de,ee);te.pixelRect={x:he,y:oe,w:de,h:ee}}ne++}}}}else console.log("No feature list")}getColorForFeature(z){const K=z._f||z;let ee;if(this.colorBy){const z=this.colorBy;let te;if(K.info.hasOwnProperty(z))te=K.info[z];else if(Xc.has(z)){const ee=Xc.get(z);te=K[ee]}ee=this.getVariantColorTable(z).getColor(te);ee||(ee="gray")}else ee=this._color?"function"===typeof this._color?this._color(z):this._color:"NONVARIANT"===K.type?this.nonRefColor:"MIXED"===K.type?this.mixedColor:this.color;return ee}getVariantStrokecolor(z){const K=z._f||z;let ee;ee=this._strokecolor?"function"===typeof this._strokecolor?this._strokecolor(K):this._strokecolor:void 0;return ee}callContextHook(z,K,ee,te,ne,re){if(this._context_hook&&"function"===typeof this._context_hook){const ie=z._f||z;K.save();this._context_hook(ie,K,ee,te,ne,re);K.restore()}}clickedFeatures(z){let K=super.clickedFeatures(z);const ee="EXPANDED"===this.displayMode?this.expandedVGap:this.squishedVGap;const te=ee+("SQUISHED"===this.displayMode?this.squishedCallHeight:this.expandedCallHeight);const ne=z.y;if(ne<=this.variantBandHeight){const z="SQUISHED"===this.displayMode?this.squishedVariantHeight:this.expandedVariantHeight;const te=Math.floor((ne-Qc)/(z+ee));"COLLAPSED"!==this.displayMode&&(K=K.filter((z=>z.row===te)))}else if(this.callSets){const z=this.callSets;const ee=ne-this.variantBandHeight;const re=Math.floor(ee/this.sampleHeight);if(re>=0&&re<z.length){const ne=Math.floor((ee-re*this.sampleHeight)/te);const ie="COLLAPSED"===this.displayMode?K:K.filter((z=>z.row===ne));const se=z[re];K=ie.map((z=>{const K=z.calls[se.id];expandGenotype(K,z);return K}))}}return K}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));const ee=z.genomicLocation;const te=this.browser.genome.id;const ne=this.browser.sampleInformation;let re=[];for(let z of K){const K=z._f||z;re.length>0&&re.push({html:'<hr style="border-top-width:2px ;border-color: #c9c3ba" />'});if("function"===typeof K.popupData){const z=K.popupData(ee,te);Array.prototype.push.apply(re,z)}else{const z=K;void 0!==z.callSetName&&re.push({name:"Name",value:z.callSetName});z.genotypeName&&re.push({name:"Genotype",value:z.genotypeName});void 0!==z.phaseset&&re.push({name:"Phase set",value:z.phaseset});void 0!==z.genotypeLikelihood&&re.push({name:"genotypeLikelihood",value:z.genotypeLikelihood.toString()});if(ne){var ie=ne.getAttributes(z.callSetName);ie&&Object.keys(ie).forEach((function(z){var K=z.replace(/([A-Z])/g," $1");K=K.charAt(0).toUpperCase()+K.slice(1);re.push({name:K,value:ie[z]})}))}var se=Object.keys(z.info);se.length&&re.push("<hr/>");se.forEach((function(K){re.push({name:K,value:decodeURIComponent(z.info[K])})}))}}return re}menuItemList(){const z=[];if(this.header.INFO&&this.header.INFO){const K=this.header.INFO.SVTYPE?["SVTYPE"]:[];this._initColorBy&&"SVTYPE"!==this._initColorBy&&K.push(this._initColorBy);if(K.length>0){z.push("<hr/>");const ee=pt('<div class="igv-track-menu-category igv-track-menu-border-top">');ee.text("Color by:");z.push({name:void 0,object:ee,click:void 0,init:void 0});K.sort();for(let ee of K){const K=this.colorBy===ee;const te=ee||"None";z.push(this.colorByCB({key:ee,label:te},K))}z.push(this.colorByCB({key:void 0,label:"None"},void 0===this.colorBy));z.push("<hr/>")}}if(this.getCallsetsLength()>0){z.push({object:pt('<div class="igv-track-menu-border-top">')});z.push({object:pt(createCheckbox("Show Genotypes",this.showGenotypes)),click:()=>{this.showGenotypes=!this.showGenotypes;this.trackView.checkContentHeight();this.trackView.repaintViews()}})}z.push({object:pt('<div class="igv-track-menu-border-top">')});for(let ee of["COLLAPSED","SQUISHED","EXPANDED"]){var K={COLLAPSED:"Collapse",SQUISHED:"Squish",EXPANDED:"Expand"};z.push({object:pt(createCheckbox(K[ee],ee===this.displayMode)),click:()=>{this.displayMode=ee;this.trackView.checkContentHeight();this.trackView.repaintViews()}})}if(this.browser.circularView){z.push("<hr>");z.push({label:"Add SVs to circular view",click:()=>{for(let z of this.trackView.viewports)this.sendChordsForViewport(z)}})}return z}contextMenuItemList(z){if(this.browser.circularView){const K=z.viewport;const ee=[];ee.push({label:"Add SVs to Circular View",click:()=>{this.sendChordsForViewport(K)}});ee.push("<hr/>");return ee}}sendChordsForViewport(z){const K=z.referenceFrame;let ee;if("all"===K.chr){const z=this.featureSource.getAllFeatures();const K=Object.keys(z).map((K=>z[K]));ee=[].concat(...K)}else ee=this.featureSource.featureCache.queryFeatures(K.chr,K.start,K.end);const te=makeVCFChords(ee);sendChords(te,this,K,.5)}
/**
         * Create a "color by" checkbox menu item, optionally initially checked
         * @param menuItem
         * @param showCheck
         * @returns {{init: undefined, name: undefined, click: clickHandler, object: (jQuery|HTMLElement|jQuery.fn.init)}}
         */colorByCB(z,K){const ee=pt(createCheckbox(z.label,K));const clickHandler=()=>{if(z.key===this.colorBy){this.colorBy=void 0;delete this.config.colorBy;this.trackView.repaintViews()}else{this.colorBy=z.key;this.config.colorBy=z.key;this.trackView.repaintViews()}};return{name:void 0,object:ee,click:clickHandler,init:void 0}}getState(){const z=super.getState();this._color&&"function"!==typeof this._color&&(z.color=this._color);return z}getVariantColorTable(z){this.colorTables||(this.colorTables=new Map);if(!this.colorTables.has(z)){let K;switch(z){case"SVTYPE":K=Yc;break;default:K=new PaletteColorTable("Set1")}this.colorTables.set(z,K)}return this.colorTables.get(z)}}function expandGenotype(z,K){if(z.genotype){let ee="";if("."===K.alternateBases)ee="No Call";else{const te=K.alternateBases.split(",");for(let ne of z.genotype){ee.length>0&&(ee+="|");if("."===ne)ee+=".";else if(0===ne)ee+=K.referenceBases;else{let z=te[ne-1].replace("<","&lt;");ee+=z}}}z.genotypeName=ee}}const Yc=new ColorTable({DEL:"#ff2101",INS:"#001888",DUP:"#028401",INV:"#008688",CNV:"#8931ff",BND:"#891100","*":"#002eff"});class EqtlTrack extends TrackBase{constructor(z,K){super(z,K)}init(z){super.init(z);this.name=z.name;this.pValueField=z.pValueField||"pValue";this.geneField=z.geneField||"geneSymbol";this.snpField=z.snpField||"snp";const K=z.minLogP||z.min;const ee=z.maxLogP||z.max;this.dataRange={min:K||3.5,max:ee||25};this.autoscale=!ee||z.autoscale;this.autoscalePercentile=void 0===z.autoscalePercentile?98:z.autoscalePercentile;this.background=z.background;this.divider=z.divider||"rgb(225,225,225)";this.dotSize=z.dotSize||2;this.height=z.height||100;this.autoHeight=false;this.disableButtons=z.disableButtons;this.visibilityWindow=void 0===z.visibilityWindow?2e6:z.visibilityWindow>=0?Math.min(2e6,z.visibilityWindow):2e6;this.featureSource=FeatureSource(z,this.browser.genome);vc.gtexLoaded=true}paintAxis(z,K,ee){const te=(this.dataRange.max-this.dataRange.min)/ee;const ne={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};Jo.fillRect(z,0,0,K,ee,{fillStyle:"rgb(255, 255, 255)"});const re=Math.ceil(10*(this.dataRange.max-this.dataRange.min)/ee);for(let ie=4;ie<=this.dataRange.max;ie+=re){const re=.85*K;const se=re-5;const oe=re;const ae=ee-(ie-this.dataRange.min)/te;Jo.strokeLine(z,se,ae,oe,ae,ne);ae>8&&Jo.fillText(z,ie,se-1,ae+2,ne)}ne.textAlign="center";Jo.fillText(z,"-log10(pvalue)",K/4,ee/2,ne,{rotate:{angle:-90}})}async getFeatures(z,K,ee){const te=this.pValueField;const ne=this.visibilityWindow;const re=await this.featureSource.getFeatures({chr:z,start:K,end:ee,visibilityWindow:ne});re.forEach((function(z){z.value=z[te]}));return re}draw(z){const K=z.context;const ee=z.pixelWidth;const te=z.pixelHeight;this.background&&Jo.fillRect(K,0,0,ee,te,{fillStyle:this.background});Jo.strokeLine(K,0,te-1,ee,te-1,{strokeStyle:this.divider});const drawEqtls=ne=>{const re=ne?2*this.dotSize:this.dotSize;const ie=z.bpStart;const se=(this.dataRange.max-this.dataRange.min)/te;const oe=z.referenceFrame.selection;for(let le of z.features){const ce=(le.start-ie+.5)/z.bpPerPixel;if(ce<0)continue;if(ce>ee)break;const he=le.snp.toUpperCase();const ue=le[this.geneField].toUpperCase();const de=oe&&(oe.snp===he||oe.gene===ue);if(!ne||de){oe&&oe.snp===he&&oe.addGene(ue);var ae=-Math.log(le[this.pValueField])/Math.LN10;if(ae>=this.dataRange.min){let z;if(ae>this.dataRange.max){ae=this.dataRange.max;z=true}else z=false;const ee=Math.max(0+re,te-Math.round((ae-this.dataRange.min)/se));le.px=ce;le.py=ee;le.radius=re;let ie;if(ne&&oe){ie=oe.colorForGene(ue);Jo.setProperties(K,{fillStyle:ie,strokeStyle:"black"})}else{ie=z?"rgb(150, 150, 150)":"rgb(180, 180, 180)";Jo.setProperties(K,{fillStyle:ie,strokeStyle:ie})}Jo.fillCircle(K,ce,ee,re);Jo.strokeCircle(K,ce,ee,re)}}}};drawEqtls(false);drawEqtls(true)}popupData(z,K){void 0===K&&(K=z.viewport.cachedFeatures);if(!K||0===K.length)return[];const ee=3;const te=this.name;const ne=[];for(let re of K)if(Math.abs(re.px-z.canvasX)<re.radius+ee&&Math.abs(re.py-z.canvasY)<re.radius+ee){ne.length>0&&ne.push("<hr/>");ne.push({name:"snp id",value:re.snp},{name:"gene id",value:re.geneId},{name:"gene name",value:re.geneName},{name:"p value",value:re.pValue},{name:"tissue",value:te})}return ne}menuItemList(){return gn.numericDataMenuItems(this.trackView)}doAutoscale(z){if(z.length>0){var K=z.map((function(z){return-Math.log(z.value)/Math.LN10}));this.dataRange.max=Vo.percentile(K,this.autoscalePercentile)}else{const z=this.config.maxLogP||this.config.max;this.dataRange.max=z||25}return this.dataRange}}const Kc={X:"rgb(204, 153, 0)",Y:"rgb(153, 204, 0)",Un:"darkGray)",1:"rgb(80, 80, 255)",2:"rgb(206, 61, 50)","2a":"rgb(210, 65, 55)","2b":"rgb(215, 70, 60)",3:"rgb(116, 155, 88)",4:"rgb(240, 230, 133)",5:"rgb(70, 105, 131)",6:"rgb(186, 99, 56)",7:"rgb(93, 177, 221)",8:"rgb(128, 34, 104)",9:"rgb(107, 215, 107)",10:"rgb(213, 149, 167)",11:"rgb(146, 72, 34)",12:"rgb(131, 123, 141)",13:"rgb(199, 81, 39)",14:"rgb(213, 143, 92)",15:"rgb(122, 101, 165)",16:"rgb(228, 175, 105)",17:"rgb(59, 27, 83)",18:"rgb(205, 222, 183)",19:"rgb(97, 42, 121)",20:"rgb(174, 31, 99)",21:"rgb(231, 199, 111)",22:"rgb(90, 101, 94)",23:"rgb(204, 153, 0)",24:"rgb(153, 204, 0)",25:"rgb(51, 204, 0)",26:"rgb(0, 204, 51)",27:"rgb(0, 204, 153)",28:"rgb(0, 153, 204)",29:"rgb(10, 71, 255)",30:"rgb(71, 117, 255)",31:"rgb(255, 194, 10)",32:"rgb(255, 209, 71)",33:"rgb(153, 0, 51)",34:"rgb(153, 26, 0)",35:"rgb(153, 102, 0)",36:"rgb(128, 153, 0)",37:"rgb(51, 153, 0)",38:"rgb(0, 153, 26)",39:"rgb(0, 153, 102)",40:"rgb(0, 128, 153)",41:"rgb(0, 51, 153)",42:"rgb(26, 0, 153)",43:"rgb(102, 0, 153)",44:"rgb(153, 0, 128)",45:"rgb(214, 0, 71)",46:"rgb(255, 20, 99)",47:"rgb(0, 214, 143)",48:"rgb(20, 255, 177)"};for(let Dp of Object.keys(Kc)){const Pp="chr"+Dp;Kc[Pp]=Kc[Dp]}for(let Op=1;Op<=48;Op++){if(10===Op)continue;const zp=romanize(Op);Kc[zp]=Kc[Op.toString()]}function romanize(z){if(!+z)return false;var K=String(+z).split("");var ee=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"];var te="",ne=3;while(ne--)te=(ee[+K.pop()+10*ne]||"")+te;return Array(+K.join("")+1).join("M")+te}const Jc=1e8;class GWASTrack extends TrackBase{constructor(z,K){super(z,K)}init(z){super.init(z);this.useChrColors=void 0===z.useChrColors||z.useChrColors;this.trait=z.trait;this.posteriorProbability=z.posteriorProbability;this.valueProperty="bed"===z.format?"score":"value";this.height=z.height||100;this.autoscale=z.autoscale;this.autoscalePercentile=void 0===z.autoscalePercentile?98:z.autoscalePercentile;this.background=z.background;this.divider=z.divider||"rgb(225,225,225)";this.dotSize=z.dotSize||3;this.popoverWindow=void 0===z.popoverWindow?Jc:z.popoverWindow;this.useChrColors?this.colorScale=new ColorTable(z.colorTable||Kc):z.color?this.colorScale=new ConstantColorScale(z.color):this.colorScale=new BinnedColorScale(z.colorScale||{thresholds:[5e-8,5e-4,.5],colors:["rgb(255,50,50)","rgb(251,100,100)","rgb(251,170,170)","rgb(227,238,249)"]});this.featureSource=FeatureSource(z,this.browser.genome)}async postInit(){if("function"===typeof this.featureSource.getHeader){this.header=await this.featureSource.getHeader();if(this.disposed)return}this.header&&this.setTrackProperties(this.header);this.autoscale||(this.posteriorProbability?this.dataRange={min:void 0===this.config.min?0:this.config.min,max:void 0===this.config.max?1:this.config.max}:this.dataRange={min:void 0===this.config.min?0:this.config.min,max:void 0===this.config.max?25:this.config.max});return this}get supportsWholeGenome(){return true}async getFeatures(z,K,ee){const te=this.visibilityWindow;return this.featureSource.getFeatures({chr:z,start:K,end:ee,visibilityWindow:te})}draw(z){const K=z.features;const ee=z.context;const te=z.pixelWidth;const ne=z.pixelHeight;this.background&&Jo.fillRect(ee,0,0,te,ne,{fillStyle:this.background});Jo.strokeLine(ee,0,ne-1,te,ne-1,{strokeStyle:this.divider});if(K){const re=z.bpPerPixel;const ie=z.bpStart;const se=ie+te*re+1;for(let z of K){const K=z.start;if(K<ie)continue;if(K>se)break;let te;if(this.posteriorProbability)te=z[this.valueProperty];else{const K=z[this.valueProperty];if(!K)continue;te=-Math.log10(K)}const oe=this.useChrColors?z._f?z._f.chr:z.chr:te;const ae=this.colorScale.getColor(oe);const le=(this.dataRange.max-this.dataRange.min)/ne;const ce=Math.round((K-ie)/re);const he=Math.max(this.dotSize,ne-Math.round((te-this.dataRange.min)/le));ae&&Jo.setProperties(ee,{fillStyle:ae,strokeStyle:"black"});Jo.fillCircle(ee,ce,he,this.dotSize);z.px=ce;z.py=he}}}paintAxis(z,K,ee){Jo.fillRect(z,0,0,K,ee,{fillStyle:"rgb(255, 255, 255)"});var te={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};const ne=(this.dataRange.max-this.dataRange.min)/ee;if(this.posteriorProbability){const K=.1;for(let re=this.dataRange.min;re<this.dataRange.max;re+=K){const K=ee-Math.round((re-this.dataRange.min)/ne);Jo.strokeLine(z,45,K-2,50,K-2,te);Jo.fillText(z,re.toFixed(1),44,K+2,te)}}else{const K=Math.ceil(10*(this.dataRange.max-this.dataRange.min)/ee);for(let re=this.dataRange.min;re<this.dataRange.max;re+=K){const K=ee-Math.round((re-this.dataRange.min)/ne);Jo.strokeLine(z,45,K,50,K,te);Jo.fillText(z,Math.floor(re),44,K+4,te)}}te.textAlign="center";this.posteriorProbability?Jo.fillText(z,"PPA",K/2,ee/2,te,{rotate:{angle:-90}}):Jo.fillText(z,"-log10(pvalue)",K/2,ee/2,te,{rotate:{angle:-90}})}popupData(z,K){void 0===K&&(K=z.viewport.cachedFeatures);let ee=[];const te=z.viewport.trackView.track;if(K){let ne=0;for(let re of K){const K=Math.abs(z.canvasX-re.px);const ie=Math.abs(z.canvasY-re.py);const se=re[this.valueProperty];if(K<this.dotSize&&ie<this.dotSize){ne>0&&ee.push("<HR/>");if(5==ne){ee.push("...");break}if("function"===typeof re.popupData)ee=ee.concat(re.popupData());else{const z=re.realChr||re.chr;const K=(re.realStart||re.start)+1;ee.push({name:"chromosome",value:z});ee.push({name:"position",value:K});ee.push({name:"name",value:re.name});te.posteriorProbability?ee.push({name:"posterior probability",value:se}):ee.push({name:"pValue",value:se})}ne++}}}return ee}menuItemList(){return gn.numericDataMenuItems(this.trackView)}doAutoscale(z){if(z.length>0){const K=this.valueProperty;const ee=this.posteriorProbability;const te=z.map((function(z){const te=z[K];return{value:ee?te:-Math.log(te)/Math.LN10}}));this.dataRange=doAutoscale(te)}else this.posteriorProbability?this.dataRange={min:this.config.min||0,max:this.config.max||1}:this.dataRange={min:this.config.max||25,max:this.config.min||0};return this.dataRange}}const eh=1;class GCNVTrack extends TrackBase{constructor(z,K){super(z,K)}init(z){super.init(z);this.autoscale=z.autoscale||void 0===z.max;this.dataRange={min:z.min||0,max:z.max};this.windowFunction=z.windowFunction||"mean";this.paintAxis=paintAxis;this.graphType=z.graphType||"bar";if(z._featureSource){this.featureSource=z._featureSource;delete z._featureSource}else this.featureSource=FeatureSource(this.config,this.browser.genome);this.visibilityWindow=-1;this.featureSource.visibilityWindow=this.visibilityWindow}async postInit(){if("function"===typeof this.featureSource.getHeader){this.header=await this.featureSource.getHeader();if(this.disposed)return;this.sampleNames=this.header.columnNames.slice(3);this.setTrackProperties(this.header);if(this.header.hasOwnProperty("clickToHighlight")){let z=this.header.clickToHighlight;this.config.clickToHighlight=z;this.config.samplesClickedToHighlight={}}if(this.header.hasOwnProperty("highlight")){this.config.highlightSamples={};let z=this.header.highlight;Array.isArray(z)||(z=[z]);for(let K of z){const z=K.split(";");2===z.length&&(this.config.highlightSamples[z[0]]=z[1])}}}}menuItemList(){return gn.numericDataMenuItems(this.trackView)}async getFeatures(z,K,ee){const te=await this.featureSource.getFeatures({chr:z,start:0,end:Number.MAX_SAFE_INTEGER,visibilityWindow:this.visibilityWindow});let ne;let re;for(let z=1;z<te.length-1;z++){void 0===ne&&te[z].end>K&&(ne=z-1);if(void 0===re&&te[z].start>ee){re=z+1;break}}void 0===ne&&(ne=0);void 0===re&&(re=te.length);return te.slice(ne,re)}draw(z){const{features:K,context:ee,bpPerPixel:te,bpStart:ne,pixelWidth:re,pixelHeight:ie}=z;const yScale=z=>(this.dataRange.max-z)/(this.dataRange.max-this.dataRange.min)*ie;const getX=function(z){let K=Math.floor((z-ne)/te);isNaN(K)&&console.warn("isNaN(x). feature start "+numberFormatter$1(z)+" bp start "+numberFormatter$1(ne));return K};const drawGuideLines=z=>{if(this.config.hasOwnProperty("guideLines"))for(let K of this.config.guideLines)if(K.hasOwnProperty("color")&&K.hasOwnProperty("y")&&K.hasOwnProperty("dotted")){let ee=yScale(K.y);let te={strokeStyle:K.color,strokeWidth:2};K.dotted?Jo.dashedLine(z.context,0,ee,z.pixelWidth,ee,5,te):Jo.strokeLine(z.context,0,ee,z.pixelWidth,ee,te)}};if(K&&K.length>0){void 0===this.dataRange.min&&(this.dataRange.min=0);if(this.dataRange.max>this.dataRange.min){const z=this.config.highlightSamples;const te=this.config.onlyHandleClicksForHighlightedSamples;const ne=this.config.clickToHighlight;let re=-1;let ie={};let se=[];let oe=[];this.clickDetectorCache={};for(let ae of K){const K=getX(ae.start);const le=getX(ae.end);const ce=re>=0?getX(re):K;if(!isNaN(K)&&!isNaN(le)){this.clickDetectorCache[K]=[];this.clickDetectorCache[le]=[];for(let re=0;re<ae.values.length;re++){const he=this.sampleNames[re];const ue=ae.values[re];const de=yScale(ue);if(K-ce>=eh){const re=ie[he];const oe=yScale(re);const ae=z&&z[he];ae?se.push([ce,oe,K,de,ae]):ne&&he in this.config.samplesClickedToHighlight?se.push([ce,oe,K,de,this.config.samplesClickedToHighlight[he]]):Jo.strokeLine(ee,ce,oe,K,de,{strokeStyle:"#D9D9D9"});te&&!(he in z)||this.clickDetectorCache[K].push([ce,oe,K,de,he,ae||"gray"])}if(le-K>=eh){const re=z&&z[he];re?oe.push([K,de,le,de,re]):ne&&he in this.config.samplesClickedToHighlight?oe.push([K,de,le,de,this.config.samplesClickedToHighlight[he]]):Jo.strokeLine(ee,K,de,le,de,{strokeStyle:"gray"});te&&!(he in z)||this.clickDetectorCache[le].push([K,de,le,de,he,re||"gray"])}ie[he]=ue}re=ae.end}}for(let z of se)Jo.strokeLine(ee,z[0],z[1],z[2],z[3],{strokeStyle:z[4],lineWidth:1.3});for(let z of oe)Jo.strokeLine(ee,z[0],z[1],z[2],z[3],{strokeStyle:z[4],lineWidth:2})}}drawGuideLines(z)}doAutoscale(z){let K,ee;if(z.length>0){K=Number.MAX_VALUE;ee=-Number.MAX_VALUE;z.forEach((function(z){K=Math.min(K,...z.values);ee=Math.max(ee,...z.values)}));K-=.01;ee+=.01}else{K=0;ee=100}return{min:K,max:ee}}clickedFeatures(z){const K=10;const ee=5;const te=z.canvasX;const ne=z.canvasY;let re=null;for(re of Object.keys(this.clickDetectorCache)){re=parseInt(re);if(re>=te)break}if(re){let z=Number.MAX_VALUE;let oe=[];const ae=this.clickDetectorCache[re];for(let ee of ae){const re=ee[0];const ie=ee[2];if(te<re||te>ie)return[];const se=ee[1];const ae=ee[3];if(ne<Math.min(se,ae)-K||ne>Math.max(se,ae)+K)continue;const le=distanceToLine(te,ne,re,se,ie,ae);if(le<z){oe=[{name:ee[4],color:ee[5]}];z=le}}if(z<ee){if(this.config.clickToHighlight){if(oe[0].name in this.config.samplesClickedToHighlight)delete this.config.samplesClickedToHighlight[oe[0].name];else if("any"===this.config.clickToHighlight){var ie=["red","darkblue","green","teal","olivedrab","orange","maroon","purple","blue","gold"];var se=ie[Math.floor(Math.random()*(ie.length+1))];this.config.samplesClickedToHighlight[oe[0].name]=se}else this.config.samplesClickedToHighlight[oe[0].name]=this.config.clickToHighlight;this.trackView.repaintViews()}return oe}}return[]}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));const ee=[];K.forEach((function(z){for(let K of Object.keys(z))isSimpleType(z[K])&&ee.push({name:K,value:z[K]})}));return ee}get supportsWholeGenome(){return false}}function distanceToLine(z,K,ee,te,ne,re){const ie=ne-ee;const se=re-te;const oe=Math.abs(ie*(te-K)-(ee-z)*se);const ae=Math.sqrt(ie*ie+se*se);const le=ae>0?oe/ae:0;return le}class RnaStructTrack extends TrackBase{constructor(z,K){super(z,K);z.height||(this.height=300);this.arcOrientation=false;this.theta=Math.PI/2;"bp"===z.format?this.featureSource=new RNAFeatureSource(z,K.genome):this.featureSource=new TextFeatureSource(z,K.genome)}async getFeatures(z,K,ee){const te=this.visibilityWindow;return this.featureSource.getFeatures({chr:z,start:K,end:ee,visibilityWindow:te})}draw(z){const K=z.context;const ee=Math.PI/2;const te=z.pixelWidth;const ne=z.pixelHeight;z.viewportWidth;const re=z.bpPerPixel;const ie=z.bpStart;const se=re;const oe=this.arcOrientation;Jo.fillRect(K,0,z.pixelTop,te,ne,{fillStyle:"rgb(255, 255, 255)"});const ae=z.features;if(ae){sortByScore(ae,1);for(let z of ae)if(z.startLeft){let te=Math.round((z.startLeft-ie)/se);let ne=Math.round((z.startRight-ie)/se);let re=Math.round((z.endLeft-ie)/se);let ae=Math.round((z.endRight-ie)/se);K.fillStyle=z.color;K.strokeStyle=z.color;K.beginPath();let le=(te+ae)/2;let ce=(ae-te)/2;let he=this.height;let ue=Math.PI+(Math.PI/2-ee);let de=2*Math.PI-(Math.PI/2-ee);if(oe){he=0;K.arc(le,he,ce,de,ue);K.lineTo(ae,he)}else{K.arc(le,he,ce,ue,de);K.lineTo(re,he)}const fe=(ne+re)/2;const pe=(re-ne)/2;const ge=he;if(oe){K.arc(fe,ge,pe,ue,de,true);K.lineTo(re,ge)}else{K.arc(fe,ge,pe,de,ue,true);K.lineTo(te,ge)}K.stroke();K.fill();z.drawState={x1:le,y1:he,r1:ce,x2:fe,y2:ge,r2:pe,sa:ue,ea:de}}else{let te=Math.round((z.start-ie)/se);let ne=Math.round((z.end-ie)/se);K.strokeStyle=z.color;K.beginPath();let re=(te+ne)/2;let ae=(ne-te)/2;let le=this.height;let ce=Math.PI+(Math.PI/2-ee);let he=2*Math.PI-(Math.PI/2-ee);if(oe){le=0;K.arc(re,le,ae,he,ce)}else K.arc(re,le,ae,ce,he);K.stroke();z.drawState={x1:re,y1:le,r1:ae,sa:ce,ea:he}}}}clickedFeatures(z){const K=super.clickedFeatures(z);const ee=[];sortByScore(K,-1);for(let te of K){const K=te.drawState;const ne=z.canvasX-K.x1;const re=z.canvasY-K.y1;const ie=Math.sqrt(ne*ne+re*re);const se=K.r1+3;let oe;let ae;if(void 0===K.x2){oe=ie;ae=K.r1-3}else{const ee=z.canvasX-K.x2;const te=z.canvasY-K.y2;oe=Math.sqrt(ee*ee+te*te);ae=K.r2-3}if(ie<se&&oe>ae){ee.push(te);break}}return ee}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));if(K&&K.length>0)return this.extractPopupData(K[0],this.getGenomeId())}menuItemList(){var z=this;return[{name:"Toggle arc direction",click:function(){z.arcOrientation=!z.arcOrientation;z.trackView.repaintViews()}}]}}function sortByScore(z,K){z.sort((function(z,ee){const te=void 0===z.score?-Number.MAX_VALUE:z.score;const ne=void 0===ee.score?-Number.MAX_VALUE:ee.score;const re=void 0===K?1:K;return re*(te-ne)}))}class RNAFeatureSource{constructor(z,K){this.config=z;this.genome=K}async getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,visibilityWindow:ne}){const re=this.genome;if(this.featureCache)return this.featureCache.queryFeatures(z,K,ee);{const te=buildOptions(this.config);const ne=await Wo.loadString(this.config.url,te);this.featureCache=new FeatureCache$1(parseBP(ne),re);return this.featureCache.queryFeatures(z,K,ee)}function parseBP(z){if(!z)return null;const K=getDataWrapper(z);let ee=true;let te;const ne=[];const re=[];const ie=[];while(void 0!==(te=K.nextLine())){const z=te.split("\t");if(ee&&te.startsWith("color:")){const K="rgb("+z[1]+","+z[2]+","+z[3]+")";ne.push(K);z.length>4&&re.push(z[4])}else{ee=false;const K=z[0];const te=Number.parseInt(z[1])-1;const oe=Number.parseInt(z[2])-1;const ae=Number.parseInt(z[3]);const le=Number.parseInt(z[4]);var se=Number.parseInt(z[5]);const ce=ne[se];let he;he=te<=le?{chr:K,startLeft:Math.min(te,oe),startRight:Math.max(te,oe),endLeft:Math.min(ae,le),endRight:Math.max(ae,le),color:ce,score:se}:{chr:K,startLeft:Math.min(ae,le),startRight:Math.max(ae,le),endLeft:Math.min(te,oe),endRight:Math.max(te,oe),color:ce,score:se};he.start=he.startLeft;he.end=he.endRight;re.length>se&&(he.description=re[se]);ie.push(he)}}return ie}}}class IdeogramTrack{constructor(z){this.browser=z;this.type="ideogram";this.height=16;this.order=Number.MIN_SAFE_INTEGER;this.disableButtons=true;this.ignoreTrackMenu=true}async getFeatures(z,K,ee){return[]}computePixelHeight(z){return this.height}draw({context:z,referenceFrame:K,pixelWidth:ee,pixelHeight:te}){const ne=K.chr;const re=K.genome.getChromosome(ne);if(void 0===re||ee<=0||te<=0||"all"===ne.toLowerCase())return;const ie=[];drawIdeogram({ctx:z,chr:ne,referenceFrame:K,genome:K.genome,width:ee,height:te,stainColors:ie});const se=Math.round(K.bpPerPixel*ee);const oe=K.start;let ae=re.bpLength;const le=K.genome.getCytobands(ne);if(le&&le.length>0&&le[le.length-1].end){ae=Math.max(ae,le[le.length-1].end);re.bpLength=ae}if(se<ae){const K=se/ae;const ne=oe/ae;let re=Math.floor(ne*ee);let ie=Math.floor(K*ee);re=Math.max(0,re);re=Math.min(ee-ie,re);z.save();z.strokeStyle="red";z.lineWidth=ie<2?1:2;const le=re+z.lineWidth/2;ie=ie<2?1:ie-z.lineWidth;const ce=z.lineWidth/2;const he=te-z.lineWidth;z.strokeRect(le,ce,ie,he);z.restore()}}dispose(){this.trackView=void 0}}function drawIdeogram({ctx:z,chr:K,referenceFrame:ee,genome:te,width:ne,height:re,stainColors:ie}){const se=1;const oe=.5*se;const ae=0;if(void 0===te)return;Jo.fillRect(z,0,0,ne,re,{fillStyle:$o.greyScale(255)});const le=te.getCytobands(K);if(le){const K=ae+re/2;const ee=[];const te=[];if(0===le.length)return;const ce=le[le.length-1].end;const he=ne/ce;z.beginPath();Jo.roundRect(z,oe,oe+ae,ne-2*oe,re-2*oe,(re-2*oe)/2,0,1);z.clip();for(let ne=0;ne<le.length;ne++){const oe=le[ne];const ce=he*oe.start;const ue=he*oe.end;if("c"===oe.type){if("p"===oe.name.charAt(0)){ee[0]=ce;te[0]=re+ae;ee[1]=ce;te[1]=ae;ee[2]=ue;te[2]=K}else{ee[0]=ue;te[0]=re+ae;ee[1]=ue;te[1]=ae;ee[2]=ce;te[2]=K}z.fillStyle="rgb(150, 0, 0)";z.strokeStyle="rgb(150, 0, 0)";Jo.polygon(z,ee,te,1,0)}else{z.fillStyle=getCytobandColor(ie,oe);Jo.fillRect(z,ce,se+ae,ue-ce,re-2*se)}}}z.strokeStyle=$o.greyScale(41);Jo.roundRect(z,oe,oe+ae,ne-2*oe,re-2*oe,(re-2*oe)/2,0,1)}function getCytobandColor(z,K){if("c"===K.type)return"rgb(150, 10, 10)";var ee=K.stain;var te=230;"p"===K.type&&(te=Math.floor(230-ee/100*230));var ne=z[te];if(!ne){ne="rgb("+te+","+te+","+te+")";z[te]=ne}return ne}let th=new PaletteColorTable("Dark2");const nh=["GT/AG","CT/AC","GC/AG","CT/GC","AT/AC","GT/AT","non-canonical"];nh.forEach((z=>{th.getColor(z)}));const rh={};class SpliceJunctionTrack extends TrackBase{constructor(z,K){super(z,K)}init(z){super.init(z);this.type=z.type||"junctions";if(z._featureSource){this.featureSource=z._featureSource;delete z._featureSource}else this.featureSource=z.featureSource?z.featureSource:FeatureSource(z,this.browser.genome);this.margin=void 0===z.margin?10:z.margin;this.height||(this.height=100);void 0===z.colorByNumReadsThreshold&&(z.colorByNumReadsThreshold=5)}async postInit(){if("function"===typeof this.featureSource.getHeader){this.header=await this.featureSource.getHeader();if(this.disposed)return}this.header&&this.setTrackProperties(this.header);void 0===this.visibilityWindow&&"function"===typeof this.featureSource.defaultVisibilityWindow&&(this.visibilityWindow=await this.featureSource.defaultVisibilityWindow());return this}get supportsWholeGenome(){return false}async getFeatures(z,K,ee,te){const ne=this.visibilityWindow;return this.featureSource.getFeatures({chr:z,start:K,end:ee,bpPerPixel:te,visibilityWindow:ne})}
/**
         * The required height in pixels required for the track content.   This is not the visible track height, which
         * can be smaller (with a scrollbar) or larger.
         *
         * @param features
         * @returns {*}
         */
computePixelHeight(z){return this.height}draw(z){const K=z.features;const ee=z.context;const te=z.bpPerPixel;const ne=z.bpStart;const re=z.pixelWidth;const ie=z.pixelHeight;const se=ne+re*te+1;this.config.isMergedTrack||Jo.fillRect(ee,0,z.pixelTop,re,ie,{fillStyle:"rgb(255, 255, 255)"});if(K){rh.referenceFrame=z.viewport.referenceFrame;rh.referenceFrameStart=rh.referenceFrame.start;rh.referenceFrameEnd=rh.referenceFrameStart+rh.referenceFrame.toBP(z.viewport.getWidth());rh.featureZoomOutTracker={};for(let z of K)if(!(z.end<ne)){if(z.start>se)break;this.renderJunction(z,ne,te,ie,ee)}}else console.log("No feature list")}
/**
         *
         * @param feature
         * @param bpStart  genomic location of the left edge of the current canvas
         * @param xScale  scale in base-pairs per pixel
         * @param pixelHeight  pixel height of the current canvas
         * @param ctx  the canvas 2d context
         */
renderJunction(z,K,ee,te,ne){z.isVisible=false;const re=Math.round((z.start-K)/ee);const ie=Math.round((z.end-K)/ee);const se=(re+ie)/2;if(ie-re<=3){if(se in rh.featureZoomOutTracker)return;rh.featureZoomOutTracker[se]=true}if(this.config.hideAnnotatedJunctions&&"true"===z.attributes.annotated_junction)return;if(this.config.hideUnannotatedJunctions&&"false"===z.attributes.annotated_junction)return;if(this.config.hideMotifs&&this.config.hideMotifs.includes(z.attributes.motif))return;if(this.config.hideStrand===z.strand)return;if(this.config.minJunctionEndsVisible){let K=0;z.start>=rh.referenceFrameStart&&z.start<=rh.referenceFrameEnd&&(K+=1);z.end>=rh.referenceFrameStart&&z.end<=rh.referenceFrameEnd&&(K+=1);if(K<this.config.minJunctionEndsVisible)return}let oe;let ae;let le;if(z.attributes.uniquely_mapped){oe=parseInt(z.attributes.uniquely_mapped);if(oe<this.config.minUniquelyMappedReads)return;ae=parseInt(z.attributes.multi_mapped);le=oe+ae;if(le<this.config.minTotalReads)return;if(le>0&&ae/le>this.config.maxFractionMultiMappedReads)return;if(z.attributes.maximum_spliced_alignment_overhang&&parseInt(z.attributes.maximum_spliced_alignment_overhang)<this.config.minSplicedAlignmentOverhang)return}let ce;if(z.attributes.num_samples_with_this_junction){ce=parseInt(z.attributes.num_samples_with_this_junction);if(this.config.minSamplesWithThisJunction&&ce<this.config.minSamplesWithThisJunction)return;if(this.config.maxSamplesWithThisJunction&&ce>this.config.maxSamplesWithThisJunction)return;if(z.attributes.num_samples_total){z.attributes.percent_samples_with_this_junction=100*ce/Number(z.attributes.num_samples_total);if(this.config.minPercentSamplesWithThisJunction&&(z.attributes.percent_samples_with_this_junction<this.config.minPercentSamplesWithThisJunction||z.attributes.percent_samples_with_this_junction>this.config.maxPercentSamplesWithThisJunction))return}}const he=this.margin;const ue=this.height;const de=he+.5*ue;let fe=he;const pe=he+ue;const ge=pe-10;const me=(re+se)/2;const be=(se+ie)/2;let ve=1;if(z.attributes.line_width)ve=Number(z.attributes.line_width);else{void 0===this.config.thicknessBasedOn||"numUniqueReads"===this.config.thicknessBasedOn?ve=oe:"numReads"===this.config.thicknessBasedOn?ve=le:"numSamplesWithThisJunction"===this.config.thicknessBasedOn&&void 0!==ce&&(ve=ce);ve=1+Math.log(ve+1)/Math.log(12)}let we;void 0===this.config.bounceHeightBasedOn||"random"===this.config.bounceHeightBasedOn?we=(z.start+z.end)%7:"distance"===this.config.bounceHeightBasedOn?we=6*(z.end-z.start)/(rh.referenceFrameEnd-rh.referenceFrameStart):"thickness"===this.config.bounceHeightBasedOn&&(we=2*ve);fe+=ue*Math.max(7-we,0)/10;let ye;ye=z.attributes.color?z.attributes.color:void 0===this.config.colorBy||"numUniqueReads"===this.config.colorBy?oe>this.config.colorByNumReadsThreshold?"blue":"#AAAAAA":"numReads"===this.config.colorBy?le>this.config.colorByNumReadsThreshold?"blue":"#AAAAAA":"isAnnotatedJunction"===this.config.colorBy?"true"===z.attributes.annotated_junction?"#b0b0ec":"orange":"strand"===this.config.colorBy?"+"===z.strand?"#b0b0ec":"#ecb0b0":"motif"===this.config.colorBy?th.getColor(z.attributes.motif):"#AAAAAA";let _e="";z.attributes.label?_e=z.attributes.label.replace(/_/g," "):void 0===this.config.labelWith||"uniqueReadCount"===this.config.labelWith?_e=oe:"totalReadCount"===this.config.labelWith?_e=le:"numSamplesWithThisJunction"===this.config.labelWith?void 0!==ce&&(_e=ce):"percentSamplesWithThisJunction"===this.config.labelWith?void 0!==z.attributes.percent_samples_with_this_junction&&(_e=z.attributes.percent_samples_with_this_junction.toFixed(0)+"%"):"motif"===this.config.labelWith&&void 0!==z.attributes.motif&&(_e+=z.attributes.motif);"uniqueReadCount"===this.config.labelWithInParen?_e+=" ("+oe+")":"totalReadCount"===this.config.labelWithInParen?_e+=" ("+le+")":"multiMappedReadCount"===this.config.labelWithInParen?ae>0&&(_e+=" (+"+ae+")"):"numSamplesWithThisJunction"===this.config.labelWithInParen?void 0!==ce&&(_e+=" ("+ce+")"):"percentSamplesWithThisJunction"===this.config.labelWithInParen?void 0!==z.attributes.percent_samples_with_this_junction&&(_e+=" ("+z.attributes.percent_samples_with_this_junction.toFixed(0)+"%)"):"motif"===this.config.labelWithInParen&&void 0!==z.attributes.motif&&(_e+=` ${z.attributes.motif}`);z.isVisible=true;ne.beginPath();ne.moveTo(re,ge);ne.bezierCurveTo(me,fe,be,fe,ie,ge);ne.lineWidth=ve;ne.strokeStyle=ye;ne.stroke();const drawArrowhead=(z,K,ee,te)=>{z.beginPath();z.moveTo(K,ee);z.lineTo(K-te/2,ee-te);z.lineTo(K+te/2,ee-te);z.lineTo(K,ee);z.closePath();z.fill()};if(z.attributes.left_shape||z.attributes.right_shape){ne.fillStyle=ye;const K=ne.lineWidth>2?10:7;z.attributes.left_shape&&drawArrowhead(ne,re,ge,K);z.attributes.right_shape&&drawArrowhead(ne,ie,ge,K)}ne.fillText(_e,se-ne.measureText(_e).width/2,(7*fe+de)/8)}clickedFeatures(z){const K=super.clickedFeatures(z);return K.filter((function(z){return z.isVisible&&z.attributes}))}popupData(z,K){void 0===K&&(K=this.clickedFeatures(z));const ee=z.genomicLocation;const te=[];for(let z of K){const K="function"===typeof z.popupData?z.popupData(ee):this.extractPopupData(z._f||z,this.getGenomeId());if(K){te.length>0&&te.push("<hr/><hr/>");Array.prototype.push.apply(te,K)}}return te}dispose(){this.trackView=void 0}}class RemoteFile{constructor(z){this.config=z;this.url=mapUrl(z.path||z.url)}async read(z,K){const ee=this.config.headers||{};if(void 0!==z&&K){const te="bytes="+z+"-"+(z+K-1);ee.Range=te}let te=this.url.slice();if(this.config.oauthToken){const z=resolveToken(this.config.oauthToken);ee.Authorization=`Bearer ${z}`}this.config.apiKey&&(te=addParameter(te,"key",this.config.apiKey));const ne=await fetch(te,{method:"GET",headers:ee,redirect:"follow",mode:"cors"});const re=ne.status;if(re>=400){const z=Error(ne.statusText);z.code=re;throw z}
/**
             * token can be a string, a function that returns a string, or a function that returns a Promise for a string
             * @param token
             * @returns {Promise<*>}
             */return ne.arrayBuffer();async function resolveToken(z){return"function"===typeof z?await Promise.resolve(z()):z}}}function mapUrl(z){return z.includes("//www.dropbox.com")?z.replace("//www.dropbox.com","//dl.dropboxusercontent.com"):z.startsWith("ftp://ftp.ncbi.nlm.nih.gov")?z.replace("ftp://","https://"):z}function addParameter(z,K,ee){const te=z.includes("?")?"&":"?";return z+te+K+"="+ee}class BufferedFile{constructor(z){this.file=z.file;this.fetchSize=z.fetchSize||16e3;this.maxSize=z.maxSize||1e6;this.buffers=[]}async read(z,K){let ee=this.buffers.filter((ee=>ee.overlaps(z,z+K)));for(let te of ee)if(te.contains(z,z+K))return te.slice(z,z+K);if(0===ee.length){let ee=Math.max(K,this.fetchSize);this.buffers.sort(((z,K)=>z.start-K.start));const te=binarySearch(this.buffers,(K=>K.start>z),0);te<this.buffers.length&&(ee=Math.min(ee,this.buffers[te].start-z));const ne=z;const re=await this.file.read(ne,ee);const ie=new Buffer$1(ne,re);this.addBuffer(ie);return ie.slice(z,z+K)}{ee.sort(((z,K)=>z.start-K.start));const te=[];let ne=z;for(let z of ee){if(ne<z.start){const K=ne;const ee=z.start-ne;const re=await this.file.read(K,ee);const ie=new Buffer$1(K,re);te.push(ie)}te.push(z);ne=z.end}const re=z+K;if(re>ne){const z=ne;const K=re-z;const ee=await this.file.read(z,K);const ie=new Buffer$1(z,ee);te.push(ie)}const ie=te[0].start;const se=concatArrayBuffers(te.map((z=>z.buffer)));const oe=new Buffer$1(ie,se);const ae=new Set(ee);this.buffers=this.buffers.filter((z=>!ae.has(z)));this.addBuffer(oe);return oe.slice(z,z+K)}}addBuffer(z){const K=this.buffers.reduce(((z,K)=>z+K.size),0)+z.size;if(K>this.maxSize){const z=K-this.maxSize;this.buffers.sort(((z,K)=>z.creationTime-K.creationTime));let ee=0;let te;for(te=0;te<this.buffers.length;te++){ee+=this.buffers[te].size;if(ee>z)break}this.buffers=te<this.buffers.length-1?this.buffers.slice(te):[]}z.size<=this.maxSize&&this.buffers.push(z)}}class Buffer$1{constructor(z,K){this.creationTime=Date.now();this.start=z;this.buffer=K}slice(z,K){if(z<this.start||K-z>this.buffer.byteLength)throw Error("buffer bounds error");return this.buffer.slice(z-this.start,K-this.start)}get end(){return this.start+this.buffer.byteLength}get size(){return this.buffer.byteLength}contains(z,K){return z>=this.start&&K<=this.end}overlaps(z,K){return z>this.start&&z<this.end||K>this.start&&K<this.end}toString(){return`Buffer ${this.creationTime}   ${this.start} - ${this.end}`}}
/**
     * concatenates 2 array buffers.
     * Credit: https://gist.github.com/72lions/4528834
     *
     * @private
     * @param {ArrayBuffers} buffer1 The first buffer.
     * @param {ArrayBuffers} buffer2 The second buffer.
     * @return {ArrayBuffers} The new ArrayBuffer created out of the two.
     */function concatArrayBuffers(z){const K=z.reduce(((z,K)=>z+K.byteLength),0);const ee=new Uint8Array(K);let te=0;for(let K of z){ee.set(new Uint8Array(K),te);te+=K.byteLength}return ee.buffer}function binarySearch(z,K,ee){let te=ee-1,ne=z.length;while(1+te<ne){const ee=te+(ne-te>>1);K(z[ee])?ne=ee:te=ee}return ne}class BlobFile{constructor(z){this.file=z}async read(z,K){if(0===K)return new ArrayBuffer;const ee=void 0!=z&&K?this.file.slice(z,z+K):this.file;return ee.arrayBuffer()}}async function _unpack_struct_from_async(z,K,ee=0){var te=new Map;for(let[ne,re]of z.entries()){let z=await oh.unpack_from_async("<"+re,K,ee);ee+=oh.calcsize(re);1==z.length&&(z=z[0]);te.set(ne,z)}return te}function _unpack_struct_from(z,K,ee=0){var te=new Map;for(let[ne,re]of z.entries()){let z=oh.unpack_from("<"+re,K,ee);ee+=oh.calcsize(re);1==z.length&&(z=z[0]);te.set(ne,z)}return te}function assert(z){z||z()}function _structure_size(z){var K="<"+Array.from(z.values()).join("");return oh.calcsize(K)}function _padded_size(z,K=8){return Math.ceil(z/K)*K}var ih={u:"Uint",i:"Int",f:"Float"};function dtype_getter(z){var K=oh._is_big_endian(z);var ee,te;if(/S/.test(z)){ee="getString";te=0|((z.match(/S(\d*)/)||[])[1]||1)}else{let[K,ne,re]=z.match(/[<>=!@]?(i|u|f)(\d*)/);te=parseInt(re||4,10);let ie=8*te;ee="get"+ih[ne]+ie.toFixed()}return[ee,K,te]}var sh=class{constructor(){this.big_endian=isBigEndian();this.getters={s:"getUint8",b:"getInt8",B:"getUint8",h:"getInt16",H:"getUint16",i:"getInt32",I:"getUint32",l:"getInt32",L:"getUint32",q:"getInt64",Q:"getUint64",f:"getFloat32",d:"getFloat64"};this.byte_lengths={s:1,b:1,B:1,h:2,H:2,i:4,I:4,l:4,L:4,q:8,Q:8,f:4,d:8};let z=Object.keys(this.byte_lengths).join("");this.fmt_size_regex="(\\d*)(["+z+"])"}calcsize(z){var K=0;var ee;var te=new RegExp(this.fmt_size_regex,"g");while(null!==(ee=te.exec(z))){let z=parseInt(ee[1]||1,10);let te=ee[2];let ne=this.byte_lengths[te];K+=z*ne}return K}_is_big_endian(z){var K;K=!/^</.test(z)&&(!!/^(!|>)/.test(z)||this.big_endian);return K}async unpack_from_async(z,K,ee){ee=Number(ee||0);const te=this.calcsize(z);const ne=await K.slice(ee,ee+te);let re=0;var ie=new ah(ne);var se=[];var oe=this._is_big_endian(z);var ae;var le=new RegExp(this.fmt_size_regex,"g");while(null!==(ae=le.exec(z))){let z=parseInt(ae[1]||1,10);let K=ae[2];let ee=this.getters[K];let te=this.byte_lengths[K];if("s"==K){se.push((new TextDecoder).decode(ne.slice(re,re+z)));re+=z}else for(var ce=0;ce<z;ce++){se.push(ie[ee](re,!oe));re+=te}}return se}unpack_from(z,K,ee){ee=Number(ee||0);const te=this.calcsize(z);const ne=K.slice(ee,ee+te);let re=0;var ie=new ah(ne);var se=[];var oe=this._is_big_endian(z);var ae;var le=new RegExp(this.fmt_size_regex,"g");while(null!==(ae=le.exec(z))){let z=parseInt(ae[1]||1,10);let K=ae[2];let ee=this.getters[K];let te=this.byte_lengths[K];if("s"==K){se.push((new TextDecoder).decode(ne.slice(re,re+z)));re+=z}else for(var ce=0;ce<z;ce++){se.push(ie[ee](re,!oe));re+=te}}return se}};var oh=new sh;function isBigEndian(){const z=new Uint8Array(4);const K=new Uint32Array(z.buffer);return!((K[0]=1)&z[0])}var ah=class extends DataView{getUint64(z,K){const ee=BigInt(this.getUint32(z,K));const te=BigInt(this.getUint32(z+4,K));let ne=K?ee+(te<<32n):(ee<<32n)+te;return Number(ne)}getInt64(z,K){var ee,te;if(K){ee=this.getUint32(z,true);te=this.getInt32(z+4,true)}else{te=this.getInt32(z,false);ee=this.getUint32(z+4,false)}let ne=BigInt(ee)+(BigInt(te)<<32n);return Number(ne)}getString(z,K,ee){const te=this.buffer.slice(z,z+ee);const ne=new TextDecoder;return ne.decode(te)}getVLENStruct(z,K,ee){let te=this.getUint32(z,K);let ne=this.getUint64(z+4,K);let re=this.getUint32(z+12,K);return[te,ne,re]}};function bitSize(z){return z.toString(2).length}function _unpack_integer(z,K,ee=0,te=true){const ne=K.slice(ee,ee+z);let re=new Uint8Array(ne);te||re.reverse();let ie=re.reduce(((z,K,ee)=>z+(K<<8*ee)),0);return ie}var lh=class{constructor(z,K){this.buf=z;this.offset=K;this.dtype=this.determine_dtype()}async determine_dtype(){let z=await _unpack_struct_from_async(ch,this.buf,this.offset);this.offset+=hh;let K=15&z.get("class_and_version");if(K==dh)return this._determine_dtype_fixed_point(z);if(K==fh)return this._determine_dtype_floating_point(z);if(K==ph)throw"Time datatype class not supported.";if(K==gh)return this._determine_dtype_string(z);if(K==mh)throw"Bitfield datatype class not supported.";if(K==bh)return{datatype_class:bh,size:z.get("size")};if(K==vh)return this._determine_dtype_compound(z);if(K==wh)return["REFERENCE",z.get("size")];if(K==yh)return this.determine_dtype();if(K==kh)throw"Array datatype class not supported.";if(K==_h){let K=this._determine_dtype_vlen(z);if("VLEN_SEQUENCE"==K[0]){let z=this.determine_dtype();K=["VLEN_SEQUENCE",z]}return K}throw"Invalid datatype class "+K}_determine_dtype_fixed_point(z){let K=z.get("size");if(![1,2,4,8].includes(K))throw"Unsupported datatype size";let ee=8&z.get("class_bit_field_0");var te;te=ee>0?"i":"u";let ne=1&z.get("class_bit_field_0");var re;re=0==ne?"<":">";this.offset+=4;return re+te+K.toFixed()}_determine_dtype_floating_point(z){let K=z.get("size");if(![1,2,4,8].includes(K))throw"Unsupported datatype size";let ee="f";let te=1&z.get("class_bit_field_0");var ne;ne=0==te?"<":">";this.offset+=12;return ne+ee+K.toFixed()}_determine_dtype_string(z){return"S"+z.get("size").toFixed()}_determine_dtype_vlen(z){let K=1&z.get("class_bit_field_0");if(1!=K)return["VLEN_SEQUENCE",0,0];let ee=z.get("class_bit_field_0")>>4;let te=1&z.get("class_bit_field_1");return["VLEN_STRING",ee,te]}_determine_dtype_compound(z){throw"Compound type not yet implemented!"}};var ch=new Map([["class_and_version","B"],["class_bit_field_0","B"],["class_bit_field_1","B"],["class_bit_field_2","B"],["size","I"]]);var hh=_structure_size(ch);var uh=new Map([["offset","I"],["dimensionality","B"],["reserved_0","B"],["reserved_1","B"],["reserved_2","B"],["permutation","I"],["reserved_3","I"],["dim_size_1","I"],["dim_size_2","I"],["dim_size_3","I"],["dim_size_4","I"]]);_structure_size(uh);var dh=0;var fh=1;var ph=2;var gh=3;var mh=4;var bh=5;var vh=6;var wh=7;var yh=8;var _h=9;var kh=10;function zero$1(z){let K=z.length;while(--K>=0)z[K]=0}var xh=3;var Ch=258;var Sh=29;var Ah=256;var Th=Ah+1+Sh;var Eh=30;var Mh=512;var Rh=new Array(2*(Th+2));zero$1(Rh);var Ih=new Array(2*Eh);zero$1(Ih);var Fh=new Array(Mh);zero$1(Fh);var Lh=new Array(Ch-xh+1);zero$1(Lh);var Bh=new Array(Sh);zero$1(Bh);var Nh=new Array(Eh);zero$1(Nh);var adler32=(z,K,ee,te)=>{let ne=65535&z|0,re=z>>>16&65535|0,ie=0;while(0!==ee){ie=ee>2e3?2e3:ee;ee-=ie;do{ne=ne+K[te++]|0;re=re+ne|0}while(--ie);ne%=65521;re%=65521}return ne|re<<16|0};var Dh=adler32;var makeTable=()=>{let z,K=[];for(var ee=0;ee<256;ee++){z=ee;for(var te=0;te<8;te++)z=1&z?3988292384^z>>>1:z>>>1;K[ee]=z}return K};var Ph=new Uint32Array(makeTable());var crc32=(z,K,ee,te)=>{const ne=Ph;const re=te+ee;z^=-1;for(let ee=te;ee<re;ee++)z=z>>>8^ne[255&(z^K[ee])];return-1^z};var Oh=crc32;var zh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var Hh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var _has=(z,K)=>Object.prototype.hasOwnProperty.call(z,K);var assign=function(z){const K=Array.prototype.slice.call(arguments,1);while(K.length){const ee=K.shift();if(ee){if("object"!==typeof ee)throw new TypeError(ee+"must be non-object");for(const K in ee)_has(ee,K)&&(z[K]=ee[K])}}return z};var flattenChunks=z=>{let K=0;for(let ee=0,te=z.length;ee<te;ee++)K+=z[ee].length;const ee=new Uint8Array(K);for(let K=0,te=0,ne=z.length;K<ne;K++){let ne=z[K];ee.set(ne,te);te+=ne.length}return ee};var Uh={assign:assign,flattenChunks:flattenChunks};var Vh=true;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Hp){Vh=false}var $h=new Uint8Array(256);for(let Up=0;Up<256;Up++)$h[Up]=Up>=252?6:Up>=248?5:Up>=240?4:Up>=224?3:Up>=192?2:1;$h[254]=$h[254]=1;var string2buf=z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(z);let K,ee,te,ne,re,ie=z.length,se=0;for(ne=0;ne<ie;ne++){ee=z.charCodeAt(ne);if(55296===(64512&ee)&&ne+1<ie){te=z.charCodeAt(ne+1);if(56320===(64512&te)){ee=65536+(ee-55296<<10)+(te-56320);ne++}}se+=ee<128?1:ee<2048?2:ee<65536?3:4}K=new Uint8Array(se);for(re=0,ne=0;re<se;ne++){ee=z.charCodeAt(ne);if(55296===(64512&ee)&&ne+1<ie){te=z.charCodeAt(ne+1);if(56320===(64512&te)){ee=65536+(ee-55296<<10)+(te-56320);ne++}}if(ee<128)K[re++]=ee;else if(ee<2048){K[re++]=192|ee>>>6;K[re++]=128|63&ee}else if(ee<65536){K[re++]=224|ee>>>12;K[re++]=128|ee>>>6&63;K[re++]=128|63&ee}else{K[re++]=240|ee>>>18;K[re++]=128|ee>>>12&63;K[re++]=128|ee>>>6&63;K[re++]=128|63&ee}}return K};var buf2binstring=(z,K)=>{if(K<65534&&z.subarray&&Vh)return String.fromCharCode.apply(null,z.length===K?z:z.subarray(0,K));let ee="";for(let te=0;te<K;te++)ee+=String.fromCharCode(z[te]);return ee};var buf2string=(z,K)=>{const ee=K||z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(z.subarray(0,K));let te,ne;const re=new Array(2*ee);for(ne=0,te=0;te<ee;){let K=z[te++];if(K<128){re[ne++]=K;continue}let ie=$h[K];if(ie>4){re[ne++]=65533;te+=ie-1}else{K&=2===ie?31:3===ie?15:7;while(ie>1&&te<ee){K=K<<6|63&z[te++];ie--}if(ie>1)re[ne++]=65533;else if(K<65536)re[ne++]=K;else{K-=65536;re[ne++]=55296|K>>10&1023;re[ne++]=56320|1023&K}}}return buf2binstring(re,ne)};var utf8border=(z,K)=>{K=K||z.length;K>z.length&&(K=z.length);let ee=K-1;while(ee>=0&&128===(192&z[ee]))ee--;return ee<0||0===ee?K:ee+$h[z[ee]]>K?ee:K};var qh={string2buf:string2buf,buf2string:buf2string,utf8border:utf8border};function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}var jh=ZStream;var Wh=30;var Gh=12;var Zh=function inflate_fast(z,K){let ee;let te;let ne;let re;let ie;let se;let oe;let ae;let le;let ce;let he;let ue;let de;let fe;let pe;let ge;let me;let be;let ve;let we;let ye;let _e;let ke,xe;const Ce=z.state;ee=z.next_in;ke=z.input;te=ee+(z.avail_in-5);ne=z.next_out;xe=z.output;re=ne-(K-z.avail_out);ie=ne+(z.avail_out-257);se=Ce.dmax;oe=Ce.wsize;ae=Ce.whave;le=Ce.wnext;ce=Ce.window;he=Ce.hold;ue=Ce.bits;de=Ce.lencode;fe=Ce.distcode;pe=(1<<Ce.lenbits)-1;ge=(1<<Ce.distbits)-1;e:do{if(ue<15){he+=ke[ee++]<<ue;ue+=8;he+=ke[ee++]<<ue;ue+=8}me=de[he&pe];t:for(;;){be=me>>>24;he>>>=be;ue-=be;be=me>>>16&255;if(0===be)xe[ne++]=65535&me;else{if(!(16&be)){if(0===(64&be)){me=de[(65535&me)+(he&(1<<be)-1)];continue t}if(32&be){Ce.mode=Gh;break e}z.msg="invalid literal/length code";Ce.mode=Wh;break e}ve=65535&me;be&=15;if(be){if(ue<be){he+=ke[ee++]<<ue;ue+=8}ve+=he&(1<<be)-1;he>>>=be;ue-=be}if(ue<15){he+=ke[ee++]<<ue;ue+=8;he+=ke[ee++]<<ue;ue+=8}me=fe[he&ge];n:for(;;){be=me>>>24;he>>>=be;ue-=be;be=me>>>16&255;if(!(16&be)){if(0===(64&be)){me=fe[(65535&me)+(he&(1<<be)-1)];continue n}z.msg="invalid distance code";Ce.mode=Wh;break e}we=65535&me;be&=15;if(ue<be){he+=ke[ee++]<<ue;ue+=8;if(ue<be){he+=ke[ee++]<<ue;ue+=8}}we+=he&(1<<be)-1;if(we>se){z.msg="invalid distance too far back";Ce.mode=Wh;break e}he>>>=be;ue-=be;be=ne-re;if(we>be){be=we-be;if(be>ae&&Ce.sane){z.msg="invalid distance too far back";Ce.mode=Wh;break e}ye=0;_e=ce;if(0===le){ye+=oe-be;if(be<ve){ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=ne-we;_e=xe}}else if(le<be){ye+=oe+le-be;be-=le;if(be<ve){ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=0;if(le<ve){be=le;ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=ne-we;_e=xe}}}else{ye+=le-be;if(be<ve){ve-=be;do{xe[ne++]=ce[ye++]}while(--be);ye=ne-we;_e=xe}}while(ve>2){xe[ne++]=_e[ye++];xe[ne++]=_e[ye++];xe[ne++]=_e[ye++];ve-=3}if(ve){xe[ne++]=_e[ye++];ve>1&&(xe[ne++]=_e[ye++])}}else{ye=ne-we;do{xe[ne++]=xe[ye++];xe[ne++]=xe[ye++];xe[ne++]=xe[ye++];ve-=3}while(ve>2);if(ve){xe[ne++]=xe[ye++];ve>1&&(xe[ne++]=xe[ye++])}}break}}break}}while(ee<te&&ne<ie);ve=ue>>3;ee-=ve;ue-=ve<<3;he&=(1<<ue)-1;z.next_in=ee;z.next_out=ne;z.avail_in=ee<te?te-ee+5:5-(ee-te);z.avail_out=ne<ie?ie-ne+257:257-(ne-ie);Ce.hold=he;Ce.bits=ue};var Qh=15;var Xh=852;var Yh=592;var Kh=0;var Jh=1;var eu=2;var tu=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]);var nu=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]);var ru=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]);var iu=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var inflate_table=(z,K,ee,te,ne,re,ie,se)=>{const oe=se.bits;let ae=0;let le=0;let ce=0,he=0;let ue=0;let de=0;let fe=0;let pe=0;let ge=0;let me=0;let be;let ve;let we;let ye;let _e;let ke=null;let xe=0;let Ce;const Se=new Uint16Array(Qh+1);const Ae=new Uint16Array(Qh+1);let Te=null;let Ee=0;let Me,Re,Ie;for(ae=0;ae<=Qh;ae++)Se[ae]=0;for(le=0;le<te;le++)Se[K[ee+le]]++;ue=oe;for(he=Qh;he>=1;he--)if(0!==Se[he])break;ue>he&&(ue=he);if(0===he){ne[re++]=20971520;ne[re++]=20971520;se.bits=1;return 0}for(ce=1;ce<he;ce++)if(0!==Se[ce])break;ue<ce&&(ue=ce);pe=1;for(ae=1;ae<=Qh;ae++){pe<<=1;pe-=Se[ae];if(pe<0)return-1}if(pe>0&&(z===Kh||1!==he))return-1;Ae[1]=0;for(ae=1;ae<Qh;ae++)Ae[ae+1]=Ae[ae]+Se[ae];for(le=0;le<te;le++)0!==K[ee+le]&&(ie[Ae[K[ee+le]]++]=le);if(z===Kh){ke=Te=ie;Ce=19}else if(z===Jh){ke=tu;xe-=257;Te=nu;Ee-=257;Ce=256}else{ke=ru;Te=iu;Ce=-1}me=0;le=0;ae=ce;_e=re;de=ue;fe=0;we=-1;ge=1<<ue;ye=ge-1;if(z===Jh&&ge>Xh||z===eu&&ge>Yh)return 1;for(;;){Me=ae-fe;if(ie[le]<Ce){Re=0;Ie=ie[le]}else if(ie[le]>Ce){Re=Te[Ee+ie[le]];Ie=ke[xe+ie[le]]}else{Re=96;Ie=0}be=1<<ae-fe;ve=1<<de;ce=ve;do{ve-=be;ne[_e+(me>>fe)+ve]=Me<<24|Re<<16|Ie|0}while(0!==ve);be=1<<ae-1;while(me&be)be>>=1;if(0!==be){me&=be-1;me+=be}else me=0;le++;if(0===--Se[ae]){if(ae===he)break;ae=K[ee+ie[le]]}if(ae>ue&&(me&ye)!==we){0===fe&&(fe=ue);_e+=ce;de=ae-fe;pe=1<<de;while(de+fe<he){pe-=Se[de+fe];if(pe<=0)break;de++;pe<<=1}ge+=1<<de;if(z===Jh&&ge>Xh||z===eu&&ge>Yh)return 1;we=me&ye;ne[we]=ue<<24|de<<16|_e-re|0}}0!==me&&(ne[_e+me]=ae-fe<<24|64<<16|0);se.bits=ue;return 0};var su=inflate_table;var ou=0;var au=1;var lu=2;var{Z_FINISH:cu,Z_BLOCK:hu,Z_TREES:uu,Z_OK:du,Z_STREAM_END:fu,Z_NEED_DICT:pu,Z_STREAM_ERROR:gu,Z_DATA_ERROR:bu,Z_MEM_ERROR:vu,Z_BUF_ERROR:wu,Z_DEFLATED:yu}=Hh;var _u=1;var ku=2;var xu=3;var Cu=4;var Su=5;var Au=6;var Tu=7;var Eu=8;var Mu=9;var Ru=10;var Iu=11;var Fu=12;var Lu=13;var Bu=14;var Nu=15;var Du=16;var Pu=17;var Ou=18;var zu=19;var Hu=20;var Uu=21;var Vu=22;var $u=23;var qu=24;var ju=25;var Wu=26;var Gu=27;var Zu=28;var Qu=29;var Xu=30;var Yu=31;var Ku=32;var Ju=852;var ed=592;var td=15;var nd=td;var zswap32=z=>(z>>>24&255)+(z>>>8&65280)+((65280&z)<<8)+((255&z)<<24);function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new Uint16Array(320);this.work=new Uint16Array(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}var inflateResetKeep=z=>{if(!z||!z.state)return gu;const K=z.state;z.total_in=z.total_out=K.total=0;z.msg="";K.wrap&&(z.adler=1&K.wrap);K.mode=_u;K.last=0;K.havedict=0;K.dmax=32768;K.head=null;K.hold=0;K.bits=0;K.lencode=K.lendyn=new Int32Array(Ju);K.distcode=K.distdyn=new Int32Array(ed);K.sane=1;K.back=-1;return du};var inflateReset=z=>{if(!z||!z.state)return gu;const K=z.state;K.wsize=0;K.whave=0;K.wnext=0;return inflateResetKeep(z)};var inflateReset2=(z,K)=>{let ee;if(!z||!z.state)return gu;const te=z.state;if(K<0){ee=0;K=-K}else{ee=1+(K>>4);K<48&&(K&=15)}if(K&&(K<8||K>15))return gu;null!==te.window&&te.wbits!==K&&(te.window=null);te.wrap=ee;te.wbits=K;return inflateReset(z)};var inflateInit2=(z,K)=>{if(!z)return gu;const ee=new InflateState;z.state=ee;ee.window=null;const te=inflateReset2(z,K);te!==du&&(z.state=null);return te};var inflateInit=z=>inflateInit2(z,nd);var rd=true;var id;var sd;var fixedtables=z=>{if(rd){id=new Int32Array(512);sd=new Int32Array(32);let K=0;while(K<144)z.lens[K++]=8;while(K<256)z.lens[K++]=9;while(K<280)z.lens[K++]=7;while(K<288)z.lens[K++]=8;su(au,z.lens,0,288,id,0,z.work,{bits:9});K=0;while(K<32)z.lens[K++]=5;su(lu,z.lens,0,32,sd,0,z.work,{bits:5});rd=false}z.lencode=id;z.lenbits=9;z.distcode=sd;z.distbits=5};var updatewindow=(z,K,ee,te)=>{let ne;const re=z.state;if(null===re.window){re.wsize=1<<re.wbits;re.wnext=0;re.whave=0;re.window=new Uint8Array(re.wsize)}if(te>=re.wsize){re.window.set(K.subarray(ee-re.wsize,ee),0);re.wnext=0;re.whave=re.wsize}else{ne=re.wsize-re.wnext;ne>te&&(ne=te);re.window.set(K.subarray(ee-te,ee-te+ne),re.wnext);te-=ne;if(te){re.window.set(K.subarray(ee-te,ee),0);re.wnext=te;re.whave=re.wsize}else{re.wnext+=ne;re.wnext===re.wsize&&(re.wnext=0);re.whave<re.wsize&&(re.whave+=ne)}}return 0};var inflate$2=(z,K)=>{let ee;let te,ne;let re;let ie;let se,oe;let ae;let le;let ce,he;let ue;let de;let fe;let pe=0;let ge,me,be;let ve,we,ye;let _e;let ke;const xe=new Uint8Array(4);let Ce;let Se;const Ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!z||!z.state||!z.output||!z.input&&0!==z.avail_in)return gu;ee=z.state;ee.mode===Fu&&(ee.mode=Lu);ie=z.next_out;ne=z.output;oe=z.avail_out;re=z.next_in;te=z.input;se=z.avail_in;ae=ee.hold;le=ee.bits;ce=se;he=oe;ke=du;e:for(;;)switch(ee.mode){case _u:if(0===ee.wrap){ee.mode=Lu;break}while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(2&ee.wrap&&35615===ae){ee.check=0;xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=Oh(ee.check,xe,2,0);ae=0;le=0;ee.mode=ku;break}ee.flags=0;ee.head&&(ee.head.done=false);if(!(1&ee.wrap)||(((255&ae)<<8)+(ae>>8))%31){z.msg="incorrect header check";ee.mode=Xu;break}if((15&ae)!==yu){z.msg="unknown compression method";ee.mode=Xu;break}ae>>>=4;le-=4;_e=8+(15&ae);if(0===ee.wbits)ee.wbits=_e;else if(_e>ee.wbits){z.msg="invalid window size";ee.mode=Xu;break}ee.dmax=1<<ee.wbits;z.adler=ee.check=1;ee.mode=512&ae?Ru:Fu;ae=0;le=0;break;case ku:while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.flags=ae;if((255&ee.flags)!==yu){z.msg="unknown compression method";ee.mode=Xu;break}if(57344&ee.flags){z.msg="unknown header flags set";ee.mode=Xu;break}ee.head&&(ee.head.text=ae>>8&1);if(512&ee.flags){xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=Oh(ee.check,xe,2,0)}ae=0;le=0;ee.mode=xu;case xu:while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.head&&(ee.head.time=ae);if(512&ee.flags){xe[0]=255&ae;xe[1]=ae>>>8&255;xe[2]=ae>>>16&255;xe[3]=ae>>>24&255;ee.check=Oh(ee.check,xe,4,0)}ae=0;le=0;ee.mode=Cu;case Cu:while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(ee.head){ee.head.xflags=255&ae;ee.head.os=ae>>8}if(512&ee.flags){xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=Oh(ee.check,xe,2,0)}ae=0;le=0;ee.mode=Su;case Su:if(1024&ee.flags){while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.length=ae;ee.head&&(ee.head.extra_len=ae);if(512&ee.flags){xe[0]=255&ae;xe[1]=ae>>>8&255;ee.check=Oh(ee.check,xe,2,0)}ae=0;le=0}else ee.head&&(ee.head.extra=null);ee.mode=Au;case Au:if(1024&ee.flags){ue=ee.length;ue>se&&(ue=se);if(ue){if(ee.head){_e=ee.head.extra_len-ee.length;ee.head.extra||(ee.head.extra=new Uint8Array(ee.head.extra_len));ee.head.extra.set(te.subarray(re,re+ue),_e)}512&ee.flags&&(ee.check=Oh(ee.check,te,ue,re));se-=ue;re+=ue;ee.length-=ue}if(ee.length)break e}ee.length=0;ee.mode=Tu;case Tu:if(2048&ee.flags){if(0===se)break e;ue=0;do{_e=te[re+ue++];ee.head&&_e&&ee.length<65536&&(ee.head.name+=String.fromCharCode(_e))}while(_e&&ue<se);512&ee.flags&&(ee.check=Oh(ee.check,te,ue,re));se-=ue;re+=ue;if(_e)break e}else ee.head&&(ee.head.name=null);ee.length=0;ee.mode=Eu;case Eu:if(4096&ee.flags){if(0===se)break e;ue=0;do{_e=te[re+ue++];ee.head&&_e&&ee.length<65536&&(ee.head.comment+=String.fromCharCode(_e))}while(_e&&ue<se);512&ee.flags&&(ee.check=Oh(ee.check,te,ue,re));se-=ue;re+=ue;if(_e)break e}else ee.head&&(ee.head.comment=null);ee.mode=Mu;case Mu:if(512&ee.flags){while(le<16){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(ae!==(65535&ee.check)){z.msg="header crc mismatch";ee.mode=Xu;break}ae=0;le=0}if(ee.head){ee.head.hcrc=ee.flags>>9&1;ee.head.done=true}z.adler=ee.check=0;ee.mode=Fu;break;case Ru:while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}z.adler=ee.check=zswap32(ae);ae=0;le=0;ee.mode=Iu;case Iu:if(0===ee.havedict){z.next_out=ie;z.avail_out=oe;z.next_in=re;z.avail_in=se;ee.hold=ae;ee.bits=le;return pu}z.adler=ee.check=1;ee.mode=Fu;case Fu:if(K===hu||K===uu)break e;case Lu:if(ee.last){ae>>>=7&le;le-=7&le;ee.mode=Gu;break}while(le<3){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.last=1&ae;ae>>>=1;le-=1;switch(3&ae){case 0:ee.mode=Bu;break;case 1:fixedtables(ee);ee.mode=Hu;if(K===uu){ae>>>=2;le-=2;break e}break;case 2:ee.mode=Pu;break;case 3:z.msg="invalid block type";ee.mode=Xu}ae>>>=2;le-=2;break;case Bu:ae>>>=7&le;le-=7&le;while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if((65535&ae)!==(ae>>>16^65535)){z.msg="invalid stored block lengths";ee.mode=Xu;break}ee.length=65535&ae;ae=0;le=0;ee.mode=Nu;if(K===uu)break e;case Nu:ee.mode=Du;case Du:ue=ee.length;if(ue){ue>se&&(ue=se);ue>oe&&(ue=oe);if(0===ue)break e;ne.set(te.subarray(re,re+ue),ie);se-=ue;re+=ue;oe-=ue;ie+=ue;ee.length-=ue;break}ee.mode=Fu;break;case Pu:while(le<14){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.nlen=257+(31&ae);ae>>>=5;le-=5;ee.ndist=1+(31&ae);ae>>>=5;le-=5;ee.ncode=4+(15&ae);ae>>>=4;le-=4;if(ee.nlen>286||ee.ndist>30){z.msg="too many length or distance symbols";ee.mode=Xu;break}ee.have=0;ee.mode=Ou;case Ou:while(ee.have<ee.ncode){while(le<3){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.lens[Ae[ee.have++]]=7&ae;ae>>>=3;le-=3}while(ee.have<19)ee.lens[Ae[ee.have++]]=0;ee.lencode=ee.lendyn;ee.lenbits=7;Ce={bits:ee.lenbits};ke=su(ou,ee.lens,0,19,ee.lencode,0,ee.work,Ce);ee.lenbits=Ce.bits;if(ke){z.msg="invalid code lengths set";ee.mode=Xu;break}ee.have=0;ee.mode=zu;case zu:while(ee.have<ee.nlen+ee.ndist){for(;;){pe=ee.lencode[ae&(1<<ee.lenbits)-1];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(be<16){ae>>>=ge;le-=ge;ee.lens[ee.have++]=be}else{if(16===be){Se=ge+2;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ge;le-=ge;if(0===ee.have){z.msg="invalid bit length repeat";ee.mode=Xu;break}_e=ee.lens[ee.have-1];ue=3+(3&ae);ae>>>=2;le-=2}else if(17===be){Se=ge+3;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ge;le-=ge;_e=0;ue=3+(7&ae);ae>>>=3;le-=3}else{Se=ge+7;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ge;le-=ge;_e=0;ue=11+(127&ae);ae>>>=7;le-=7}if(ee.have+ue>ee.nlen+ee.ndist){z.msg="invalid bit length repeat";ee.mode=Xu;break}while(ue--)ee.lens[ee.have++]=_e}}if(ee.mode===Xu)break;if(0===ee.lens[256]){z.msg="invalid code -- missing end-of-block";ee.mode=Xu;break}ee.lenbits=9;Ce={bits:ee.lenbits};ke=su(au,ee.lens,0,ee.nlen,ee.lencode,0,ee.work,Ce);ee.lenbits=Ce.bits;if(ke){z.msg="invalid literal/lengths set";ee.mode=Xu;break}ee.distbits=6;ee.distcode=ee.distdyn;Ce={bits:ee.distbits};ke=su(lu,ee.lens,ee.nlen,ee.ndist,ee.distcode,0,ee.work,Ce);ee.distbits=Ce.bits;if(ke){z.msg="invalid distances set";ee.mode=Xu;break}ee.mode=Hu;if(K===uu)break e;case Hu:ee.mode=Uu;case Uu:if(se>=6&&oe>=258){z.next_out=ie;z.avail_out=oe;z.next_in=re;z.avail_in=se;ee.hold=ae;ee.bits=le;Zh(z,he);ie=z.next_out;ne=z.output;oe=z.avail_out;re=z.next_in;te=z.input;se=z.avail_in;ae=ee.hold;le=ee.bits;ee.mode===Fu&&(ee.back=-1);break}ee.back=0;for(;;){pe=ee.lencode[ae&(1<<ee.lenbits)-1];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(me&&0===(240&me)){ve=ge;we=me;ye=be;for(;;){pe=ee.lencode[ye+((ae&(1<<ve+we)-1)>>ve)];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ve+ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ve;le-=ve;ee.back+=ve}ae>>>=ge;le-=ge;ee.back+=ge;ee.length=be;if(0===me){ee.mode=Wu;break}if(32&me){ee.back=-1;ee.mode=Fu;break}if(64&me){z.msg="invalid literal/length code";ee.mode=Xu;break}ee.extra=15&me;ee.mode=Vu;case Vu:if(ee.extra){Se=ee.extra;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.length+=ae&(1<<ee.extra)-1;ae>>>=ee.extra;le-=ee.extra;ee.back+=ee.extra}ee.was=ee.length;ee.mode=$u;case $u:for(;;){pe=ee.distcode[ae&(1<<ee.distbits)-1];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(0===(240&me)){ve=ge;we=me;ye=be;for(;;){pe=ee.distcode[ye+((ae&(1<<ve+we)-1)>>ve)];ge=pe>>>24;me=pe>>>16&255;be=65535&pe;if(ve+ge<=le)break;if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ae>>>=ve;le-=ve;ee.back+=ve}ae>>>=ge;le-=ge;ee.back+=ge;if(64&me){z.msg="invalid distance code";ee.mode=Xu;break}ee.offset=be;ee.extra=15&me;ee.mode=qu;case qu:if(ee.extra){Se=ee.extra;while(le<Se){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}ee.offset+=ae&(1<<ee.extra)-1;ae>>>=ee.extra;le-=ee.extra;ee.back+=ee.extra}if(ee.offset>ee.dmax){z.msg="invalid distance too far back";ee.mode=Xu;break}ee.mode=ju;case ju:if(0===oe)break e;ue=he-oe;if(ee.offset>ue){ue=ee.offset-ue;if(ue>ee.whave&&ee.sane){z.msg="invalid distance too far back";ee.mode=Xu;break}if(ue>ee.wnext){ue-=ee.wnext;de=ee.wsize-ue}else de=ee.wnext-ue;ue>ee.length&&(ue=ee.length);fe=ee.window}else{fe=ne;de=ie-ee.offset;ue=ee.length}ue>oe&&(ue=oe);oe-=ue;ee.length-=ue;do{ne[ie++]=fe[de++]}while(--ue);0===ee.length&&(ee.mode=Uu);break;case Wu:if(0===oe)break e;ne[ie++]=ee.length;oe--;ee.mode=Uu;break;case Gu:if(ee.wrap){while(le<32){if(0===se)break e;se--;ae|=te[re++]<<le;le+=8}he-=oe;z.total_out+=he;ee.total+=he;he&&(z.adler=ee.check=ee.flags?Oh(ee.check,ne,he,ie-he):Dh(ee.check,ne,he,ie-he));he=oe;if((ee.flags?ae:zswap32(ae))!==ee.check){z.msg="incorrect data check";ee.mode=Xu;break}ae=0;le=0}ee.mode=Zu;case Zu:if(ee.wrap&&ee.flags){while(le<32){if(0===se)break e;se--;ae+=te[re++]<<le;le+=8}if(ae!==(4294967295&ee.total)){z.msg="incorrect length check";ee.mode=Xu;break}ae=0;le=0}ee.mode=Qu;case Qu:ke=fu;break e;case Xu:ke=bu;break e;case Yu:return vu;case Ku:default:return gu}z.next_out=ie;z.avail_out=oe;z.next_in=re;z.avail_in=se;ee.hold=ae;ee.bits=le;(ee.wsize||he!==z.avail_out&&ee.mode<Xu&&(ee.mode<Gu||K!==cu))&&updatewindow(z,z.output,z.next_out,he-z.avail_out);ce-=z.avail_in;he-=z.avail_out;z.total_in+=ce;z.total_out+=he;ee.total+=he;ee.wrap&&he&&(z.adler=ee.check=ee.flags?Oh(ee.check,ne,he,z.next_out-he):Dh(ee.check,ne,he,z.next_out-he));z.data_type=ee.bits+(ee.last?64:0)+(ee.mode===Fu?128:0)+(ee.mode===Hu||ee.mode===Nu?256:0);(0===ce&&0===he||K===cu)&&ke===du&&(ke=wu);return ke};var inflateEnd=z=>{if(!z||!z.state)return gu;let K=z.state;K.window&&(K.window=null);z.state=null;return du};var inflateGetHeader=(z,K)=>{if(!z||!z.state)return gu;const ee=z.state;if(0===(2&ee.wrap))return gu;ee.head=K;K.done=false;return du};var inflateSetDictionary=(z,K)=>{const ee=K.length;let te;let ne;let re;if(!z||!z.state)return gu;te=z.state;if(0!==te.wrap&&te.mode!==Iu)return gu;if(te.mode===Iu){ne=1;ne=Dh(ne,K,ee,0);if(ne!==te.check)return bu}re=updatewindow(z,K,ee,ee);if(re){te.mode=Yu;return vu}te.havedict=1;return du};var od=inflateReset;var ad=inflateReset2;var ld=inflateResetKeep;var cd=inflateInit;var hd=inflateInit2;var ud=inflate$2;var dd=inflateEnd;var fd=inflateGetHeader;var pd=inflateSetDictionary;var gd="pako inflate (from Nodeca project)";var bd={inflateReset:od,inflateReset2:ad,inflateResetKeep:ld,inflateInit:cd,inflateInit2:hd,inflate:ud,inflateEnd:dd,inflateGetHeader:fd,inflateSetDictionary:pd,inflateInfo:gd};function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}var vd=GZheader;var wd=Object.prototype.toString;var{Z_NO_FLUSH:yd,Z_FINISH:_d,Z_OK:kd,Z_STREAM_END:xd,Z_NEED_DICT:Cd,Z_STREAM_ERROR:Sd,Z_DATA_ERROR:Ad,Z_MEM_ERROR:Td}=Hh;function Inflate$1(z){this.options=Uh.assign({chunkSize:65536,windowBits:15,to:""},z||{});const K=this.options;if(K.raw&&K.windowBits>=0&&K.windowBits<16){K.windowBits=-K.windowBits;0===K.windowBits&&(K.windowBits=-15)}K.windowBits>=0&&K.windowBits<16&&!(z&&z.windowBits)&&(K.windowBits+=32);K.windowBits>15&&K.windowBits<48&&0===(15&K.windowBits)&&(K.windowBits|=15);this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new jh;this.strm.avail_out=0;let ee=bd.inflateInit2(this.strm,K.windowBits);if(ee!==kd)throw new Error(zh[ee]);this.header=new vd;bd.inflateGetHeader(this.strm,this.header);if(K.dictionary){"string"===typeof K.dictionary?K.dictionary=qh.string2buf(K.dictionary):"[object ArrayBuffer]"===wd.call(K.dictionary)&&(K.dictionary=new Uint8Array(K.dictionary));if(K.raw){ee=bd.inflateSetDictionary(this.strm,K.dictionary);if(ee!==kd)throw new Error(zh[ee])}}}Inflate$1.prototype.push=function(z,K){const ee=this.strm;const te=this.options.chunkSize;const ne=this.options.dictionary;let re,ie,se;if(this.ended)return false;ie=K===~~K?K:true===K?_d:yd;"[object ArrayBuffer]"===wd.call(z)?ee.input=new Uint8Array(z):ee.input=z;ee.next_in=0;ee.avail_in=ee.input.length;for(;;){if(0===ee.avail_out){ee.output=new Uint8Array(te);ee.next_out=0;ee.avail_out=te}re=bd.inflate(ee,ie);if(re===Cd&&ne){re=bd.inflateSetDictionary(ee,ne);re===kd?re=bd.inflate(ee,ie):re===Ad&&(re=Cd)}while(ee.avail_in>0&&re===xd&&ee.state.wrap>0&&0!==z[ee.next_in]){bd.inflateReset(ee);re=bd.inflate(ee,ie)}switch(re){case Sd:case Ad:case Cd:case Td:this.onEnd(re);this.ended=true;return false}se=ee.avail_out;if(ee.next_out&&(0===ee.avail_out||re===xd))if("string"===this.options.to){let z=qh.utf8border(ee.output,ee.next_out);let K=ee.next_out-z;let ne=qh.buf2string(ee.output,z);ee.next_out=K;ee.avail_out=te-K;K&&ee.output.set(ee.output.subarray(z,z+K),0);this.onData(ne)}else this.onData(ee.output.length===ee.next_out?ee.output:ee.output.subarray(0,ee.next_out));if(re!==kd||0!==se){if(re===xd){re=bd.inflateEnd(this.strm);this.onEnd(re);this.ended=true;return true}if(0===ee.avail_in)break}}return true};Inflate$1.prototype.onData=function(z){this.chunks.push(z)};Inflate$1.prototype.onEnd=function(z){z===kd&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Uh.flattenChunks(this.chunks));this.chunks=[];this.err=z;this.msg=this.strm.msg};function inflate$1(z,K){const ee=new Inflate$1(K);ee.push(z);if(ee.err)throw ee.msg||zh[ee.err];return ee.result}function inflateRaw$1(z,K){K=K||{};K.raw=true;return inflate$1(z,K)}var Ed=Inflate$1;var Md=inflate$1;var Rd=inflateRaw$1;var Id=inflate$1;var Fd=Hh;var Ld={Inflate:Ed,inflate:Md,inflateRaw:Rd,ungzip:Id,constants:Fd};var{Inflate:Bd,inflate:Nd,inflateRaw:Dd,ungzip:Pd}=Ld;var Od=Nd;var zd=Pd;var zlib_decompress=function(z,K){let ee=new Uint8Array(z);return Od(ee).buffer};var unshuffle=function(z,K){let ee=z.byteLength;let te=new Uint8Array(ee);let ne=Math.floor(ee/K);let re=new DataView(z);for(var ie=0;ie<K;ie++)for(var se=0;se<ne;se++)te[ie+se*K]=re.getUint8(ie*ne+se);return te.buffer};var fletch32=function(z,K){_verify_fletcher32(z);return z.slice(0,-4)};function _verify_fletcher32(z){var K=z.byteLength%2!=0;var ee=z.byteLength-4;var te=new DataView(z);var ne=0;var re=0;for(var ie=0;ie<ee-1;ie+=2){let z=te.getUint16(ie,true);ne=(ne+z)%65535;re=(re+ne)%65535}if(K){let z=te.getUint8(ee-1);ne=(ne+z)%65535;re=(re+ne)%65535}var[se,oe]=oh.unpack_from(">HH",z,ee);se%=65535;oe%=65535;if(ne!=se||re!=oe)throw'ValueError("fletcher32 checksum invalid")';return true}var Hd=1;var Ud=2;var Vd=3;var $d=new Map([[Hd,zlib_decompress],[Ud,unshuffle],[Vd,fletch32]]);var qd=class{constructor(z,K){this.fh=z;this.offset=K;this.depth=null}async init(){this.all_nodes=new Map;await this._read_root_node();await this._read_children()}async _read_children(){let z=this.depth;while(z>0){for(var K of this.all_nodes.get(z))for(var ee of K.get("addresses"))this._add_node(await this._read_node(ee,z-1));z--}}async _read_root_node(){let z=await this._read_node(this.offset,null);this._add_node(z);this.depth=z.get("node_level")}_add_node(z){let K=z.get("node_level");this.all_nodes.has(K)?this.all_nodes.get(K).push(z):this.all_nodes.set(K,[z])}async _read_node(z,K){let ee=await this._read_node_header(z,K);ee.set("keys",[]);ee.set("addresses",[]);return ee}async _read_node_header(z){throw"NotImplementedError: must define _read_node_header in implementation class"}};var jd=class extends qd{B_LINK_NODE=new Map([["signature","4s"],["node_type","B"],["node_level","B"],["entries_used","H"],["left_sibling","Q"],["right_sibling","Q"]]);async _read_node_header(z,K){let ee=await _unpack_struct_from_async(this.B_LINK_NODE,this.fh,z);if(null!=K&&ee.get("node_level")!=K)throw"node level does not match";return ee}};var Wd=class extends jd{NODE_TYPE=0;constructor(z,K){super(z,K);this.ready=this.init()}async _read_node(z,K){let ee=await this._read_node_header(z,K);z+=_structure_size(this.B_LINK_NODE);let te=[];let ne=[];let re=ee.get("entries_used");for(var ie=0;ie<re;ie++){let K=(await oh.unpack_from_async("<Q",this.fh,z))[0];z+=8;let ee=(await oh.unpack_from_async("<Q",this.fh,z))[0];z+=8;te.push(K);ne.push(ee)}te.push((await oh.unpack_from_async("<Q",this.fh,z))[0]);ee.set("keys",te);ee.set("addresses",ne);return ee}symbol_table_addresses(){var z=[];var K=this.all_nodes.get(0);for(var ee of K)z=z.concat(ee.get("addresses"));return z}};var Gd=class extends jd{NODE_TYPE=1;constructor(z,K,ee){super(z,K);this.dims=ee;this.ready=this.init()}async _read_node(z,K){let ee=await this._read_node_header(z,K);z+=_structure_size(this.B_LINK_NODE);var te=[];var ne=[];let re=ee.get("entries_used");for(var ie=0;ie<re;ie++){let[K,ee]=await oh.unpack_from_async("<II",this.fh,z);z+=8;let re="<"+this.dims.toFixed()+"Q";let ie=oh.calcsize(re);let se=await oh.unpack_from_async(re,this.fh,z);z+=ie;let oe=(await oh.unpack_from_async("<Q",this.fh,z))[0];z+=8;te.push(new Map([["chunk_size",K],["filter_mask",ee],["chunk_offset",se]]));ne.push(oe)}ee.set("keys",te);ee.set("addresses",ne);return ee}async construct_data_from_chunks(z,K,ee,te){var ne,re,ie;if(ee instanceof Array){let z=ee[0];if("REFERENCE"==z){let z=ee[1];if(8!=z)throw"NotImplementedError('Unsupported Reference type')";ee="<u8";ne="getUint64";re=false;ie=8}else{if("VLEN_STRING"!=z&&"VLEN_SEQUENCE"!=z)throw"NotImplementedError('datatype not implemented')";ne="getVLENStruct";re=false;ie=16}}else[ne,re,ie]=dtype_getter(ee);var se=K.reduce((function(z,K){return z*K}),1);var oe=z.reduce((function(z,K){return z*K}),1);let ae=K.length;var le=1;z.slice().map((function(z){let K=le;le*=z;return K}));le=1;var ce=K.slice().reverse().map((function(z){let K=le;le*=z;return K})).reverse();var he=new Array(se);let ue=oe*ie;for(var de of this.all_nodes.get(0)){let ee=de.get("keys");let se=de.get("addresses");let le=ee.length;for(var fe=0;fe<le;fe++){let le=ee[fe];let de=se[fe];var pe;if(null==te)pe=await this.fh.slice(de,de+ue);else{pe=await this.fh.slice(de,de+le.get("chunk_size"));let z=le.get("filter_mask");pe=this._filter_chunk(pe,z,te,ie)}var ge=le.get("chunk_offset").slice();var me=ge.slice();var be=me.map((function(){return 0}));var ve=new ah(pe);for(var we=0;we<oe;we++){for(var ye=ae-1;ye>=0;ye--){if(!(be[ye]>=z[ye]))break;be[ye]=0;me[ye]=ge[ye];if(ye>0){be[ye-1]+=1;me[ye-1]+=1}}let ee=me.slice(0,-1).every((function(z,ee){return z<K[ee]}));if(ee){let z=we*ie;let K=ve[ne](z,!re,ie);let ee=me.slice(0,-1).reduce((function(z,K,ee){return K*ce[ee]+z}),0);he[ee]=K}be[ae-1]+=1;me[ae-1]+=1}}}return he}_filter_chunk(z,K,ee,te){let ne=ee.length;let re=z.slice();for(var ie=ne-1;ie>=0;ie--){if(K&1<<ie)continue;let z=ee[ie];let ne=z.get("filter_id");let se=z.get("client_data");if(!$d.has(ne))throw'NotImplementedError("Filter with id:'+ne.toFixed()+' not supported")';re=$d.get(ne)(re,te,se)}return re}};var Zd=class extends qd{B_TREE_HEADER=new Map([["signature","4s"],["version","B"],["node_type","B"],["node_size","I"],["record_size","H"],["depth","H"],["split_percent","B"],["merge_percent","B"],["root_address","Q"],["root_nrecords","H"],["total_nrecords","Q"]]);B_LINK_NODE=new Map([["signature","4s"],["version","B"],["node_type","B"]]);constructor(z,K){super(z,K);this.ready=this.init()}async _read_root_node(){let z=await this._read_tree_header(this.offset);this.address_formats=this._calculate_address_formats(z);this.header=z;this.depth=z.get("depth");let K=[z.get("root_address"),z.get("root_nrecords"),z.get("total_nrecords")];let ee=await this._read_node(K,this.depth);this._add_node(ee)}async _read_tree_header(z){let K=await _unpack_struct_from_async(this.B_TREE_HEADER,this.fh,this.offset);return K}_calculate_address_formats(z){let K=z.get("node_size");let ee=z.get("record_size");let te=0;let ne=0;let re=new Map;let ie=z.get("depth");for(var se=0;se<=ie;se++){let z="";let oe="";let ae="";let le,ce,he;if(0==se){le=0;ce=0;he=0}else if(1==se){le=8;z="<Q";ce=this._required_bytes(te);oe=this._int_format(ce);he=0}else{le=8;z="<Q";ce=this._required_bytes(te);oe=this._int_format(ce);he=this._required_bytes(ne);ae=this._int_format(he)}re.set(se,[le,ce,he,z,oe,ae]);if(se<ie){let z=le+ce+he;te=this._nrecords_max(K,ee,z);ne>0?ne*=te:ne=te}}return re}_nrecords_max(z,K,ee){return Math.floor((z-10-ee)/(K+ee))}_required_bytes(z){return Math.ceil(bitSize(z)/8)}_int_format(z){return["<B","<H","<I","<Q"][z-1]}async _read_node(z,K){let[ee,te,ne]=z;let re=this._read_node_header(ee,K);ee+=_structure_size(this.B_LINK_NODE);let ie=this.header.get("record_size");let se=[];for(let z=0;z<te;z++){let z=await this._parse_record(this.fh,ee,ie);ee+=ie;se.push(z)}let oe=[];let ae=this.address_formats.get(K);if(0!=K){let[z,K,ne,re,ie,se]=ae;for(let ae=0;ae<=te;ae++){let te=(await oh.unpack_from_async(re,this.fh,ee))[0];ee+=z;let ae=(await oh.unpack_from_async(ie,this.fh,ee))[0];ee+=K;let le=ae;if(ne>0){le=(await oh.unpack_from_async(se,this.fh,ee))[0];ee+=ne}oe.push([te,ae,le])}}re.set("keys",se);re.set("addresses",oe);return re}async _read_node_header(z,K){let ee=await _unpack_struct_from_async(this.B_LINK_NODE,this.fh,z);ee.set("node_level",K);return ee}*iter_records(){for(let z of this.all_nodes.values())for(let K of z)for(let z of K.get("keys"))yield z}_parse_record(z){throw"NotImplementedError"}};var Qd=class extends Zd{NODE_TYPE=5;async _parse_record(z,K,ee){let te=(await oh.unpack_from_async("<I",z,K))[0];K+=4;const ne=await z.slice(K,K+7);return new Map([["namehash",te],["heapid",ne]])}};var Xd=class extends Zd{NODE_TYPE=6;async _parse_record(z,K,ee){let te=(await oh.unpack_from_async("<Q",z,K))[0];K+=8;const ne=await z.slice(K,K+7);return new Map([["creationorder",te],["heapid",ne]])}};var Yd=class{constructor(z,K){this.ready=this.init(z,K)}async init(z,K){let ee=await oh.unpack_from_async("<B",z,K+8);var te;if(0==ee){te=await _unpack_struct_from_async(sf,z,K);this._end_of_sblock=K+of}else{if(2!=ee&&3!=ee)throw"unsupported superblock version: "+ee.toFixed();te=await _unpack_struct_from_async(af,z,K);this._end_of_sblock=K+lf}if(te.get("format_signature")!=nf)throw"Incorrect file signature: "+te.get("format_signature");if(8!=te.get("offset_size")||8!=te.get("length_size"))throw"File uses non-64-bit addressing";this.version=te.get("superblock_version");this._contents=te;this._root_symbol_table=null;this._fh=z}async get_offset_to_dataobjects(){if(0==this.version){var z=new Jd(this._fh,this._end_of_sblock,true);await z.ready;this._root_symbol_table=z;return z.group_offset}if(2==this.version||3==this.version)return this._contents.get("root_group_address");throw"Not implemented version = "+this.version.toFixed()}};var Kd=class{constructor(z,K){this.ready=this.init(z,K)}async init(z,K){let ee=await _unpack_struct_from_async(ff,z,K);assert("HEAP"==ee.get("signature"));assert(0==ee.get("version"));let te=ee.get("address_of_data_segment");let ne=await z.slice(te,te+ee.get("data_segment_size"));ee.set("heap_data",ne);this._contents=ee;this.data=ne}get_object_name(z){let K=new Uint8Array(this.data).indexOf(0,z);let ee=K-z;let te=oh.unpack_from("<"+ee.toFixed()+"s",this.data,z)[0];return te}};var Jd=class{constructor(z,K,ee=false){this.ready=this.init(z,K,ee)}async init(z,K,ee){var te;if(ee)te=new Map([["symbols",1]]);else{te=await _unpack_struct_from_async(uf,z,K);if("SNOD"!=te.get("signature"))throw"incorrect node type";K+=df}var ne=[];var re=te.get("symbols");for(var ie=0;ie<re;ie++){ne.push(await _unpack_struct_from_async(cf,z,K));K+=hf}ee&&(this.group_offset=ne[0].get("object_header_address"));this.entries=ne;this._contents=te;return this}assign_name(z){this.entries.forEach((function(K){let ee=K.get("link_name_offset");let te=z.get_object_name(ee);K.set("link_name",te)}))}get_links(z){var K={};this.entries.forEach((function(ee){let te=ee.get("cache_type");let ne=ee.get("link_name");if(0==te||1==te)K[ne]=ee.get("object_header_address");else if(2==te){let te=ee.get("scratch");let ie=new ArrayBuffer(4);let se=new Uint8Array(ie);for(var re=0;re<4;re++)se[re]=te.charCodeAt(re);let oe=oh.unpack_from("<I",ie,0)[0];K[ne]=z.get_object_name(oe)}}));return K}};var ef=class{constructor(z,K){this.ready=this.init(z,K)}async init(z,K){let ee=await _unpack_struct_from_async(pf,z,K);K+=gf;let te=ee.get("collection_size")-gf;let ne=await z.slice(K,K+te);this.heap_data=ne;this._header=ee;this._objects=null}get objects(){if(null==this._objects){this._objects=new Map;var z=0;while(z<=this.heap_data.byteLength-bf){let K=_unpack_struct_from(mf,this.heap_data,z);if(0==K.get("object_index"))break;z+=bf;let ee=this.heap_data.slice(z,z+K.get("object_size"));this._objects.set(K.get("object_index"),ee);z+=_padded_size(K.get("object_size"))}}return this._objects}};var tf=class{constructor(z,K){this.fh=z;this.ready=this.init(K)}async init(z){let K=await _unpack_struct_from_async(vf,this.fh,z);z+=_structure_size(vf);assert("FRHP"==K.get("signature"));assert(0==K.get("version"));if(K.get("filter_info_size")>0)throw"Filter info size not supported on FractalHeap";if(K.get("btree_address_huge_objects")!=rf)throw"Huge objects not implemented in FractalHeap";K.set("btree_address_huge_objects",null);K.get("root_block_address")==rf&&K.set("root_block_address",null);let ee=K.get("log2_maximum_heap_size");let te=this._min_size_nbits(ee);let ne=new Map([["signature","4s"],["version","B"],["heap_header_adddress","Q"],["block_offset",`${te}B`]]);this.indirect_block_header=new Map(ne);this.indirect_block_header_size=_structure_size(ne);2==(2&K.get("flags"))&&ne.set("checksum","I");this.direct_block_header=ne;this.direct_block_header_size=_structure_size(ne);let re=K.get("maximum_direct_block_size");this._managed_object_offset_size=this._min_size_nbits(ee);let ie=Math.min(re,K.get("max_managed_object_size"));this._managed_object_length_size=this._min_size_integer(ie);let se=K.get("starting_block_size");let oe=K.get("table_width");if(!(se>0))throw"Starting block size == 0 not implemented";let ae=Number(Math.floor(Math.log2(re)));assert(1n<<BigInt(ae)==re);let le=Number(Math.floor(Math.log2(se)));assert(1n<<BigInt(le)==se);this._max_direct_nrows=ae-le+2;let ce=Math.floor(Math.log2(oe));assert(1<<ce==oe);this._indirect_nrows_sub=ce+le-1;this.header=K;this.nobjects=K.get("managed_object_count")+K.get("huge_object_count")+K.get("tiny_object_count");let he=[];let ue=K.get("root_block_address");let de=0;null!=ue&&(de=K.get("indirect_current_rows_count"));if(de>0)for await(let z of this._iter_indirect_block(this.fh,ue,de))he.push(z);else{let z=await this._read_direct_block(this.fh,ue,se);he.push(z)}let fe=he.reduce(((z,K)=>z+K.byteLength),0);let pe=new Uint8Array(fe);let ge=0;he.forEach((z=>{pe.set(new Uint8Array(z),ge);ge+=z.byteLength}));this.managed=pe.buffer}async _read_direct_block(z,K,ee){let te=await z.slice(K,K+ee);let ne=_unpack_struct_from(this.direct_block_header,te);assert("FHDB"==ne.get("signature"));return te}get_data(z){let K=oh.unpack_from("<B",z,0)[0];let ee=K>>4&3;let te=K>>6;let ne=1;if(0==ee){assert(0==te);let K=this._managed_object_offset_size;let ee=_unpack_integer(K,z,ne);ne+=K;K=this._managed_object_length_size;let re=_unpack_integer(K,z,ne);return this.managed.slice(ee,ee+re)}throw 1==ee?"tiny objectID not supported in FractalHeap":2==ee?"huge objectID not supported in FractalHeap":"unknown objectID type in FractalHeap"}_min_size_integer(z){return this._min_size_nbits(bitSize(z))}_min_size_nbits(z){return Math.ceil(z/8)}async*_iter_indirect_block(z,K,ee){let te=await _unpack_struct_from_async(this.indirect_block_header,z,K);K+=this.indirect_block_header_size;assert("FHIB"==te.get("signature"));let ne=te.get("block_offset");let re=ne.reduce(((z,K,ee)=>z+(K<<8*ee)),0);te.set("block_offset",re);let[ie,se]=this._indirect_info(ee);let oe=[];for(let ee=0;ee<ie;ee++){let te=(await oh.unpack_from_async("<Q",z,K))[0];K+=8;if(te==rf)break;let ne=this._calc_block_size(ee);oe.push([te,ne])}let ae=[];for(let ee=ie;ee<ie+se;ee++){let te=(await oh.unpack_from_async("<Q",z,K))[0];K+=8;if(te==rf)break;let ne=this._calc_block_size(ee);let re=this._iblock_nrows_from_block_size(ne);ae.push([te,re])}for(let[K,ee]of oe){let te=await this._read_direct_block(z,K,ee);yield te}for(let[K,ee]of ae)for await(let te of this._iter_indirect_block(z,K,ee))yield te}_calc_block_size(z){let K=Math.floor(z/this.header.get("table_width"));return 2**Math.max(K-1,0)*this.header.get("starting_block_size")}_iblock_nrows_from_block_size(z){let K=Math.floor(Math.log2(z));assert(2**K==z);return K-this._indirect_nrows_sub}_indirect_info(z){let K=this.header.get("table_width");let ee=z*K;let te=this._max_direct_nrows*K;let ne,re;if(z<=te){ne=ee;re=0}else{ne=te;re=ee-te}return[ne,re]}_int_format(z){return["B","H","I","Q"][z-1]}};var nf=oh.unpack_from("8s",new Uint8Array([137,72,68,70,13,10,26,10]).buffer)[0];var rf=oh.unpack_from("<Q",new Uint8Array([255,255,255,255,255,255,255,255]).buffer)[0];var sf=new Map([["format_signature","8s"],["superblock_version","B"],["free_storage_version","B"],["root_group_version","B"],["reserved_0","B"],["shared_header_version","B"],["offset_size","B"],["length_size","B"],["reserved_1","B"],["group_leaf_node_k","H"],["group_internal_node_k","H"],["file_consistency_flags","L"],["base_address_lower","Q"],["free_space_address","Q"],["end_of_file_address","Q"],["driver_information_address","Q"]]);var of=_structure_size(sf);var af=new Map([["format_signature","8s"],["superblock_version","B"],["offset_size","B"],["length_size","B"],["file_consistency_flags","B"],["base_address","Q"],["superblock_extension_address","Q"],["end_of_file_address","Q"],["root_group_address","Q"],["superblock_checksum","I"]]);var lf=_structure_size(af);var cf=new Map([["link_name_offset","Q"],["object_header_address","Q"],["cache_type","I"],["reserved","I"],["scratch","16s"]]);var hf=_structure_size(cf);var uf=new Map([["signature","4s"],["version","B"],["reserved_0","B"],["symbols","H"]]);var df=_structure_size(uf);var ff=new Map([["signature","4s"],["version","B"],["reserved","3s"],["data_segment_size","Q"],["offset_to_free_list","Q"],["address_of_data_segment","Q"]]);var pf=new Map([["signature","4s"],["version","B"],["reserved","3s"],["collection_size","Q"]]);var gf=_structure_size(pf);var mf=new Map([["object_index","H"],["reference_count","H"],["reserved","I"],["object_size","Q"]]);var bf=_structure_size(mf);var vf=new Map([["signature","4s"],["version","B"],["object_index_size","H"],["filter_info_size","H"],["flags","B"],["max_managed_object_size","I"],["next_huge_object_index","Q"],["btree_address_huge_objects","Q"],["managed_freespace_size","Q"],["freespace_manager_address","Q"],["managed_space_size","Q"],["managed_alloc_size","Q"],["next_directblock_iterator_address","Q"],["managed_object_count","Q"],["huge_objects_total_size","Q"],["huge_object_count","Q"],["tiny_objects_total_size","Q"],["tiny_object_count","Q"],["table_width","H"],["starting_block_size","Q"],["maximum_direct_block_size","Q"],["log2_maximum_heap_size","H"],["indirect_starting_rows_count","H"],["root_block_address","Q"],["indirect_current_rows_count","H"]]);var wf=class{constructor(z,K){this.ready=this.init(z,K)}async init(z,K){let ee=(await oh.unpack_from_async("<B",z,K))[0];if(1==ee)var[te,ne,re]=await this._parse_v1_objects(z,K);else{if(ee!="O".charCodeAt(0))throw"InvalidHDF5File('unknown Data Object Header')";var[te,ne,re]=await this._parse_v2_objects(z,K)}this.fh=z;this.msgs=te;this.msg_data=ne;this.offset=K;this._global_heaps={};this._header=re;this._filter_pipeline=null;this._chunk_params_set=false;this._chunks=null;this._chunk_dims=null;this._chunk_address=null}get dtype(){let z=this.find_msg_type(Gf)[0];let K=z.get("offset_to_message");return new lh(this.fh,K).dtype}get chunks(){return this._get_chunk_params().then((()=>this._chunks))}get shape(){let z=this.find_msg_type(jf)[0];let K=z.get("offset_to_message");return determine_data_shape(this.fh,K)}async get_filter_pipeline(){if(null!=this._filter_pipeline)return this._filter_pipeline;let z=this.find_msg_type(Yf);if(!z.length){this._filter_pipeline=null;return this._filter_pipeline}var K=z[0].get("offset_to_message");let[ee,te]=await oh.unpack_from_async("<BB",this.fh,K);K+=oh.calcsize("<BB");var ne=[];if(1==ee){await oh.unpack_from_async("<HI",this.fh,K);K+=oh.calcsize("<HI");for(var re=0;re<te;re++){let z=await _unpack_struct_from_async($f,this.fh,K);K+=qf;let ee=_padded_size(z.get("name_length"),8);let te="<"+ee.toFixed()+"s";let re=(await oh.unpack_from_async(te,this.fh,K))[0];z.set("filter_name",re);K+=ee;te="<"+z.get("client_data_values").toFixed()+"I";let ie=await oh.unpack_from_async(te,this.fh,K);z.set("client_data",ie);K+=4*z.get("client_data_values");z.get("client_data_values")%2&&(K+=4);ne.push(z)}}else{if(2!=ee)throw`version ${ee} is not supported`;for(let z=0;z<te;z++){let z=new Map;let ee=this.fh;let te=(await oh.unpack_from_async("<H",ee,K))[0];K+=2;z.set("filter_id",te);let re=0;if(te>255){re=(await oh.unpack_from_async("<H",ee,K))[0];K+=2}let ie=(await oh.unpack_from_async("<H",ee,K))[0];K+=2;let se=(1&ie)>0;z.set("optional",se);let oe=(await oh.unpack_from_async("<H",ee,K))[0];K+=2;let ae;if(re>0){ae=(await oh.unpack_from_async(`${re}s`,ee,K))[0];K+=re}z.set("name",ae);let le=await oh.unpack_from_async(`<${oe}i`,ee,K);K+=4*oe;z.set("client_data_values",le);ne.push(z)}}this._filter_pipeline=ne;return this._filter_pipeline}find_msg_type(z){return this.msgs.filter((function(K){return K.get("type")==z}))}async get_attributes(){let z={};let K=this.find_msg_type(Kf);for(let ee of K){let K=ee.get("offset_to_message");let[te,ne]=await this.unpack_attribute(K);z[te]=ne}return z}async get_fillvalue(){let z=this.find_msg_type(Zf)[0];var K=z.get("offset_to_message");var ee;let te=(await oh.unpack_from_async("<B",this.fh,K))[0];var ne,re,ie;if(1==te||2==te){ne=await _unpack_struct_from_async(zf,this.fh,K);K+=Hf;ee=ne.get("fillvalue_defined")}else{if(3!=te)throw'InvalidHDF5File("Unknown fillvalue msg version: "'+String(te);ne=await _unpack_struct_from_async(Uf,this.fh,K);K+=Vf;ee=32&ne.get("flags")}if(ee){re=(await oh.unpack_from_async("<I",this.fh,K))[0];K+=4}else re=0;if(re){let[z,ee,te]=dtype_getter(await this.dtype);let ne=new ah(await this.fh.slice(K,K+te));ie=ne[z](K,!ee,te)}else ie=0;return ie}async unpack_attribute(z){let K=(await oh.unpack_from_async("<B",this.fh,z))[0];var ee,te;if(1==K){ee=await _unpack_struct_from_async(kf,this.fh,z);assert(1==ee.get("version"));z+=xf;te=8}else{if(3!=K)throw"unsupported attribute message version: "+K;ee=await _unpack_struct_from_async(Cf,this.fh,z);assert(3==ee.get("version"));z+=Sf;te=1}let ne=ee.get("name_size");let re=(await oh.unpack_from_async("<"+ne.toFixed()+"s",this.fh,z))[0];re=re.replace(/\x00$/,"");z+=_padded_size(ne,te);var ie;try{ie=await new lh(this.fh,z).dtype}catch(z){console.warn("Attribute "+re+" type not implemented, set to null.");return[re,null]}z+=_padded_size(ee.get("datatype_size"),te);let se=await this.determine_data_shape(this.fh,z);let oe=se.reduce((function(z,K){return z*K}),1);z+=_padded_size(ee.get("dataspace_size"),te);if(5===ie.datatype_class)ae=await this.fh.slice(z,z+ie.size);else{var ae=await this._attr_value(ie,this.fh,oe,z);0==se.length&&(ae=ae[0])}return[re,ae]}async determine_data_shape(z,K){let ee=(await oh.unpack_from_async("<B",z,K))[0];var te;if(1==ee){te=await _unpack_struct_from_async(Ef,z,K);assert(1==te.get("version"));K+=Mf}else{if(2!=ee)throw"unknown dataspace message version";te=await _unpack_struct_from_async(Rf,z,K);assert(2==te.get("version"));K+=If}let ne=te.get("dimensionality");let re=await oh.unpack_from_async("<"+ne.toFixed()+"Q",z,K);return re}async _attr_value(z,K,ee,te){var ne=new Array(ee);if(z instanceof Array){let ae=z[0];for(var re=0;re<ee;re++)if("VLEN_STRING"==ae){let ee=z[2];var[ie,se]=await this._vlen_size_and_data(K,te);const oe=0==ee?"ascii":"utf-8";const ae=new TextDecoder(oe);ne[re]=ae.decode(se);te+=16}else if("REFERENCE"==ae){var oe=await oh.unpack_from_async("<Q",K,te);ne[re]=oe;te+=8}else{if("VLEN_SEQUENCE"!=ae)throw"NotImplementedError";{let ee=z[1];var[ie,se]=this._vlen_size_and_data(K,te);ne[re]=this._attr_value(ee,se,ie,0);te+=16}}}else{let[ie,se,oe]=dtype_getter(z);const ae=await K.slice(te,te+ee*oe);let le=new ah(ae,0);let ce=0;for(re=0;re<ee;re++){ne[re]=le[ie](ce,!se,oe);ce+=oe}}return ne}async _vlen_size_and_data(z,K){let ee=(await oh.unpack_from_async("<I",z,K))[0];let te=await _unpack_struct_from_async(_f,z,K+4);let ne=te.get("collection_address");assert(te.get("collection_address")<Number.MAX_SAFE_INTEGER);var re;if(!(ne in this._global_heaps)){re=new ef(this.fh,ne);await re.ready;this._global_heaps[ne]=re}re=this._global_heaps[ne];let ie=re.objects.get(te.get("object_index"));return[ee,ie]}async _parse_v1_objects(z,K){let ee=await _unpack_struct_from_async(Af,z,K);assert(1==ee.get("version"));let te=ee.get("total_header_messages");var ne=ee.get("object_header_size");var re=K+_structure_size(Af);var ie=await z.slice(re,re+ne);var se=[[re,ne]];var oe=0;var ae=0;var le=new Array(te);for(var ce=0;ce<te;ce++){if(ae>=ne){[re,ne]=se[++oe];ae=0}let K=await _unpack_struct_from_async(Ff,z,re+ae);let ee=re+ae+Lf;K.set("offset_to_message",ee);if(K.get("type")==Jf){var[he,ue]=await oh.unpack_from_async("<QQ",z,ee);se.push([he,ue])}ae+=Lf+K.get("size");le[ce]=K}return[le,ie,ee]}async _parse_v2_objects(z,K){var[ee,te,ne]=await this._parse_v2_header(z,K);K=ne;var re=[];var ie=ee.get("size_of_chunk_0");var se=z.slice(K,K+=ie);var oe=[[ne,ie]];var ae=0;var le=0;while(true){if(le>=ie-Nf){let z=oe[++ae];if(null==z)break;[ne,ie]=z;le=0}let K=await _unpack_struct_from_async(Bf,z,ne+le);let ee=ne+le+Nf+te;K.set("offset_to_message",ee);if(K.get("type")==Jf){var[ce,he]=await oh.unpack_from_async("<QQ",z,ee);oe.push([ce+4,he-4])}le+=Nf+K.get("size")+te;re.push(K)}return[re,se,ee]}async _parse_v2_header(z,K){let ee=await _unpack_struct_from_async(Tf,z,K);var te;K+=_structure_size(Tf);assert(2==ee.get("version"));te=4&ee.get("flags")?2:0;assert(0==(16&ee.get("flags")));if(32&ee.get("flags")){let te=await oh.unpack_from_async("<4I",z,K);K+=16;ee.set("access_time",te[0]);ee.set("modification_time",te[1]);ee.set("change_time",te[2]);ee.set("birth_time",te[3])}let ne=["<B","<H","<I","<Q"][3&ee.get("flags")];ee.set("size_of_chunk_0",(await oh.unpack_from_async(ne,z,K))[0]);K+=oh.calcsize(ne);return[ee,te,K]}async find_link(z){if(this._links){for(link of this._links)if(z===link[0])return link}else{const K=[];for await(const ee of this.iter_links()){if(z===ee[0])return ee;K.push(ee)}this._links=K}}async get_links(){const z=[];for await(const K of this.iter_links())z.push(K);return Object.fromEntries(z)}async*iter_links(){for(let z of this.msgs)z.get("type")==ep?yield*this._iter_links_from_symbol_tables(z):z.get("type")==Qf?yield this._get_link_from_link_msg(z):z.get("type")==Wf&&(yield*this._iter_link_from_link_info_msg(z))}async*_iter_links_from_symbol_tables(z){assert(16==z.get("size"));let K=await _unpack_struct_from_async(Df,this.fh,z.get("offset_to_message"));yield*this._iter_links_btree_v1(K.get("btree_address"),K.get("heap_address"))}async*_iter_links_btree_v1(z,K){let ee=new Wd(this.fh,z);await ee.ready;let te=new Kd(this.fh,K);await te.ready;for(let z of ee.symbol_table_addresses()){let K=new Jd(this.fh,z);await K.ready;K.assign_name(te);yield*Object.entries(K.get_links(te))}}async _get_link_from_link_msg(z){let K=z.get("offset_to_message");return await this._decode_link_msg(this.fh,K)[1]}async _decode_link_msg(z,K){let[ee,te]=await oh.unpack_from_async("<BB",z,K);K+=2;assert(1==ee);let ne=2**(3&te);let re=(8&te)>0;let ie=(16&te)>0;let se=(4&te)>0;let oe;if(re){oe=(await oh.unpack_from_async("<B",z,K))[0];K+=1}else oe=0;assert([0,1].includes(oe));let ae;if(se){ae=(await oh.unpack_from_async("<Q",z,K))[0];K+=8}let le=0;if(ie){le=(await oh.unpack_from_async("<B",z,K))[0];K+=1}let ce=0==le?"ascii":"utf-8";let he=["<B","<H","<I","<Q"][3&te];let ue=(await oh.unpack_from_async(he,z,K))[0];K+=ne;let de=new TextDecoder(ce).decode(await z.slice(K,K+ue));K+=ue;let fe;if(0==oe)fe=(await oh.unpack_from_async("<Q",z,K))[0];else if(1==oe){let ee=(await oh.unpack_from_async("<H",z,K))[0];K+=2;fe=new TextDecoder(ce).decode(await z.slice(K,K+ee))}return[ae,[de,fe]]}async*_iter_link_from_link_info_msg(z){let K=z.get("offset_to_message");let ee=await this._decode_link_info_msg(this.fh,K);let te=ee.get("heap_address");let ne=ee.get("name_btree_address");let re=ee.get("order_btree_address");null!=ne&&(yield*this._iter_links_btree_v2(ne,re,te))}async*_iter_links_btree_v2(z,K,ee){let te=new tf(this.fh,ee);await te.ready;let ne;const re=null!=K;if(re){ne=new Xd(this.fh,K);await ne.ready}else{ne=new Qd(this.fh,z);await ne.ready}let ie=new Map;for(let z of ne.iter_records()){let K=te.get_data(z.get("heapid"));let[ee,ne]=await this._decode_link_msg(K,0);const se=re?ee:ne[0];ie.set(se,ne)}let se=Array.from(ie.keys()).sort();for(let z of se)yield ie.get(z)}async _decode_link_info_msg(z,K){let[ee,te]=await oh.unpack_from_async("<BB",z,K);assert(0==ee);K+=2;(1&te)>0&&(K+=8);let ne=(2&te)>0?Of:Pf;let re=await _unpack_struct_from_async(ne,z,K);let ie=new Map;for(let[z,K]of re.entries())ie.set(z,K==yf?null:K);return ie}get is_dataset(){return this.find_msg_type(jf).length>0}async get_data(){let z=this.find_msg_type(Xf)[0];let K=z.get("offset_to_message");var[ee,te,ne,re]=await this._get_data_message_properties(K);if(0==ne)throw"Compact storage of DataObject not implemented";return 1==ne?this._get_contiguous_data(re):2==ne?this._get_chunked_data(K):void 0}async _get_data_message_properties(z){let K,ee,te;let[ne,re,ie]=await oh.unpack_from_async("<BBB",this.fh,z);if(1==ne||2==ne){K=re;ee=ie;te=z;te+=oh.calcsize("<BBB");te+=oh.calcsize("<BI");assert(1==ee||2==ee)}else if(3==ne||4==ne){ee=re;te=z;te+=oh.calcsize("<BB")}assert(ne>=1&&ne<=4);return[ne,K,ee,te]}async _get_contiguous_data(z){let[K]=await oh.unpack_from_async("<Q",this.fh,z);const ee=await this.shape;const te=await this.dtype;if(K==yf){let z=ee.reduce((function(z,K){return z*K}),1);return new Array(z)}var ne=ee.reduce((function(z,K){return z*K}),1);if(te instanceof Array){let z=te[0];if("REFERENCE"==z){let z=te[1];if(8!=z)throw"NotImplementedError('Unsupported Reference type')";let ee=await this.fh.slice(K,K+ne);return ee}if("VLEN_STRING"==z){let z=te[2];const ee=0==z?"ascii":"utf-8";const se=new TextDecoder(ee);var re=[];for(ie=0;ie<ne;ie++){const[z,ee]=await this._vlen_size_and_data(this.fh,K);re[ie]=se.decode(ee);K+=16}return re}throw"NotImplementedError('datatype not implemented')"}if(/[<>=!@\|]?(i|u|f|S)(\d*)/.test(te)){let[z,ee,re]=dtype_getter(te);let se=new Array(ne);const oe=await this.fh.slice(K,K+re*ne);let ae=new ah(oe);for(var ie=0;ie<ne;ie++)se[ie]=ae[z](ie*re,!ee,re);return se}if(5===te.datatype_class)return this.fh.slice(K,K+te.size);throw"not Implemented - no proper dtype defined"}async _get_chunked_data(z){await this._get_chunk_params();if(this._chunk_address==yf)return[];var K=new Gd(this.fh,this._chunk_address,this._chunk_dims);await K.ready;const ee=await this.dtype;const te=await this.shape;const ne=await this.chunks;const re=await this.get_filter_pipeline();let ie=await K.construct_data_from_chunks(ne,te,ee,re);if(ee instanceof Array&&/^VLEN/.test(ee[0])){let z=ee[0];for(var se=0;se<ie.length;se++){let[K,te,ne]=ie[se];var oe;if(te in this._global_heaps)oe=this._global_heaps[te];else{oe=new ef(this.fh,te);await oe.ready;this._global_heaps[te]=oe}let re=oe.objects.get(ne);if("VLEN_STRING"==z){let z=ee[2];const K=0==z?"ascii":"utf-8";const te=new TextDecoder(K);ie[se]=te.decode(re)}}}return ie}async _get_chunk_params(){if(!this._chunk_params_set){this._chunk_params_set=true;var z=this.find_msg_type(Xf)[0];var K=z.get("offset_to_message");var[ee,te,ne,re]=await this._get_data_message_properties(K);if(2==ne){var ie;if(1==ee||2==ee){var se=(await oh.unpack_from_async("<Q",this.fh,re))[0];ie=re+oh.calcsize("<Q")}else if(3==ee){var[te,se]=await oh.unpack_from_async("<BQ",this.fh,re);ie=re+oh.calcsize("<BQ")}assert(ee>=1&&ee<=3);var oe="<"+(te-1).toFixed()+"I";var ae=await oh.unpack_from_async(oe,this.fh,ie);this._chunks=ae;this._chunk_dims=te;this._chunk_address=se}}}};async function determine_data_shape(z,K){let ee=(await oh.unpack_from_async("<B",z,K))[0];var te;if(1==ee){te=await _unpack_struct_from_async(Ef,z,K);assert(1==te.get("version"));K+=Mf}else{if(2!=ee)throw"InvalidHDF5File('unknown dataspace message version')";te=await _unpack_struct_from_async(Rf,z,K);assert(2==te.get("version"));K+=If}let ne=te.get("dimensionality");let re=await oh.unpack_from_async("<"+(2*ne).toFixed()+"I",z,K);return re.filter((function(z,K){return K%2==0}))}var yf=oh.unpack_from("<Q",new Uint8Array([255,255,255,255,255,255,255,255]).buffer);var _f=new Map([["collection_address","Q"],["object_index","I"]]);_structure_size(_f);var kf=new Map([["version","B"],["reserved","B"],["name_size","H"],["datatype_size","H"],["dataspace_size","H"]]);var xf=_structure_size(kf);var Cf=new Map([["version","B"],["flags","B"],["name_size","H"],["datatype_size","H"],["dataspace_size","H"],["character_set_encoding","B"]]);var Sf=_structure_size(Cf);var Af=new Map([["version","B"],["reserved","B"],["total_header_messages","H"],["object_reference_count","I"],["object_header_size","I"],["padding","I"]]);var Tf=new Map([["signature","4s"],["version","B"],["flags","B"]]);var Ef=new Map([["version","B"],["dimensionality","B"],["flags","B"],["reserved_0","B"],["reserved_1","I"]]);var Mf=_structure_size(Ef);var Rf=new Map([["version","B"],["dimensionality","B"],["flags","B"],["type","B"]]);var If=_structure_size(Rf);var Ff=new Map([["type","H"],["size","H"],["flags","B"],["reserved","3s"]]);var Lf=_structure_size(Ff);var Bf=new Map([["type","B"],["size","H"],["flags","B"]]);var Nf=_structure_size(Bf);var Df=new Map([["btree_address","Q"],["heap_address","Q"]]);var Pf=new Map([["heap_address","Q"],["name_btree_address","Q"]]);var Of=new Map([["heap_address","Q"],["name_btree_address","Q"],["order_btree_address","Q"]]);var zf=new Map([["version","B"],["space_allocation_time","B"],["fillvalue_write_time","B"],["fillvalue_defined","B"]]);var Hf=_structure_size(zf);var Uf=new Map([["version","B"],["flags","B"]]);var Vf=_structure_size(Uf);var $f=new Map([["filter_id","H"],["name_length","H"],["flags","H"],["client_data_values","H"]]);var qf=_structure_size($f);var jf=1;var Wf=2;var Gf=3;var Zf=5;var Qf=6;var Xf=8;var Yf=11;var Kf=12;var Jf=16;var ep=17;var tp=class{constructor(z,K){if(null==K){this.parent=this;this.file=this}else{this.parent=K;this.file=K.file}this.name=z}async init(z){const K=this.file.index;K&&this.name in K?this._links=K[this.name]:this._links=await z.get_links();this._dataobjects=z;this._attrs=null;this._keys=null}get keys(){null==this._keys&&(this._keys=Object.keys(this._links));return this._keys.slice()}get values(){return this.keys.map((z=>this.get(z)))}length(){return this.keys.length}_dereference(z){if(!z)throw"cannot deference null reference";let K=this.file._get_object_by_address(z);if(null==K)throw"reference not found in file";return K}async get(z){if("number"==typeof z)return this._dereference(z);var K=normpath(z);if("/"==K)return this.file;if("."==K)return this;if(/^\//.test(K))return this.file.get(K.slice(1));if(""!=posix_dirname(K))var[ee,te]=K.split(/\/(.*)/);else{var ee=K;var te="."}if(!(ee in this._links))throw ee+" not found in group";var ne=normpath(this.name+"/"+ee);let re=this._links[ee];if("string"==typeof re)try{return this.get(re)}catch(z){return null}var ie=new wf(this.file._fh,re);await ie.ready;if(ie.is_dataset){if("."!=te)throw ne+" is a dataset, not a group";return new rp(ne,ie,this)}var se=new tp(ne,this);await se.init(ie);return se.get(te)}visit(z){return this.visititems(((K,ee)=>z(K)))}visititems(z){var K=this.name.length;/\/$/.test(this.name)||(K+=1);var ee=this.values.slice();while(ee){let te=ee.shift();1==ee.length&&console.log(te);let ne=te.name.slice(K);let re=z(ne,te);if(null!=re)return re;te instanceof tp&&(ee=ee.concat(te.values))}return null}get attrs(){null==this._attrs&&(this._attrs=this._dataobjects.get_attributes());return this._attrs}};var np=class extends tp{constructor(z,K,ee){super("/",null);this.ready=this.init(z,K,ee)}async init(z,K,ee){var te=new Yd(z,0);await te.ready;var ne=await te.get_offset_to_dataobjects();var re=new wf(z,ne);await re.ready;this.parent=this;this.file=this;this.name="/";this._dataobjects=re;this._attrs=null;this._keys=null;this._fh=z;this.filename=K||"";this.mode="r";this.userblock_size=0;if(ee&&ee.index)this.index=ee.index;else{let K;if(ee&&ee.indexOffset)K=ee.indexOffset;else{const z=await this.attrs;if(z.hasOwnProperty("_index_offset"))K=z._index_offset;else{const z=this.indexName||"_index";const ee=await re.find_link(z);ee&&(K=ee[1])}}if(K)try{const ee=new wf(z,K);await ee.ready;const te=await ee.get_data();const ne=zd(te);const re=(new TextDecoder).decode(ne);this.index=JSON.parse(re)}catch(z){console.error(`Error loading index by offset ${z}`)}}this.index&&this.name in this.index?this._links=this.index[this.name]:this._links=await re.get_links()}_get_object_by_address(z){return this._dataobjects.offset==z?this:this.visititems((K=>{K._dataobjects.offset==z?K:null}))}};var rp=class extends Array{constructor(z,K,ee){super();this.parent=ee;this.file=ee.file;this.name=z;this._dataobjects=K;this._attrs=null;this._astype=null}get value(){var z=this._dataobjects.get_data();return null==this._astype?this.getValue(z):z.astype(this._astype)}get shape(){return this._dataobjects.shape}get attrs(){return this._dataobjects.get_attributes()}get dtype(){return this._dataobjects.dtype}get fillvalue(){return this._dataobjects.get_fillvalue()}async to_array(){const z=await this.value;const K=await this.shape;return create_nested_array(z,K)}async getValue(z){const K=await this.dtype;return K.startsWith("S")?(await z).map((z=>z.substr(0,z.indexOf("\0")))):z}};function posix_dirname(z){let K="/";let ee=z.lastIndexOf(K)+1;let te=z.slice(0,ee);let ne=new RegExp("^"+K+"+$");let re=new RegExp(K+"$");te&&!ne.test(te)&&(te=te.replace(re,""));return te}function normpath(z){return z.replace(/\/(\/)+/g,"/")}function create_nested_array(z,K){const ee=z.length;const te=K.reduce(((z,K)=>z*K),1);ee!==te&&console.warn(`shape product: ${te} does not match length of flattened array: ${ee}`);let ne=z;const re=K.slice(1).reverse();for(let z of re){const K=[];const{length:ee}=ne;let te=0;while(te<ee)K.push(ne.slice(te,te+=z));ne=K}return ne}
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */async function openH5File(z){if(z.url&&isBlobLike(z.url)){z.file=z.url;z.url=void 0}const K=void 0!==z.url;let ee=z.reader?z.reader:getReaderFor(z);const te=z.fetchSize||2e3;const ne=z.maxSize||2e5;K&&(ee=new BufferedFile({file:ee,fetchSize:te,maxSize:ne}));const re=new AsyncBuffer(ee);const ie=await readExternalIndex(z);const se=z.indexOffset;const oe=getFilenameFor(z);const ae=new np(re,oe,{index:ie,indexOffset:se});await ae.ready;return ae}async function readExternalIndex(z){let K;if(z.indexReader)K=z.indexReader;else{if(z.index)return z.index;z.indexURL?K=new RemoteFile({url:z.indexURL}):z.indexPath?K=new NodeLocalFile({path:z.indexPath}):z.indexFile&&(K=new BlobFile({file:z.indexFile}))}if(K){const z=await K.read();const ee=(new TextDecoder).decode(z);return JSON.parse(ee)}}function getReaderFor(z){if(z.url)return new RemoteFile(z);if(z.path)return new NodeLocalFile(z);if(z.file)return new BlobFile(z.file);throw Error("One of 'url', 'path (node only)', or 'file (browser only)' must be specified")}function getFilenameFor(z){return z.url?getFilename(z.url):z.path?getFilename(z.path):z.file?z.file.name:void 0}class AsyncBuffer{constructor(z){this.fileReader=z}async slice(z,K){return this.fileReader.read(z,K-z)}}function getFilename(z){const K=z.lastIndexOf("/");return K>0?z.substring(K+1):z}function isBlobLike(z){return"function"===typeof z.slice&&"function"===typeof z.arrayBuffer}class HDF5Reader{constructor(z,K=1e5){this.h5_file=z;this.bin_size=K;this.h5_obj=void 0}async fetch(){this.h5_obj||(this.h5_obj=await openH5File({url:this.h5_file,fetchSize:1e6,maxSize:2e8}));return this.h5_obj}async get_keys(){let z=await this.fetch();return z.keys}async get_rd_signal(z=this.bin_size){let K=await this.fetch();let ee=K.keys;let te=new ParseSignals(ee);let ne=te.get_rd_bins();let re=te.get_snp_bins();this.available_bins=[...new Set(ne,re)];this.available_bins.includes(z)||(z=this.available_bins.at(-1));const ie=await K.get("rd_chromosomes");await ie.dtype;let se=await ie.value;let oe="";let ae=await this.rd_stat(K,ee,z);var le=[];var ce=[];var he=[];var ue=[];var de=[];var fe=[];for(let te of se){var pe=`his_rd_p_${te}_${z}${oe}`;let ne=await this.get_chr_signal(K,ee,te,z,pe,ae);le=le.concat(ne);var ge=`his_rd_p_${te}_${z}_GC`;let re=await this.get_chr_signal(K,ee,te,z,ge,ae);ce=ce.concat(re);let ie=`his_rd_p_${te}_${z}_partition_GC_merge`;let se=await this.get_chr_signal(K,ee,te,z,ie,ae);he=he.concat(se);let me=await this.rd_call_combined(K,ee,te,z,ae);ue=ue.concat(me);let be=`snp_likelihood_${te}_${z}_mask`;let ve=await this.get_baf_signals(K,ee,te,z,be);de=de.concat(ve[0]);fe=fe.concat(ve[1])}this.callers=[];0!=ue.length&&this.callers.push("ReadDepth");0!=ue.length&&this.callers.push("2D");var me={};var be={RD_Raw:le,RD_Raw_gc_coor:ce,ReadDepth:he,"2D":ue,BAF1:de,BAF2:fe};me[z]=be;return me}decode_segments(z){let K=2**32-1;let ee=[];let te=[];for(let ne of z)if(ne==K){ee.push(te);te=[]}else te.push(ne);return ee}async rd_call_combined(z,K,ee,te,ne){let re=[];let ie;let se=`his_rd_p_${ee}_${te}_partition_GC_mosaic_segments_2d`;if(K.includes(se)){const K=await z.get(se);let ee=await K.value;ie=this.decode_segments(ee)}let oe=`his_rd_p_${ee}_${te}_partition_GC_mosaic_call_2d`;if(K.includes(oe)){const K=await z.get(oe);let se=await K.to_array();ie.forEach(((z,K)=>{z.forEach(((z,ie)=>{re.push({chr:ee,start:z*te,end:(z+1)*te,value:se[0][K]/ne[4]*2})}))}))}return re}async rd_stat(z,K,ee){let te=`rd_stat_${ee}_auto`;let ne;if(K.includes(te)){const K=await z.get(te);ne=await K.value}return ne}async get_chr_signal(z,K,ee,te,ne,re){let ie=[];if(K.includes(ne)){const K=await z.get(ne);let se=await K.value;se.forEach(((z,K)=>{ie.push({chr:ee,start:K*te,end:(K+1)*te,value:z/re[4]*2})}))}return ie}async get_baf_signals(z,K,ee,te,ne){let re=[];let ie=[];if(K.includes(ne)){let K=await z.get(ne);let se=await K.to_array();se.forEach(((z,K)=>{let ne=Math.max(...z);const se=z.indexOf(ne);let oe=Math.max(se/200,1-se/200);re.push({chr:ee,start:K*te,end:(K+1)*te,value:-2*oe});.5!=oe&&ie.push({chr:ee,start:K*te,end:(K+1)*te,value:-2*(1-oe)})}))}return[re,ie]}async get_baf_signals_v2(z,K,ee,te,ne){let re=[];let ie=[];if(K.includes(ne)){let K=await z.get(ne);let se=await K.to_array();se.forEach(((z,K)=>{if(!isNaN(z)){re.push({chr:ee,start:K*te,end:(K+1)*te,value:-2*(.5-z)});.5!=z&&ie.push({chr:ee,start:K*te,end:(K+1)*te,value:-2*(.5+z)})}}))}console.log(ee,re,ie);return[re,ie]}}class ParseSignals{constructor(z){this.signals=z}get_rd_bins(){let z=[];this.signals.forEach((K=>{let ee=K.match(/^his_rd_p_(.*)_(\d+)$/);ee&&z.push({chr:ee[1],bin_size:ee[2]})}));const K=[...new Set(z.map((z=>Number(z.bin_size))))];return K}get_snp_bins(){let z=[];this.signals.forEach((K=>{let ee=K.match(/^snp_likelihood_(.*)_(\d+)_mask$/);ee&&z.push({chr:ee[1],bin_size:ee[2]})}));const K=[...new Set(z.map((z=>Number(z.bin_size))))];return K}}class GetFit{constructor(z){this.allBins=z}getValues(){const z=Object.values(this.allBins).reduce(((z,K)=>z.concat(K.filter((z=>z.binScore>0)).map((z=>z.binScore)))),[]);return z}getMean(z){return z.reduce((function(z,K){return z+K}))/z.length}fit_data(){let z=this.getValues();let K=getDistParams(z);return K}histogram(z,K){const ee=K[1]-K[0];const te=[];z.forEach(((z,ne)=>{K.forEach(((K,ne)=>{te[K]||(te[K]={count:0});if(K<=z&&z<K+ee){te[K].count++;return false}}))}));const ne=[];te.forEach(((z,K)=>{ne.push(z.count)}));return ne}}function range_function(z,K,ee){const te=Array(Math.ceil((K-z)/ee)).fill(z).map(((z,K)=>z+K*ee));return te}function filterOutliers(z){if(z.length<4)return z;let K,ee,te,ne,re,ie;K=z.slice().sort(((z,K)=>z-K));if(K.length/4%1===0){ee=.5*(K[K.length/4]+K[K.length/4+1]);te=.5*(K[K.length*(3/4)]+K[K.length*(3/4)+1])}else{ee=K[Math.floor(K.length/4+1)];te=K[Math.ceil(K.length*(3/4)+1)]}ne=te-ee;re=te+1.5*ne;ie=ee-1.5*ne;return K.filter((z=>z>=ie&&z<=re))}function getDistParams(z){let K=filterOutliers(z);const ee=K.length;const te=K.reduce(((z,K)=>z+K))/ee;const ne=Math.sqrt(K.map((z=>Math.pow(z-te,2))).reduce(((z,K)=>z+K))/ee);return[te,ne]}function linspace(z,K,ee){"undefined"===typeof ee&&(ee=Math.max(Math.round(K-z)+1,1));if(ee<2)return 1===ee?[z]:[];var te=Array(ee);ee--;for(let ne=ee;ne>=0;ne--)te[ne]=(ne*K+(ee-ne)*z)/ee;return te}var ip={range_function:range_function,getDistParams:getDistParams,linspace:linspace,GetFit:GetFit};
/** 
    * Evaluates the cumulative distribution function (CDF) for a Student's t distribution with degrees of freedom `v` at a value `t`.
    *
    * @params {number} t - value for the t test
    * @params {PositiveNumber} v - degree of freedom
    * @returns {Probability} evaluated CDF
    */function TdistributionCDF(z,K){return isNaN(z)||isNaN(K)||K<=0?NaN:0===z?.5:.5+.5*(incompbeta(.5*K,.5,1)-incompbeta(.5*K,.5,K/(K+z*z)))*Math.sign(z)}
/** 
    * incompbeta(a,b,x) evaluates incomplete beta function, here a, b > 0 and 0 <= x <= 1. This function requires contfractbeta(a,b,x, ITMAX = 200) 
    *  code translated from  https://malishoaib.wordpress.com/2014/04/15/the-beautiful-beta-functions-in-raw-python/
    *
    * @params
    * @params
    * @params
    * @returns 
    */function incompbeta(z,K,ee){if(0==ee)return 0;if(1==ee)return 1;{let te=lgamma(z+K)-lgamma(z)-lgamma(K)+z*Math.log(ee)+K*Math.log(1-ee);return ee<(z+1)/(z+K+2)?Math.exp(te)*contfractbeta(z,K,ee)/z:1-Math.exp(te)*contfractbeta(K,z,1-ee)/K}}
/**
     * contfractbeta() evaluates the continued fraction form of the incomplete Beta function; incompbeta().  
     *   (Code translated from: Numerical Recipes in C.)
     * 
     * @param {*} a 
     * @param {*} b 
     * @param {*} x 
     * @param {*} ITMAX 
     * @returns 
     */function contfractbeta(z,K,ee,te=1e3){let ne=3e-7;let re=1;let ie=1;let se=1;let oe=z+K;let ae=z+1;let le=z-1;let ce=1-oe*ee/ae;for(let he=0;he<=te;he++){let te=parseFloat(he+1);let ue=te+te;let de=te*(K-te)*ee/((le+ue)*(z+ue));let fe=re+de*ie;let pe=ce+de*se;de=-(z+te)*(oe+te)*ee/((ae+ue)*(z+ue));let ge=fe+de*re;let me=pe+de*ce;let be=re;ie=fe/me;se=pe/me;re=ge/me;ce=1;if(Math.abs(re-be)<ne*Math.abs(re))return re}}
/**
     * Evaluates factorial of a number
     * 
     * @param {Number} xf - Integer number 
     * @returns factorial of the number
     */function factorial(z){if(0==z||1==z)return 1;{let K=z*factorial(z-1);return K}}
/**
     * Evalues factorial for an integer or fraction using either either factorial or gamma function
     * 
     * @param {Number} a - integar or fraction number
     * @returns value of a gamma function
     */function gamma(z){let K;var ee=[75122.633153,80916.6278952,36308.2951477,8687.24529705,1168.92649479,83.8676043424,2.50662827511];var te=0;var ne=1;if(0==z)K=1e99;else if(z%1==0)K=factorial(z-1);else{for(let K=0;K<ee.length;K++){te+=ee[K]*Math.pow(z,K);ne*=z+K}K=te*Math.pow(z+5.5,z+.5)*Math.exp(-(z+5.5))/ne}return K}
/**
     * 
     * @param {Number} xg  - integar or fraction number
     * @returns natural log of gamma function
     */function lgamma(z){return Math.log(gamma(z))}function t_test_1_sample$1(z,K,ee,te){0==ee&&(ee=1);var ne=(z-K)/ee*Math.sqrt(te);var re=1-TdistributionCDF(Math.abs(ne),te-1);return re}function t_test_2_samples$1(z,K,ee,te,ne,re){0==K&&(K=1);0==ne&&(ne=1);var ie=(z-te)/Math.sqrt(K**2/ee+ne**2/re);var se=(K**2/ee+ne**2/re)**2*(ee-1)*(re-1)/(K**4*(re-1)/ee**2+ne**4*(ee-1)/re**2);var oe=1-TdistributionCDF(Math.abs(ie),parseInt(se+.5));return oe}var sp={TdistributionCDF:TdistributionCDF,gamma:gamma,t_test_1_sample:t_test_1_sample$1,t_test_2_samples:t_test_2_samples$1};class CombinedCaller{constructor(z,K){this.wigFeatures=z;this.binSize=K}get_fit(){var z=new ip.GetFit(this.wigFeatures);var[K,ee]=z.fit_data();return{globalMean:K,globalStd:ee}}async call_2d(z=null,K=null,ee="both",te=.1,ne=0,re=10,ie=0){let se=this.get_fit();this.globalMean=se.globalMean;this.globalStd=se.globalStd;let oe=null==z?.05*this.binSize/3e9:z;let ae=null==K?parseInt(this.binSize/1e4):K;let le=[];let ce=[];let he=[];let ue=[];let de=[];let fe=[];for(const[z,K]of Object.entries(this.wigFeatures)){let z=[];let ee=[];let re=[];K.forEach(((K,te)=>{if(K.hets_count>4&&K.dp_count>ae){z.push([te]);ee.push(K.binScore);re.push(K.likelihood_score);delete K.likelihood_score}}));let ie=[];for(let z=1;z<ee.length;z++)ie.push(Math.abs(ee[z]-ee[z-1]));let se=[0];for(let z=1;z<ie.length;z++)se.push(Math.min(ie[z-1],ie[z]));se.push(0);let fe=ee.map(((z,K)=>Math.sqrt(Math.sqrt(z)**2+this.globalStd**2+Math.pow(se[K]/2,2))));let pe=[];for(let K=0;K<z.length-1;K++){let te=0;try{te=likelihood_overlap(re[K],re[K+1])}catch{console.log("Overlap failed: ",K,re[K],z[K+1],re[K+1])}let ne=normal_overlap_approx(ee[K],fe[K],ee[K+1],fe[K+1]);pe.push(ne*te)}while(pe.length>0){pe=pe.filter((z=>"number"===typeof z));let K=arrayMax(pe);isNaN(K)&&console.log("NaN value",pe);if(K<oe)break;let te=pe.indexOf(K);let ne=normal_merge(ee[te],fe[te],ee[te+1],fe[te+1]);let ie;let se;try{ie=re[te].map(((z,K)=>z*re[te+1][K]));se=ie.reduce(((z,K)=>z+K))}catch{console.log(re);console.log("max_overlap:",K,te,pe.length);console.log("likelihood: ",te,re[te],re[te+1]);console.log("nlh: ",se)}ee[te]=ne.nl;fe[te]=ne.ne;re[te]=ie.map((function(z){return z/se}));z[te].push(...z[te+1]);ee.splice(te+1,1);fe.splice(te+1,1);z.splice(te+1,1);re.splice(te+1,1);pe.splice(te,1);if(te<pe.length){let z=normal_overlap_approx(ee[te],fe[te],ee[te+1],fe[te+1]);let K=z*likelihood_overlap(re[te],re[te+1]);pe[te]=K}if(te>0){let z=normal_overlap_approx(ee[te-1],fe[te-1],ee[te],fe[te])*likelihood_overlap(re[te-1],re[te]);pe[te-1]=z}}let ge=-1;while(true){pe=[];for(let K=0;K<ee.length;K++)for(let ne=K;ne<ee.length;ne++)z[ne][0]-z[K].at(-1)<te*(z[K].length+z[ne].length)&&pe.push(normal_overlap_approx(ee[K],fe[K],ee[ne],fe[ne])*likelihood_overlap(re[K],re[ne]));if(0==pe.length)break;let K=arrayMax(pe);if(K<oe)break;let ne=0;let ie=1;while(ne<z.length-1){let se=normal_overlap_approx(ee[ne],fe[ne],ee[ie],fe[ie])*likelihood_overlap(re[ne],re[ie]);if(z[ie][0]-z[ne].at(-1)<te*(z[ne].length+z[ie].length)&&se==K){let K=normal_merge(ee[ne],fe[ne],ee[ne+1],fe[ne+1]);ee[ne]=K.nl;fe[ne]=K.ne;let te=re[ne].map(((z,K)=>z*re[ne+1][K]));let se=te.reduce(((z,K)=>z+K));re[ne]=te.map((function(z){return z/se}));z[ne].push(...z[ne+1]);z[ne]=z[ne].sort(((z,K)=>z-K));ee.splice(ie,1);fe.splice(ie,1);z.splice(ie,1);re.splice(ie,1);if(ie>=z.length){ne+=1;ie=ne+1}}else{ie+=1;if(ie>=z.length){ne+=1;ie=ne+1}}}if(ge==z.length)break;ge=z.length}z.forEach(((z,te)=>{let ie=likelihood_baf_pval(re[te]);if(z.length>1){z.forEach(((z,re)=>{ce.push(K[z]);ie.mean<=ne&&le.push(K[z]);K[z].segment_score=ee[te]}));he.push(ee[te]);ue.push(fe[te]);de.push(re[te])}}))}let pe=parseInt(1e3*(1-ie));0==pe&&(pe=1);let ge=ip.linspace(ie,1,pe);let me={};let be={};for(let z=10;z>-1;z--)for(let K=0;K<z/2+1;K++){let te=z-K;let ne=ge.map(((K,ee)=>1-K+K*z/2));let re=z/2;let ie;let se;if(z>0){ie=.5-K/(K+te);se=ge.map(((z,ee)=>.5-(1-z+z*K)/(2-2*z+(K+te)*z)))}else{ie=0;se=ge.map(((z,K)=>0*z))}for(let ee=0;ee<he.length;ee++){let oe=normal(re*this.globalMean,1,he[ee],ue[ee])*likelihood_of_baf(de[ee],.5+ie);ee in be?be[ee].push([z,K,te,oe,1]):be[ee]=[z,K,te,oe,1];let ae=0;let le=0;let ce=0;ne.forEach(((z,K)=>{if(!isNaN(se[K])){let te=normal(z*this.globalMean,1,he[ee],ue[ee])*likelihood_of_baf(de[ee],.5+se[K]);ae+=te;if(te>le){le=te;ce=ge[K]}}}));ee in me?me[ee].push([z,K,te,ae/ge.length,ce]):me[ee]=[z,K,te,ae/ge.length,ce]}for(let z=0;z<he.length;z++)if("germline"==ee)me[z].sort(((z,K)=>z[3]-K[3]));else{me[z].sort(((z,K)=>z[3]-K[3]));if("both"==ee){be[z].sort(((z,K)=>z[3]-K[3]));if(be[z][0][3]>me[z][0][3]){let K=me[z].filter((K=>K[0]!=be[z][0][0]&&K[1]<=be[z][0][1]));me[z]=[be[z][0]].push(...K)}}}for(let z=0;z<he.length;z++){me[z][0][0]>2;me[z][0][0]<2;he[z]/this.globalMean;sp.t_test_1_sample(this.globalMean,he[z],ue[z],fe[z])}}var ve=this.formatDataStructure(this.wigFeatures,"binScore",this.globalMean);var we=this.formatDataStructure(this.wigFeatures,"segment_score",this.globalMean);return{binScore:ve,segment_score:we}}formatDataStructure(z,K,ee=1){const te=[];for(const[ne,re]of Object.entries(z))re.forEach((z=>{var ne={...z};1!=ee&&(ne.value=z[K]/ee*2);te.push(ne)}));return te}formatDataStructure_BAF(z,K=2){const ee=[];const te=[];for(const[K,ne]of Object.entries(this.wigFeatures))ne.forEach((K=>{var ne={...K};var re={...K};let ie=K[z];if(.5!=ie){re.value=-2*(1-ie);te.push(re)}ne.value=-2*ie;ee.push(ne)}));return[ee,te]}}function arrayMax(z){return z.reduce((function(z,K){return z>K?z:K}))}
/**
     * Normal distribution.
     * 
     * @param {float} x - Variable.
     * @param {float} a - area
     * @param {float} x0 -  Mean value
     * @param {float} sigma - Sigma
     * @returns {float} - Value of distribution in x.
     */function normal(z,K,ee,te){return K*Math.exp(-1*(z-ee)**2/(2*te**2))/Math.sqrt(2*Math.PI)/te}
/**
     *  Calculates two normal distributions overlap area.
     * 
     * @param {float} m1 - Mean value of the first distribution
     * @param {float} s1 - Sigma of the first distribution
     * @param {float} m2 - Mean value for second distribution
     * @param {float} s2 - Sigma of the second distribution
     * 
     * @returns {float} area - Area of overlap
     */function normal_overlap_approx(z,K,ee,te){return Math.exp(-1*(z-ee)**2/(K**2+te**2))}
/**
     * Returns overlap area of two likelihood functions.
     * 
     * @param {*} lk1 - First likelihood function.
     * @param {*} lk2 - Second likelihood function.
     * 
     * @returns {float}  - Overlap area.
     */function likelihood_overlap(z,K){let ee;try{ee=z.reduce(((z,ee,te)=>z+Math.min(ee,K[te])))}catch{console.log("Failed to find likelihood overlap: ",z,K);return 0}return ee}
/**
     * Calculates normal distribution that is product of two given normal distributions.
     * 
     * @param {float} m1 - Mean value of the first distribution
     * @param {float} s1 - Sigma of the first distribution
     * @param {float} m2 - Mean value for second distribution
     * @param {float} s2 - Sigma of the second distribution
     * @returns {Object} An object representing the first distribution
     * @property {float} nl - Mean value of the first distribution
     * @property {float} ne - Sigma of the first distribution
     */function normal_merge(z,K,ee,te){return 0==K&&0==te?{nl:.5*(z+ee),ne:0}:{nl:(z*te*te+ee*K*K)/(K*K+te*te),ne:Math.sqrt(K*K*te*te/(K*K+te*te))}}
/**
     * Calculates likelihood for given baf
     * @param {*} likelihood 
     * @param {*} baf 
     * @returns {float}  likelihood value
     */function likelihood_of_baf(z,K){let ee=parseInt(K*(z.length-1));let te=K*(z.length-1)-ee;return ee<z.length-1?z[ee]*(1-te)+z[ee+1]*te:z[ee]}
/**
     * 
     * Calculates baf level and p-value for given likelihood function.
     * 
     * @param {*} likelihood 
     * @returns {Object} An object representing BAF
     * @property {float} mean  BAF level (difference from 1/2)
     * @property {float} p  p-value for event different than 1/2
     */function likelihood_baf_pval(z){const K=z.length;const ee=Math.max(...z);let te=z.indexOf(ee);te>Math.floor(K/2)&&(te=K-1-te);const ne=(K/2-te)/(K+1);const re=Math.floor((K/2+te)/2);const ie=K-1-re;let se=z.slice(re,ie+1).reduce(((z,K)=>z+K),0)/z.reduce(((z,K)=>z+K),0);te===Math.floor(K/2)&&(se=1);return{mean:ne,p:se}}var op={CombinedCaller:CombinedCaller};function erf(z){var K=1,ee=1,te=1*z;for(var ne=1;ne<50;ne++){K*=ne;ee*=-1;te+=ee*Math.pow(z,2*ne+1)/(K*(2*ne+1))}return 2*te/Math.sqrt(3.14159265358979)}function getEValue(z,K,ee,te,ne){var re=new DataStat(ee.slice(te,ne));0==re.std&&(re.std=K>0?K*re.mean/z:1);var ie=t_test_1_sample(z,re.mean,re.std,ne-te)/(ne-te);return ie}function gaussianEValue(z,K,ee,te,ne){var re=new DataStat(ee.slice(te,ne));if(re.mean<z){var ie=(re.max-re.mean)/(K*Math.sqrt(2));return Math.pow(.5*(1+erf(ie)),ne-te)}ie=(re.min-re.mean)/(K*Math.sqrt(2));return Math.pow(.5*(1-erf(ie)),ne-te)}function adjustToEvalue(z,K,ee,te,ne,re,ie=1e3){var se=getEValue(z,K,ee,te,ne);var oe=0,ae=false;while(se>re&!ae&oe<ie){ae=true;oe+=1;var[le,ce,he,ue]=[1e10,1e10,1e10,1e10];te>0&&(le=getEValue(z,K,ee,te-1,ne));if(ne-te>2){var ce=getEValue(z,K,ee,te+1,ne);var he=getEValue(z,K,ee,te,ne-1)}if(ne<ee.length)var ue=getEValue(z,K,ee,te,ne+1);if(Math.min[ue]<se){ae=false;if(le==Math.min[ue]){te-=1;se=le}elif(ce==Math.min[ue]);te+=1;se=ce;elif(he==Math.min[ue]);ne-=1;se=he;elif(ue==Math.min[ue]);ne+=1;se=ue}}return se<=re?ne:0}class DataStat{constructor(z){this.data=z;this.mean=z.reduce(((z,K)=>z+K))/z.length;this.std=Math.sqrt(z.reduce(((z,K)=>(K-this.mean)**2))/z.length)}}function t_test_1_sample(z,K,ee,te){0==ee&&(ee=1);var ne=(z-K)/ee*Math.sqrt(te);var re=1-sp.TdistributionCDF(Math.abs(ne),te-1);return re}function t_test_2_samples(z,K,ee,te,ne,re){0==K&&(K=1);0==ne&&(ne=1);var ie=(z-te)/Math.sqrt(K**2/ee+ne**2/re);var se=(K**2/ee+ne**2/re)**2*(ee-1)*(re-1)/(K**4*(re-1)/ee**2+ne**4*(ee-1)/re**2);var oe=1-sp.TdistributionCDF(Math.abs(ie),parseInt(se+.5));return oe}class Partition{constructor(z,K,ee){this.rd=z;this.mean=K;this.std=ee;this.bin_bands=[2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128]}get_rd_signal_bandwidth(z){var K=[];z.forEach(((z,ee)=>{var te=0;te=z>this.mean/4?this.mean/(this.std**2*z):4/this.std**2;K.push(te)}));return K}meanShiftCaller(z=3){var K={};Object.entries(this.rd).forEach((([ee,te])=>{var ne=new Array(te.length).fill(false);var re=new Array(te.length);for(let z=0;z<te.length;z++)ne[z]||(re[z]=te[z]);this.bin_bands.forEach(((K,ee)=>{var ie=ne.map(((z,K)=>!z));var se=[];Object.entries(te).forEach((([z,K])=>{se.push(K.binScore)}));var oe=[0];var ae=0;for(let z=0;z<ne.length;z++)if(ne[z]){if(ae>0){oe.push(oe[oe.length-1]+ae-1);ae=0}}else ae+=1;oe.shift();for(let ee=0;ee<z;ee++){var le=this.get_rd_signal_bandwidth(se);var ce=new Array(se.length).fill(0);for(let z=0;z<se.length;z++)for(let ee=z-3*K;ee<=z+3*K+1;ee++)if(!(ee<0||ee>=se.length)&&!(Math.abs(z-ee)>=se.length)){var he=(ee-z)*Math.exp(-.5*(ee-z)**2/K**2)*Math.exp(-.5*(se[z]-se[ee])**2*le[z]);ce[z]+=he}var ue=new Array;for(var de=0;de<ce.length-1;de++)ce[de]<0&ce[de+1]>=0&&ue.push(de);ue.push(ce.length-1);ue=ue.concat(oe).sort(((z,K)=>z-K));ue=Array.from(new Set(ue));var fe=0;for(de=0;de<ue.length;de++){var pe=se.slice(fe,ue[de]+1);var ge=pe.reduce(((z,K)=>z+K))/pe.length;se.fill(ge,fe,ue[de]+1);fe=ue[de]+1}}de=0;for(var me=0;de<re.length;de++)if(ie[de]){re[de]=se[me];me++}ue=new Array;for(de=0;de<re.length-1;de++){var be=Math.abs(re[de+1]-re[de]);be>.01&&ue.push(de+1)}ue.unshift(0);ue.push(re.length);ne=new Array(this.rd.length).fill(false);for(de=1;de<ue.length;de++){var ve=[ue[de-1],ue[de]];var we=[ue[de-1],ue[de-1]];if(!(de>1))continue;we[0]=ue[de-2];var ye=[ue[de],ue[de]];if(!(de<ue.length-1))continue;ye[1]=ue[de+1];var _e=ve[1]-ve[0];var ke=we[1]-we[0];var xe=ye[1]-ye[0];if(_e<=1)continue;var Ce=new DataStat(re.slice(ve[0],ve[1]));if(xe<=15||ke<=15||_e<=15){var Se=1.8*Math.sqrt(re[we[0]]/this.mean)*this.std;if(Math.abs(re[we[0]]-re[ve[0]])<Se)continue;Se=1.8*Math.sqrt(re[ye[0]]/this.mean)*this.std;if(Math.abs(re[ye[0]]-re[ve[0]])<Se)continue}else{var Ae=re.slice(we[0],we[1]);var Te=new DataStat(Ae);var Ee=re.slice(ye[0],ye[1]);var Me=new DataStat(Ee);var Re=t_test_2_samples(Ce.mean,Ce.std,Ce.data.length,Te.mean,Te.std,Te.data.length);if(Re>.01/genome_size*bin_size*(_e+ke))continue;var Ie=t_test_2_samples(Ce.mean,Ce.std,Ce.data.length,Me.mean,Me.std,Me.data.length);if(Ie>.01/genome_size*bin_size*(_e+xe))continue}var Fe=t_test_1_sample(this.mean,Ce.mean,Ce.std,Ce.data.length);if(Fe>.05)continue;let z=se.slice(ve[0],ve[1]);var Le=new DataStat(z);ne.fill(true,ve[0],ve[1]);re.fill(Le.mean,ve[0],ve[1])}}));K[ee]=re}));return K}call_mean_shift(z=3){const K=1e3;const ee=2871e6;var te=new Array(this.rd.length).fill(false);var ne=new Array(this.rd.length);for(var re=0;re<this.rd.length;re++)te[re]||(ne[re]=this.rd[re]);this.bin_bands.forEach(((re,ie)=>{var se=te.map(((z,K)=>!z));var oe=[];se.forEach(((z,K)=>{z&&oe.push(this.rd[K])}));var ae=[0];var le=0;for(var ce=0;ce<te.length;ce++)if(te[ce]){if(le>0){ae.push(ae[ae.length-1]+le-1);le=0}}else le+=1;ae.shift();for(var he=0;he<z;he++){var ue=this.get_rd_signal_bandwidth(oe);var de=new Array(oe.length).fill(0);for(ce=0;ce<oe.length;ce++)for(var fe=ce-3*re;fe<=ce+3*re+1;fe++)if(!(fe<0||fe>=oe.length)&&!(Math.abs(ce-fe)>=oe.length)){var pe=(fe-ce)*Math.exp(-.5*(fe-ce)**2/re**2)*Math.exp(-.5*(oe[ce]-oe[fe])**2*ue[ce]);de[ce]+=pe}var ge=new Array;for(ce=0;ce<de.length-1;ce++)de[ce]<0&de[ce+1]>=0&&ge.push(ce);ge.push(de.length-1);ge=ge.concat(ae).sort(((z,K)=>z-K));ge=Array.from(new Set(ge));var me=0;for(ce=0;ce<ge.length;ce++){var be=oe.slice(me,ge[ce]+1);var ve=be.reduce(((z,K)=>z+K))/be.length;oe.fill(ve,me,ge[ce]+1);me=ge[ce]+1}}for(ce=0,fe=0;ce<ne.length;ce++)if(se[ce]){ne[ce]=oe[fe];fe++}ge=new Array;for(ce=0;ce<ne.length-1;ce++){var we=Math.abs(ne[ce+1]-ne[ce]);we>.01&&ge.push(ce+1)}ge.unshift(0);ge.push(ne.length);te=new Array(this.rd.length).fill(false);for(ce=1;ce<ge.length;ce++){var ye=[ge[ce-1],ge[ce]];var _e=[ge[ce-1],ge[ce-1]];if(ce>1){_e[0]=ge[ce-2];var ke=[ge[ce],ge[ce]];if(ce<ge.length-1){ke[1]=ge[ce+1];var xe=ye[1]-ye[0];var Ce=_e[1]-_e[0];var Se=ke[1]-ke[0];if(!(xe<=1)){var Ae=new DataStat(ne.slice(ye[0],ye[1]));if(Se<=15||Ce<=15||xe<=15){var Te=1.8*Math.sqrt(ne[_e[0]]/this.mean)*this.std;if(Math.abs(ne[_e[0]]-ne[ye[0]])<Te)continue;Te=1.8*Math.sqrt(ne[ke[0]]/this.mean)*this.std;if(Math.abs(ne[ke[0]]-ne[ye[0]])<Te)continue}else{var Ee=ne.slice(_e[0],_e[1]);var Me=new DataStat(Ee);var Re=ne.slice(ke[0],ke[1]);var Ie=new DataStat(Re);var Fe=t_test_2_samples(Ae.mean,Ae.std,Ae.data.length,Me.mean,Me.std,Me.data.length);if(Fe>.01/ee*K*(xe+Ce))continue;var Le=t_test_2_samples(Ae.mean,Ae.std,Ae.data.length,Ie.mean,Ie.std,Ie.data.length);if(Le>.01/ee*K*(xe+Se))continue}var Be=t_test_1_sample(this.mean,Ae.mean,Ae.std,Ae.data.length);if(!(Be>.05)){var Ne=new DataStat(this.rd.slice(ye[0],ye[1]));te.fill(true,ye[0],ye[1]);ne.fill(Ne.mean,ye[0],ye[1])}}}}}}));return ne}cnv_calling(z=1e5){var K=.25;K*=this.mean;var ee=this.mean-K,te=this.mean+K;var ne=2971e6;var re=this.meanShiftCaller();var ie={};var se=[];Object.entries(re).forEach((([oe,ae])=>{var le=false;while(!le){le=true;var ce=new Array(1).fill(0);for(let z=0;z<ae.length-1;z++){var he=Math.abs(ae[z+1]-ae[z]);he>.01&&ce.push(z+1)}ce.push(ae.length);for(let z=0;z<ce.length-2;z++){var ue=Math.abs(ae[ce[z]]-ae[ce[z+1]]);if(ue<K){var de=ue+1,fe=ue+1;z>0&&(de=Math.abs(ae[ce[z]]-ae[ce[z-1]]));z<ce.length-3&&(fe=Math.abs(re[ce[z+1]]-ae[ce[z+2]]));if(ue<de&&ue<fe){le=false;var pe=new DataStat(ae.slice(ce[z],ce[z+2]));ae.fill(pe.mean,ce[z],ce[z+2]);ce.splice(z+1,z+1)}}}}var ge=[];Object.entries(this.rd[oe]).forEach((([z,K])=>{ge.push(K.binScore)}));var me=new Array(ae.length).fill("");var be=0;var ve=.05*z/ne;while(be<ae.length){var we=be,ye=be;while(be<ae.length&ae[be]<ee)be+=1;var _e=be;if(_e>ye+1){var ke=adjustToEvalue(this.mean,this.std,ge,ye,_e,ve);if(ke){_e=ke;me.fill("D",ye,_e)}}ye=be;while(be<ae.length&ae[be]>te)be+=1;_e=be;if(_e>ye+1){ke=adjustToEvalue(this.mean,this.std,ge,ye,_e,ve);if(ke){_e=ke;me.fill("A",ye,_e)}}be==we&&(be+=1)}be=0;while(be<ae.length){while(be<ae.length&""!=me[be])be+=1;ye=be;while(be<ae.length&ae[be]<ee)be+=1;_e=be;if(_e>ye+1){gaussianEValue(this.mean,this.std,ge,ye,_e)<.05/ne&&me.fill(["d"]*(_e-ye),ye,_e);be-=1}be+=1}be=0;var xe;be<ae.length&&(xe=me[be]);ye=0;var Ce=[...ge];while(be<ae.length){while(me[be]==xe){be+=1;if(be>=me.length)break}if(be>ye){var Se=new DataStat(Ce.slice(ye,be));Ce.fill(Se.mean,ye,be)}be<ae.length&&(xe=me[be]);ye=be}ie[oe]=Ce;be=0;while(be<ae.length){xe=me[be];if(""==xe){be+=1;continue}ye=be;while(be<ae.length&xe==me[be])be+=1;var Ae=new DataStat(Ce.slice(ye,be));let K=Ae.mean/this.mean;let ee;ee="D"==xe?"deletion":"duplication";let te={chr:oe,start:z*ye+1,end:z*be,size:z*(be-ye+1),value:2*K,event_type:ee};se.push(te)}}));return[ie,se]}}var ap={Partition:Partition};class CNVpytorVCF{constructor(z,K){this.allVariants=z;this.rowBinSize=1e4;this.binSize=K;this.binFactor=K/this.rowBinSize}async computeDepthFeatures(){const z=Object.keys(this.allVariants);const K=[];for(let ee of z){const z=this.allVariants[ee];if(0===z.length)continue;const te=z[0];let ne=0;let re=0;let ie=te.start=te.start%this.binSize;let se=ie+this.binSize;let oe=0;for(let te of z){const z=te.start+1;oe=Math.max(Math.floor((te.start-1)/this.binSize),0);if(z>se){re>0&&K.push({chr:ee,start:ie,end:se,value:ne,bin:oe,count:re});ne=0;ie=te.start-te.start%this.binSize;se=ie+this.binSize}const ae=te.calls[9].info.DP;if(ae){ne+=Number.parseInt(ae);re++}}re>0&&K.push({chr:ee,start:ie,end:se,value:ne,bin:oe,count:re})}return K}async computeReadDepth(){const z=Object.keys(this.allVariants);var K={};for(let te of z){const z=this.allVariants[te];var ee;if(0!==z.length)for(let ne of z){ee=Math.max(Math.floor(ne.start/this.rowBinSize),0);K[te]||(K[te]=[]);K[te][ee]||(K[te][ee]={chr:te,start:ee*this.rowBinSize,end:(ee+1)*this.rowBinSize,value:0,sum_score:0,count:0});const z=ne.calls[9].info.DP;if(z){K[te][ee].sum_score+=Number.parseInt(z);K[te][ee].count++}}}var te={};for(let ee of z){te[ee]||(te[ee]=[]);for(let z=0;z<K[ee].length/this.binFactor;z++){const ie=z;te[ee][z]||(te[ee][z]={chr:ee,binScore:0,start:ie*this.binSize,end:(ie+1)*this.binSize});for(var ne=10*z;ne<10*z+10;ne++)if(K[ee][ne]){var re=100*parseInt(K[ee][ne].sum_score/K[ee][ne].count);te[ee][z].binScore+=re}}}var ie=this.readDepthMeanshift(te);return ie}readDepthMeanshift(z){var K=new ip.GetFit(z);var[ee,te]=K.fit_data();var ne=new ap.Partition(z,ee,te);var re=ne.meanShiftCaller();var ie=ne.cnv_calling();Object.entries(z).forEach((([z,K])=>{K.forEach(((K,ee)=>{K.partition_level=parseInt(re[z][ee]);K.partition_call=parseInt(ie[0][z][ee])}))}));var se=this.formatDataStructure(z,"binScore",ee);var oe=this.formatDataStructure(z,"partition_level",ee);var ae=this.formatDataStructure(z,"partition_call",ee);return[se,oe,ae,ie[1]]}formatDataStructure(z,K,ee=1){const te=[];for(const[ne,re]of Object.entries(z))re.forEach((z=>{var ne={...z};1!=ee&&(ne.value=z[K]/ee*2);te.push(ne)}));return te}async computeBAF_v2(){const z=Object.keys(this.allVariants);const K={};const ee=[],te=[];for(let ie of z){const z=this.allVariants[ie];if(0===z.length)continue;var ne;for(let se of z){ne=Math.max(Math.floor(se.start/this.binSize),0);K[ie]||(K[ie]=[]);if(!K[ie][ne]){if(ne>0){let z=ne-1;if(K[ie][z]){const ne=this.get_max_min_score(K[ie][z]);if(.5!=ne.value){let z=Object.assign({},ne);z.value=-2*(1-ne.value);te.push(z)}ne.value=-2*ne.value;K[ie][z]=ne;ee.push(K[ie][z])}}K[ie][ne]={chr:ie,start:ne*this.binSize,end:(ne+1)*this.binSize,value:0,count:0,likelihood_score:[],min_score:0}}const z=se.calls[9];let oe=z.genotype;let ae=z.info.AD.split(",");let le=ae[0],ce=ae[1];if(0==oe[0]&&1==oe[1]||1==oe[0]&&0==oe[1]){if(0==K[ie][ne].likelihood_score.length)K[ie][ne].likelihood_score=ip.linspace(0,1,100).map(((z,K)=>beta(le,ce,z)));else{var re=0;K[ie][ne].likelihood_score=ip.linspace(0,1,100).map(((z,ee)=>{var te=K[ie][ne].likelihood_score[ee]*beta(le,ce,z);re+=te;return te}));K[ie][ne].likelihood_score=ip.linspace(0,1,100).map(((z,ee)=>K[ie][ne].likelihood_score[ee]/re))}K[ie][ne].count++}}const se=this.get_max_min_score(K[ie][ne]);if(.5!=se.value){let z=Object.assign({},se);z.value=-2*(1-se.value);te.push(z)}se.value=-2*se.value;K[ie][ne]=se;ee.push(K[ie][ne])}return[ee,te]}format_BAF_likelihood(z){const K=[];for(const[ee,te]of Object.entries(z))te.forEach((z=>{var ee={...z};if(.5!=z.value){ee.value=1-z.value;K.push(ee)}}));return K}get_max_min_score(z){if(z.likelihood_score.length>0){const K=Math.max(...z.likelihood_score);const ee=z.likelihood_score.indexOf(K);z.value=Math.max(ee/100,1-ee/100);z.min_score=Math.min(ee/100,1-ee/100)}else z.score=0;return z}async getAllbins(){const z=await this.computeDepthFeatures();const K=new ip.GetFit(z);K.fit_data();return z}async read_rd_baf(z="ReadDepth"){const K=Object.keys(this.allVariants);var ee={};for(let z of K){const K=this.allVariants[z];var te;if(0!==K.length)for(let ne of K){te=Math.max(Math.floor(ne.start/this.rowBinSize),0);ee[z]||(ee[z]=[]);ee[z][te]||(ee[z][te]={chr:z,start:te*this.rowBinSize,end:(te+1)*this.rowBinSize,dp_sum_score:0,dp_count:0,hets_count:0,hets:[]});const K=ne.calls[9];const re=K.info.DP;if(re){ee[z][te].dp_sum_score+=Number.parseInt(re);ee[z][te].dp_count++}let ie=K.info.AD.split(",");let se=K.genotype;if(0==se[0]&&1==se[1]||1==se[0]&&0==se[1]){ee[z][te].hets_count++;let K=parseInt(ie[0]),ne=parseInt(ie[1]);ee[z][te].hets.push({ref:K,alt:ne})}}}var ne=this.adjust_bin_size(ee);var re;if("ReadDepth"==z){re=this.readDepthMeanshift(ne);var ie=this.formatDataStructure_BAF(ne,"max_likelihood")}else if("2D"==z){let z=new op.CombinedCaller(ne,this.binSize);let K=await z.call_2d();re=[K.binScore,[],K.segment_score];ie=z.formatDataStructure_BAF("max_likelihood")}return[re,ie]}formatDataStructure_BAF(z,K,ee=2){const te=[];const ne=[];for(const[ee,re]of Object.entries(z))re.forEach((z=>{delete z.likelihood_score;var ee={...z};var re={...z};let ie=z[K];if(.5!=ie){re.value=-2*(1-ie);ne.push(re)}ee.value=-2*ie;te.push(ee)}));return[te,ne]}adjust_bin_size(z){const K=Object.keys(this.allVariants);var ee={};for(let re of K){ee[re]||(ee[re]=[]);for(let K=0;K<z[re].length/this.binFactor;K++){const ie=K;ee[re][K]||(ee[re][K]={chr:re,start:ie*this.binSize,end:(ie+1)*this.binSize,dp_count:0,hets_count:0,binScore:0,likelihood_score:[]});for(var te=10*K;te<10*K+10;te++)if(z[re][te]){var ne=100*parseInt(z[re][te].dp_sum_score/z[re][te].dp_count);ee[re][K].binScore+=ne;ee[re][K].dp_count+=z[re][te].dp_count;ee[re][K].hets_count+=z[re][te].hets_count;0!=z[re][te].hets.length&&z[re][te].hets.forEach(((z,te)=>{if(0==ee[re][K].likelihood_score.length)ee[re][K].likelihood_score=ip.linspace(0,1,100).map(((K,ee)=>beta(z.ref,z.alt,K)));else{var ne=0;ee[re][K].likelihood_score=ip.linspace(0,1,100).map(((te,ie)=>{var se=ee[re][K].likelihood_score[ie]*beta(z.ref,z.alt,te);ne+=se;return se}));ee[re][K].likelihood_score=ip.linspace(0,1,100).map(((z,te)=>ee[re][K].likelihood_score[te]/ne))}}))}const se=this.get_max_min_score(ee[re][K]);ee[re][K].max_likelihood=se.value}}return ee}}function beta(z,K,ee,te=true){return ee**z*(1-ee)**K+ee**K*(1-ee)**z}const lp=250;class CNVPytorTrack extends TrackBase{constructor(z,K){super(z,K);this.featureType="numeric";this.paintAxis=paintAxis;if(!z.max){this.defaultScale=true;this.autoscale=false}this.height=void 0!==z.height?z.height:lp}async init(z){this.type="cnvpytor";this.graphType=z.graphType||"points";this.bin_size=z.bin_size||1e5;this.signal_name=z.signal_name||"rd_snp";this.cnv_caller=z.cnv_caller||"2D";this.colors=z.colors||["gray","black","green","blue"];super.init(z)}get supportsWholeGenome(){return true}get_signals(){let z=[];"rd_snp"==this.signal_name?z=["RD_Raw","RD_Raw_gc_coor",this.cnv_caller,"BAF1","BAF2"]:"rd"==this.signal_name?z=["RD_Raw","RD_Raw_gc_coor",this.cnv_caller]:"snp"==this.signal_name?z=["BAF1","BAF2"]:"cnh"==this.signal_name&&(z=[this.cnv_caller]);return z}get_signal_colors(){let z=[{singal_name:"RD_Raw",color:this.colors[0]},{singal_name:"RD_Raw_gc_coor",color:this.colors[1]},{singal_name:"ReadDepth",color:this.colors[2]},{singal_name:"2D",color:this.colors[2]},{singal_name:"BAF1",color:this.colors[3]},{singal_name:"BAF2",color:this.colors[3]}];return z}async postInit(){if("vcf"==this.config.format){this.featureSource=FeatureSource(this.config,this.browser.genome);this.header=await this.getHeader();var z=this.featureSource.reader.features.reduce((function(z,K){z[K.chr]=z[K.chr]||[];z[K.chr].push(K);return z}),Object.create(null));const K=new CNVpytorVCF(z,this.bin_size);let ee;let te;this.wigFeatures_obj={};this.wigFeatures_obj[this.bin_size]={};let ne;if("2D"==this.config.cnv_caller){ne=await K.read_rd_baf("2D");ee=ne[0];te=ne[1];this.wigFeatures_obj[this.bin_size]["2D"]=ee[2];this.available_callers=["2D"]}else{ne=await K.read_rd_baf();ee=ne[0];te=ne[1];this.wigFeatures_obj[this.bin_size].ReadDepth=ee[2];this.available_callers=["ReadDepth"]}this.wigFeatures_obj[this.bin_size].RD_Raw=ee[0];this.wigFeatures_obj[this.bin_size].RD_Raw_gc_coor=ee[1];this.wigFeatures_obj[this.bin_size].BAF1=te[0];this.wigFeatures_obj[this.bin_size].BAF2=te[1];this.available_bins=[this.bin_size];this.set_available_callers()}else{this.cnvpytor_obj=new HDF5Reader(this.config.url,this.bin_size);this.wigFeatures_obj=await this.cnvpytor_obj.get_rd_signal(this.bin_size);this.available_bins=this.cnvpytor_obj.available_bins;this.available_callers=this.cnvpytor_obj.callers;this.set_available_callers()}this.tracks=[];const K=[];this.signals=this.get_signals();this.signal_colors=this.get_signal_colors();for(let z in this.wigFeatures_obj)for(const[ee,te]of Object.entries(this.wigFeatures_obj[z]))if(this.signals.includes(ee)){let z={};z.type="wig";z.isMergedTrack=true;z.features=te;z.name=ee;z.color=this.signal_colors.filter((z=>z.singal_name===ee)).map((z=>z.color));const ne=await this.browser.createTrack(z);if(ne){ne.autoscale=false;this.tracks.push(ne)}else console.warn("Could not create track "+z);"function"===typeof ne.postInit&&K.push(ne.postInit())}this.flipAxis=!!this.config.flipAxis&&this.config.flipAxis;this.logScale=!!this.config.logScale&&this.config.logScale;this.autoscale=this.config.autoscale;this.autoscale||(this.dataRange={min:this.config.min||0,max:this.config.max});for(let z of this.tracks){z.autoscale=false;z.dataRange=this.dataRange}return Promise.all(K)}set_available_callers(){this.available_callers.includes(this.cnv_caller)||(this.available_callers.length>0?this.cnv_caller=this.available_callers[0]:this.cnv_caller=null)}async getHeader(){if(!this.header){if("function"===typeof this.featureSource.getHeader){const z=await this.featureSource.getHeader();z&&(this.callSets=z.callSets||[]);this.header=z}this.sampleNames=this.callSets?this.callSets.map((z=>z.name)):[]}return this.header}get height(){return this._height}set height(z){this._height=z;if(this.tracks)for(let K of this.tracks){K.height=z;K.config.height=z}}menuItemList(){let z=[];void 0!==this.flipAxis&&z.push({label:"Flip y-axis",click:()=>{this.flipAxis=!this.flipAxis;this.trackView.repaintViews()}});z=z.concat(gn.numericDataMenuItems(this.trackView));z.push("<hr/>");z.push("Bin Sizes");for(let K of this.available_bins){const ee=createCheckbox(K,K===this.bin_size);z.push({object:pt(ee),click:async()=>{this.bin_size=K;await this.recreate_tracks(K);this.clearCachedFeatures();this.trackView.updateViews();this.trackView.repaintViews()}})}z.push("<hr/>");z.push("Signal Type");let K={rd_snp:"RD and BAF Likelihood",rd:"RD Signal",snp:"BAF Likelihood"};for(let ee in K){const te=createCheckbox(K[ee],ee===this.signal_name);z.push({object:pt(te),click:async()=>{this.signal_name=ee;await this.recreate_tracks(this.bin_size);this.clearCachedFeatures();this.trackView.updateViews();this.trackView.repaintViews()}})}z.push("<hr/>");z.push("CNV caller");for(let K of this.available_callers){const ee=createCheckbox(K,K===this.cnv_caller);z.push({object:pt(ee),click:async()=>{this.cnv_caller=K;await this.recreate_tracks(this.bin_size);this.clearCachedFeatures();this.trackView.updateViews();this.trackView.repaintViews()}})}return z}async recreate_tracks(z){this.tracks=[];const K=[];z in this.wigFeatures_obj||(this.wigFeatures_obj={...this.wigFeatures_obj,...await this.cnvpytor_obj.get_rd_signal(z)});this.signals=this.get_signals();this.signal_colors=this.get_signal_colors();for(const[ee,te]of Object.entries(this.wigFeatures_obj[z]))if(this.signals.includes(ee)){let z={};z.type="wig";z.isMergedTrack=true;z.features=te;z.name=ee;z.color=this.signal_colors.filter((z=>z.singal_name===ee)).map((z=>z.color));const ne=await this.browser.createTrack(z);if(ne){ne.autoscale=false;this.tracks.push(ne)}else console.warn("Could not create track "+z);"function"===typeof ne.postInit&&K.push(ne.postInit())}this.flipAxis=!!this.config.flipAxis&&this.config.flipAxis;this.logScale=!!this.config.logScale&&this.config.logScale;this.autoscale=this.config.autoscale;this.autoscale||(this.dataRange={min:this.config.min||0,max:this.config.max});for(let z of this.tracks){z.autoscale=false;z.dataRange=this.dataRange}return Promise.all(K)}async getFeatures(z,K,ee,te){if(this.tracks){const ne=this.tracks.map((ne=>ne.getFeatures(z,K,ee,te)));return Promise.all(ne)}}getScaleFactor(z,K,ee,te){const ne=te?ee/(Math.log10(K+1)-(z<=0?0:Math.log10(z+1))):ee/(K-z);return ne}computeYPixelValue(z,K){return(this.flipAxis?z-this.dataRange.min:this.dataRange.max-z)*K}computeYPixelValueInLogScale(z,K){let ee=this.dataRange.max;let te=this.dataRange.min;if(ee<=0)return 0;te<=-1&&(te=0);te=te<=0?0:Math.log10(te+1);ee=Math.log10(ee+1);z=Math.log10(z+1);return(this.flipAxis?z-te:ee-z)*K}draw(z){const K=z.features;if(!K)return;this.defaultScale&&("rd_snp"==this.signal_name?this.dataRange={min:this.config.min||this.dataRange.min||-2,max:this.config.max||this.dataRange.max||6}:"rd"==this.signal_name?this.dataRange={min:this.config.min||this.dataRange.min||0,max:this.config.max||this.dataRange.max||6}:"snp"==this.signal_name&&(this.dataRange={min:this.config.min||this.dataRange.min||-2,max:this.config.max||this.dataRange.max||0}));this.autoscale&&(this.dataRange=autoscale(z.referenceFrame.chr,K));if(this.tracks)for(let ee=0,te=this.tracks.length;ee<te;ee++){const te=Object.assign({},z);te.features=K[ee];this.tracks[ee].dataRange=this.dataRange;this.tracks[ee].flipAxis=this.flipAxis;this.tracks[ee].logScale=this.logScale;this.graphType&&(this.tracks[ee].graphType=this.graphType);this.tracks[ee].draw(te)}const ee=this.getScaleFactor(this.dataRange.min,this.dataRange.max,z.pixelHeight,this.logScale);const yScale=z=>this.logScale?this.computeYPixelValueInLogScale(z,ee):this.computeYPixelValue(z,ee);if(this.config.hasOwnProperty("guideLines"))for(let K of this.config.guideLines)if(K.hasOwnProperty("color")&&K.hasOwnProperty("y")&&K.hasOwnProperty("dotted")){let ee=yScale(K.y);let te={strokeStyle:K.color,strokeWidth:1};K.dotted?Jo.dashedLine(z.context,0,ee,z.pixelWidth,ee,5,te):Jo.strokeLine(z.context,0,ee,z.pixelWidth,ee,te)}}popupData(z,K){const ee=K||z.viewport.cachedFeatures;if(ee&&ee.length===this.tracks.length){const K=[];for(let te=0;te<this.tracks.length;te++){te>0&&K.push("<hr/>");K.push(`<div style=background-color:rgb(245,245,245);border-bottom-style:dashed;border-bottom-width:1px;padding-bottom:5px;padding-top:10px;font-weight:bold;font-size:larger >${this.tracks[te].name}</div>`);const ne=this.tracks[te].popupData(z,ee[te]);K.push(...ne)}return K}}}function autoscale(z,K){let ee=0;let te=-Number.MAX_VALUE;for(let z of K)for(let K of z)if("undefined"!==typeof K.value&&!Number.isNaN(K.value)){ee=Math.min(ee,K.value);te=Math.max(te,K.value)}return{min:ee,max:te}}const cp=new Map([["ideogram",(z,K)=>new IdeogramTrack(z,K)],["sequence",(z,K)=>new SequenceTrack(z,K)],["feature",(z,K)=>new FeatureTrack(z,K)],["seg",(z,K)=>new SegTrack(z,K)],["mut",(z,K)=>new SegTrack(z,K)],["maf",(z,K)=>new SegTrack(z,K)],["wig",(z,K)=>new WigTrack(z,K)],["merged",(z,K)=>new MergedTrack(z,K)],["alignment",(z,K)=>new BAMTrack(z,K)],["interaction",(z,K)=>new InteractionTrack(z,K)],["interact",(z,K)=>new InteractionTrack(z,K)],["variant",(z,K)=>new VariantTrack(z,K)],["eqtl",(z,K)=>new EqtlTrack(z,K)],["gwas",(z,K)=>new GWASTrack(z,K)],["arc",(z,K)=>new RnaStructTrack(z,K)],["gcnv",(z,K)=>new GCNVTrack(z,K)],["junction",(z,K)=>new SpliceJunctionTrack(z,K)],["blat",(z,K)=>new BlatTrack(z,K)],["cnvpytor",(z,K)=>new CNVPytorTrack(z,K)]]);
/**
     * Add a track constructor  the the factory lookup table.
     *
     * @param type
     * @param track
     */const addTrackCreatorFunction=function(z,K){cp.set(z,K)};const getTrack=function(z,K,ee){let te;switch(z){case"annotation":case"genes":case"fusionjuncspan":case"snp":te="feature";break;case"seg":case"maf":case"mut":te="seg";break;case"junctions":case"splicejunctions":te="junction";break;default:te=z}return cp.has(te)?cp.get(te)(K,ee):void 0};var hp={tracks:cp,addTrack:addTrackCreatorFunction,trackFunctions:cp,addTrackCreatorFunction:addTrackCreatorFunction,getTrack:getTrack};class XMLSession{constructor(z,K){const ee=new DOMParser;const te=ee.parseFromString(z,"text/xml");this.processRootNode(te,K);const ne=te.getElementsByTagName("Resource");const re=te.getElementsByTagName("Track");const ie=re&&re.length>0;const se=[];this.tracks=se;const oe=new Map;Array.from(ne).forEach((function(z,K){var ee={url:z.getAttribute("path"),indexURL:z.getAttribute("index"),order:K};oe.set(ee.url,ee);ie||se.push(ee)}));ie&&Array.from(re).forEach((function(z){const K=z.getElementsByTagName("Track");if(K&&K.length>0){const ee={type:"merged",tracks:[]};extractTrackAttributes(z,ee);se.push(ee);Array.from(K).forEach((function(z){z.processed=true;const K=z.getAttribute("id");const te=oe.get(K);if(te){ee.tracks.push(te);extractTrackAttributes(z,te);te.autoscale=false;ee.height=te.height}}))}else if(!z.processed){const K=z.getAttribute("id");const ee=oe.get(K);if(ee){se.push(ee);extractTrackAttributes(z,ee)}}}))}processRootNode(z,K){const ee=z.getElementsByTagName("Session");!ee||0===ee.length;const te=ee.item(0);const ne=te.getAttribute("genome");const re=te.getAttribute("locus");const ie=te.getAttribute("ucscID");if(K&&K.hasOwnProperty(ne))this.genome=ne;else{this.reference={fastaURL:ne};ie&&(this.reference.id=ie)}re&&(this.locus=re)}}function extractTrackAttributes(z,K){K.name=z.getAttribute("name");const ee=z.getAttribute("color");ee&&(K.color="rgb("+ee+")");const te=z.getAttribute("altColor");ee&&(K.altColor="rgb("+te+")");const ne=z.getAttribute("height");ne&&(K.height=parseInt(ne));const re=z.getAttribute("autoScale");re&&(K.autoscale="true"===re);const ie=z.getAttribute("autoscaleGroup");ie&&(K.autoscaleGroup=ie);const se=z.getAttribute("windowFunction");se&&(K.windowFunction=se);const oe=z.getAttribute("visibilityWindow")||z.getAttribute("featureVisibilityWindow");oe&&(K.visibilityWindow=oe);const ae=z.getAttribute("indexed");ae&&(K.indexed="true"===ae);const le=z.getAttribute("normalize");le&&(K.normalize="true"===le);const ce=z.getElementsByTagName("DataRange");if(ce.length>0){const z=ce.item(0);K.min=Number(z.getAttribute("minimum"));K.max=Number(z.getAttribute("maximum"));K.logScale="LOG"===z.getAttribute("type")}}const up=splitLines$5;class SampleInformation{constructor(){this.attributes={};this.plinkLoaded=false}async loadPlinkFile(z,K){K||(K={});var ee=buildOptions(K);const te=await Wo.loadString(z,ee);var ne=up(te);for(let z of ne){var re=z.split(" ");this.attributes[re[1]]={familyId:re[0],fatherId:re[2],motherId:re[3],sex:re[4],phenotype:re[5]}}this.plinkLoaded=true;return this}
/**
         * Return the attributes for the given sample as a map-like object (key-value pairs)
         * @param sample
         */getAttributes(z){return this.attributes[z]}getAttributeNames(){return this.hasAttributes()?Object.keys(this.attributes[Object.keys(this.attributes)[0]]):[]}hasAttributes(){return Object.keys(this.attributes).length>0}}function loadPlinkFile(z,K){const ee=new SampleInformation;return ee.loadPlinkFile(z,K)}class GtexSelection{constructor(z,K){this.geneColors={};this.gene=null;this.snp=null;this.genesCount=0;if(z){this.gene=z.toUpperCase();this.geneColors[this.gene]=dp[this.genesCount++]}K&&(this.snp=K.toUpperCase())}addGene(z){this.geneColors[z.toUpperCase()]||(this.geneColors[z.toUpperCase()]=dp[this.genesCount++])}colorForGene(z){return this.geneColors[z.toUpperCase()]}}var dp=[];dp.push("rgb(228,26,28)");dp.push("rgb(55,126,184)");dp.push("rgb(77,175,74)");dp.push("rgb(166,86,40)");dp.push("rgb(152,78,163)");dp.push("rgb(255,127,0)");dp.push("rgb(247,129,191)");dp.push("rgb(153,153,153)");dp.push("rgb(255,255,51)");dp.push("rgb(102, 194, 165");dp.push("rgb(252, 141, 98");dp.push("rgb(141, 160, 203");dp.push("rgb(231, 138, 195");dp.push("rgb(166, 216, 84");dp.push("rgb(255, 217, 47");dp.push("rgb(229, 196, 148");dp.push("rgb(179, 179, 179");dp.push("rgb( 141, 211, 199");dp.push("rgb(255, 255, 179");dp.push("rgb(190, 186, 218");dp.push("rgb(251, 128, 114");dp.push("rgb(128, 177, 211");dp.push("rgb(253, 180, 98");dp.push("rgb(179, 222, 105");dp.push("rgb(252, 205, 229");dp.push("rgb(217, 217, 217");dp.push("rgb(188, 128, 189");dp.push("rgb(204, 235, 197");dp.push("rgb(255, 237, 111");class ReferenceFrame{constructor(z,K,ee,te,ne){this.genome=z;this.chr=K;this.start=ee;this.end=te;this.bpPerPixel=ne;this.id=gt.guid()}
/**
         * Extend this frame to accomodate the given locus.  Used th CircularView methods to merge 2 frames.
         * @param locus
         */extend(z){const K=Math.min(z.start,this.start);const ee=Math.max(z.end,this.end);const te=(ee-K)/(this.end-this.start);this.start=K;this.end=ee;this.bpPerPixel*=te}calculateEnd(z){return this.start+this.bpPerPixel*z}calculateBPP(z,K){return(z-this.start)/K}set(z){this.chr=z.chr;this.start=z.start;this.bpPerPixel=z.bpPerPixel}toPixels(z){return z/this.bpPerPixel}toBP(z){return this.bpPerPixel*z}
/**
         * Shift frame by stated pixels.  Return true if view changed, false if not.
         *
         * @param pixels
         * @param clamp -- if true "clamp" shift to prevent panning off edge of chromosome.  This is disabled if "show soft clipping" is on
         * @param viewportWidth
         */shiftPixels(z,K,ee){const te=this.start;const ne=z*this.bpPerPixel;this.start+=ne;ee&&this.clampStart(K);this.end=this.start+K*this.bpPerPixel;return te!==this.start}clampStart(z){const K=this.genome.getChromosome(this.chr).bpStart||0;this.start=Math.max(K,this.start);if(z){const{bpLength:K}=this.genome.getChromosome(this.chr);const ee=K-z*this.bpPerPixel;this.start>ee&&(this.start=ee)}}async zoomWithScaleFactor(z,K,ee,te){const ne=void 0===te?this.start+this.toBP(ee/2):te;const{start:re,bpPerPixel:ie}=this.start;const{bpLength:se}=this.getChromosome();const oe=K<1?z.minimumBases()/ee:se/ee;this.bpPerPixel=K<1?Math.max(this.bpPerPixel*K,oe):Math.min(this.bpPerPixel*K,oe);const ae=this.bpPerPixel*ee;this.start=ne-.5*ae;this.clampStart(ee);this.end=this.start+ae;const le=re!==this.start||ie!==this.bpPerPixel;le&&await z.updateViews(true)}getChromosome(){return this.genome.getChromosome(this.chr)}getMultiLocusLabelBPLengthOnly(z){const K="&nbsp";const ee=Math.floor(this.start)+1;const te=Math.round(this.start+this.bpPerPixel*z);return`${K}${this.chr}${K}${prettyBasePairNumber(te-ee)}${K}`}getMultiLocusLabelLocusOnly(z){const K="&nbsp";const{chr:ee,start:te,end:ne}=this.getPresentationLocusComponents(z);return`${K}${ee}:${te}-${ne}${K}`}getMultiLocusLabel(z){const K="&nbsp";const{chr:ee,start:te,end:ne}=this.getPresentationLocusComponents(z);const re=Math.floor(this.start)+1;const ie=Math.round(this.start+this.bpPerPixel*z);return`${K}${ee}:${te}-${ne}${K}${K}(${prettyBasePairNumber(ie-re)})${K}`}getPresentationLocusComponents(z){if("all"===this.chr)return{chr:this.chr};{const K=numberFormatter$1(Math.floor(this.start)+1);const ee=numberFormatter$1(Math.round(this.start+this.bpPerPixel*z));return{chr:this.chr,start:K,end:ee}}}getLocusString(){if("all"===this.chr)return"all";{const z=numberFormatter$1(Math.floor(this.start)+1);const K=numberFormatter$1(Math.round(this.end));return`${this.chr}:${z}-${K}`}}description(z){console.log(` ${z||""} referenceFrame - ${this.chr} bpp ${this.bpPerPixel.toFixed(3)} start ${numberFormatter$1(Math.round(this.start))} end ${numberFormatter$1(Math.round(this.end))} `)}}function createReferenceFrameList(z,K,ee,te,ne,re){return z.map((z=>{if(ee&&z.gene){z.start=Math.max(0,z.start-ee);z.end+=ee}if(!re){const ee=K.getChromosome(z.chr);validateGenomicExtent(ee.bpLength,z,te)}const ie=new ReferenceFrame(K,z.chr,z.start,z.end,(z.end-z.start)/ne);ie.locusSearchString=z.locusSearchString;(z.gene||z.snp)&&(ie.selection=new GtexSelection(z.gene,z.snp));return ie}))}const fp={timeout:5e3,type:"plain",url:"https://igv.org/genomes/locus.php?genome=$GENOME$&name=$FEATURE$",coords:0,chromosomeField:"chromosome",startField:"start",endField:"end",geneField:"gene",snpField:"snp"};
/**
     * Return an object representing the locus of the given string.  Object is of the form
     * {
     *   chr,
     *   start,
     *   end,
     *   locusSearchString,
     *   gene,
     *   snp
     * }
     * @param browser
     * @param string
     * @returns {Promise<*>}
     */async function search(z,K){if(void 0===K||""===K.trim())return;(K&&"all"===K.trim().toLowerCase()||"*"===K)&&(K="all");const ee=K.split(" ");let te=z.searchConfig||fp;let ne=[];const searchLocus=async ee=>{let ne=parseLocusString(z,ee);if(!ne){const te=z.genome.featureDB.get(ee.toUpperCase());te&&(ne={chr:te.chr,start:te.start,end:te.end,gene:te.name,locusSearchString:K})}if(!ne&&z.config&&false!==z.config.search)try{ne=await searchWebService(z,ee,te)}catch(z){console.error(z);throw Error("Search service currently unavailable.")}return ne};for(let z of ee){const K=await searchLocus(z);if(K){K.locusSearchString=z;ne.push(K)}}if(0===ne.length){const z=await searchLocus(K);if(z){z.locusSearchString=K;ne.push(z)}}return 0===ne.length?void 0:ne}function parseLocusString(z,K){const ee=K.split("\t");if(ee.length>=3)try{const K=z.genome.getChromosomeName(ee[0]);const te=parseInt(ee[1].replace(/,/g,""),10)-1;const ne=parseInt(ee[2].replace(/,/g,""),10);if(!isNaN(te)&&!isNaN(ne))return{chr:K,start:te,end:ne}}catch(z){}const te=K.split(":");const ne=te[0];if("all"===ne&&z.genome.getChromosome(ne))return{chr:ne,start:0,end:z.genome.getChromosome(ne).bpLength};if(void 0!==z.genome.getChromosome(ne)){const K=z.genome.getChromosomeName(ne);const ee={chr:K,start:0,end:z.genome.getChromosome(ne).bpLength};if(te.length>1){let K=te[1].split("-");if(K.length>2){if(!te[1].startsWith("-"))return;{const z=te[1].indexOf("-",1);if(z>0){const ee=te[1].substring(0,z);const ne=te[1].substring(z+1);K=[ee,ne]}}}let ne;ne=K[0].replace(/,/g,"");if(isNaN(ne))return;ee.start=parseInt(ne,10)-1;ee.end=ee.start+1;if(1===K.length){ee.start-=20;ee.end+=20}if(2===K.length){ne=K[1].replace(/,/g,"");if(isNaN(ne))return;ee.end=parseInt(ne,10);if(ee.start<0&&!z.isSoftclipped()){const z=-ee.start;ee.start+=z;ee.end+=z}}}return ee}}async function searchWebService(z,K,ee){let te=ee.url.replace("$FEATURE$",K.toUpperCase());te.indexOf("$GENOME$")>-1&&(te=te.replace("$GENOME$",z.genome.id?z.genome.id:"hg19"));const ne=ee.timeout?{timeout:ee.timeout}:void 0;const re=await Wo.loadString(te,ne);const ie=processSearchResult(z,re,ee);ie&&(ie.locusSearchString=K);return ie}function processSearchResult(z,K,ee){let te;te="plain"===ee.type?parseSearchResults(z,K):JSON.parse(K);ee.resultsField&&(te=te[ee.resultsField]);if(te&&0!==te.length){const K=ee.chromosomeField||"chromosome";const ne=ee.startField||"start";const re=ee.endField||"end";const ie=ee.coords||1;let se;se=Array.isArray(te)?te[0]:te;se.hasOwnProperty(K)&&se.hasOwnProperty(ne)||console.error("Search service results must include chromosome and start fields: "+se);const oe=se[K];const ae=z.genome.getChromosome(oe);if(!ae)return;const le=ae.name;let ce=se[ne]-ie;let he=se[re];void 0===he&&(he=ce+1);const ue={chr:le,start:ce,end:he};const de=se.type?se.type:"gene";ee.geneField&&"gene"===de&&(ue.gene=se[ee.geneField]);ee.snpField&&"snp"===de&&(ue.snp=se[ee.snpField]);return ue}}function parseSearchResults(z,K){const ee=[];const te=[];const ne=splitLines$5(K);ne.forEach((function(z){""===z||ee.push(z)}));ee.forEach((function(K){var ee,ne,re,ie,se=K.split("\t");if(se.length>=3){ne=se[1].split(":");re=ne[1].split("-");ee=se[2].trim();ie={gene:se[0],chromosome:z.genome.getChromosomeName(ne[0].trim()),start:parseInt(re[0].replace(/,/g,"")),end:parseInt(re[1].replace(/,/g,"")),type:"gtex"===ee?"snp":"gene"};te.push(ie)}}));return te}class NavbarManager{constructor(z){this.browser=z}navbarDidResize(z){this.updateNavbar(this.createResponsiveClassSchedule(z))}updateNavbar(z){this.browser.$toggle_button_container.removeClass();this.browser.$toggle_button_container.addClass(z.$toggle_button_container);pt(this.browser.zoomWidget.zoomContainer).removeClass();pt(this.browser.zoomWidget.zoomContainer).addClass(z.zoomContainer)}createResponsiveClassSchedule(z){let K={};const ee=this.browser.isMultiLocusWholeGenomeView()||this.browser.referenceFrameList&&Ma.isWholeGenomeView(this.browser.referenceFrameList[0].chr);ee?this.browser.windowSizePanel.hide():this.browser.windowSizePanel.show();if(z>990){K.$toggle_button_container="igv-navbar-toggle-button-container";K.zoomContainer="igv-zoom-widget"}else if(z>860){K.$toggle_button_container="igv-navbar-toggle-button-container";K.zoomContainer="igv-zoom-widget-900"}else if(z>540){K.$toggle_button_container="igv-navbar-toggle-button-container-750";K.zoomContainer="igv-zoom-widget-900"}else{K.$toggle_button_container="igv-navbar-toggle-button-container-750";K.zoomContainer="igv-zoom-widget-900";this.browser.windowSizePanel.hide()}ee&&(K.zoomContainer="igv-zoom-widget-hidden");return K}}const ChromosomeSelectWidget=function(z,K){this.container=gt.div({class:"igv-chromosome-select-widget-container"});K.appendChild(this.container);this.select=document.createElement("select");this.select.setAttribute("name","chromosome-select-widget");this.container.appendChild(this.select);this.select.addEventListener("change",(()=>{this.select.blur();""!==this.select.value&&z.search(this.select.value)}));this.showAllChromosomes=false!==z.config.showAllChromosomes};ChromosomeSelectWidget.prototype.show=function(){this.container.style.display="flex"};ChromosomeSelectWidget.prototype.hide=function(){this.container.style.display="none"};ChromosomeSelectWidget.prototype.update=function(z){const K=this.showAllChromosomes?z.chromosomeNames.slice():z.wgChromosomeNames.slice();if(z.showWholeGenomeView()){K.unshift("all");K.unshift("")}this.select.innerHTML="";for(let z of K){const K=document.createElement("option");K.setAttribute("value",z);K.innerText=z;this.select.appendChild(K)}};class WindowSizePanel{constructor(z,K){this.container=gt.div({class:"igv-windowsize-panel-container"});z.appendChild(this.container);K.on("locuschange",(z=>{this.updatePanel(z)}));this.browser=K}show(){this.container.style.display="block"}hide(){this.container.style.display="none"}updatePanel(z){const K=this.browser.calculateViewportWidth(this.browser.referenceFrameList.length);this.container.innerText=1===z.length?prettyBasePairNumber(Math.round(K*z[0].bpPerPixel)):""}}class CursorGuide{constructor(z,K){this.browser=K;this.columnContainer=z;this.horizontalGuide=gt.div({class:"igv-cursor-guide-horizontal"});z.appendChild(this.horizontalGuide);this.verticalGuide=gt.div({class:"igv-cursor-guide-vertical"});z.appendChild(this.verticalGuide);this.addMouseHandler(K);this.setVisibility(K.config.showCursorGuide)}addMouseHandler(z){this.boundMouseMoveHandler=mouseMoveHandler.bind(this);this.columnContainer.addEventListener("mousemove",this.boundMouseMoveHandler);function mouseMoveHandler(K){const{x:ee,y:te}=gt.translateMouseCoordinates(K,this.columnContainer);this.horizontalGuide.style.top=`${te}px`;const ne=document.elementFromPoint(K.clientX,K.clientY);const re=findAncestorOfClass(ne,"igv-viewport");if(re&&z.getRulerTrackView()){this.verticalGuide.style.left=`${ee}px`;const te=z.root.querySelectorAll(".igv-column");let ne;const ie=re.parentElement;for(let z=0;z<te.length;z++)void 0===ne&&ie===te[z]&&(ne=z);const se=z.getRulerTrackView().viewports[ne];const oe=se.mouseMove(K);if(oe){const{start:z,bp:K,end:ee}=oe;const te=(K-z)/(ee-z);this.customMouseHandler&&this.customMouseHandler({start:z,bp:K,end:ee,interpolant:te})}}}}removeMouseHandler(){this.columnContainer.removeEventListener("mousemove",this.boundMouseMoveHandler)}setVisibility(z){true===z?this.show():this.hide()}show(){this.verticalGuide.style.display="block";this.horizontalGuide.style.display="block"}hide(){this.verticalGuide.style.display="none";this.horizontalGuide.style.display="none";if(this.browser.getRulerTrackView())for(let z of this.browser.getRulerTrackView().viewports)z.$tooltip.hide()}}
/**
     * Walk up the tree until a parent is found with the given classname.  If no ancestor is found return undefined.
     * @param target
     * @param classname
     * @returns {*}
     */function findAncestorOfClass(z,K){while(z.parentElement){if(z.parentElement.classList.contains(K))return z.parentElement;z=z.parentElement}}class CursorGuideButton{constructor(z,K){this.browser=z;this.button=gt.div({class:"igv-navbar-button"});K.appendChild(this.button);this.button.textContent="cursor guide";this.button.addEventListener("click",(()=>{z.cursorGuideVisible=!z.cursorGuideVisible;z.setCursorGuideVisibility(z.cursorGuideVisible);this.setButtonState(z.cursorGuideVisible)}));this.setButtonState(z.cursorGuideVisible);z.config.showCursorTrackingGuideButton?this.show():this.hide()}setButtonState(z){true===z?this.button.classList.add("igv-navbar-button-clicked"):this.button.classList.remove("igv-navbar-button-clicked")}show(){this.button.style.display="block";this.setButtonState(this.browser.cursorGuideVisible)}hide(){this.button.style.display="none"}}class CenterLineButton{constructor(z,K){this.browser=z;this.button=gt.div({class:"igv-navbar-button"});K.appendChild(this.button);this.button.textContent="center line";this.button.addEventListener("click",(()=>{z.isCenterLineVisible=!z.isCenterLineVisible;z.setCenterLineVisibility(z.isCenterLineVisible);this.setButtonState(z.isCenterLineVisible)}));this.setButtonState(z.isCenterLineVisible);z.config.showCenterGuideButton?this.show():this.hide()}setButtonState(z){true===z?this.button.classList.add("igv-navbar-button-clicked"):this.button.classList.remove("igv-navbar-button-clicked")}show(){this.isVisible=true;this.button.style.display="block";this.setButtonState(this.browser.isCenterLineVisible)}hide(){this.isVisible=false;this.button.style.display="none"}}class TrackLabelControl{constructor(z,K){this.button=gt.div({class:"igv-navbar-button"});z.appendChild(this.button);this.button.textContent="track labels";this.button.addEventListener("click",(()=>{K.trackLabelsVisible=!K.trackLabelsVisible;this.setState(K.trackLabelsVisible);K.setTrackLabelVisibility(K.trackLabelsVisible)}));this.browser=K;this.setVisibility(K.config.showTrackLabelButton);this.setState(K.trackLabelsVisible)}setVisibility(z){true===z?this.show():this.hide()}setState(z){true===z?this.button.classList.add("igv-navbar-button-clicked"):this.button.classList.remove("igv-navbar-button-clicked")}show(){this.button.style.display="block";this.setState(this.browser.trackLabelsVisible)}hide(){this.button.style.display="none"}}class SampleNameControl{constructor(z,K){this.button=gt.div({class:"igv-navbar-button"});z.appendChild(this.button);this.button.innerText="Sample Names";this.setState(K.showSampleNames);this.setVisibility(K.showSampleNameButton);this.button.addEventListener("click",(()=>{K.showSampleNames=!K.showSampleNames;this.setState(K.showSampleNames);for(let{sampleNameViewport:z}of K.trackViews)false===K.showSampleNames?z.hide():z.show();K.layoutChange()}))}setVisibility(z){true===z?this.show():this.hide()}setState(z){true===z?this.button.classList.add("igv-navbar-button-clicked"):this.button.classList.remove("igv-navbar-button-clicked")}hide(){this.button.style.display="none"}show(){this.button.style.display="block"}}const pp=0;let gp=23;let mp=0;const ZoomWidget=function(z,K){this.browser=z;this.zoomContainer=gt.div({class:"igv-zoom-widget"});K.appendChild(this.zoomContainer);this.zoomOutButton=gt.div();this.zoomContainer.appendChild(this.zoomOutButton);this.zoomOutButton.appendChild(cn.createIcon("minus-circle"));this.zoomOutButton.addEventListener("click",(()=>{z.zoomOut()}));const ee=gt.div();this.zoomContainer.appendChild(ee);this.slider=document.createElement("input");this.slider.type="range";this.slider.min=`${pp}`;this.slider.max=`${gp}`;ee.appendChild(this.slider);this.slider.addEventListener("change",(K=>{K.preventDefault();K.stopPropagation();const ee=z.referenceFrameList[0];const{bpLength:te}=ee.genome.getChromosome(ee.chr);const{end:ne,start:re}=ee;const ie=ne-re;const se=Math.pow(2,K.target.valueAsNumber);const oe=te/se;z.zoomWithScaleFactor(oe/ie)}));this.zoomInButton=gt.div();this.zoomContainer.appendChild(this.zoomInButton);this.zoomInButton.appendChild(cn.createIcon("plus-circle"));this.zoomInButton.addEventListener("click",(()=>{z.zoomIn()}));z.on("locuschange",(z=>{if(this.browser.isMultiLocusMode())this.disable();else{this.enable();this.update(z)}}))};ZoomWidget.prototype.update=function(z){const K=z[0];const{bpLength:ee}=K.genome.getChromosome(K.chr);const{start:te,end:ne}=K;gp=Math.ceil(Math.log2(ee/this.browser.minimumBases()));this.slider.max=`${gp}`;const re=ee/(ne-te);mp=Math.log2(re);this.slider.value=`${Math.round(mp)}`};ZoomWidget.prototype.enable=function(){this.slider.disabled=false};ZoomWidget.prototype.disable=function(){this.slider.disabled=true};ZoomWidget.prototype.hide=function(){this.zoomContainer.style.display="none"};ZoomWidget.prototype.show=function(){this.zoomContainer.style.display="block"};ZoomWidget.prototype.hideSlider=function(){this.slider.style.display="none"};ZoomWidget.prototype.showSlider=function(){this.slider.style.display="block"};const SVGSaveControl=function(z,K){const ee=gt.div({class:"igv-navbar-button"});z.append(ee);ee.textContent="Save SVG";ee.addEventListener("click",(()=>K.saveSVGtoFile({})))};const bp={createColumns:(z,K)=>{for(let ee=0;ee<K;ee++)if(0===ee)createColumn(z,"igv-column");else{z.appendChild(gt.div({class:"igv-column-shim"}));createColumn(z,"igv-column")}},removeColumnAtIndex:(z,K)=>{const ee=0===z?K.nextElementSibling:K.previousElementSibling;K.remove();ee.remove()},insertAfter:z=>{const K=gt.div({class:"igv-column-shim"});insertElementAfter(K,z);const ee=gt.div({class:"igv-column"});insertElementAfter(ee,K);return ee},insertBefore:(z,K)=>{for(let ee=0;ee<K;ee++){const te=gt.div({class:"igv-column"});insertElementBefore(te,z);if(K>1&&ee>0){const z=gt.div({class:"igv-column-shim"});insertElementBefore(z,te)}}},indexOfColumn:(z,K)=>{const ee=z.querySelectorAll(".igv-column");for(let z=0;z<ee.length;z++){const te=ee[z];if(te===K)return z}}};class ViewportCenterLine{constructor(z,K,ee){this.browser=z;this.referenceFrame=K;this.column=ee;this.container=gt.div({class:"igv-center-line"});ee.appendChild(this.container);z.isCenterLineVisible?this.show():this.hide()}repaint(){if(this.referenceFrame){const z=1/this.referenceFrame.bpPerPixel;if(z>1){const z=Math.floor(this.referenceFrame.toPixels(1));this.container.style.width=`${z}px`;this.container.classList.remove("igv-center-line-thin");this.container.classList.add("igv-center-line-wide")}else{this.container.style.width="1px";this.container.classList.remove("igv-center-line-wide");this.container.classList.add("igv-center-line-thin")}}}show(){this.isVisible=true;this.container.style.display="block";this.repaint()}hide(){this.isVisible=false;this.container.style.display="none"}resize(){this.repaint()}}const vp=numberFormatter$1;class RulerTrack{constructor(z){this.browser=z;this.height=40;this.name="";this.id="ruler";this.disableButtons=true;this.ignoreTrackMenu=true;this.order=.01*Number.MIN_SAFE_INTEGER;this.removable=false;this.type="ruler"}async getFeatures(z,K,ee){return[]}computePixelHeight(z){return this.height}draw({context:z,referenceFrame:K,pixelWidth:ee,pixelHeight:te,bpPerPixel:ne,bpStart:re}){Ma.isWholeGenomeView(K.chr)?this.drawWholeGenome({context:z,pixelWidth:ee,pixelHeight:te,bpPerPixel:ne}):this.doDraw({context:z,referenceFrame:K,pixelWidth:ee,pixelHeight:te,bpStart:re})}drawWholeGenome({context:z,pixelWidth:K,pixelHeight:ee,bpPerPixel:te}){z.save();Jo.fillRect(z,0,0,K,ee,{fillStyle:"white"});for(let K of this.browser.genome.wgChromosomeNames){let ne=this.browser.genome.getCumulativeOffset(K);let re=this.browser.genome.getChromosome(K).bpLength;let ie=Math.round(ne/te);let se=Math.round(re/te);this.renderChromosomeRect(z,ie,0,se,ee,K)}z.restore()}doDraw({context:z,referenceFrame:K,pixelWidth:ee,pixelHeight:te,bpStart:ne}){z.clearRect(0,0,ee,te);const re=6;const ie=2;const se=Math.floor(K.toBP(ee));const oe=findSpacing(se,z.isSVG);let ae=Math.floor(ne/oe.majorTick)-1;const{tickDelta:le,labelLength:ce}=calculateDeltas(z,K,ne,ae,oe);this.browser.referenceFrameList.indexOf(K);let he;let ue;let de=le;const fe=.25*ce;do{ue=Math.floor(ae*oe.majorTick);const ee=`${numberFormatter$1(Math.floor(ue/oe.unitMultiplier))} ${oe.majorUnit}`;he=Math.round(K.toPixels(ue-1-ne+.5));const te=Math.round(he-z.measureText(ee).width/2);if(te>0&&fe+ce<=de){Jo.fillText(z,ee,te,this.height-re/.75);de=0}he>0&&Jo.strokeLine(z,he,this.height-re,he,this.height-ie);ue=Math.floor((1+ae)*oe.majorTick);let se=Math.round(K.toPixels(ue-1-ne+.5));let pe=(se-he)/2;let ge=he+pe;ge>0&&Jo.strokeLine(z,ge,this.height-re,ge,this.height-ie);++ae;de+=le}while(he<ee);Jo.strokeLine(z,0,this.height-ie,ee,this.height-ie)}renderChromosomeRect(z,K,ee,te,ne,re){z.textAlign="center";z.textBaseline="middle";z.font="12px sans-serif";Jo.strokeLine(z,K+te,ee,K+te,ee+ne,{strokeStyle:$o.greyScale(191)});const ie=re.startsWith("chr")?re.substring(3):re;te>z.measureText(ie).width&&Jo.fillText(z,ie,K+te/2,ee+ne/2,{fillStyle:$o.greyScale(68)})}get supportsWholeGenome(){return true}dispose(){}}function findSpacing(z,K){if(z<10)return new Tick(1,"bp",1);const ee=Math.floor(Math.log10(z));let te="bp";let ne=1;if(ee>9){te="gb";ne=1e9}else if(ee>6){te="mb";ne=1e6}else if(ee>3){te="kb";ne=1e3}const re=Math.pow(10,ee-1);const ie=z/re;const se=75;const oe=Math.pow(10,ee-1);const ae=Math.pow(10,ee)/2;const le=ie<se&&true!==K?oe:ae;return new Tick(le,te,ne)}function calculateDeltas(z,K,ee,te,ne){const re=getX(K,getBP(1+te,ne),ee)-getX(K,getBP(te,ne),ee);const ie=`${numberFormatter$1(Math.floor(getBP(te,ne)/ne.unitMultiplier))} ${ne.majorUnit}`;const se=Math.floor(z.measureText(ie).width);return{tickDelta:re,labelLength:se};function getBP(z,K){return Math.floor(z*K.majorTick)}function getX(z,K,ee){return Math.round(z.toPixels(K-1-ee+.5))}}class Tick{constructor(z,K,ee){this.majorTick=z;this.minorTick=z/10;this.majorUnit=K;this.unitMultiplier=ee}description(z){console.log((z||"")+" tick "+vp(this.majorTick)+" label width "+vp(this.labelWidthBP)+" multiplier "+this.unitMultiplier)}}const CircularViewControl=function(z,K){this.button=gt.div({class:"igv-navbar-button"});z.appendChild(this.button);this.button.textContent="circular view";this.button.addEventListener("click",(()=>{K.circularViewVisible=!K.circularViewVisible}));this.browser=K;this.setVisibility(K.config.showCircularViewButton);this.setState(K.circularViewVisible)};CircularViewControl.prototype.setVisibility=function(z){true===z?this.show():this.hide()};CircularViewControl.prototype.setState=function(z){true===z?this.button.classList.add("igv-navbar-button-clicked"):this.button.classList.remove("igv-navbar-button-clicked")};CircularViewControl.prototype.show=function(){this.button.style.display="block";this.setState(this.browser.circularViewVisible)};CircularViewControl.prototype.hide=function(){this.button.style.display="none"};const CustomButton=function(z,K,ee){const te=gt.div({class:"igv-navbar-button"});z.append(te);te.textContent=ee.label;te.addEventListener("click",(()=>ee.callback(K)))};class ROIManager{constructor(z,K,ee,te,ne){this.browser=z;this.roiMenu=K;this.roiTable=ee;this.top=te;this.roiSets=ne||[];this.boundLocusChangeHandler=locusChangeHandler.bind(this);z.on("locuschange",this.boundLocusChangeHandler)}async initialize(){if(this.roiSets.length>0){this.browser.showROITableButton=true;this.browser.roiTableControl.setVisibility(this.browser.showROITableButton)}const z=this.roiSets.map((z=>this.renderROISet({browser:this.browser,pixelTop:this.top,roiSet:z})));z.length>0&&await Promise.all(z);const K=await this.getTableRecords();this.roiTable.renderTable(K)}async loadROI(z,K){const ee=Array.isArray(z)?z:[z];for(let z of ee)this.roiSets.push(new ROISet(z,K));await this.initialize()}clearROIs(){this.roiTable.clearTable();const z=this.browser.columnContainer.querySelectorAll(".igv-roi-region");for(let K of z)K.remove();for(let z of this.roiSets)z.dispose();this.roiSets=[]}async getTableRecords(){const z=[];for(let K of this.roiSets){const ee=K.isUserDefined?"":K.name||"";const te=await K.getAllFeatures();for(let K of Object.keys(te))for(let ne of te[K])z.push({setName:ee,feature:ne})}return z}presentTable(){this.roiTable.present()}async repaintTable(){const z=await this.getTableRecords();this.roiTable.renderTable(z)}dismissTable(){this.roiTable.dismiss()}async updateUserDefinedROISet(z){let K=await this.getUserDefinedROISet();void 0===K&&(K=this.initializeUserDefinedROISet());K.addFeature(z);false===this.browser.showROITableButton&&this.setROITableButtonVisibility(true);await this.renderROISet({browser:this.browser,pixelTop:this.top,roiSet:K});const ee=await this.getTableRecords();this.roiTable.renderTable(ee)}setROITableButtonVisibility(z){this.browser.showROITableButton=z;this.browser.roiTableControl.setVisibility(this.browser.showROITableButton)}async renderAllROISets(){for(let z of this.roiSets)await this.renderROISet({browser:this.browser,pixelTop:this.top,roiSet:z})}async renderROISet({browser:z,pixelTop:K,roiSet:ee}){const te=z.columnContainer.querySelectorAll(".igv-column");for(let ne=0;ne<te.length;ne++){let{chr:re,start:ie,end:se,bpPerPixel:oe}=z.referenceFrameList[ne];const ae=te[ne].querySelectorAll(".igv-roi-region");for(let z of ae){const K=z.dataset.region;const{chr:ee,start:te,end:ne}=parseRegionKey(K);(ee!==re||ne<ie||te>se)&&z.remove()}const le=await ee.getFeatures(re,ie,se);if(le)for(let ae of le){const le=createRegionKey(re,ae.start,ae.end);const{x:ce,width:he}=screenCoordinates(Math.max(ie,ae.start),Math.min(se,ae.end),ie,oe);const ue=te[ne].querySelector(createSelector(le));if(ue){ue.style.left=`${ce}px`;ue.style.width=`${he}px`}else{const re=this.createRegionElement(z.columnContainer,K,ce,he,ee,le,ae.name);te[ne].appendChild(re)}}}}createRegionElement(z,K,ee,te,ne,re,ie){const se=gt.div({class:"igv-roi-region"});se.style.top=`${K}px`;se.style.left=`${ee}px`;se.style.width=`${te}px`;se.style.backgroundColor=ne.color;se.dataset.region=re;const oe=gt.div();se.appendChild(oe);oe.style.backgroundColor=ne.headerColor;true===ne.isUserDefined?oe.addEventListener("click",(K=>{K.preventDefault();K.stopPropagation();const{x:ee,y:te}=gt.translateMouseCoordinates(K,z);this.roiMenu.present(ee,te,this,z,se)})):ie?oe.addEventListener("click",(K=>{K.preventDefault();K.stopPropagation();this.popover&&this.popover.dispose();this.popover=new Popover(z,ne.name);this.popover.presentContentWithEvent(K,ie)})):oe.style.pointerEvents="none";return se}renderSVGContext(z,{deltaX:K,deltaY:ee}){for(const te of document.querySelectorAll(".igv-roi-region")){const{x:ne,y:re,width:ie,height:se}=te.getBoundingClientRect();z.fillStyle=te.style.backgroundColor;z.fillRect(ne+K,re+ee,ie,se);const oe=te.querySelector("div");const{x:ae,y:le,width:ce,height:he}=oe.getBoundingClientRect();z.fillStyle=oe.style.backgroundColor;z.fillRect(ae+K,le+ee,ce,he)}}async getUserDefinedROISet(){return this.roiSets.find((z=>true===z.isUserDefined))}initializeUserDefinedROISet(){const z={isUserDefined:true,features:[]};const K=new ROISet(z,this.browser.genome);this.roiSets.push(K);return K}async deleteUserDefinedRegionWithKey(z,K){K.querySelectorAll(createSelector(z)).forEach((z=>z.remove()));const ee=await this.findUserDefinedRegionWithKey(z);const te=await this.getUserDefinedROISet();te&&te.removeFeature(ee);const ne=await this.getTableRecords();if(0===ne.length){this.browser.roiTableControl.buttonHandler(false);this.setROITableButtonVisibility(false)}}async findUserDefinedRegionWithKey(z){const{chr:K,start:ee,end:te}=parseRegionKey(z);const ne=await this.getUserDefinedROISet();if(ne){const z=await ne.getFeatures(K,ee,te);for(let ne of z)if(ne.chr===K&&ne.start>=ee&&ne.end<=te)return ne}}toJSON(){return this.roiSets.map((z=>z.toJSON()))}dispose(){this.browser.off("locuschange",this.boundLocusChangeHandler);const z=this.browser.columnContainer.querySelectorAll(".igv-roi-region");for(let K of z)K.remove();this.roiMenu&&this.roiMenu.dispose();this.roiTable&&this.roiTable.dispose();for(let z of this.roiSets)z.dispose();for(let z of Object.keys(this))this[z]=void 0}}function locusChangeHandler(){this.renderAllROISets()}function createRegionKey(z,K,ee){return`${z}-${K}-${ee}`}function createSelector(z){return`[data-region="${z}"]`}function parseRegionKey(z){let[K,ee,te]=z.split("-");ee=parseInt(ee);te=parseInt(te);return{chr:K,start:ee,end:te,locus:`${K}:${ee}-${te}`,bedRecord:`${K}\t${ee}\t${te}`}}class ROITable extends RegionTableBase{constructor(z){const K=Object.assign({width:"512px"},z);super(K)}tableRowDOM(z){const K=gt.div({class:"igv-roi-table-row"});const{setName:ee,feature:te}=z;K.dataset.region=createRegionKey(te.chr,te.start,te.end);let ne=[te.chr,numberFormatter$1(te.start),numberFormatter$1(te.end),te.name||"",ee];4===this.columnFormat.length&&(ne=ne.slice(0,4));for(let z=0;z<ne.length;z++){const ee=gt.div();K.appendChild(ee);ee.style.width=this.columnFormat[z].width;ee.innerText=ne[z]}this.tableRowDOMHelper(K);return K}renderTable(z){Array.from(this.tableRowContainer.querySelectorAll(".igv-roi-table-row")).forEach((z=>z.remove()));if(z.length>0){const K=z.sort(((z,K)=>z.feature.chr.localeCompare(K.feature.chr)||z.feature.start-K.feature.start||z.feature.end-K.feature.end));for(let z of K){const K=this.tableRowDOM(z);this.tableRowContainer.appendChild(K)}}}dispose(){document.removeEventListener("click",this.boundGotoButtonHandler);this.browser.roiTableControl.buttonHandler(false);super.dispose()}static getColumnFormatConfiguration(z){return true===z?[{label:"Chr",width:"20%"},{label:"Start",width:"15%"},{label:"End",width:"15%"},{label:"Description",width:"30%"},{label:"ROI Set",width:"20%"}]:[{label:"Chr",width:"25%"},{label:"Start",width:"20%"},{label:"End",width:"20%"},{label:"Description",width:"35%"}]}static gotoButtonHandler(z){z.stopPropagation();const K=this.tableDOM.querySelectorAll(".igv-roi-table-row-selected");const ee=[];for(let z of K){const{locus:K}=parseRegionKey(z.dataset.region);ee.push(K)}for(let z of this.tableDOM.querySelectorAll(".igv-roi-table-row"))z.classList.remove("igv-roi-table-row-selected");this.setTableRowSelectionState(false);ee.length>0&&this.browser.search(ee.join(" "))}}class ROIMenu{constructor(z,K){this.browser=z;this.container=gt.div({class:"igv-roi-menu-next-gen"});K.appendChild(this.container);const ee=gt.div();this.container.appendChild(ee);hn.attachDialogCloseHandlerWithParent(ee,(()=>this.container.style.display="none"));this.body=gt.div();this.container.appendChild(this.body);this.container.style.display="none"}async present(z,K,ee,te,ne){removeAllChildNodes(this.body);const re=await this.browser.roiManager.findUserDefinedRegionWithKey(ne.dataset.region);const ie=gt.div();this.body.appendChild(ie);const se="Description";const oe=re.name||se;ie.innerText=oe;ie.setAttribute("title",oe);se===oe?ie.classList.add("igv-roi-placeholder"):ie.classList.remove("igv-roi-placeholder");const ae=gt.div();this.body.appendChild(ae);ae.innerText="Set Description";ae.addEventListener("click",(z=>{z.stopPropagation();this.container.style.display="none";const callback=()=>{const z=this.browser.inputDialog.value||"";re.name=z.trim();this.container.style.display="none";this.browser.roiManager.repaintTable()};const K={label:"Description",value:re.name||"",callback:callback};this.browser.inputDialog.present(K,z)}));const le=gt.div();this.body.appendChild(le);le.innerText="Delete Region";le.addEventListener("click",(z=>{z.stopPropagation();this.container.style.display="none";this.browser.roiManager.deleteUserDefinedRegionWithKey(ne.dataset.region,this.browser.columnContainer)}));this.container.style.left=`${z}px`;this.container.style.top=`${K}px`;this.container.style.display="flex"}async __present(z,K,ee,te,ne){removeAllChildNodes(this.container);const re=await this.browser.roiManager.findUserDefinedRegionWithKey(ne.dataset.region);let ie;ie=gt.div({class:"igv-roi-menu-row-edit-description"});this.container.appendChild(ie);ie.addEventListener("click",(z=>{z.stopPropagation()}));const se="description-input";const oe=document.createElement("label");ie.appendChild(oe);oe.setAttribute("for",se);oe.innerText="Description:";const ae=document.createElement("input");ie.appendChild(ae);ae.setAttribute("type","text");ae.setAttribute("name",se);ae.setAttribute("placeholder","");ae.value=re.name||"";ae.addEventListener("change",(async z=>{z.stopPropagation();const K=await this.browser.roiManager.findUserDefinedRegionWithKey(ne.dataset.region);K.name=ae.value;ae.blur();this.container.style.display="none";await this.browser.roiManager.repaintTable()}));ie=gt.div({class:"igv-roi-menu-row"});ie.innerText="Delete region";this.container.appendChild(ie);ie.addEventListener("click",(z=>{z.stopPropagation();this.container.style.display="none";this.browser.roiManager.deleteUserDefinedRegionWithKey(ne.dataset.region,this.browser.columnContainer)}));this.container.style.left=`${z}px`;this.container.style.top=`${K}px`;this.container.style.display="flex";te.addEventListener("click",(z=>{z.stopPropagation();this.container.style.display="none"}))}dispose(){this.container.innerHTML=""}}function removeAllChildNodes(z){while(z.firstChild)z.removeChild(z.firstChild)}class TrackROISet{constructor(z,K){this.name=z.name;this.featureSource=z.featureSource||FeatureSource(z,K);this.color=z.color||yl}async getFeatures(z,K,ee){return this.featureSource.getFeatures({chr:z,start:K,end:ee})}draw(z){const{context:K,bpPerPixel:ee,bpStart:te,pixelTop:ne,pixelHeight:re,pixelWidth:ie,features:se}=z;if(!se)return;const oe=te+ie*ee+1;for(let{start:z,end:ie}of se){if(ie<te)continue;if(z>oe)break;const{x:se,width:ae}=screenCoordinates(z,ie,te,ee);Jo.fillRect(K,se,ne,ae,re,{fillStyle:this.color})}}}class ROITableControl{constructor(z,K){this.browser=K;this.button=gt.div({class:"igv-navbar-button"});z.appendChild(this.button);this.button.textContent="ROI Table";this.button.addEventListener("click",(()=>{this.buttonHandler(!K.roiTableVisible)}));this.browser=K;this.setVisibility(K.showROITableButton);this.setState(K.roiTableVisible)}buttonHandler(z){this.browser.roiTableVisible=z;this.setState(this.browser.roiTableVisible);this.browser.setROITableVisibility(this.browser.roiTableVisible)}setVisibility(z){true===z?this.show():this.hide()}setState(z){true===z?this.button.classList.add("igv-navbar-button-clicked"):this.button.classList.remove("igv-navbar-button-clicked")}show(){this.button.style.display="block";this.setState(this.browser.roiTableVisible)}hide(){this.button.style.display="none"}}const wp=14;const yp=12;const _p=28;const kp=5;const xp=200;class Browser{constructor(z,K){this.config=z;this.guid=gt.guid();this.namespace=".browser_"+this.guid;this.parent=K;this.root=gt.div({class:"igv-container"});K.appendChild(this.root);this.alert=new Alert(this.root);this.columnContainer=gt.div({class:"igv-column-container"});this.root.appendChild(this.columnContainer);this.menuPopup=new MenuPopup(this.columnContainer);this.initialize(z);this.trackViews=[];this.constants={dragThreshold:3,scrollThreshold:5,defaultColor:"rgb(0,0,150)",doubleClickDelay:z.doubleClickDelay||500};this.eventHandlers={};this.addMouseHandlers();this.setControls(z)}initialize(z){z.gtex&&(vc.gtexLoaded=true);this.flanking=z.flanking;this.crossDomainProxy=z.crossDomainProxy;this.formats=z.formats;this.trackDefaults=z.trackDefaults;this.nucleotideColors=z.nucleotideColors||ha;for(let z of Object.keys(this.nucleotideColors))this.nucleotideColors[z.toLowerCase()]=this.nucleotideColors[z];this.trackLabelsVisible=z.showTrackLabels;this.roiTableVisible=z.showROITable;this.showROITableButton=z.showROITableButton;this.isCenterLineVisible=z.showCenterGuide;this.cursorGuideVisible=z.showCursorGuide;this.showSampleNames=z.showSampleNames;this.showSampleNameButton=z.showSampleNameButton;this.sampleNameViewportWidth=z.sampleNameViewportWidth||xp;z.search&&(this.searchConfig={type:"json",url:z.search.url,coords:void 0===z.search.coords?1:z.search.coords,chromosomeField:z.search.chromosomeField||"chromosome",startField:z.search.startField||"start",endField:z.search.endField||"end",geneField:z.search.geneField||"gene",snpField:z.search.snpField||"snp",resultsField:z.search.resultsField})}setControls(z){const K=this.createStandardControls(z);K.insertBefore(pt(this.columnContainer));this.$navigation=K;false===z.showControls&&K.hide()}createStandardControls(z){this.navbarManager=new NavbarManager(this);const K=pt("<div>",{class:"igv-navbar"});this.$navigation=K;const ee=pt("<div>",{class:"igv-navbar-left-container"});K.append(ee);const te=pt("<div>",{class:"igv-logo"});ee.append(te);const ne=logo();ne.css("width","34px");ne.css("height","32px");te.append(ne);this.$current_genome=pt("<div>",{class:"igv-current-genome"});ee.append(this.$current_genome);this.$current_genome.text("");const re=pt("<div>",{class:"igv-navbar-genomic-location"});ee.append(re);this.chromosomeSelectWidget=new ChromosomeSelectWidget(this,re.get(0));void 0===z.showChromosomeWidget&&(z.showChromosomeWidget=true);true===z.showChromosomeWidget?this.chromosomeSelectWidget.show():this.chromosomeSelectWidget.hide();const ie=pt("<div>",{class:"igv-locus-size-group"});re.append(ie);const se=pt("<div>",{class:"igv-search-container"});ie.append(se);this.$searchInput=pt("<input>",{class:"igv-search-input",type:"text",placeholder:"Locus Search"});se.append(this.$searchInput);this.$searchInput.change((()=>this.doSearch(this.$searchInput.val())));const oe=gt.div({class:"igv-search-icon-container"});se.append(pt(oe));oe.appendChild(cn.createIcon("search"));oe.addEventListener("click",(()=>this.doSearch(this.$searchInput.val())));this.windowSizePanel=new WindowSizePanel(ie.get(0),this);const ae=pt("<div>",{class:"igv-navbar-right-container"});K.append(ae);const le=pt('<div class="igv-navbar-toggle-button-container">');ae.append(le);this.$toggle_button_container=le;this.cursorGuide=new CursorGuide(this.columnContainer,this);this.cursorGuideButton=new CursorGuideButton(this,le.get(0));this.centerLineButton=new CenterLineButton(this,le.get(0));this.setTrackLabelVisibility(z.showTrackLabels);this.trackLabelControl=new TrackLabelControl(le.get(0),this);this.roiTableControl=new ROITableControl(le.get(0),this);this.sampleNameControl=new SampleNameControl(le.get(0),this);true===z.showSVGButton&&(this.svgSaveControl=new SVGSaveControl(le.get(0),this));if(z.customButtons)for(let K of z.customButtons)new CustomButton(le.get(0),this,K);this.zoomWidget=new ZoomWidget(this,ae.get(0));false===z.showNavigation&&this.$navigation.hide();this.inputDialog=new InputDialog(this.root);this.inputDialog.container.id=`igv-input-dialog-${gt.guid()}`;this.dataRangeDialog=new DataRangeDialog(this,pt(this.root));this.dataRangeDialog.$container.get(0).id=`igv-data-range-dialog-${gt.guid()}`;this.genericColorPicker=new GenericColorPicker({parent:this.columnContainer,width:432});this.genericColorPicker.container.id=`igv-track-color-picker-${gt.guid()}`;return K}getSampleNameViewportWidth(){return false===this.showSampleNames?0:this.sampleNameViewportWidth}isMultiLocusMode(){return this.referenceFrameList&&this.referenceFrameList.length>1}addTrackToFactory(z,K){hp.addTrack(z,K)}isMultiLocusWholeGenomeView(){if(void 0===this.referenceFrameList||1===this.referenceFrameList.length)return false;for(let z of this.referenceFrameList)if("all"===z.chr.toLowerCase())return true;return false}
/**
         * PUBLIC API FUNCTION
         *
         * Return the current genomic region as a locus string, or array of locus strings if in multi-locus view
         * @returns {string|*[]|*}
         */
currentLoci(){const noCommaLocusString=z=>`${z.chr}:${z.start+1}-${z.end}`;return void 0===this.referenceFrameList||0===this.referenceFrameList.length?"":1===this.referenceFrameList.length?noCommaLocusString(this.referenceFrameList[0]):this.referenceFrameList.map((z=>noCommaLocusString(z)))}
/**
         * Render browse display as SVG
         * @returns {string}
         */toSVG(){const{y:z,width:K,height:ee}=this.columnContainer.getBoundingClientRect();const te=8e3;const ne={width:K,height:te,backdropColor:"white",multiLocusGap:0,viewbox:{x:0,y:0,width:K,height:te}};const re=new ctx(ne);const ie={deltaX:0,deltaY:-z};for(let z of this.trackViews)z.renderSVGContext(re,ie);this.roiManager.renderSVGContext(re,ie);re.setHeight(ee);return re.getSerializedSvg(true)}renderSVG(z){const K=this.toSVG();z.empty();z.append(K);return K}saveSVGtoFile(z){let K=this.toSVG();if(z.$container){z.$container.empty();z.$container.append(K)}const ee=z.filename||"igvjs.svg";const te=URL.createObjectURL(new Blob([K],{type:"application/octet-stream"}));download(ee,te)}
/**
         * Initialize a session from an object, json, or by loading from a file.
         *
         * TODO Really should be split into at least 2 functions, load from file and load from object/json
         *
         * @param options
         * @returns {*}
         */async loadSession(z){this.roiSets=[];let K;K=z.url||z.file?await loadSessionFile(z):z;return this.loadSessionObject(K);async function loadSessionFile(z){const K=z.url||z.file;if(z.url&&(z.url.startsWith("blob:")||z.url.startsWith("data:"))){const K=Browser.uncompressSession(z.url);return JSON.parse(K)}{let ee=z.filename;ee||(ee=z.url?await getFilename$1(z.url):z.file.name);if(ee.endsWith(".xml")){const z=Ma.KNOWN_GENOMES;const ee=await Wo.loadString(K);return new XMLSession(ee,z)}return ee.endsWith(".json")?Wo.loadJson(K):void 0}}}
/**
         * Note:  public API function
         * @param session
         * @returns {Promise<void>}
         */async loadSessionObject(z){this.cleanHouseForSession();this.showSampleNames=z.showSampleNames||false;this.sampleNameControl.setState(true===this.showSampleNames);z.sampleNameViewportWidth&&(this.sampleNameViewportWidth=z.sampleNameViewportWidth);createColumn(this.columnContainer,"igv-axis-column");createColumn(this.columnContainer,"igv-sample-name-column");createColumn(this.columnContainer,"igv-scrollbar-column");createColumn(this.columnContainer,"igv-track-drag-column");createColumn(this.columnContainer,"igv-gear-menu-column");const K=z.reference||z.genome;if(!K){console.warn("No genome or reference object specified");return}const ee=await Ma.expandReference(this.alert,K);await this.loadReference(ee,z.locus);this.centerLineList=this.createCenterLineList(this.columnContainer);let te=0;if(false!==z.showIdeogram){const z=new IdeogramTrack(this);z.id="ideogram";const K=new TrackView(this,this.columnContainer,z);const{$viewport:ee}=K.viewports[0];te=getElementAbsoluteHeight(ee.get(0));this.trackViews.push(K)}false!==z.showRuler&&this.trackViews.push(new TrackView(this,this.columnContainer,new RulerTrack(this)));if(z.gtexSelections)for(let K of this.referenceFrameList)for(let ee of Object.keys(z.gtexSelections)){const te=z.gtexSelections[ee].gene;const ne=z.gtexSelections[ee].snp;K.selection=new GtexSelection(te,ne)}this.roiManager&&this.roiManager.dispose();const ne=new ROIMenu(this,this.columnContainer);const re={browser:this,parent:this.columnContainer,headerTitle:"Regions of Interest",dismissHandler:()=>this.roiTableControl.buttonHandler(false),gotoButtonHandler:ROITable.gotoButtonHandler};if(z.roi){const K=z.roi.map((z=>new ROISet(z,this.genome)));const ee=K.filter((({name:z})=>void 0!==z&&z.length>0));re.columnFormat=ROITable.getColumnFormatConfiguration(ee.length>0);const ie=new ROITable(re);this.roiManager=new ROIManager(this,ne,ie,te,K)}else{re.columnFormat=ROITable.getColumnFormatConfiguration(false);const z=new ROITable(re);this.roiManager=new ROIManager(this,ne,z,te,void 0)}await this.roiManager.initialize();const ie=ee.tracks||[];const se=z.tracks?ie.concat(z.tracks):ie;const oe=0===se.filter((z=>"sequence"===z.type&&!z.url&&!z.fastaURL)).length;oe&&se.push({type:"sequence",order:ua});let ae=1;for(let z of se)void 0===z.order&&(z.order=ae++);await this.loadTrackList(se);for(let z of this.trackViews.filter((z=>"ruler"===z.track.type||"ideogram"===z.track.type)))z.updateViews();this.updateUIWithReferenceFrameList()}createCenterLineList(z){const K=z.querySelectorAll(".igv-center-line");for(let z=0;z<K.length;z++)K[z].remove();const ee=[];const te=z.querySelectorAll(".igv-column");for(let z=0;z<te.length;z++)ee.push(new ViewportCenterLine(this,this.referenceFrameList[z],te[z]));return ee}
/**
         * Load a reference genome object.  This includes the fasta, and optional cytoband, but no tracks.  This method
         * is used by loadGenome and loadSession.
         *
         * @param genomeConfig
         * @param initialLocus
         */async loadReference(z,K){const ee=await Ma.loadGenome(z);const te=void 0===this.genome||this.genome.id!==ee.id;this.genome=ee;this.updateNavbarDOMWithGenome(ee);te&&this.removeAllTracks();let ne=getInitialLocus(K,ee);const re=await this.search(ne,true);if(!re){console.log("Initial locus not found: "+ne);ne=ee.getHomeChromosomeName();const z=await this.search(ne,true);if(!z)throw new Error("Cannot set initial locus")}te&&this.circularView&&this.circularView.setAssembly({name:this.genome.id,id:this.genome.id,chromosomes:makeCircViewChromosomes(this.genome)})}cleanHouseForSession(){for(let z of this.trackViews)z.removeDOMFromColumnContainer();const z=this.columnContainer.querySelectorAll(".igv-axis-column, .igv-column-shim, .igv-column, .igv-sample-name-column, .igv-scrollbar-column, .igv-track-drag-column, .igv-gear-menu-column");z.forEach((z=>z.remove()));this.trackViews=[];this.circularView&&this.circularView.clearChords()}updateNavbarDOMWithGenome(z){let K=z.id&&z.id.length<10?z.id:"";this.$current_genome.text(K);this.$current_genome.attr("title",z.id||"");this.chromosomeSelectWidget.update(z)}
/**
         * Load a genome, defined by a string ID or a json-like configuration object. This includes a fasta reference
         * as well as optional cytoband and annotation tracks.
         *
         * @param idOrConfig
         * @returns genome
         */async loadGenome(z){const K=await Ma.expandReference(this.alert,z);await this.loadReference(K,void 0);const ee=K.tracks||[];const te=0===ee.filter((z=>"sequence"===z.type)).length;te&&ee.push({type:"sequence",order:ua});await this.loadTrackList(ee);await this.updateViews();return this.genome}
/**
         * Called after a session load, search, pan (horizontal drag), or resize
         *
         * @param referenceFrameList
         */updateUIWithReferenceFrameList(){const z=this.referenceFrameList;this.updateLocusSearchWidget();const K=this.isMultiLocusWholeGenomeView()||Ma.isWholeGenomeView(z[0].chr);this.navbarManager.navbarDidResize(this.$navigation.width(),K);toggleTrackLabels(this.trackViews,this.trackLabelsVisible);this.setCenterLineAndCenterLineButtonVisibility(!Ma.isWholeGenomeView(z[0].chr))}setTrackLabelVisibility(z){toggleTrackLabels(this.trackViews,z)}setROITableVisibility(z){true===z?this.roiManager.presentTable():this.roiManager.dismissTable()}setCursorGuideVisibility(z){z?this.cursorGuide.show():this.cursorGuide.hide()}setCustomCursorGuideMouseHandler(z){this.cursorGuide.customMouseHandler=z}setCenterLineVisibility(z){for(let K of this.centerLineList)if(true===z){K.show();K.repaint()}else K.hide()}setCenterLineAndCenterLineButtonVisibility(z){for(let K of this.centerLineList){const ee=z&&K.isVisible;ee?K.show():K.container.style.display="none"}const K=z&&this.centerLineButton.isVisible;K?this.centerLineButton.show():this.centerLineButton.button.style.display="none"}
/**
         * Public API function. Load a list of tracks.
         *
         * @param configList  Array of track configurations
         * @returns {Promise<*>}  Promise for track objects
         */async loadTrackList(z){const K=[];for(let ee of z)K.push(this._loadTrack(ee));const ee=await Promise.all(K);const te=this.trackViews.filter((function(z){return z.track.autoscaleGroup}));te.length>0&&this.updateViews();return ee}
/**
         * Public API function
         *
         * Load an individual track.  If part of an autoscale group force a general update
         *
         * @param config  A track configuration
         * @returns {Promise<*>}  Promise for track object
         */async loadTrack(z){const K=this._loadTrack(z);if(z.autoscaleGroup){await K;this.updateViews()}return K}
/**
         * Return a promise to load a track.   Private function used by loadTrack() and loadTrackList()
         *
         * @param config
         * @returns {*}
         */async _loadTrack(z){isString$2(z)&&(z=JSON.parse(z));try{const K=await this.createTrack(z);if(void 0===K)return;void 0===K.order&&(K.order=this.trackViews.length);const ee=new TrackView(this,this.columnContainer,K);this.trackViews.push(ee);toggleTrackLabels(this.trackViews,this.trackLabelsVisible);this.reorderTracks();this.fireEvent("trackorderchanged",[this.getTrackOrder()]);if("function"===typeof K.postInit)try{ee.startSpinner();await K.postInit()}finally{ee.stopSpinner()}K.autoscaleGroup||(z.sync?await ee.updateViews():ee.updateViews());"function"===typeof K.hasSamples&&K.hasSamples()&&false!==this.config.showSampleNameButton&&this.sampleNameControl.show();return K}catch(K){const ee={401:"Access unauthorized",403:"Access forbidden",404:"Not found"};console.error(K);let te=K.message||K.error||K.toString();ee.hasOwnProperty(te)&&(te=ee[te]);te+=": "+z.url;this.alert.present(new Error(te),void 0)}}
/**
         * Public API function - load a region of interest
         *
         * @param config  A "track" configuration object, or array of objects,  of type == "annotation" (bed, gff, etc)
         *
         * @returns {Promise<void>}
         */async loadROI(z){await this.roiManager.loadROI(z,this.genome)}clearROIs(){this.roiManager.clearROIs()}async getUserDefinedROIs(){if(this.roiManager){const z=await this.roiManager.getUserDefinedROISet();if(void 0===z)return[];const K=await z.getAllFeatures();const ee=[];for(let z of Object.values(K))ee.push(...z);return ee}return[]}getRulerTrackView(){const z=this.trackViews.filter((({track:z})=>"ruler"===z.id));return z.length>0?z[0]:void 0}
/**
         * Create a Track object.
         * @param config
         * @returns {Promise<*>}
         */async createTrack(z){let K=await resolveURL(z.url||z.fastaURL);isString$2(K)&&(K=K.trim());if(K)if(z.format)z.format=z.format.toLowerCase();else if(z.fastaURL)z.format="fasta";else{let ee=z.filename;ee||(ee=await getFilename$1(K));const te=inferFileFormat(ee);"tsv"===te?z.format=await inferFileFormatFromHeader(z):te?z.format=te:"htsget"===z.sourceType&&await HtsgetReader.inferFormat(z)}let ee=z.type?z.type.toLowerCase():void 0;if(!ee){ee=inferTrackType(z);if("bedtype"===ee){const K=FeatureSource(z,this.genome);z._featureSource=K;const te=await K.trackType();ee=te||"annotation"}z.type=ee}if(this.trackDefaults&&ee){const K=this.trackDefaults[ee];if(K)for(let ee in K)K.hasOwnProperty(ee)&&void 0===z[ee]&&(z[ee]=K[ee])}const te=hp.getTrack(ee,z,this);if(void 0!==te){z.roi&&z.roi.length>0&&(te.roiSets=z.roi.map((z=>new TrackROISet(z,this.genome))));return te}this.alert.present(new Error(`Error creating track.  Could not determine track type for file: ${z.url||z}`),void 0)}reorderTracks(){this.trackViews.sort((function(z,K){const firstSortOrder=z=>"ideogram"===z.track.id?1:"ruler"===z.track.id?2:3;const ee=firstSortOrder(z);const te=firstSortOrder(K);if(ee===te){const ee=z.track.order||0;const te=K.track.order||0;return ee-te}return ee-te}));for(let{axis:z,viewports:K,sampleNameViewport:ee,outerScroll:te,dragHandle:ne,gearContainer:re}of this.trackViews){z.remove();for(let{$viewport:z}of K)z.detach();ee.viewport.remove();te.remove();ne.remove();re.remove()}const z=this.columnContainer.querySelectorAll(".igv-column");for(let{axis:K,viewports:ee,sampleNameViewport:te,outerScroll:ne,dragHandle:re,gearContainer:ie}of this.trackViews){this.columnContainer.querySelector(".igv-axis-column").appendChild(K);for(let K=0;K<z.length;K++){const{$viewport:te}=ee[K];z[K].appendChild(te.get(0))}this.columnContainer.querySelector(".igv-sample-name-column").appendChild(te.viewport);this.columnContainer.querySelector(".igv-scrollbar-column").appendChild(ne);this.columnContainer.querySelector(".igv-track-drag-column").appendChild(re);this.columnContainer.querySelector(".igv-gear-menu-column").appendChild(ie)}}getTrackOrder(){return this.trackViews.filter((z=>z.track&&z.track.name)).map((z=>z.track.name))}
/**
         * NOTE: Public API function
         *
         * Remove all tracks matching the given name.  Usually this will be a single track, but there is no
         * guarantee names are unique
         *
         * @param name
         */removeTrackByName(z){const K=this.trackViews.slice();for(let ee of K)z===ee.track.name&&this.removeTrack(ee.track)}
/**
         * NOTE: Public API function
         *
         * Remove the given track.  If it has already been removed this is a no-op.
         *
         * @param track
         */removeTrack(z){for(let K of this.trackViews)if(z===K.track){this._removeTrack(K.track);break}}_removeTrack(z){if(!z.disposed){this.trackViews.splice(this.trackViews.indexOf(z.trackView),1);this.fireEvent("trackremoved",[z]);this.fireEvent("trackorderchanged",[this.getTrackOrder()]);z.trackView&&z.trackView.dispose()}}removeAllTracks(){const z=[];for(let K of this.trackViews)if("ruler"!==K.track.id&&"ideogram"!==K.track.id){this.fireEvent("trackremoved",[K.track]);K.dispose()}else z.push(K);this.trackViews=z}
/**
         *
         * @param property
         * @param value
         * @returns {Array}  tracks with given property value.  e.g. findTracks("type", "annotation")
         */findTracks(z,K){let ee="function"===typeof z?K=>z(K.track):ee=>K===ee.track[z];return this.trackViews.filter(ee).map((z=>z.track))}
/**
         * Set the track height globally for all tracks.  (Note: Its not clear why this is useful).
         * @param newHeight
         */setTrackHeight(z){this.trackHeight=z;this.trackViews.forEach((function(K){K.setTrackHeight(z)}))}
/**
         * API function to signal that this browser visibility has changed, e.g. from hiding/showing in a tab interface.
         *
         * @returns {Promise<void>}
         */async visibilityChange(){this.layoutChange()}async layoutChange(){const z=this.referenceFrameList.find((z=>z.bpPerPixel<0));if(z){const z=this.calculateViewportWidth(this.referenceFrameList.length);for(let K of this.referenceFrameList)K.bpPerPixel=(K.end-K.start)/z}if(this.referenceFrameList){const z=this.isMultiLocusWholeGenomeView()||Ma.isWholeGenomeView(this.referenceFrameList[0].chr);this.navbarManager.navbarDidResize(this.$navigation.width(),z)}resize.call(this);await this.updateViews()}async updateViews(){const z=this.trackViews;this.updateLocusSearchWidget();for(let z of this.centerLineList)z.repaint();if(this.dragObject)for(let K of z)await K.updateViews();else{const ne={};const re=[];for(let ee of z){const z=ee.track.autoscaleGroup;if(z){var K=ne[z];if(!K){K=[];ne[z]=K}K.push(ee)}else re.push(ee)}if(Object.entries(ne).length>0){const z=Object.keys(ne);for(let K of z){const z=ne[K];const re=[];for(let K of z)re.push(K.getInViewFeatures());const ie=await Promise.all(re);var ee,te=[];for(let z of ie)te=te.concat(z);ee=doAutoscale(te);const se=[];for(let K of z){K.track.dataRange=ee;K.track.autoscale=false;se.push(K.updateViews())}await Promise.all(se)}}await Promise.all(re.map((z=>z.updateViews())))}}repaintViews(){for(let z of this.trackViews)z.repaintViews()}updateLocusSearchWidget(){if(!this.referenceFrameList)return;const z=this.referenceFrameList;const K=this.calculateViewportWidth(this.referenceFrameList.length);for(let ee of z)ee.end=ee.start+ee.bpPerPixel*K;this.chromosomeSelectWidget.select.value=1===z.length?this.referenceFrameList[0].chr:"";const ee=this.referenceFrameList.map((z=>z.getLocusString())).join(" ");this.$searchInput.val(ee);this.fireEvent("locuschange",[this.referenceFrameList])}calculateViewportWidth(z){let{width:K}=this.columnContainer.getBoundingClientRect();const ee=this.getSampleNameViewportWidth();K-=zc+ee+wp+yp+_p;K-=kp*(z-1);return Math.floor(K/z)}getCenterLineXOffset(){let{width:z}=this.columnContainer.getBoundingClientRect();z-=zc+this.getSampleNameViewportWidth()+wp+yp+_p;return Math.floor(z/2+zc)}minimumBases(){return this.config.minimumBases}zoomIn(){this.zoomWithScaleFactor(.5)}zoomOut(){this.zoomWithScaleFactor(2)}async zoomWithScaleFactor(z,K,ee){if(!this.referenceFrameList)return;const te=this.calculateViewportWidth(this.referenceFrameList.length);let ne=ee?[ee]:this.referenceFrameList;for(let ee of ne)ee.zoomWithScaleFactor(this,z,te,K)}
/**
         * Add a new multi-locus panel for the specified region
         * @param chr
         * @param start
         * @param end
         * @param referenceFrameLeft - optional, if supplied new panel should be placed to the immediate right
         */async addMultiLocusPanel(z,K,ee,te){if(!this.referenceFrameList)return;const ne=this.calculateViewportWidth(1+this.referenceFrameList.length);const re=this.calculateViewportWidth(this.referenceFrameList.length)/this.calculateViewportWidth(1+this.referenceFrameList.length);for(let z of this.referenceFrameList)z.bpPerPixel*=re;const ie=(ee-K)/ne;const se=new ReferenceFrame(this.genome,z,K,ee,ie);const oe=te?this.referenceFrameList.indexOf(te):this.referenceFrameList.length-1;const ae=1+oe;const{$viewport:le}=this.trackViews[0].viewports[oe];const ce=bp.insertAfter(le.get(0).parentElement);if(ae===this.referenceFrameList.length){this.referenceFrameList.push(se);for(let z of this.trackViews){const K=createViewport(z,ce,se);z.viewports.push(K)}}else{this.referenceFrameList.splice(ae,0,se);for(let z of this.trackViews){const K=createViewport(z,ce,se);z.viewports.splice(ae,0,K)}}this.centerLineList=this.createCenterLineList(this.columnContainer);resize.call(this);await this.updateViews(true)}async removeMultiLocusPanel(z){const K=this.referenceFrameList.indexOf(z);const{$viewport:ee}=this.trackViews[0].viewports[K];bp.removeColumnAtIndex(K,ee.parent().get(0));for(let{viewports:z}of this.trackViews){z[K].dispose();z.splice(K,1)}this.referenceFrameList.splice(K,1);if(1===this.referenceFrameList.length&&this.getRulerTrackView())for(let z of this.getRulerTrackView().viewports)z.dismissLocusLabel();const te=this.calculateViewportWidth(1+this.referenceFrameList.length)/this.calculateViewportWidth(this.referenceFrameList.length);await this.rescaleForMultiLocus(te)}
/**
         * Goto the locus represented by the selected referenceFrame, discarding all other panels
         *
         * @param referenceFrame
         * @returns {Promise<void>}
         */async gotoMultilocusPanel(z){const K=this.referenceFrameList.indexOf(z);this.columnContainer.querySelectorAll(".igv-column").forEach(((z,ee)=>{ee===K||z.remove()}));this.columnContainer.querySelectorAll(".igv-column-shim").forEach((z=>z.remove()));for(let z of this.trackViews){const ee=z.viewports[K];z.viewports.filter(((z,ee)=>ee!==K)).forEach((z=>z.dispose()));z.viewports=[ee]}const ee=this.calculateViewportWidth(1);z.bpPerPixel=(z.end-z.start)/ee;this.referenceFrameList=[z];this.trackViews.forEach((({viewports:z})=>z.forEach((z=>z.setWidth(ee)))));this.centerLineList=this.createCenterLineList(this.columnContainer);this.updateUIWithReferenceFrameList();await this.updateViews(true)}async rescaleForMultiLocus(z){const K=this.calculateViewportWidth(this.referenceFrameList.length);for(let K of this.referenceFrameList)K.bpPerPixel*=z;for(let{viewports:z}of this.trackViews)for(let ee of z)ee.setWidth(K);this.centerLineList=this.createCenterLineList(this.columnContainer);this.updateUIWithReferenceFrameList();await this.updateViews()}
/**
         * @deprecated  This is a deprecated method with no known usages.  To be removed in a future release.
         */async goto(z,K,ee){await this.search(z+":"+K+"-"+ee)}
/**

         * Search for the locus string -- this function is called from various igv.js GUI elements, and is not part of the
         * API.  Wraps ```search``` and presents an error dialog if false.
         *
         * @param string
         * @param init
         * @returns {Promise<void>}
         */async doSearch(z,K){const ee=await this.search(z,K);ee||this.alert.present(new Error(`Unrecognized locus: <b> ${z} </b>`));return ee}
/**
         * Search for the locus string
         * NOTE: This is part of the API
         * @param string
         * @param init  true if called during browser initialization
         * @returns {Promise<boolean>}  true if found, false if not
         */async search(z,K){const ee=await search(this,z);if(ee&&ee.length>0){this.referenceFrameList=createReferenceFrameList(ee,this.genome,this.flanking,this.minimumBases(),this.calculateViewportWidth(ee.length),this.isSoftclipped());for(let z of this.trackViews)z.removeDOMFromColumnContainer();this.columnContainer.querySelectorAll(".igv-column-shim, .igv-column").forEach((z=>z.remove()));bp.insertBefore(this.columnContainer.querySelector(".igv-sample-name-column"),this.referenceFrameList.length);this.centerLineList=this.createCenterLineList(this.columnContainer);for(let z of this.trackViews)z.addDOMToColumnContainer(this,this.columnContainer,this.referenceFrameList);this.updateUIWithReferenceFrameList();K||await this.updateViews();return true}return false}async loadSampleInformation(z){var K=z;isFile(z)&&(K=z.name);var ee=K.substr(K.lastIndexOf(".")+1);"fam"===ee&&(this.sampleInformation=await loadPlinkFile(z))}on(z,K){this.eventHandlers[z]||(this.eventHandlers[z]=[]);this.eventHandlers[z].push(K)}
/**
         * @deprecated use off()
         * @param eventName
         * @param fn
         */
un(z,K){this.off(z,K)}off(z,K){if(z)if(K){const ee=this.eventHandlers[z];if(ee&&0!==ee.length){const te=ee.indexOf(K);-1!==te&&this.eventHandlers[z].splice(te,1)}else console.warn("No handlers to remove for event: "+z)}else this.eventHandlers[z]=[];else this.eventHandlers={}}fireEvent(z,K,ee){const te=this.eventHandlers[z];if(void 0===te||0===te.length)return;const ne=ee||window;const re=te.map((function(z){return z.apply(ne,K)}));return re[0]}dispose(){this.removeMouseHandlers();for(let z of this.trackViews)z.dispose()}toJSON(){const z={version:version()};void 0!==this.showSampleNames&&(z.showSampleNames=this.showSampleNames);this.sampleNameViewportWidth!==xp&&(z.sampleNameViewportWidth=this.sampleNameViewportWidth);z.reference=this.genome.toJSON();if(z.reference.fastaURL instanceof File)throw new Error(`Error. Sessions cannot include local file references ${z.reference.fastaURL.name}.`);if(z.reference.indexURL instanceof File)throw new Error(`Error. Sessions cannot include local file references ${z.reference.indexURL.name}.`);const K=[];const ee={};let te=false;let ne=this.trackViews[0];for(let{referenceFrame:z}of ne.viewports){const ne=z.getLocusString();K.push(ne);if(z.selection){const K={gene:z.selection.gene,snp:z.selection.snp};ee[ne]=K;te=true}}z.locus=1===K.length?K[0]:K;te&&(z.gtexSelections=ee);z.roi=this.roiManager.toJSON();const re=[];const ie=[];for(let{track:z}of this.trackViews)try{let K;K="function"===typeof z.getState?z.getState():z.config;if(K){K.browser&&delete K.browser;K.order=z.order;re.push(K)}}catch(K){console.error(`Track: ${z.name}: ${K}`);ie.push(`Track: ${z.name}: ${K}`)}if(ie.length>0){let z=1;let K="Errors encountered saving session: </br>";for(let ee of ie)K+=` (${z++}) ${ee.toString()} <br/>`;throw Error(K)}z.tracks=re;return z}compressedSession(){const z=JSON.stringify(this.toJSON());return compressString(z)}sessionURL(){const z=window.location.href.slice();const K=z.indexOf("?");const ee=(K>0?z.substring(0,K):z)+"?sessionURL=blob:"+this.compressedSession();return ee}
/**
         * Record a mouse click on a specific viewport.   This might be the start of a drag operation.   Dragging
         * (panning) is handled here so that the mouse can move out of a specific viewport (e.g. stray into another
         * track) without halting the drag.
         *
         * @param e
         * @param viewport
         */mouseDownOnViewport(z,K){var ee;ee=gt.pageCoordinates(z);this.vpMouseDown={viewport:K,lastMouseX:ee.x,mouseDownX:ee.x,lastMouseY:ee.y,mouseDownY:ee.y,referenceFrame:K.referenceFrame}}cancelTrackPan(){const z=this.dragObject;this.dragObject=void 0;this.isScrolling=false;this.vpMouseDown=void 0;if(z&&z.viewport.referenceFrame.start!==z.start){this.updateViews();this.fireEvent("trackdragend")}}isTrackPanning(){return this.dragObject}isSoftclipped(){const z=this.trackViews.find((z=>true===z.track.showSoftClips));return void 0!==z}
/**
         * Track drag here refers to vertical dragging to reorder tracks, not horizontal panning.
         *
         * @param trackView
         */startTrackDrag(z){this.dragTrack=z}
/**
         * Track drag here refers to vertical dragging to reorder tracks, not horizontal panning.
         *
         * @param dragDestination
         */updateTrackDrag(z){if(z&&this.dragTrack){const K=this.dragTrack;const ee=this.trackViews.indexOf(z);const te=this.trackViews.indexOf(K);const ne=this.trackViews;ne[ee]=K;ne[te]=z;const re=this.trackViews[ee].track.order;this.trackViews[te].track.order=re;const ie=ne.length;let se=re;if(ee<te)for(let z=ee+1;z<ie;z++){const K=ne[z].track;if(!(K.order<=se))break;K.order=Math.min(Number.MAX_SAFE_INTEGER,se+1);se=K.order}else for(let z=ee-1;z>0;z--){const K=ne[z].track;if(!(K.order>=se))break;K.order=Math.max(-Number.MAX_SAFE_INTEGER,se-1);se=K.order}this.reorderTracks()}}endTrackDrag(){if(this.dragTrack){this.dragTrack=void 0;this.fireEvent("trackorderchanged",[this.getTrackOrder()])}else this.dragTrack=void 0}addMouseHandlers(){this.addWindowResizeHandler();this.addRootMouseUpHandler();this.addRootMouseLeaveHandler();this.addColumnContainerEventHandlers()}removeMouseHandlers(){this.removeWindowResizeHandler();this.removeRootMouseUpHandler();this.removeRootMouseLeaveHandler();this.removeColumnContainerEventHandlers()}addWindowResizeHandler(){this.boundWindowResizeHandler=resize.bind(this);window.addEventListener("resize",this.boundWindowResizeHandler)}removeWindowResizeHandler(){window.removeEventListener("resize",this.boundWindowResizeHandler)}addRootMouseUpHandler(){this.boundRootMouseUpHandler=mouseUpOrLeave.bind(this);this.root.addEventListener("mouseup",this.boundRootMouseUpHandler)}removeRootMouseUpHandler(){this.root.removeEventListener("mouseup",this.boundRootMouseUpHandler)}addRootMouseLeaveHandler(){this.boundRootMouseLeaveHandler=mouseUpOrLeave.bind(this);this.root.addEventListener("mouseleave",this.boundRootMouseLeaveHandler)}removeRootMouseLeaveHandler(){this.root.removeEventListener("mouseleave",this.boundRootMouseLeaveHandler)}addColumnContainerEventHandlers(){this.boundColumnContainerMouseMoveHandler=handleMouseMove.bind(this);this.boundColumnContainerTouchMoveHandler=handleMouseMove.bind(this);this.boundColumnContainerMouseLeaveHandler=mouseUpOrLeave.bind(this);this.boundColumnContainerMouseUpHandler=mouseUpOrLeave.bind(this);this.boundColumnContainerTouchEndHandler=mouseUpOrLeave.bind(this);this.columnContainer.addEventListener("mousemove",this.boundColumnContainerMouseMoveHandler);this.columnContainer.addEventListener("touchmove",this.boundColumnContainerTouchMoveHandler);this.columnContainer.addEventListener("mouseleave",this.boundColumnContainerMouseLeaveHandler);this.columnContainer.addEventListener("mouseup",this.boundColumnContainerMouseUpHandler);this.columnContainer.addEventListener("touchend",this.boundColumnContainerTouchEndHandler)}removeColumnContainerEventHandlers(){this.columnContainer.removeEventListener("mousemove",this.boundColumnContainerMouseMoveHandler);this.columnContainer.removeEventListener("touchmove",this.boundColumnContainerTouchMoveHandler);this.columnContainer.removeEventListener("mouseleave",this.boundColumnContainerMouseLeaveHandler);this.columnContainer.removeEventListener("mouseup",this.boundColumnContainerMouseUpHandler);this.columnContainer.removeEventListener("touchend",this.boundColumnContainerTouchEndHandler)}static uncompressSession(z){let K;if(z.indexOf("/gzip;base64")>0){K=decodeDataURI$1(z);let ee="";for(let z of K)ee+=String.fromCharCode(z);return ee}{let K=z.substring(5);return uncompressString(K)}}createCircularView(z,K){K=true===K;this.circularView=createCircularView(z,this);this.circularViewControl=new CircularViewControl(this.$toggle_button_container.get(0),this);this.circularView.setAssembly({name:this.genome.id,id:this.genome.id,chromosomes:makeCircViewChromosomes(this.genome)});this.circularViewVisible=K;return this.circularView}get circularViewVisible(){return void 0!==this.circularView&&this.circularView.visible}set circularViewVisible(z){if(this.circularView){this.circularView.visible=z;this.circularViewControl.setState(z)}}}
/**
     * Function called win window is resized, or visibility changed (e.g. "show" from a tab).  This is a function rather
     * than class method because it needs to be copied and bound to specific instances of browser to support listener
     * removal
     *
     * @returns {Promise<void>}
     */async function resize(){if(!this.referenceFrameList)return;const z=this.calculateViewportWidth(this.referenceFrameList.length);for(let K of this.referenceFrameList){const ee=this.referenceFrameList.indexOf(K);const{chr:te,genome:ne}=K;const{bpLength:re}=ne.getChromosome(K.chr);const ie=K.toBP(z);Ma.isWholeGenomeView(te)||ie>re?K.bpPerPixel=re/z:K.end=K.start+K.toBP(z);for(let{viewports:K}of this.trackViews)K[ee].setWidth(z)}this.updateUIWithReferenceFrameList();await this.updateViews(true)}function handleMouseMove(z){z.preventDefault();const{x:K,y:ee}=gt.pageCoordinates(z);if(this.vpMouseDown){const{viewport:z,referenceFrame:te}=this.vpMouseDown;const ne=Math.abs(K-this.vpMouseDown.mouseDownX)>Math.abs(ee-this.vpMouseDown.mouseDownY);if(!this.dragObject&&!this.isScrolling)if(ne)this.vpMouseDown.mouseDownX&&Math.abs(K-this.vpMouseDown.mouseDownX)>this.constants.dragThreshold&&(this.dragObject={viewport:z,start:te.start});else if(this.vpMouseDown.mouseDownY&&Math.abs(ee-this.vpMouseDown.mouseDownY)>this.constants.scrollThreshold){this.isScrolling=true;const K=z.$viewport.height();const ee=z.trackView.maxViewportContentHeight();this.vpMouseDown.r=K/ee}if(this.dragObject){const ee=!this.isSoftclipped();let ne=this.vpMouseDown.lastMouseX-K;const re=te.shiftPixels(ne,z.$viewport.width(),ee);re&&this.updateViews();this.fireEvent("trackdrag")}if(this.isScrolling){const K=this.vpMouseDown.r*(this.vpMouseDown.lastMouseY-ee);z.trackView.moveScroller(K)}this.vpMouseDown.lastMouseX=K;this.vpMouseDown.lastMouseY=ee}}function mouseUpOrLeave(z){this.cancelTrackPan();this.endTrackDrag()}function getInitialLocus(z,K){return z?Array.isArray(z)?z.join(" "):z:K.getHomeChromosomeName()}function logo(){return pt('<svg width="690px" height="324px" viewBox="0 0 690 324" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>IGV</title><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="IGV" fill="#666666"><polygon id="Path" points="379.54574 8.00169252 455.581247 8.00169252 515.564813 188.87244 532.884012 253.529506 537.108207 253.529506 554.849825 188.87244 614.833392 8.00169252 689.60164 8.00169252 582.729511 320.722144 486.840288 320.722144"></polygon><path d="M261.482414,323.793286 C207.975678,323.793286 168.339046,310.552102 142.571329,284.069337 C116.803612,257.586572 103.919946,217.158702 103.919946,162.784513 C103.919946,108.410325 117.437235,67.8415913 144.472217,41.0770945 C171.507199,14.3125977 212.903894,0.930550071 268.663545,0.930550071 C283.025879,0.930550071 298.232828,1.84616386 314.284849,3.6774189 C330.33687,5.50867394 344.839793,7.97378798 357.794056,11.072835 L357.794056,68.968378 C339.48912,65.869331 323.578145,63.5450806 310.060654,61.9955571 C296.543163,60.4460336 284.574731,59.6712835 274.154998,59.6712835 C255.850062,59.6712835 240.502308,61.4320792 228.111274,64.9537236 C215.720241,68.4753679 205.793482,74.2507779 198.330701,82.2801269 C190.867919,90.309476 185.587729,100.87425 182.48997,113.974767 C179.392212,127.075284 177.843356,143.345037 177.843356,162.784513 C177.843356,181.942258 179.251407,198.000716 182.067551,210.960367 C184.883695,223.920018 189.671068,234.41436 196.429813,242.443709 C203.188559,250.473058 212.059279,256.178037 223.042241,259.558815 C234.025202,262.939594 247.683295,264.629958 264.01693,264.629958 C268.241146,264.629958 273.098922,264.489094 278.590403,264.207362 C284.081883,263.925631 289.643684,263.50304 295.275972,262.939577 L295.275972,159.826347 L361.595831,159.826347 L361.595831,308.579859 C344.698967,313.087564 327.239137,316.750019 309.215815,319.567334 C291.192494,322.38465 275.281519,323.793286 261.482414,323.793286 L261.482414,323.793286 L261.482414,323.793286 Z" id="Path"></path>;<polygon id="Path" points="0.81355666 5.00169252 73.0472883 5.00169252 73.0472883 317.722144 0.81355666 317.722144"></polygon></g> </g> </svg>')}function toggleTrackLabels(z,K){for(let{viewports:ee}of z)for(let z of ee)z.$trackLabel&&(0===ee.indexOf(z)&&true===K?z.$trackLabel.show():z.$trackLabel.hide())}let Cp=[];
/**
     * Create an igv.browser instance.  This object defines the public API for interacting with the genome browser.
     *
     * @param parentDiv - DOM tree root
     * @param config - configuration options.
     *
     */async function createBrowser(z,K){void 0===K&&(K={});Ma.KNOWN_GENOMES||await Ma.initializeGenomes(K);setDefaults(K);K.queryParametersSupported&&extractQuery(K);K.apiKey&&Wo.setApiKey(K.apiKey);K.oauthToken&&Wo.setOauthToken(K.oauthToken);K.clientId&&!isInitialized()&&await init$1({clientId:K.clientId,apiKey:K.apiKey,scope:"https://www.googleapis.com/auth/userinfo.profile"});const ee=new Browser(K,z);Cp.push(ee);K.sessionURL?await ee.loadSession({url:K.sessionURL}):await ee.loadSessionObject(K);ee.navbarManager.navbarDidResize(ee.$navigation.width());return ee}function removeBrowser(z){z.dispose();z.root.remove();Cp=Cp.filter((K=>K!==z))}function removeAllBrowsers(){for(let z of Cp){z.dispose();z.root.remove()}Cp=[]}async function visibilityChange(){for(let z of Cp)await z.visibilityChange()}function setDefaults(z){void 0===z.minimumBases&&(z.minimumBases=40);void 0===z.showIdeogram&&(z.showIdeogram=true);void 0===z.showCircularView&&(z.showCircularView=false);void 0===z.showCircularViewButton&&(z.showCircularViewButton=false);void 0===z.showTrackLabelButton&&(z.showTrackLabelButton=true);void 0===z.showTrackLabels&&(z.showTrackLabels=true);void 0===z.showROITableButton&&(z.showROITableButton=false);void 0===z.showROITable&&(z.showROITable=false);void 0===z.showCursorTrackingGuideButton&&(z.showCursorTrackingGuideButton=true);void 0===z.showCursorGuide&&(z.showCursorGuide=z.showCursorTrackingGuide||false);void 0===z.showCenterGuideButton&&(z.showCenterGuideButton=true);void 0===z.showCenterGuide&&(z.showCenterGuide=false);void 0===z.showSampleNames&&(z.showSampleNames=false);void 0===z.showSVGButton&&(z.showSVGButton=true);void 0===z.showControls&&(z.showControls=true);void 0===z.showNavigation&&(z.showNavigation=true);void 0===z.showRuler&&(z.showRuler=true);void 0===z.flanking&&(z.flanking=1e3);void 0===z.pairsSupported&&(z.pairsSupported=true);z.tracks||(z.tracks=[])}function extractQuery(z){var K,ee,te,ne,re,ie,se,oe,ae,le;oe=window.location.href;ie={};K=oe.indexOf("?");ee=oe.lastIndexOf("#");let ce;let he;let ue;if(K>=0){ee<0&&(ee=oe.length);for(te=K+1;te<ee;){ne=oe.indexOf("&",te);ne<0&&(ne=ee);re=oe.substring(te,ne);se=re.split("=",2);if(2===se.length){ae=se[0];le=decodeURIComponent(se[1]);"file"===ae?ce=le.split(","):"index"===ae?he=le.split(","):"name"===ae?ue=le.split(","):"genome"!==ae||!le.startsWith("https://")&&!le.startsWith("http://")||le.endsWith(".json")?z[ae]=le:z.reference={fastaURL:le,indexURL:le+".fai"};te=ne+1}else te++}}if(ce){z.tracks||(z.tracks=[]);for(let K=0;K<ce.length;K++){if(ce[K].endsWith(".xml")||ce[K].endsWith(".json")){z.sessionURL=ce[K];break}const ee={url:ce[K]};he&&he.length>K&&(ee.indexURL=he[K]);ue&&ue.length>K&&(ee.name=ue[K]);z.tracks.push(ee)}}return ie}async function createTrack(z,K){return await Browser.prototype.createTrack.call(K,z)}function embedCSS(){var z='.igv-navbar {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n  box-sizing: border-box;\n  width: 100%;\n  color: #444;\n  font-size: 12px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n  line-height: 32px;\n  padding-left: 8px;\n  padding-right: 8px;\n  margin-top: 2px;\n  margin-bottom: 6px;\n  height: 32px;\n  border-style: solid;\n  border-radius: 3px;\n  border-width: thin;\n  border-color: #bfbfbf;\n  background-color: #f3f3f3;\n}\n.igv-navbar .igv-navbar-left-container {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n  height: 32px;\n  line-height: 32px;\n}\n.igv-navbar .igv-navbar-left-container .igv-logo {\n  width: 34px;\n  height: 32px;\n  margin-right: 8px;\n}\n.igv-navbar .igv-navbar-left-container .igv-current-genome {\n  height: 32px;\n  margin-left: 4px;\n  margin-right: 4px;\n  user-select: none;\n  line-height: 32px;\n  vertical-align: middle;\n  text-align: center;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n  height: 100%;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location .igv-chromosome-select-widget-container {\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n  height: 100%;\n  width: 125px;\n  margin-right: 4px;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location .igv-chromosome-select-widget-container select {\n  display: block;\n  cursor: pointer;\n  width: 100px;\n  height: 75%;\n  outline: none;\n  font-size: 12px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location .igv-locus-size-group {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n  margin-left: 8px;\n  height: 22px;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location .igv-locus-size-group .igv-search-container {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  width: 210px;\n  height: 22px;\n  line-height: 22px;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location .igv-locus-size-group .igv-search-container input.igv-search-input {\n  cursor: text;\n  width: 85%;\n  height: 22px;\n  line-height: 22px;\n  font-size: 12px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n  text-align: left;\n  padding-left: 8px;\n  margin-right: 8px;\n  outline: none;\n  border-style: solid;\n  border-radius: 3px;\n  border-width: thin;\n  border-color: #bfbfbf;\n  background-color: white;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location .igv-locus-size-group .igv-search-container .igv-search-icon-container {\n  cursor: pointer;\n  height: 16px;\n  width: 16px;\n}\n.igv-navbar .igv-navbar-left-container .igv-navbar-genomic-location .igv-locus-size-group .igv-windowsize-panel-container {\n  margin-left: 4px;\n  user-select: none;\n}\n.igv-navbar .igv-navbar-right-container {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n  height: 32px;\n  line-height: 32px;\n}\n.igv-navbar .igv-navbar-right-container .igv-navbar-toggle-button-container {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n  height: 100%;\n}\n.igv-navbar .igv-navbar-right-container .igv-navbar-toggle-button-container div {\n  margin-left: 0;\n  margin-right: 4px;\n}\n.igv-navbar .igv-navbar-right-container .igv-navbar-toggle-button-container div:last-child {\n  margin-left: 0;\n  margin-right: 0;\n}\n.igv-navbar .igv-navbar-right-container .igv-navbar-toggle-button-container-750 {\n  display: none;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget {\n  color: #737373;\n  font-size: 18px;\n  height: 32px;\n  line-height: 32px;\n  margin-left: 8px;\n  user-select: none;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget div {\n  cursor: pointer;\n  margin-left: unset;\n  margin-right: unset;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget div:first-child {\n  height: 24px;\n  width: 24px;\n  margin-left: unset;\n  margin-right: 8px;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget div:last-child {\n  height: 24px;\n  width: 24px;\n  margin-left: 8px;\n  margin-right: unset;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget div:nth-child(even) {\n  display: block;\n  height: fit-content;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget input {\n  display: block;\n  width: 125px;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget svg {\n  display: block;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-900 {\n  color: #737373;\n  font-size: 18px;\n  height: 32px;\n  line-height: 32px;\n  margin-left: 8px;\n  user-select: none;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-900 div {\n  cursor: pointer;\n  margin-left: unset;\n  margin-right: unset;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-900 div:first-child {\n  height: 24px;\n  width: 24px;\n  margin-left: unset;\n  margin-right: 8px;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-900 div:last-child {\n  height: 24px;\n  width: 24px;\n  margin-left: 8px;\n  margin-right: unset;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-900 div:nth-child(even) {\n  width: 0;\n  height: 0;\n  display: none;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-900 input {\n  width: 0;\n  height: 0;\n  display: none;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-900 svg {\n  display: block;\n}\n.igv-navbar .igv-navbar-right-container .igv-zoom-widget-hidden {\n  display: none;\n}\n\n.igv-navbar-button {\n  display: block;\n  box-sizing: unset;\n  padding-left: 6px;\n  padding-right: 6px;\n  height: 18px;\n  text-transform: capitalize;\n  user-select: none;\n  line-height: 18px;\n  text-align: center;\n  vertical-align: middle;\n  font-family: "Open Sans", sans-serif;\n  font-size: 11px;\n  font-weight: 200;\n  color: #737373;\n  background-color: #f3f3f3;\n  border-color: #737373;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 6px;\n}\n\n.igv-navbar-button-clicked {\n  color: white;\n  background-color: #737373;\n}\n\n.igv-navbar-button:hover {\n  cursor: pointer;\n}\n\n.igv-zoom-in-notice-container {\n  z-index: 1024;\n  position: absolute;\n  top: 8px;\n  left: 50%;\n  transform: translate(-50%, 0%);\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  justify-content: center;\n  align-items: center;\n  background-color: white;\n}\n.igv-zoom-in-notice-container > div {\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-top: 2px;\n  padding-bottom: 2px;\n  width: 100%;\n  height: 100%;\n  font-family: "Open Sans", sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  color: #3f3f3f;\n}\n\n.igv-zoom-in-notice {\n  position: absolute;\n  top: 10px;\n  left: 50%;\n}\n.igv-zoom-in-notice div {\n  position: relative;\n  left: -50%;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  color: #3f3f3f;\n  background-color: rgba(255, 255, 255, 0.51);\n  z-index: 64;\n}\n\n.igv-container-spinner {\n  position: absolute;\n  top: 90%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1024;\n  width: 24px;\n  height: 24px;\n  pointer-events: none;\n  color: #737373;\n}\n\n.igv-multi-locus-close-button {\n  position: absolute;\n  top: 2px;\n  right: 0;\n  padding-left: 2px;\n  padding-right: 2px;\n  width: 12px;\n  height: 12px;\n  color: #666666;\n  background-color: white;\n  z-index: 1000;\n}\n.igv-multi-locus-close-button > svg {\n  vertical-align: top;\n}\n\n.igv-multi-locus-close-button:hover {\n  cursor: pointer;\n  color: #434343;\n}\n\n.igv-multi-locus-ruler-label {\n  z-index: 64;\n  position: absolute;\n  top: 2px;\n  left: 0;\n  width: 100%;\n  height: 12px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: center;\n  align-items: center;\n}\n.igv-multi-locus-ruler-label > div {\n  font-family: "Open Sans", sans-serif;\n  font-size: 12px;\n  color: rgb(16, 16, 16);\n  background-color: white;\n}\n.igv-multi-locus-ruler-label > div {\n  cursor: pointer;\n}\n\n.igv-multi-locus-ruler-label-square-dot {\n  z-index: 64;\n  position: absolute;\n  left: 50%;\n  top: 5%;\n  transform: translate(-50%, 0%);\n  background-color: white;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-multi-locus-ruler-label-square-dot > div:first-child {\n  width: 14px;\n  height: 14px;\n}\n.igv-multi-locus-ruler-label-square-dot > div:last-child {\n  margin-left: 16px;\n  font-family: "Open Sans", sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  color: rgb(16, 16, 16);\n}\n\n.igv-ruler-sweeper {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  top: 26px;\n  bottom: 0;\n  left: 0;\n  width: 0;\n  z-index: 99999;\n  background-color: rgba(68, 134, 247, 0.25);\n}\n\n.igv-ruler-tooltip {\n  pointer-events: none;\n  z-index: 128;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 1px;\n  height: 32px;\n  background-color: transparent;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-ruler-tooltip > div {\n  pointer-events: none;\n  width: 128px;\n  height: auto;\n  padding: 1px;\n  color: #373737;\n  font-size: 10px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n  background-color: white;\n  border-style: solid;\n  border-width: thin;\n  border-color: #373737;\n}\n\n.igv-track-label {\n  position: absolute;\n  left: 8px;\n  top: 8px;\n  width: auto;\n  height: auto;\n  max-width: 50%;\n  padding-left: 4px;\n  padding-right: 4px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-family: "Open Sans", sans-serif;\n  font-size: small;\n  font-weight: 400;\n  text-align: center;\n  user-select: none;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  border-color: #444;\n  border-radius: 2px;\n  border-style: solid;\n  border-width: thin;\n  background-color: white;\n  z-index: 128;\n  cursor: pointer;\n}\n\n.igv-track-label:hover,\n.igv-track-label:focus,\n.igv-track-label:active {\n  background-color: #e8e8e8;\n}\n\n.igv-track-label-popup-shim {\n  padding-left: 8px;\n  padding-right: 8px;\n  padding-top: 4px;\n}\n\n.igv-center-line {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  z-index: 8;\n  user-select: none;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  border-left-style: dashed;\n  border-left-width: thin;\n  border-right-style: dashed;\n  border-right-width: thin;\n}\n\n.igv-center-line-wide {\n  background-color: rgba(0, 0, 0, 0);\n  border-left-color: rgba(127, 127, 127, 0.51);\n  border-right-color: rgba(127, 127, 127, 0.51);\n}\n\n.igv-center-line-thin {\n  background-color: rgba(0, 0, 0, 0);\n  border-left-color: rgba(127, 127, 127, 0.51);\n  border-right-color: rgba(0, 0, 0, 0);\n}\n\n.igv-cursor-guide-horizontal {\n  display: none;\n  pointer-events: none;\n  user-select: none;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 50%;\n  height: 1px;\n  z-index: 1;\n  margin-left: 50px;\n  margin-right: 54px;\n  border-top-style: dotted;\n  border-top-width: thin;\n  border-top-color: rgba(127, 127, 127, 0.76);\n}\n\n.igv-cursor-guide-vertical {\n  pointer-events: none;\n  user-select: none;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 50%;\n  width: 1px;\n  z-index: 1;\n  border-left-style: dotted;\n  border-left-width: thin;\n  border-left-color: rgba(127, 127, 127, 0.76);\n  display: none;\n}\n\n.igv-user-feedback {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 512px;\n  height: 360px;\n  z-index: 2048;\n  background-color: white;\n  border-color: #a2a2a2;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  color: #444;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-user-feedback div:first-child {\n  position: relative;\n  height: 24px;\n  width: 100%;\n  background-color: white;\n  border-bottom-color: #a2a2a2;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n}\n.igv-user-feedback div:first-child div {\n  position: absolute;\n  top: 2px;\n  width: 16px;\n  height: 16px;\n  background-color: transparent;\n}\n.igv-user-feedback div:first-child div:first-child {\n  left: 8px;\n}\n.igv-user-feedback div:first-child div:last-child {\n  cursor: pointer;\n  right: 8px;\n}\n.igv-user-feedback div:last-child {\n  width: 100%;\n  height: calc(100% - 24px);\n  border-width: 0;\n}\n.igv-user-feedback div:last-child div {\n  width: auto;\n  height: auto;\n  margin: 8px;\n}\n\n.igv-generic-dialog-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 300px;\n  height: 200px;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  z-index: 2048;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-generic-dialog-container .igv-generic-dialog-header {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  width: 100%;\n  height: 24px;\n  cursor: move;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-color: #7F7F7F;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n}\n.igv-generic-dialog-container .igv-generic-dialog-header div {\n  margin-right: 4px;\n  margin-bottom: 2px;\n  height: 12px;\n  width: 12px;\n  color: #7F7F7F;\n}\n.igv-generic-dialog-container .igv-generic-dialog-header div:hover {\n  cursor: pointer;\n  color: #444;\n}\n.igv-generic-dialog-container .igv-generic-dialog-one-liner {\n  color: #373737;\n  width: 95%;\n  height: 24px;\n  line-height: 24px;\n  text-align: left;\n  margin-top: 8px;\n  padding-left: 8px;\n  overflow-wrap: break-word;\n  background-color: white;\n}\n.igv-generic-dialog-container .igv-generic-dialog-label-input {\n  margin-top: 8px;\n  width: 95%;\n  height: 24px;\n  color: #373737;\n  line-height: 24px;\n  padding-left: 8px;\n  background-color: white;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-generic-dialog-container .igv-generic-dialog-label-input div {\n  width: 30%;\n  height: 100%;\n  font-size: 16px;\n  text-align: right;\n  padding-right: 8px;\n  background-color: white;\n}\n.igv-generic-dialog-container .igv-generic-dialog-label-input input {\n  display: block;\n  height: 100%;\n  width: 100%;\n  padding-left: 4px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n  color: #373737;\n  text-align: left;\n  outline: none;\n  border-style: solid;\n  border-width: thin;\n  border-color: #7F7F7F;\n  background-color: white;\n}\n.igv-generic-dialog-container .igv-generic-dialog-label-input input {\n  width: 50%;\n  font-size: 16px;\n}\n.igv-generic-dialog-container .igv-generic-dialog-input {\n  margin-top: 8px;\n  width: calc(100% - 16px);\n  height: 24px;\n  color: #373737;\n  line-height: 24px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-generic-dialog-container .igv-generic-dialog-input input {\n  display: block;\n  height: 100%;\n  width: 100%;\n  padding-left: 4px;\n  font-family: "Open Sans", sans-serif;\n  font-weight: 400;\n  color: #373737;\n  text-align: left;\n  outline: none;\n  border-style: solid;\n  border-width: thin;\n  border-color: #7F7F7F;\n  background-color: white;\n}\n.igv-generic-dialog-container .igv-generic-dialog-input input {\n  font-size: 16px;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok-cancel {\n  width: 100%;\n  height: 28px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok-cancel div {\n  margin-top: 32px;\n  color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  width: 75px;\n  height: 28px;\n  line-height: 28px;\n  text-align: center;\n  border-color: transparent;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 2px;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok-cancel div:first-child {\n  margin-left: 32px;\n  margin-right: 0;\n  background-color: #5ea4e0;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok-cancel div:last-child {\n  margin-left: 0;\n  margin-right: 32px;\n  background-color: #c4c4c4;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok-cancel div:first-child:hover {\n  cursor: pointer;\n  background-color: #3b5c7f;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok-cancel div:last-child:hover {\n  cursor: pointer;\n  background-color: #7f7f7f;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok {\n  width: 100%;\n  height: 36px;\n  margin-top: 32px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok div {\n  width: 98px;\n  height: 36px;\n  line-height: 36px;\n  text-align: center;\n  color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  border-color: white;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 4px;\n  background-color: #2B81AF;\n}\n.igv-generic-dialog-container .igv-generic-dialog-ok div:hover {\n  cursor: pointer;\n  background-color: #25597f;\n}\n\n.igv-generic-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 2048;\n  background-color: white;\n  cursor: pointer;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-generic-container div:first-child {\n  cursor: move;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  height: 24px;\n  width: 100%;\n  background-color: #dddddd;\n}\n.igv-generic-container div:first-child i {\n  display: block;\n  color: #5f5f5f;\n  cursor: pointer;\n  width: 14px;\n  height: 14px;\n  margin-right: 8px;\n  margin-bottom: 4px;\n}\n\n.igv-menu-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: max-content;\n  z-index: 4096;\n  cursor: pointer;\n  font-family: "Open Sans", sans-serif;\n  font-size: small;\n  font-weight: 400;\n  color: #4b4b4b;\n  background: white;\n  border-radius: 4px;\n  border-color: #7F7F7F;\n  border-style: solid;\n  border-width: thin;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-end;\n  text-align: left;\n}\n.igv-menu-popup > div:not(:first-child) {\n  width: 100%;\n}\n.igv-menu-popup > div:not(:first-child) > div {\n  background: white;\n}\n.igv-menu-popup > div:not(:first-child) > div.context-menu {\n  padding-left: 4px;\n  padding-right: 4px;\n}\n.igv-menu-popup > div:not(:first-child) > div:last-child {\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n  border-bottom-color: transparent;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n}\n.igv-menu-popup > div:not(:first-child) > div:hover {\n  background: #efefef;\n}\n\n.igv-menu-popup-shim {\n  padding-left: 8px;\n  padding-right: 8px;\n  padding-bottom: 1px;\n  padding-top: 1px;\n}\n\n.igv-menu-popup-header {\n  position: relative;\n  width: 100%;\n  height: 24px;\n  cursor: move;\n  border-top-color: transparent;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-color: #7F7F7F;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n}\n.igv-menu-popup-header div {\n  margin-right: 4px;\n  height: 12px;\n  width: 12px;\n  color: #7F7F7F;\n}\n.igv-menu-popup-header div:hover {\n  cursor: pointer;\n  color: #444;\n}\n\n.igv-menu-popup-check-container {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  width: 100%;\n  height: 20px;\n  margin-right: 4px;\n  background-color: transparent;\n}\n.igv-menu-popup-check-container div {\n  padding-top: 2px;\n  padding-left: 8px;\n}\n.igv-menu-popup-check-container div:first-child {\n  position: relative;\n  width: 12px;\n  height: 12px;\n}\n.igv-menu-popup-check-container div:first-child svg {\n  position: absolute;\n  width: 12px;\n  height: 12px;\n}\n\n.igv-user-feedback {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 512px;\n  height: 360px;\n  z-index: 2048;\n  background-color: white;\n  border-color: #a2a2a2;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  color: #444;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n}\n.igv-user-feedback div:first-child {\n  position: relative;\n  height: 24px;\n  width: 100%;\n  background-color: white;\n  border-bottom-color: #a2a2a2;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n}\n.igv-user-feedback div:first-child div {\n  position: absolute;\n  top: 2px;\n  width: 16px;\n  height: 16px;\n  background-color: transparent;\n}\n.igv-user-feedback div:first-child div:first-child {\n  left: 8px;\n}\n.igv-user-feedback div:first-child div:last-child {\n  cursor: pointer;\n  right: 8px;\n}\n.igv-user-feedback div:last-child {\n  width: 100%;\n  height: calc(100% - 24px);\n  border-width: 0;\n}\n.igv-user-feedback div:last-child div {\n  width: auto;\n  height: auto;\n  margin: 8px;\n}\n\n.igv-loading-spinner-container {\n  z-index: 1024;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 32px;\n  height: 32px;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  justify-content: center;\n  align-items: center;\n}\n.igv-loading-spinner-container > div {\n  box-sizing: border-box;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  border: 4px solid rgba(128, 128, 128, 0.5);\n  border-top-color: rgb(255, 255, 255);\n  animation: spin 1s ease-in-out infinite;\n  -webkit-animation: spin 1s ease-in-out infinite;\n}\n\n@keyframes spin {\n  to {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n@-webkit-keyframes spin {\n  to {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n.igv-roi-menu-next-gen {\n  position: absolute;\n  z-index: 512;\n  font-family: "Open Sans", sans-serif;\n  font-size: small;\n  font-weight: 400;\n  color: #4b4b4b;\n  background-color: white;\n  width: 192px;\n  border-radius: 4px;\n  border-color: #7F7F7F;\n  border-style: solid;\n  border-width: thin;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n}\n.igv-roi-menu-next-gen > div:first-child {\n  height: 24px;\n  border-top-color: transparent;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-color: #7F7F7F;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n}\n.igv-roi-menu-next-gen > div:first-child > div {\n  margin-right: 4px;\n  height: 12px;\n  width: 12px;\n  color: #7F7F7F;\n}\n.igv-roi-menu-next-gen > div:first-child > div:hover {\n  cursor: pointer;\n  color: #444;\n}\n.igv-roi-menu-next-gen > div:last-child {\n  background-color: white;\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n  border-bottom-color: transparent;\n  border-bottom-style: solid;\n  border-bottom-width: 0;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n  text-align: start;\n  vertical-align: middle;\n}\n.igv-roi-menu-next-gen > div:last-child > div {\n  height: 24px;\n  padding-left: 4px;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  border-bottom-color: #7f7f7f;\n}\n.igv-roi-menu-next-gen > div:last-child > div:not(:first-child):hover {\n  background-color: rgba(127, 127, 127, 0.1);\n}\n.igv-roi-menu-next-gen > div:last-child div:first-child {\n  font-style: italic;\n  text-align: center;\n  padding-right: 4px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.igv-roi-menu-next-gen > div:last-child > div:last-child {\n  border-bottom-width: 0;\n  border-bottom-color: transparent;\n}\n\n.igv-roi-placeholder {\n  font-style: normal;\n  color: rgba(75, 75, 75, 0.6);\n}\n\n.igv-roi-table {\n  position: absolute;\n  z-index: 1024;\n  width: min-content;\n  max-width: 1600px;\n  border-color: #7f7f7f;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: 12px;\n  font-weight: 400;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n  cursor: default;\n}\n.igv-roi-table > div {\n  height: 24px;\n  font-size: 14px;\n  text-align: start;\n  vertical-align: middle;\n  line-height: 24px;\n}\n.igv-roi-table > div:first-child {\n  border-color: transparent;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-top-width: 0;\n  border-bottom-color: #7f7f7f;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n  background-color: #eee;\n  cursor: move;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center;\n}\n.igv-roi-table > div:first-child > div:first-child {\n  text-align: center;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  margin-left: 4px;\n  margin-right: 4px;\n  width: calc(100% - 4px - 12px);\n}\n.igv-roi-table > div:first-child > div:last-child {\n  margin-right: 4px;\n  margin-bottom: 2px;\n  height: 12px;\n  width: 12px;\n  color: #7f7f7f;\n}\n.igv-roi-table > div:first-child > div:last-child > svg {\n  display: block;\n}\n.igv-roi-table > div:first-child > div:last-child:hover {\n  cursor: pointer;\n  color: #444;\n}\n.igv-roi-table > .igv-roi-table-description {\n  padding: 4px;\n  margin-left: 4px;\n  word-break: break-all;\n  overflow-y: auto;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  background-color: transparent;\n}\n.igv-roi-table > .igv-roi-table-goto-explainer {\n  margin-top: 5px;\n  margin-left: 4px;\n  color: #7F7F7F;\n  font-style: italic;\n  height: 24px;\n  border-top: solid lightgray;\n  background-color: transparent;\n}\n.igv-roi-table > .igv-roi-table-column-titles {\n  height: 24px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: stretch;\n  align-items: stretch;\n  padding-right: 16px;\n  background-color: white;\n  border-top-color: #7f7f7f;\n  border-top-style: solid;\n  border-top-width: thin;\n  border-bottom-color: #7f7f7f;\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n}\n.igv-roi-table > .igv-roi-table-column-titles > div {\n  font-size: 14px;\n  vertical-align: middle;\n  line-height: 24px;\n  text-align: left;\n  margin-left: 4px;\n  height: 24px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  border-right-color: #7f7f7f;\n  border-right-style: solid;\n  border-right-width: thin;\n}\n.igv-roi-table > .igv-roi-table-column-titles > div:last-child {\n  border-right: unset;\n}\n.igv-roi-table > .igv-roi-table-row-container {\n  overflow: auto;\n  resize: both;\n  max-width: 1600px;\n  height: 360px;\n  background-color: transparent;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n}\n.igv-roi-table > .igv-roi-table-row-container > .igv-roi-table-row {\n  height: 24px;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: stretch;\n  align-items: stretch;\n}\n.igv-roi-table > .igv-roi-table-row-container > .igv-roi-table-row > div {\n  font-size: 14px;\n  vertical-align: middle;\n  line-height: 24px;\n  text-align: left;\n  margin-left: 4px;\n  height: 24px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  border-right-color: transparent;\n  border-right-style: solid;\n  border-right-width: thin;\n}\n.igv-roi-table > .igv-roi-table-row-container > .igv-roi-table-row > div:last-child {\n  border-right: unset;\n}\n.igv-roi-table > .igv-roi-table-row-container > .igv-roi-table-row-hover {\n  background-color: rgba(0, 0, 0, 0.04);\n}\n.igv-roi-table > div:last-child {\n  height: 32px;\n  line-height: 32px;\n  border-top-color: #7f7f7f;\n  border-top-style: solid;\n  border-top-width: thin;\n  border-bottom-color: transparent;\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n  border-bottom-width: 0;\n  background-color: #eee;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: space-around;\n  align-items: center;\n}\n\n.igv-roi-table-row-selected {\n  background-color: rgba(0, 0, 0, 0.125);\n}\n\n.igv-roi-table-button {\n  cursor: pointer;\n  height: 20px;\n  user-select: none;\n  line-height: 20px;\n  text-align: center;\n  vertical-align: middle;\n  font-family: "Open Sans", sans-serif;\n  font-size: 13px;\n  font-weight: 400;\n  color: black;\n  padding-left: 6px;\n  padding-right: 6px;\n  background-color: rgb(239, 239, 239);\n  border-color: black;\n  border-style: solid;\n  border-width: thin;\n  border-radius: 3px;\n}\n\n.igv-roi-table-button:hover {\n  font-weight: 400;\n  background-color: rgba(0, 0, 0, 0.13);\n}\n\n.igv-roi-region {\n  z-index: 64;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  pointer-events: none;\n  overflow: visible;\n  margin-top: 44px;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n}\n.igv-roi-region > div {\n  position: relative;\n  width: 100%;\n  height: 8px;\n  pointer-events: auto;\n}\n\n.igv-roi-menu {\n  position: absolute;\n  z-index: 1024;\n  width: 144px;\n  border-color: #7f7f7f;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n}\n.igv-roi-menu > div:not(:last-child) {\n  border-bottom-color: rgba(128, 128, 128, 0.5);\n  border-bottom-style: solid;\n  border-bottom-width: thin;\n}\n.igv-roi-menu > div:first-child {\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-top-color: transparent;\n  border-top-style: solid;\n  border-top-width: 0;\n}\n.igv-roi-menu > div:last-child {\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n  border-bottom-color: transparent;\n  border-bottom-style: solid;\n  border-bottom-width: 0;\n}\n\n.igv-roi-menu-row {\n  height: 24px;\n  padding-left: 8px;\n  font-size: small;\n  text-align: start;\n  vertical-align: middle;\n  line-height: 24px;\n  background-color: white;\n}\n\n.igv-roi-menu-row-edit-description {\n  width: -webkit-fill-available;\n  font-size: small;\n  text-align: start;\n  vertical-align: middle;\n  background-color: white;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-bottom: 4px;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: stretch;\n  align-items: stretch;\n}\n.igv-roi-menu-row-edit-description > label {\n  margin-left: 2px;\n  margin-bottom: 0;\n  display: block;\n  width: -webkit-fill-available;\n}\n.igv-roi-menu-row-edit-description > input {\n  display: block;\n  margin-left: 2px;\n  margin-right: 2px;\n  margin-bottom: 1px;\n  width: -webkit-fill-available;\n}\n\n.igv-container {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n  padding-top: 4px;\n  user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n}\n\n.igv-viewport {\n  position: relative;\n  margin-top: 5px;\n  line-height: 1;\n  overflow-x: hidden;\n  overflow-y: hidden;\n}\n\n.igv-viewport-content {\n  position: relative;\n  width: 100%;\n}\n.igv-viewport-content > canvas {\n  position: relative;\n  display: block;\n}\n\n.igv-column-container {\n  position: relative;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n  width: 100%;\n}\n\n.igv-column-shim {\n  width: 1px;\n  margin-left: 2px;\n  margin-right: 2px;\n  background-color: #545453;\n}\n\n.igv-column {\n  position: relative;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n  box-sizing: border-box;\n  height: 100%;\n}\n\n.igv-axis-column {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n  box-sizing: border-box;\n  height: 100%;\n  width: 50px;\n}\n.igv-axis-column > div {\n  margin-top: 5px;\n  width: 100%;\n}\n\n.igv-sample-name-column {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n  box-sizing: border-box;\n  height: 100%;\n}\n\n.igv-scrollbar-column {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n  box-sizing: border-box;\n  height: 100%;\n  width: 14px;\n}\n.igv-scrollbar-column > div {\n  position: relative;\n  margin-top: 5px;\n  width: 14px;\n}\n.igv-scrollbar-column > div > div {\n  cursor: pointer;\n  position: absolute;\n  top: 0;\n  left: 2px;\n  width: 8px;\n  border-width: 1px;\n  border-style: solid;\n  border-color: #c4c4c4;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n}\n.igv-scrollbar-column > div > div:hover {\n  background-color: #c4c4c4;\n}\n\n.igv-track-drag-column {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n  box-sizing: border-box;\n  height: 100%;\n  width: 12px;\n  background-color: white;\n}\n.igv-track-drag-column > .igv-track-drag-handle {\n  z-index: 512;\n  position: relative;\n  cursor: pointer;\n  margin-top: 5px;\n  width: 100%;\n  border-style: solid;\n  border-width: 0;\n  border-top-right-radius: 6px;\n  border-bottom-right-radius: 6px;\n  background-color: #c4c4c4;\n}\n.igv-track-drag-column .igv-track-drag-handle-hover {\n  background-color: #787878;\n}\n.igv-track-drag-column > .igv-track-drag-shim {\n  position: relative;\n  margin-top: 5px;\n  width: 100%;\n  border-style: solid;\n  border-width: 0;\n}\n\n.igv-gear-menu-column {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n  box-sizing: border-box;\n  height: 100%;\n  width: 28px;\n}\n.igv-gear-menu-column > div {\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  margin-top: 5px;\n  width: 100%;\n  background: white;\n}\n.igv-gear-menu-column > div > div {\n  position: relative;\n  margin-top: 4px;\n  width: 16px;\n  height: 16px;\n  color: #7F7F7F;\n}\n.igv-gear-menu-column > div > div:hover {\n  cursor: pointer;\n  color: #444;\n}\n\n/*# sourceMappingURL=dom.css.map */\n';var K=document.createElement("style");K.setAttribute("type","text/css");K.innerHTML=z;document.head.append(K)}const Sp=Wo.setApiKey;embedCSS();function setGoogleOauthToken(z){return Wo.setOauthToken(z)}function setOauthToken(z,K){return Wo.setOauthToken(z,K)}const Ap=Wo.oauth;var Tp={TrackUtils:na,IGVGraphics:Jo,MenuUtils:gn,DataRangeDialog:DataRangeDialog,createTrack:createTrack,createBrowser:createBrowser,removeBrowser:removeBrowser,removeAllBrowsers:removeAllBrowsers,visibilityChange:visibilityChange,setGoogleOauthToken:setGoogleOauthToken,setOauthToken:setOauthToken,oauth:Ap,version:version,setApiKey:Sp,registerFileFormats:registerFileFormats};return Tp}));

